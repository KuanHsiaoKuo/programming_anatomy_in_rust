<!DOCTYPE HTML>
<html lang="cn" class="sidebar-visible no-js rust">
<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>系统IO模型 - Programming Anatomy In Rust</title>
    <!-- Custom HTML head -->
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="以rust为例分享学习编程常考虑的方方面面">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff"/>

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
    <link rel="stylesheet" href="../../css/variables.css">
    <link rel="stylesheet" href="../../css/general.css">
    <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
    <!-- Fonts -->
    <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="../../highlight.css">
    <link rel="stylesheet" href="../../tomorrow-night.css">
    <link rel="stylesheet" href="../../ayu-highlight.css">

    <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../style.css">
        <link rel="stylesheet" href="../../././assets/css/mdbook-admonish.css">
        <!-- MathJax -->
        <script async type="text/javascript"
                src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<!-- Provide site root to javascript -->
<script type="text/javascript">
    var path_to_root = "../../";
    var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
</script>

<!-- Work around some values being stored in localStorage wrapped in quotes -->
<script type="text/javascript">
    try {
        var theme = localStorage.getItem('mdbook-theme');
        var sidebar = localStorage.getItem('mdbook-sidebar');

        if (theme.startsWith('"') && theme.endsWith('"')) {
            localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
        }

        if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
            localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
        }
    } catch (e) {
    }
</script>

<!-- Set the theme before any content is loaded, prevents flash -->
<script type="text/javascript">
    var theme;
    try {
        theme = localStorage.getItem('mdbook-theme');
    } catch (e) {
    }
    if (theme === null || theme === undefined) {
        theme = default_theme;
    }
    var html = document.querySelector('html');
    html.classList.remove('no-js')
    html.classList.remove('rust')
    html.classList.add(theme);
    html.classList.add('js');
</script>

<!-- Hide / unhide sidebar before it is displayed -->
<script type="text/javascript">
    var html = document.querySelector('html');
    var sidebar = 'hidden';
    if (document.body.clientWidth >= 1080) {
        try {
            sidebar = localStorage.getItem('mdbook-sidebar');
        } catch (e) {
        }
        sidebar = sidebar || 'visible';
    }
    html.classList.remove('sidebar-visible');
    html.classList.add("sidebar-" + sidebar);
</script>

<nav id="sidebar" class="sidebar" aria-label="Table of contents">
    <div class="sidebar-scrollbox">
        <ol class="chapter"><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/layer1_underlying_abstract.html"><strong aria-hidden="true">1.</strong> Layer1: 底层抽象</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/1_virtual_memory/virtual_memory.html"><strong aria-hidden="true">1.1.</strong> 虚拟内存管理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/1_virtual_memory/memory_manage_safety.html"><strong aria-hidden="true">1.1.1.</strong> 内存管理与内存安全</a></li><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html"><strong aria-hidden="true">1.1.2.</strong> 所有权三件套</a></li></ol></li><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/2_type_system/type_system.html"><strong aria-hidden="true">1.2.</strong> 类型系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/2_type_system/primitive_types.html"><strong aria-hidden="true">1.2.1.</strong> 基础内置类型</a></li><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/2_type_system/collections.html"><strong aria-hidden="true">1.2.2.</strong> 集合类型</a></li><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/2_type_system/user_defined_types.html"><strong aria-hidden="true">1.2.3.</strong> 自定义类型</a></li><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/2_type_system/generics_traits_objects.html"><strong aria-hidden="true">1.2.4.</strong> 泛型、特征及特征对象</a></li></ol></li><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/3_language_grammar/language_grammar.html"><strong aria-hidden="true">1.3.</strong> 语言语法</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/3_language_grammar/keywords_glossary.html"><strong aria-hidden="true">1.3.1.</strong> 词法结构扫盲</a></li><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/3_language_grammar/binding_match.html"><strong aria-hidden="true">1.3.2.</strong> 绑定、赋值与匹配</a></li><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/3_language_grammar/logical_decision_loops.html"><strong aria-hidden="true">1.3.3.</strong> 逻辑判断与循环♻️</a></li><li class="chapter-item expanded "><a href="../../layer1_underlying_abstract/3_language_grammar/statements_expressions.html"><strong aria-hidden="true">1.3.4.</strong> 语句与表达式</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../layer2_design_abstract/layer2_design_abstract.html"><strong aria-hidden="true">2.</strong> Layer2: 设计抽象</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer2_design_abstract/4_programming_paradigm/4_programming_paradigm.html"><strong aria-hidden="true">2.1.</strong> 编程范式</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer2_design_abstract/4_programming_paradigm/fp.html"><strong aria-hidden="true">2.1.1.</strong> 函数式编程</a></li><li class="chapter-item expanded "><a href="../../layer2_design_abstract/4_programming_paradigm/oop.html"><strong aria-hidden="true">2.1.2.</strong> 面向对象编程</a></li><li class="chapter-item expanded "><a href="../../layer2_design_abstract/4_programming_paradigm/gp.html"><strong aria-hidden="true">2.1.3.</strong> 泛型编程</a></li></ol></li><li class="chapter-item expanded "><a href="../../layer2_design_abstract/5_design_pattern/5_design_pattern.html"><strong aria-hidden="true">2.2.</strong> 设计模式</a></li><li class="chapter-item expanded "><a href="../../layer2_design_abstract/6_module_manage/6_module_manage.html"><strong aria-hidden="true">2.3.</strong> 模块管理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer2_design_abstract/6_module_manage/module_relate.html"><strong aria-hidden="true">2.3.1.</strong> 模块使用</a></li><li class="chapter-item expanded "><a href="../../layer2_design_abstract/6_module_manage/cargo_project_lifetime.html"><strong aria-hidden="true">2.3.2.</strong> Cargo与项目生命周期</a></li><li class="chapter-item expanded "><a href="../../layer2_design_abstract/6_module_manage/rust_plugins.html"><strong aria-hidden="true">2.3.3.</strong> Rust扩展工具</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../layer3_task_abstract/layer3_task_abstract.html"><strong aria-hidden="true">3.</strong> Layer3: 任务抽象</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer3_task_abstract/7_concurrency/7_concurrency.html"><strong aria-hidden="true">3.1.</strong> 并发编程</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer3_task_abstract/7_concurrency/io_models.html" class="active"><strong aria-hidden="true">3.1.1.</strong> 系统IO模型</a></li><li class="chapter-item expanded "><a href="../../layer3_task_abstract/7_concurrency/1_multi_models/multi_models.html"><strong aria-hidden="true">3.1.2.</strong> 多线程模型</a></li><li class="chapter-item expanded "><a href="../../layer3_task_abstract/7_concurrency/2_async_models/async_models.html"><strong aria-hidden="true">3.1.3.</strong> 异步模型</a></li></ol></li><li class="chapter-item expanded "><a href="../../layer3_task_abstract/8_meta_programming/8_meta_programming.html"><strong aria-hidden="true">3.2.</strong> 元编程</a></li></ol></li><li class="chapter-item expanded "><a href="../../layer4_protocol_abstract/layer4_protocol_abstract.html"><strong aria-hidden="true">4.</strong> Layer4: 协议抽象</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer4_protocol_abstract/9_multilingual_programming/9_multilingual_programming.html"><strong aria-hidden="true">4.1.</strong> 跨语言编程</a></li><li class="chapter-item expanded "><a href="../../layer4_protocol_abstract/10_computer_network/10_computer_network.html"><strong aria-hidden="true">4.2.</strong> 计算机网络</a></li></ol></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/layer5_ecosystem.html"><strong aria-hidden="true">5.</strong> Layer5: 生态环境</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer5_ecosystem/1_learning_resource/learning_resource.html"><strong aria-hidden="true">5.1.</strong> 学习资源</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer5_ecosystem/1_learning_resource/1_books/books.html"><strong aria-hidden="true">5.1.1.</strong> 书籍整理</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/1_learning_resource/2_courses/courses.html"><strong aria-hidden="true">5.1.2.</strong> 线上课程</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/1_learning_resource/3_blogs/blogs.html"><strong aria-hidden="true">5.1.3.</strong> 博客文章</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/1_learning_resource/4_videos/videos.html"><strong aria-hidden="true">5.1.4.</strong> 在线视频</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/1_learning_resource/5_projects/projects.html"><strong aria-hidden="true">5.1.5.</strong> 开源项目</a></li></ol></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/2_lang_update/lang_update.html"><strong aria-hidden="true">5.2.</strong> 官方动态</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/3_community/community.html"><strong aria-hidden="true">5.3.</strong> 社区热点</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/4_academic/academic.html"><strong aria-hidden="true">5.4.</strong> 学术讨论</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/open_source.html"><strong aria-hidden="true">5.5.</strong> 开源观察</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/1_underlying/underlying.html"><strong aria-hidden="true">5.5.1.</strong> 底层开发</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/1_underlying/command/command.html"><strong aria-hidden="true">5.5.1.1.</strong> 命令行工具</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/1_underlying/data/data.html"><strong aria-hidden="true">5.5.1.2.</strong> 数据处理</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/1_underlying/embedded/embedded.html"><strong aria-hidden="true">5.5.1.3.</strong> 嵌入式</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/1_underlying/os/os.html"><strong aria-hidden="true">5.5.1.4.</strong> 系统开发</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/1_underlying/performance/performance.html"><strong aria-hidden="true">5.5.1.5.</strong> 性能工具</a></li></ol></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/2_network/network.html"><strong aria-hidden="true">5.5.2.</strong> 网络相关</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/2_network/cloud/cloud.html"><strong aria-hidden="true">5.5.2.1.</strong> 云原生</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/2_network/frontend/frontend.html"><strong aria-hidden="true">5.5.2.2.</strong> 前端基建</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/2_network/network/network.html"><strong aria-hidden="true">5.5.2.3.</strong> 网络基建</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/2_network/web/web.html"><strong aria-hidden="true">5.5.2.4.</strong> web开发</a></li></ol></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/3_media/media.html"><strong aria-hidden="true">5.5.3.</strong> 多媒体</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/3_media/av/av.html"><strong aria-hidden="true">5.5.3.1.</strong> 音视频处理</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/3_media/game/game.html"><strong aria-hidden="true">5.5.3.2.</strong> 游戏开发</a></li></ol></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/4_other/other.html"><strong aria-hidden="true">5.5.4.</strong> 其他</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/4_other/lang-with-rust/lang_with_rust.html"><strong aria-hidden="true">5.5.4.1.</strong> Rust与其他语言</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/4_other/scientific-research/scientific_research.html"><strong aria-hidden="true">5.5.4.2.</strong> 科学艺术研究</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/5_open_source/4_other/tools/tools.html"><strong aria-hidden="true">5.5.4.3.</strong> 其他工具</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/6_security/security.html"><strong aria-hidden="true">5.6.</strong> 安全参考</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/7_business/business.html"><strong aria-hidden="true">5.7.</strong> 商业观察</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layer5_ecosystem/7_business/blockchain/blockchain.html"><strong aria-hidden="true">5.7.1.</strong> 区块链</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/7_business/practices/practices.html"><strong aria-hidden="true">5.7.2.</strong> 生产实践</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/7_business/products/products.html"><strong aria-hidden="true">5.7.3.</strong> 优秀产品</a></li></ol></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/8_libs/libs.html"><strong aria-hidden="true">5.8.</strong> 基础库</a></li><li class="chapter-item expanded "><a href="../../layer5_ecosystem/9_frameworks/frameworks.html"><strong aria-hidden="true">5.9.</strong> 框架引擎</a></li></ol></li><li class="chapter-item expanded "><a href="../../checklist.html">Checklist</a></li></ol>
    </div>
    <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
</nav>

<div id="page-wrapper" class="page-wrapper">

    <div class="page">
        <div id="menu-bar-hover-placeholder"></div>
        <div id="menu-bar" class="menu-bar sticky bordered">
            <div class="left-buttons">
                <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                    <i class="fa fa-bars"></i>
                </button>
                <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                    <i class="fa fa-paint-brush"></i>
                </button>
                <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                    <li role="none">
                        <button role="menuitem" class="theme" id="light">Light</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="rust">Rust (default)</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="coal">Coal</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="navy">Navy</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="ayu">Ayu</button>
                    </li>
                </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                            aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                            aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
            </div>

            <h1 class="menu-title">Programming Anatomy In Rust</h1>
            <h4 class="menu-bar"> -- 练武不练功 到头一场空 -- 《赛博英雄传》 </h4>
            <div class="right-buttons">
                    <a href="../../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/KuanHsiaoKuo/programming_anatomy_in_rust.git" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-rust"></i>
                    </a>
            </div>
        </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" name="search" id="searchbar" name="searchbar"
                           placeholder="Search this book ..." aria-controls="searchresults-outer"
                           aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>
        <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
        <script type="text/javascript">
            document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
            document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
            Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
            });
        </script>

        <div id="content" class="content">
            <main>

                <!-- Page table of contents -->
                <div class="sidetoc">
                    <nav class="pagetoc"></nav>
                </div>
                <h1 id="从io模型开始"><a class="header" href="#从io模型开始">从IO模型开始</a></h1>
<!--ts-->
<ul>
<li><a href="#%E4%BB%8Eio%E6%A8%A1%E5%9E%8B%E5%BC%80%E5%A7%8B">从IO模型开始</a>
<ul>
<li><a href="#1-%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%E9%98%BB%E5%A1%9E%E9%9D%9E%E9%98%BB%E5%A1%9E%E6%A6%82%E5%BF%B5%E5%8C%BA%E5%88%AB">1. 同步/异步、阻塞/非阻塞概念区别</a>
<ul>
<li><a href="#%E5%90%8C%E6%AD%A5%E5%92%8C%E5%BC%82%E6%AD%A5%E5%85%B3%E6%B3%A8%E7%9A%84%E6%98%AF%E6%B6%88%E6%81%AF%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E8%B0%83%E7%94%A8%E8%80%85%E8%A7%86%E8%A7%92">同步和异步，关注的是消息通信机制。（调用者视角）</a></li>
<li><a href="#%E9%98%BB%E5%A1%9E%E5%92%8C%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%85%B3%E6%B3%A8%E7%9A%84%E6%98%AF%E7%A8%8B%E5%BA%8F%E7%AD%89%E5%BE%85%E8%B0%83%E7%94%A8%E7%BB%93%E6%9E%9C%E7%9A%84%E7%8A%B6%E6%80%81%E8%A2%AB%E8%B0%83%E7%94%A8%E8%80%85%E8%A7%86%E8%A7%92">阻塞和非阻塞，关注的是程序等待调用结果的状态。（被调用者视角）</a></li>
<li><a href="#%E9%98%BB%E5%A1%9E%E4%B8%8E%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E6%9C%89%E5%85%B3">阻塞，与系统调用有关。</a></li>
</ul>
</li>
<li><a href="#2-%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5io-%E6%A8%A1%E5%9E%8B%E5%88%86%E7%B1%BB">2. 同步/异步IO 模型分类</a></li>
<li><a href="#3-%E5%90%8C%E6%AD%A5%E9%98%BB%E5%A1%9Eio-blocking-io">3. 同步阻塞I/O (blocking I/O)</a></li>
<li><a href="#4-io-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8io-multiplexing-">4. I/O 多路复用（I/O Multiplexing )</a></li>
<li><a href="#5-epoll-%E5%90%8C%E6%AD%A5%E9%98%BB%E5%A1%9E%E9%9D%9E%E9%98%BB%E5%A1%9E%E6%A8%A1%E5%9E%8B">5. epoll: 同步阻塞/非阻塞模型</a>
<ul>
<li><a href="#epoll%E4%B8%89%E4%B8%AA%E5%87%BD%E6%95%B0">epoll三个函数</a></li>
<li><a href="#epoll-%E4%B8%A4%E7%A7%8D%E8%A7%A6%E5%8F%91%E6%9C%BA%E5%88%B6">epoll 两种触发机制：</a></li>
<li><a href="#%E6%83%8A%E7%BE%A4%E9%97%AE%E9%A2%98">惊群问题：</a></li>
</ul>
</li>
<li><a href="#6-%E5%BC%82%E6%AD%A5-io-%E6%A8%A1%E5%9E%8B-io_uring">6. 异步 I/O 模型: io_uring</a>
<ul>
<li><a href="#1-reactor%E5%8F%8D%E5%BA%94%E5%99%A8-%E6%A8%A1%E5%BC%8F">1. Reactor（反应器） 模式</a></li>
<li><a href="#2-preactor%E4%B8%BB%E5%8A%A8%E5%99%A8-%E6%A8%A1%E5%BC%8F">2. Preactor（主动器） 模式</a></li>
<li><a href="#reactor-model">Reactor Model:</a>
<ul>
<li><a href="#%E4%B8%89%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F">三种实现方式：</a></li>
<li><a href="#%E8%AF%BB%E5%86%99%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B">读写操作流程：</a></li>
<li><a href="#%E5%8F%82%E4%B8%8E%E8%80%85">参与者：</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a></li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Wed Jun 15 08:35:12 UTC 2022 -->
<!--te-->
<h2 id="1-同步异步阻塞非阻塞概念区别"><a class="header" href="#1-同步异步阻塞非阻塞概念区别">1. 同步/异步、阻塞/非阻塞概念区别</a></h2>
<h3 id="同步和异步关注的是消息通信机制调用者视角"><a class="header" href="#同步和异步关注的是消息通信机制调用者视角">同步和异步，关注的是消息通信机制。（调用者视角）</a></h3>
<ul>
<li>同步，发出一个调用，在没有得到结果之前不返回。</li>
<li>异步，发出一个调用，在没有得到结果之前返回。</li>
</ul>
<h3 id="阻塞和非阻塞关注的是程序等待调用结果的状态被调用者视角"><a class="header" href="#阻塞和非阻塞关注的是程序等待调用结果的状态被调用者视角">阻塞和非阻塞，关注的是程序等待调用结果的状态。（被调用者视角）</a></h3>
<ul>
<li>阻塞，在调用结果返回之前，线程被挂起。</li>
<li>非阻塞，在调用结果返回之前，线程不会被挂起。</li>
</ul>
<h3 id="阻塞与系统调用有关"><a class="header" href="#阻塞与系统调用有关">阻塞，与系统调用有关。</a></h3>
<h2 id="2-同步异步io-模型分类"><a class="header" href="#2-同步异步io-模型分类">2. 同步/异步IO 模型分类</a></h2>
<pre><code class="language-text">                                 +-+ 阻 塞 I/O (BIO)
                                 |
                                 +-+ 非 阻 塞 I/O (NIO)
                                 |
              +----+ 同 步 I/O +--+
              |                  |
              |                  +-+ I/O 多 路 复 用
              |                  |
              |                  +-+ 信 号 驱 动 I/O
I/O 模 型  +---+
              |
              |
              |                  +-+ Linux (AIO)
              |                  |         (io_uring)
              +----+ 异 步 I/O +--+
                                 |
                                 +-+ windows (IOCP)

</code></pre>
<h2 id="3-同步阻塞io-blocking-io"><a class="header" href="#3-同步阻塞io-blocking-io">3. 同步阻塞I/O (blocking I/O)</a></h2>
<pre><code class="language-text">Application               kernel
+---------+            +-----------+  +---+
|         |   syscall  | no        |      |
|   Read  | +--------&gt; | datagram  |      |
| recvfrom|            | ready     |      |
|         |            |    +      |      +-+ wait for
|         |            |    |      |      +-+ data
|         |            |    v      |      |
|         |            | datagram  |      |
|         |            | ready     |  +---+
|         |            |           |
|         |            | copy      |  +---+
|         |            | datagram  |      |
|process  |            |    +      |      +-+ copy data
|datagram |   return   |    |      |      +-+ from kernel to user
|         | &lt;--------+ |    v      |      |
|         |            |  copy     |  +---+
|         |            |  complete |
+---------+            +-----------+
</code></pre>
<blockquote>
<p>输入操作两个阶段：</p>
</blockquote>
<ol>
<li>进程等待内核把数据准备好；这个阶段可以阻塞也可非阻塞，设置socket属性。
<ul>
<li>阻塞： recvfrom 阻塞线程直到返回数据就绪的结果。</li>
<li>非阻塞：立即返回一个错误，轮询直到数据就绪。</li>
</ul>
</li>
<li>从内核缓冲区向进程缓冲区复制数据。（一直阻塞）</li>
</ol>
<p>异步I/O，recvfrom总是立即返回，两个阶段都由内核完成。</p>
<h2 id="4-io-多路复用io-multiplexing-"><a class="header" href="#4-io-多路复用io-multiplexing-">4. I/O 多路复用（I/O Multiplexing )</a></h2>
<p>IO多路复用是一种同步IO模型，实现一个线程可以监视多个文件句柄。</p>
<p>支持I/O多路复用的系统调用有 select/pselect/poll/epoll，本质都是同步I/O，因为数据拷贝都是阻塞的。
通过 select/epoll 来判断数据报是否准备好，即判断可读可写状态。</p>
<h2 id="5-epoll-同步阻塞非阻塞模型"><a class="header" href="#5-epoll-同步阻塞非阻塞模型">5. epoll: 同步阻塞/非阻塞模型</a></h2>
<pre><code class="language-text">                        +--------------------------------+     +-------------------------+
                        | epoll_ctl                      |     | epoll_wait              |
                        |                                |     |                         |
                        |                                |     |         +----+          |
                        |                 +---+          |     |         |    |          |
                        |                 |   |          |     |         |    |          |
                        |               +-+---+--+       |     |         +--+-+          |
                        |               |        |       |     |            |            |
                        |            +--++     +-++      |     |            |            |
epoll_create  +----&gt;    |            |   |     |  |      |     |         +--+-+          |
                        |            +-+-+     +--+      +----&gt;+         |    |          |
                        |              |                 |event|         |    |          |
                        |         +----+--+              |     |         +--+-+          |
                        |         |       |              |     |            |            |
                        |         ++      |              |     |            |            |
                        |        +--+   +-+-+            |     |         +--+-+          |
                        |        |  |   |   |            |     |         |    |          |
                        |        +--+   +---+            |     |         |    |          |
                        |                                |     |         +----+          |
                        |                    红 黑 树     |     |                 链 表    |
                        +--------------------------------+     +-------------------------+


</code></pre>
<h3 id="epoll三个函数"><a class="header" href="#epoll三个函数">epoll三个函数</a></h3>
<ul>
<li>epoll_create(int size) : 内核产生一个epoll实例数据结构，并返回一个epfd</li>
<li>epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)：将被监听的描述符添加到红黑树或从红黑树中删除或者对监听事件进行修改。</li>
<li>epoll_wait(int epfd, struct epoll_event *events, int maxevents, int timeout): 阻塞等待注册的事件发生，返回事件的数目，并将触发的事件写入events数组中</li>
</ul>
<h3 id="epoll-两种触发机制"><a class="header" href="#epoll-两种触发机制">epoll 两种触发机制：</a></h3>
<ul>
<li>水平触发机制（LT)。缓冲区只要有数据就触发读写。epoll 默认工作方式。select/poll只支持该方式。</li>
<li>边缘触发机制（ET)。缓冲区空或满的状态才触发读写。nginx 使用该方式，避免频繁读写。</li>
</ul>
<h3 id="惊群问题"><a class="header" href="#惊群问题">惊群问题：</a></h3>
<p>当多个进程/线程调用epoll_wait时会阻塞等待，当内核触发可读写事件，所有进程/线程都会进行响应，但是实际上只有一个进程/线程真实处理这些事件。
Liux 4.5 通过引入 EPOLLEXCLUSIVE 标识来保证一个事件发生时候只有一个线程会被唤醒，以避免多侦听下的惊群问题。</p>
<h2 id="6-异步-io-模型-io_uring"><a class="header" href="#6-异步-io-模型-io_uring">6. 异步 I/O 模型: io_uring</a></h2>
<p>Linux AIO 实现的并不理想，所以引入了新的异步I/O接口 io_uring。</p>
<pre><code class="language-text">+----+ Head  +---------+               +----------+ Head
|            |         |               |          |
|            |         |               |          |
|            +---------+               +----------+
|            |         |               |          |
|            |         |               |          |
|            +---------+               +----------+
|            |         |               |          |
|            |         |               |          |
|            +---------+               +----------+
|            |         |               |          |
|      Tail  +---------+               +----------+ Tail &lt;--+
|        +--------------------------------------------+     |
|        | Kernel                                     |     |
|        |                                            |     |
|        |        +-------+              +-------+    |     |
|        |        |       |              |       |    |     |
+---------------&gt; | SQ    |              |  CQ   | +--------+
         |        |       |              |       |    |
         |        +-------+              +-------+    |
         |                                            |
         +--------------------------------------------+

</code></pre>
<p>io_uring接口通过两个主要数据结构工作：</p>
<ul>
<li>提交队列条目（sqe）</li>
<li>完成队列条目（cqe）</li>
</ul>
<p>这些结构的实例位于内核和应用程序之间的<strong>共享内存</strong>单生产者单消费者环形缓冲区中。</p>
<p>参考：</p>
<p><a href="https://thenewstack.io/how-io_uring-and-ebpf-will-revolutionize-programming-in-linux/">https://thenewstack.io/how-io_uring-and-ebpf-will-revolutionize-programming-in-linux/</a></p>
<p><a href="https://cor3ntin.github.io/posts/iouring/#io_uring">https://cor3ntin.github.io/posts/iouring/#io_uring</a></p>
<blockquote>
<p>因为处理 I/O 复用的编程模型相当复杂，为了简化编程，引入了下面两种模型:</p>
</blockquote>
<h3 id="1-reactor反应器-模式"><a class="header" href="#1-reactor反应器-模式">1. Reactor（反应器） 模式</a></h3>
<p>对应同步I/O，被动的事件分离和分发模型。服务等待请求事件的到来，再通过不受间断的同步处理事件，从而做出反应。</p>
<h3 id="2-preactor主动器-模式"><a class="header" href="#2-preactor主动器-模式">2. Preactor（主动器） 模式</a></h3>
<p>对应异步I/O，主动的事件分离和分发模型。这种设计允许多个任务并发的执行，从而提高吞吐量；并可执行耗时长的任务（各个任务间互不影响）。</p>
<h3 id="reactor-model"><a class="header" href="#reactor-model">Reactor Model:</a></h3>
<pre><code class="language-text">                                                     +----------------+
req                                        Dispatch  |                |
+------+                                  +--------&gt; | req handler    |
|      |                                  |          +----------------+
|      | +----+                           |
+------+      | event    +------------+   |
              |          |            |   |
              +--------&gt; |  Service   |   |Dispatch  +----------------+
                         |  Handler   +------------&gt; |                |
req          +---------&gt; |            |   |          | req handler    |
+------+     |           +------------+   |          +----------------+
|      |     | event                      |
|      +----+                             |
+------+                                  | Dispatch +----------------+
                                          +---------&gt;+                |
                                                     | req handler    |
                                                     +----------------+

</code></pre>
<h4 id="三种实现方式"><a class="header" href="#三种实现方式">三种实现方式：</a></h4>
<ul>
<li>单线程模式。 accept()、read()、write()以及connect()操作 都在同一线程。</li>
<li>工作者线程池模式。非 I/O 操作交给线程池处理</li>
<li>多线程模式。主Reactor (master) ，负责网络监听 ， 子Reactor(worker) 读写网络数据。</li>
</ul>
<h4 id="读写操作流程"><a class="header" href="#读写操作流程">读写操作流程：</a></h4>
<ol>
<li>应用注册读写就绪事件和相关联的事件处理器</li>
<li>事件分离器等待事件发生</li>
<li>当发生读写就绪事件，事件分离器调用已注册的事件处理器</li>
<li>事件处理器执行读写操作</li>
</ol>
<h4 id="参与者"><a class="header" href="#参与者">参与者：</a></h4>
<ol>
<li>描述符（handle）：操作系统提供的资源，识别 socket等。</li>
<li>同步事件多路分离器。开启事件循环，等待事件的发生。封装了 多路复用函数 select/poll/epoll等。</li>
<li>事件处理器。提供回调函数，用于描述与应用程序相关的某个事件的操作。</li>
<li>具体的事件处理器。事件处理器接口的具体实现。使用描述符来识别事件和程序提供的服务。</li>
<li>Reactor 管理器。事件处理器的调度核心。分离每个事件，调度事件管理器，调用具体的函数处理某个事件。</li>
</ol>
<h2 id="参考资源"><a class="header" href="#参考资源">参考资源</a></h2>
<ul>
<li><a href="https://time.geekbang.org/course/detail/100060601-365835">88. IO模型</a></li>
<li><a href="https://time.geekbang.org/course/detail/100060601-365838">89. epoll和io_uring</a></li>
<li><a href="https://time.geekbang.org/course/detail/100060601-367808">90. 事件驱动编程模型</a></li>
</ul>

            </main>

            <script src="https://utteranc.es/client.js"
                    repo="RustMagazine/rust_magazine_2022"
                    issue-term="title"
                    theme="github-light"
                    crossorigin="anonymous"
                    async></script>

            <nav class="nav-wrapper" aria-label="Page navigation">
                <!-- Mobile navigation buttons -->
                    <a rel="prev" href="../../layer3_task_abstract/7_concurrency/7_concurrency.html" class="mobile-nav-chapters previous"
                       title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../layer3_task_abstract/7_concurrency/1_multi_models/multi_models.html" class="mobile-nav-chapters next"
                       title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                <div style="clear: both"></div>
            </nav>
        </div>
    </div>

    <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="../../layer3_task_abstract/7_concurrency/7_concurrency.html" class="nav-chapters previous" title="Previous chapter"
               aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>
            <a rel="next" href="../../layer3_task_abstract/7_concurrency/1_multi_models/multi_models.html" class="nav-chapters next" title="Next chapter"
               aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
    </nav>

</div>

    <script type="text/javascript">
        window.playground_copyable = true;
    </script>
    <script src="../../ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
<script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
<script src="../../book.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JS scripts -->
    <script type="text/javascript" src="../../mermaid.min.js"></script>
    <script type="text/javascript" src="../../mermaid-init.js"></script>
    <script type="text/javascript" src="../../smart-anchor.js"></script>
    <script type="text/javascript" src="../../sidebar.js"></script>
</body>
</html>
