<!DOCTYPE HTML>
<html lang="cn" class="sidebar-visible no-js rust">
<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Programming Anatomy In Rust 🦀</title>
        <meta name="robots" content="noindex"/>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="以rust为例分享学习编程常考虑的方方面面">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff"/>

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="assets/pagetoc/pagetoc_style.css">
        <link rel="stylesheet" href="assets/css/mdbook-admonish.css">

        <!-- MathJax -->
        <script async type="text/javascript"
                src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<!-- Provide site root to javascript -->
<script type="text/javascript">
    var path_to_root = "";
    var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
</script>

<!-- Work around some values being stored in localStorage wrapped in quotes -->
<script type="text/javascript">
    try {
        var theme = localStorage.getItem('mdbook-theme');
        var sidebar = localStorage.getItem('mdbook-sidebar');

        if (theme.startsWith('"') && theme.endsWith('"')) {
            localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
        }

        if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
            localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
        }
    } catch (e) {
    }
</script>

<!-- Set the theme before any content is loaded, prevents flash -->
<script type="text/javascript">
    var theme;
    try {
        theme = localStorage.getItem('mdbook-theme');
    } catch (e) {
    }
    if (theme === null || theme === undefined) {
        theme = default_theme;
    }
    var html = document.querySelector('html');
    html.classList.remove('no-js')
    html.classList.remove('rust')
    html.classList.add(theme);
    html.classList.add('js');
</script>

<!-- Hide / unhide sidebar before it is displayed -->
<script type="text/javascript">
    var html = document.querySelector('html');
    var sidebar = 'hidden';
    if (document.body.clientWidth >= 1080) {
        try {
            sidebar = localStorage.getItem('mdbook-sidebar');
        } catch (e) {
        }
        sidebar = sidebar || 'visible';
    }
    html.classList.remove('sidebar-visible');
    html.classList.add("sidebar-" + sidebar);
</script>

<nav id="sidebar" class="sidebar" aria-label="Table of contents">
    <div class="sidebar-scrollbox">
        <ol class="chapter"><li class="chapter-item expanded "><a href="overview.html"><strong aria-hidden="true">1.</strong> 总览</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html"><strong aria-hidden="true">1.1.</strong> Substrate介绍与解析</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/1_learning_resource/talks.html"><strong aria-hidden="true">1.2.</strong> Rust话题</a></li></ol></li><li class="chapter-item expanded "><a href="layer1_underlying_abstract/layer1_underlying_abstract.html"><strong aria-hidden="true">2.</strong> Layer1: 底层抽象</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer1_underlying_abstract/1_virtual_memory/virtual_memory.html"><strong aria-hidden="true">2.1.</strong> 虚拟内存管理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer1_underlying_abstract/1_virtual_memory/memory_manage_safety.html"><strong aria-hidden="true">2.1.1.</strong> 内存管理与内存安全</a></li><li class="chapter-item expanded "><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html"><strong aria-hidden="true">2.1.2.</strong> 所有权三件套</a></li></ol></li><li class="chapter-item expanded "><a href="layer1_underlying_abstract/2_type_system/type_system.html"><strong aria-hidden="true">2.2.</strong> 类型系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer1_underlying_abstract/2_type_system/built_in_types.html"><strong aria-hidden="true">2.2.1.</strong> 基础内置类型</a></li><li class="chapter-item expanded "><a href="layer1_underlying_abstract/2_type_system/collections.html"><strong aria-hidden="true">2.2.2.</strong> 集合类型</a></li><li class="chapter-item expanded "><a href="layer1_underlying_abstract/2_type_system/user_defined_types.html"><strong aria-hidden="true">2.2.3.</strong> 自定义类型</a></li><li class="chapter-item expanded "><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html"><strong aria-hidden="true">2.2.4.</strong> 泛型、特征及特征对象</a></li></ol></li><li class="chapter-item expanded "><a href="layer1_underlying_abstract/3_language_grammar/language_grammar.html"><strong aria-hidden="true">2.3.</strong> 语言语法</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer1_underlying_abstract/3_language_grammar/annotation_rustdoc.html"><strong aria-hidden="true">2.3.1.</strong> 注释与文档(rustdoc)</a></li><li class="chapter-item expanded "><a href="layer1_underlying_abstract/3_language_grammar/keywords_glossary.html"><strong aria-hidden="true">2.3.2.</strong> 词法结构扫盲</a></li><li class="chapter-item expanded "><a href="layer1_underlying_abstract/3_language_grammar/binding_match_patterns.html"><strong aria-hidden="true">2.3.3.</strong> 绑定、赋值与匹配</a></li><li class="chapter-item expanded "><a href="layer1_underlying_abstract/3_language_grammar/logical_decision_loops.html"><strong aria-hidden="true">2.3.4.</strong> 逻辑判断与循环♻️</a></li><li class="chapter-item expanded "><a href="layer1_underlying_abstract/3_language_grammar/statements_expressions.html"><strong aria-hidden="true">2.3.5.</strong> 语句与表达式</a></li><li class="chapter-item expanded "><a href="layer1_underlying_abstract/3_language_grammar/code_quality.html"><strong aria-hidden="true">2.3.6.</strong> 代码质量</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="layer2_design_abstract/layer2_design_abstract.html"><strong aria-hidden="true">3.</strong> Layer2: 设计抽象</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer2_design_abstract/4_programming_paradigm/4_programming_paradigm.html"><strong aria-hidden="true">3.1.</strong> 编程范式</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer2_design_abstract/4_programming_paradigm/fp.html"><strong aria-hidden="true">3.1.1.</strong> 函数式编程</a></li><li class="chapter-item expanded "><a href="layer2_design_abstract/4_programming_paradigm/oop.html"><strong aria-hidden="true">3.1.2.</strong> 面向对象编程</a></li><li class="chapter-item expanded "><a href="layer2_design_abstract/4_programming_paradigm/gp.html"><strong aria-hidden="true">3.1.3.</strong> 泛型编程</a></li></ol></li><li class="chapter-item expanded "><a href="layer2_design_abstract/5_design_pattern/5_design_pattern.html"><strong aria-hidden="true">3.2.</strong> 设计模式</a></li><li class="chapter-item expanded "><a href="layer2_design_abstract/6_module_manage/6_module_manage.html"><strong aria-hidden="true">3.3.</strong> 模块管理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer2_design_abstract/6_module_manage/module_system.html"><strong aria-hidden="true">3.3.1.</strong> 模块系统</a></li><li class="chapter-item expanded "><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html"><strong aria-hidden="true">3.3.2.</strong> Cargo与项目生命周期</a></li><li class="chapter-item expanded "><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html"><strong aria-hidden="true">3.3.3.</strong> Cargo run: rustc</a></li><li class="chapter-item expanded "><a href="layer2_design_abstract/6_module_manage/rust_plugins.html"><strong aria-hidden="true">3.3.4.</strong> Rust扩展工具</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="layer3_task_abstract/layer3_task_abstract.html"><strong aria-hidden="true">4.</strong> Layer3: 任务抽象</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer3_task_abstract/7_concurrency/7_concurrency.html"><strong aria-hidden="true">4.1.</strong> 并发编程</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer3_task_abstract/7_concurrency/io_models.html"><strong aria-hidden="true">4.1.1.</strong> 系统IO模型</a></li><li class="chapter-item expanded "><a href="layer3_task_abstract/7_concurrency/1_multi_models/multi_models.html"><strong aria-hidden="true">4.1.2.</strong> 多线程模型</a></li><li class="chapter-item expanded "><a href="layer3_task_abstract/7_concurrency/2_async_models/async_models.html"><strong aria-hidden="true">4.1.3.</strong> 异步模型</a></li></ol></li><li class="chapter-item expanded "><a href="layer3_task_abstract/8_meta_programming/8_meta_programming.html"><strong aria-hidden="true">4.2.</strong> 元编程</a></li></ol></li><li class="chapter-item expanded "><a href="layer4_protocol_abstract/layer4_protocol_abstract.html"><strong aria-hidden="true">5.</strong> Layer4: 协议抽象</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer4_protocol_abstract/9_multilingual_programming/9_multilingual_programming.html"><strong aria-hidden="true">5.1.</strong> 跨语言编程</a></li><li class="chapter-item expanded "><a href="layer4_protocol_abstract/10_computer_network/10_computer_network.html"><strong aria-hidden="true">5.2.</strong> 计算机网络</a></li></ol></li><li class="chapter-item expanded "><a href="layer5_ecosystem/layer5_ecosystem.html"><strong aria-hidden="true">6.</strong> Layer5: 生态环境</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/1_learning_resource/learning_resource.html"><strong aria-hidden="true">6.1.</strong> 学习资源</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/1_learning_resource/1_books/books.html"><strong aria-hidden="true">6.1.1.</strong> 书籍整理</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/1_learning_resource/2_courses/courses.html"><strong aria-hidden="true">6.1.2.</strong> 线上课程</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/1_learning_resource/3_blogs/blogs.html"><strong aria-hidden="true">6.1.3.</strong> 博客文章</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/1_learning_resource/4_videos/videos.html"><strong aria-hidden="true">6.1.4.</strong> 在线视频</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/1_learning_resource/5_projects/projects.html"><strong aria-hidden="true">6.1.5.</strong> 开源项目</a></li></ol></li><li class="chapter-item expanded "><a href="layer5_ecosystem/2_lang_update/lang_update.html"><strong aria-hidden="true">6.2.</strong> 官方动态</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/3_community/community.html"><strong aria-hidden="true">6.3.</strong> 社区热点</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/4_academic/academic.html"><strong aria-hidden="true">6.4.</strong> 学术讨论</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/open_source.html"><strong aria-hidden="true">6.5.</strong> 开源观察</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/1_underlying/underlying.html"><strong aria-hidden="true">6.5.1.</strong> 底层开发</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/1_underlying/command/command.html"><strong aria-hidden="true">6.5.1.1.</strong> 命令行工具</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/1_underlying/data/data.html"><strong aria-hidden="true">6.5.1.2.</strong> 数据处理</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/1_underlying/embedded/embedded.html"><strong aria-hidden="true">6.5.1.3.</strong> 嵌入式</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/1_underlying/os/os.html"><strong aria-hidden="true">6.5.1.4.</strong> 系统开发</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/1_underlying/performance/performance.html"><strong aria-hidden="true">6.5.1.5.</strong> 性能工具</a></li></ol></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/2_network/network.html"><strong aria-hidden="true">6.5.2.</strong> 网络相关</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/2_network/cloud/cloud.html"><strong aria-hidden="true">6.5.2.1.</strong> 云原生</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/2_network/frontend/frontend.html"><strong aria-hidden="true">6.5.2.2.</strong> 前端基建</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/2_network/network/network.html"><strong aria-hidden="true">6.5.2.3.</strong> 网络基建</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html"><strong aria-hidden="true">6.5.2.3.1.</strong> IPFS: 星际文件系统(InterPlanetary File System)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs_website.html"><strong aria-hidden="true">6.5.2.3.1.1.</strong> 利用IPFS构建自己的去中心化分布式网站</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs_pubsub.html"><strong aria-hidden="true">6.5.2.3.1.2.</strong> IPFS pubsub功能</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs_companion.html"><strong aria-hidden="true">6.5.2.3.1.3.</strong> IPFS伴侣插件</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs_ngrok.html"><strong aria-hidden="true">6.5.2.3.1.4.</strong> IPFS+ngrok</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/2_network/web/web.html"><strong aria-hidden="true">6.5.2.4.</strong> web开发</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/2_network/web/webassembly_try.html"><strong aria-hidden="true">6.5.2.4.1.</strong> 基于Rust尝试WebAssembly</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/3_media/media.html"><strong aria-hidden="true">6.5.3.</strong> 多媒体</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/3_media/av/av.html"><strong aria-hidden="true">6.5.3.1.</strong> 音视频处理</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/3_media/game/game.html"><strong aria-hidden="true">6.5.3.2.</strong> 游戏开发</a></li></ol></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/4_other/other.html"><strong aria-hidden="true">6.5.4.</strong> 其他</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/4_other/lang-with-rust/lang_with_rust.html"><strong aria-hidden="true">6.5.4.1.</strong> Rust与其他语言</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/4_other/scientific-research/scientific_research.html"><strong aria-hidden="true">6.5.4.2.</strong> 科学艺术研究</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/5_open_source/4_other/tools/tools.html"><strong aria-hidden="true">6.5.4.3.</strong> 其他工具</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="layer5_ecosystem/6_security/security.html"><strong aria-hidden="true">6.6.</strong> 安全参考</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/business.html"><strong aria-hidden="true">6.7.</strong> 商业观察</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/blockchain/blockchain.html"><strong aria-hidden="true">6.7.1.</strong> 区块链</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/blockchain/build-a-block-in-rust.html"><strong aria-hidden="true">6.7.1.1.</strong> 使用rust建立一个简单的区块链</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html"><strong aria-hidden="true">6.7.1.2.</strong> Substrate介绍与解析</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html"><strong aria-hidden="true">6.7.1.2.1.</strong> Substrate尝试</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html"><strong aria-hidden="true">6.7.1.2.2.</strong> Substrate深入pallet</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html"><strong aria-hidden="true">6.7.1.2.3.</strong> Substrate开源项目</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html"><strong aria-hidden="true">6.7.1.2.4.</strong> Substrate惊奇资源</a></li></ol></li><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/blockchain/nervos_ckb_anatomy.html"><strong aria-hidden="true">6.7.1.3.</strong> Nervos CKB介绍与解析</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/blockchain/solana.html"><strong aria-hidden="true">6.7.1.4.</strong> Solana</a></li></ol></li><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/practices/practices.html"><strong aria-hidden="true">6.7.2.</strong> 生产实践</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/7_business/products/products.html"><strong aria-hidden="true">6.7.3.</strong> 优秀产品</a></li></ol></li><li class="chapter-item expanded "><a href="layer5_ecosystem/8_libs/libs.html"><strong aria-hidden="true">6.8.</strong> 基础库</a></li><li class="chapter-item expanded "><a href="layer5_ecosystem/9_frameworks/frameworks.html"><strong aria-hidden="true">6.9.</strong> 框架引擎</a></li></ol></li><li class="chapter-item expanded "><a href="checklist.html">Checklist</a></li></ol>
    </div>
    <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
</nav>

<div id="page-wrapper" class="page-wrapper">

    <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
        <div id="menu-bar" class="menu-bar sticky bordered">
            <div class="left-buttons">
                <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                    <i class="fa fa-bars"></i>
                </button>
                <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                    <i class="fa fa-paint-brush"></i>
                </button>
                <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                    <li role="none">
                        <button role="menuitem" class="theme" id="light">Light</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="rust">Rust (default)</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="coal">Coal</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="navy">Navy</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="ayu">Ayu</button>
                    </li>
                </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                            aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                            aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
            </div>

            <h1 class="menu-title">Programming Anatomy In Rust 🦀</h1>
            <h4 class="menu-bar"><a href="https://kuanhsiaokuo.github.io/think-tool-kit/">保持批判，有所取舍，知行合一, 方见真我</a> -- 练武不练功
                到头一场空 -- 《赛博英雄传》 </h4>
            <div class="right-buttons">
                    <a href="print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/KuanHsiaoKuo/programming_anatomy_in_rust.git" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-rust"></i>
                    </a>
            </div>
        </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" name="search" id="searchbar" name="searchbar"
                           placeholder="Search this book ..." aria-controls="searchresults-outer"
                           aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

        <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
        <script type="text/javascript">
            document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
            document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
            Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
            });
        </script>

        <div id="content" class="content">
            <main>

                <!-- Page table of contents -->
                <div class="sidetoc">
                    <nav class="pagetoc"></nav>
                </div>
                <h1 id="编程解剖-in-rust"><a class="header" href="#编程解剖-in-rust">编程解剖 in rust</a></h1>
<blockquote>
<p>以rust为例分享学习编程常考虑的方方面面</p>
</blockquote>
<!--ts-->
<ul>
<li><a href="overview.html#%E7%BC%96%E7%A8%8B%E8%A7%A3%E5%89%96-in-rust">编程解剖 in rust</a>
<ul>
<li><a href="overview.html#%E6%9C%AC%E5%9C%B0%E8%BF%90%E8%A1%8C">本地运行</a></li>
<li><a href="overview.html#git-lfs%E9%85%8D%E7%BD%AE">git lfs配置</a></li>
<li><a href="overview.html#%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%BB%93%E6%9E%84">项目基础结构</a></li>
<li><a href="overview.html#%E7%94%A8%E5%88%B0%E7%9A%84%E5%B7%A5%E5%85%B7">用到的工具</a>
<ul>
<li><a href="overview.html#mdbook-checklist-%E6%95%B4%E7%90%86%E5%BE%85%E5%8A%9E%E4%BA%8B%E9%A1%B9">mdbook-checklist: 整理待办事项</a></li>
<li><a href="overview.html#mdbook-pagetoc-%E6%B7%BB%E5%8A%A0%E4%B8%9A%E5%86%85%E7%9B%AE%E5%BD%95">mdbook-pagetoc: 添加业内目录</a></li>
<li><a href="overview.html#mdbook-admonish-%E4%BD%BF%E7%94%A8%E6%96%B0%E7%9A%84css%E6%96%87%E4%BB%B6">mdbook-admonish: 使用新的css文件</a>
<ul>
<li><a href="overview.html#%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90">相关资源</a></li>
<li><a href="overview.html#%E7%89%B9%E5%88%AB%E8%AF%AD%E6%B3%95">特别语法</a>
<ul>
<li><a href="overview.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E9%A2%98">自定义标题</a></li>
<li><a href="overview.html#%E5%86%85%E5%B5%8C%E4%BB%A3%E7%A0%81">内嵌代码</a></li>
<li><a href="overview.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%B7%E5%BC%8F">自定义样式</a></li>
<li><a href="overview.html#%E5%8F%AF%E6%8A%98%E5%8F%A0">可折叠</a></li>
</ul>
</li>
<li><a href="overview.html#%E5%B8%B8%E7%94%A8%E6%A0%BC%E5%BC%8F">常用格式</a>
<ul>
<li><a href="overview.html#note">note</a></li>
<li><a href="overview.html#abstract-summary-tldr">abstract, summary, tldr</a></li>
<li><a href="overview.html#info-todo">info, todo</a></li>
<li><a href="overview.html#tip-hint-important">tip, hint, important</a></li>
<li><a href="overview.html#success-check-done">success, check, done</a></li>
<li><a href="overview.html#question-help-faq">question, help, faq</a></li>
<li><a href="overview.html#warning-caution-attention">warning, caution, attention</a></li>
<li><a href="overview.html#failure-fail-missing">failure, fail, missing</a></li>
<li><a href="overview.html#danger-error">danger, error</a></li>
<li><a href="overview.html#bug">bug</a></li>
<li><a href="overview.html#example">example</a></li>
<li><a href="overview.html#quote-cite">quote, cite</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="overview.html#github-action">github action</a></li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Wed Jun 15 09:14:14 UTC 2022 -->
<!--te-->
<h2 id="主要参考书籍"><a class="header" href="#主要参考书籍">主要参考书籍</a></h2>
<ul>
<li>&lt;Rust编程之道&gt;</li>
<li><a href="https://doc.rust-lang.org/book/title-page.html">The Rust Programming Language - The Rust Programming Language</a>(中文名：Rust权威指南)</li>
<li>精通rust</li>
<li><a href="https://doc.rust-lang.org/stable/rust-by-example/index.html">Rust By Example</a></li>
<li><a href="https://doc.rust-lang.org/edition-guide/index.html">The Edition Guide</a></li>
<li><a href="https://doc.rust-lang.org/cargo/index.html">The Cargo Book</a></li>
<li><a href="https://doc.rust-lang.org/rustdoc/index.html">The rustdoc book</a></li>
<li><a href="https://doc.rust-lang.org/rustc/index.html">The rustc book</a></li>
<li><a href="https://doc.rust-lang.org/error-index.html">Rust Compiler Error Index</a></li>
<li><a href="https://rust-cli.github.io/book/index.html">Command Line Applications in Rust</a></li>
<li><a href="https://rustwasm.github.io/docs/book/">Rust 🦀 and WebAssembly 🕸</a></li>
<li><a href="https://doc.rust-lang.org/stable/embedded-book/">The Embedded Rust Book</a></li>
<li><a href="https://rust-lang.github.io/rustup/index.html">The rustup book</a></li>
<li><a href="https://rustc-dev-guide.rust-lang.org/">Guide to Rustc Development</a></li>
<li><a href="https://blog.rust-lang.org/">The Rust Programming Language Blog</a></li>
</ul>
<blockquote>
<p>更多资源：<a href="https://github.com/orgs/rust-lang/repositories?type=source">Rust Lang Github Repositories</a></p>
</blockquote>
<h2 id="参考资源说明"><a class="header" href="#参考资源说明">参考资源说明</a></h2>
<ol>
<li>online-book: 主要指各种在线电子书</li>
<li>fragment: 主要指各种博客、论坛，比如reddit</li>
<li>local：指在本地用marginnote/devonthink等创建的知识点链接，只是对应本地跳转。</li>
</ol>
<h2 id="本地运行"><a class="header" href="#本地运行">本地运行</a></h2>
<pre><code class="language-shell">cargo install mdbook
mdbook serve
</code></pre>
<h2 id="git-lfs配置"><a class="header" href="#git-lfs配置">git lfs配置</a></h2>
<ul>
<li><a href="https://git-lfs.github.com/">Git Large File Storage | Git Large File Storage (LFS) replaces large files such as audio samples, videos, datasets, and graphics with text pointers inside Git, while storing the file contents on a remote server like GitHub.com or GitHub Enterprise.</a></li>
</ul>
<pre><code>git lfs install 
git lfs track '*.img'
</code></pre>
<h2 id="项目基础结构"><a class="header" href="#项目基础结构">项目基础结构</a></h2>
<h3 id="同名md文件"><a class="header" href="#同名md文件">同名md文件</a></h3>
<div id="admonition-同名md" class="admonition tip">
<div class="admonition-title">
<p>同名md</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-同名md"></a></p>
</div>
<div>
<p>每个文件夹下的同名md文件介绍当前文件夹的内容</p>
</div>
</div>
<h3 id="文章目录链接"><a class="header" href="#文章目录链接">文章目录链接</a></h3>
<div id="admonition-目录链接" class="admonition tip">
<div class="admonition-title">
<p>目录链接</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-目录链接"></a></p>
</div>
<div>
<p>默认情况下，所有md文件都需要链接到SUMMARY.md文件才可以被创建链接</p>
</div>
</div>
<h3 id="文件内链"><a class="header" href="#文件内链">文件内链</a></h3>
<div id="admonition-使用相对链接添加内链" class="admonition tip">
<div class="admonition-title">
<p>使用相对链接添加内链</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-使用相对链接添加内链"></a></p>
</div>
<div>
<p>这里可以使用mdbook渲染后的网页规则，以src文件为根目录，把后缀改成html即可
layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html</p>
</div>
</div>
<p><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html">ownership_borrow_lifetime</a></p>
<h2 id="用到的工具"><a class="header" href="#用到的工具">用到的工具</a></h2>
<blockquote>
<p>来自：<a href="https://kuanhsiaokuo.github.io/apple_power_user/app_deepin/mdbook_deepin.html">Mdbook - Apple Power User</a></p>
</blockquote>
<h3 id="mdbook-checklist-整理待办事项"><a class="header" href="#mdbook-checklist-整理待办事项">mdbook-checklist: 整理待办事项</a></h3>
<p><a href="https://github.com/ANSSI-FR/mdbook-checklist">ANSSI-FR/mdbook-checklist: mdbook preprocessor for generating checklists and indexes</a></p>
<pre><code class="language-shell">cargo install mdbook-checklist
</code></pre>
<p><a href="https://crates.io/crates/mdbook-checklist">mdbook-checklist - crates.io: Rust Package Registry</a></p>
<h3 id="mdbook-pagetoc-添加页旁目录"><a class="header" href="#mdbook-pagetoc-添加页旁目录">mdbook-pagetoc: 添加页旁目录</a></h3>
<p><a href="https://github.com/JorelAli/mdBook-pagetoc">JorelAli/mdBook-pagetoc: A page table of contents for mdBook</a></p>
<h3 id="mdbook-admonish-使用新的css文件"><a class="header" href="#mdbook-admonish-使用新的css文件">mdbook-admonish: 使用新的css文件</a></h3>
<h4 id="相关资源"><a class="header" href="#相关资源">相关资源</a></h4>
<ul>
<li><a href="https://github.com/tommilligan/mdbook-admonish">tommilligan/mdbook-admonish: A preprocessor for mdbook to add Material Design admonishments.</a></li>
<li><a href="https://crates.io/crates/mdbook-admonish">mdbook-admonish - crates.io: Rust Package Registry</a></li>
<li><a href="https://tommilligan.github.io/mdbook-admonish/">Overview - The mdbook-admonish book</a></li>
<li><a href="https://squidfunk.github.io/mkdocs-material/reference/admonitions/#usage">Admonitions - Material for MkDocs</a></li>
</ul>
<blockquote>
<p>All supported directives are listed below.</p>
</blockquote>
<h4 id="特别语法"><a class="header" href="#特别语法">特别语法</a></h4>
<h5 id="自定义标题"><a class="header" href="#自定义标题">自定义标题</a></h5>
<div id="admonition-数据损失" class="admonition warning">
<div class="admonition-title">
<p>数据损失</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-数据损失"></a></p>
</div>
<div>
<p>The following steps can lead to irrecoverable data corruption.</p>
</div>
</div>
<h5 id="内嵌代码"><a class="header" href="#内嵌代码">内嵌代码</a></h5>
<div id="admonition-内嵌代码" class="admonition bug">
<div class="admonition-title">
<p>内嵌代码</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-内嵌代码"></a></p>
</div>
<div>
<p>This syntax won't work in Python 3:</p>
<pre><code class="language-python">print &quot;Hello, world!&quot;
</code></pre>
</div>
</div>
<h5 id="自定义样式"><a class="header" href="#自定义样式">自定义样式</a></h5>
<div id="admonition-note" class="admonition note custom-0 custom-1">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-note"></a></p>
</div>
<div>
<p>Styled with my custom CSS class.</p>
</div>
</div>
<h5 id="可折叠"><a class="header" href="#可折叠">可折叠</a></h5>
<details id="admonition-note-1" class="admonition note">
<summary class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-note-1"></a></p>
</summary>
<div>
<p>Content will be hidden initially.</p>
</div>
</details>
<h4 id="常用格式"><a class="header" href="#常用格式">常用格式</a></h4>
<h5 id="note"><a class="header" href="#note">note</a></h5>
<div id="admonition-note-2" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-note-2"></a></p>
</div>
<div>
<p>Rust is a multi-paradigm, general-purpose programming language designed for performance and safety, especially safe concurrency.</p>
</div>
</div>
<h5 id="abstract-summary-tldr"><a class="header" href="#abstract-summary-tldr"><code>abstract</code>, <code>summary</code>, <code>tldr</code></a></h5>
<div id="admonition-abstract" class="admonition abstract">
<div class="admonition-title">
<p>Abstract</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-abstract"></a></p>
</div>
<div>
<p>Rust is a multi-paradigm, general-purpose programming language designed for performance and safety, especially safe concurrency.</p>
</div>
</div>
<h5 id="info-todo"><a class="header" href="#info-todo"><code>info</code>, <code>todo</code></a></h5>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-info"></a></p>
</div>
<div>
<p>Rust is a multi-paradigm, general-purpose programming language designed for performance and safety, especially safe concurrency.</p>
</div>
</div>
<h5 id="tip-hint-important"><a class="header" href="#tip-hint-important"><code>tip</code>, <code>hint</code>, <code>important</code></a></h5>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-tip"></a></p>
</div>
<div>
<p>Rust is a multi-paradigm, general-purpose programming language designed for performance and safety, especially safe concurrency.</p>
</div>
</div>
<h5 id="success-check-done"><a class="header" href="#success-check-done"><code>success</code>, <code>check</code>, <code>done</code></a></h5>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-success"></a></p>
</div>
<div>
<p>Rust is a multi-paradigm, general-purpose programming language designed for performance and safety, especially safe concurrency.</p>
</div>
</div>
<h5 id="question-help-faq"><a class="header" href="#question-help-faq"><code>question</code>, <code>help</code>, <code>faq</code></a></h5>
<div id="admonition-question" class="admonition question">
<div class="admonition-title">
<p>Question</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-question"></a></p>
</div>
<div>
<p>Rust is a multi-paradigm, general-purpose programming language designed for performance and safety, especially safe concurrency.</p>
</div>
</div>
<h5 id="warning-caution-attention"><a class="header" href="#warning-caution-attention"><code>warning</code>, <code>caution</code>, <code>attention</code></a></h5>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-warning"></a></p>
</div>
<div>
<p>Rust is a multi-paradigm, general-purpose programming language designed for performance and safety, especially safe concurrency.</p>
</div>
</div>
<h5 id="failure-fail-missing"><a class="header" href="#failure-fail-missing"><code>failure</code>, <code>fail</code>, <code>missing</code></a></h5>
<div id="admonition-failure" class="admonition failure">
<div class="admonition-title">
<p>Failure</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-failure"></a></p>
</div>
<div>
<p>Rust is a multi-paradigm, general-purpose programming language designed for performance and safety, especially safe concurrency.</p>
</div>
</div>
<h5 id="danger-error"><a class="header" href="#danger-error"><code>danger</code>, <code>error</code></a></h5>
<div id="admonition-danger" class="admonition danger">
<div class="admonition-title">
<p>Danger</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-danger"></a></p>
</div>
<div>
<p>Rust is a multi-paradigm, general-purpose programming language designed for performance and safety, especially safe concurrency.</p>
</div>
</div>
<h5 id="bug"><a class="header" href="#bug"><code>bug</code></a></h5>
<div id="admonition-bug" class="admonition bug">
<div class="admonition-title">
<p>Bug</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-bug"></a></p>
</div>
<div>
<p>Rust is a multi-paradigm, general-purpose programming language designed for performance and safety, especially safe concurrency.</p>
</div>
</div>
<h5 id="example"><a class="header" href="#example"><code>example</code></a></h5>
<div id="admonition-example" class="admonition example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-example"></a></p>
</div>
<div>
<p>Rust is a multi-paradigm, general-purpose programming language designed for performance and safety, especially safe concurrency.</p>
</div>
</div>
<h5 id="quote-cite"><a class="header" href="#quote-cite"><code>quote</code>, <code>cite</code></a></h5>
<div id="admonition-quote" class="admonition quote">
<div class="admonition-title">
<p>Quote</p>
<p><a class="admonition-anchor-link" href="overview.html#admonition-quote"></a></p>
</div>
<div>
<p>Rust is a multi-paradigm, general-purpose programming language designed for performance and safety, especially safe concurrency.</p>
</div>
</div>
<h2 id="github-action"><a class="header" href="#github-action">github action</a></h2>
<ul>
<li><a href="https://github.com/marketplace/actions/rust-cargo-install">rust-cargo-install · Actions · GitHub Marketplace</a> </li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="substrate介绍与源码解读"><a class="header" href="#substrate介绍与源码解读">Substrate介绍与源码解读</a></h1>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/what_is_substrate.png" alt="what_is_substrate" /></p>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate%E4%BB%8B%E7%BB%8D%E4%B8%8E%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB">Substrate介绍与源码解读</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#gavin-wookpolkadot-and-substrate">Gavin Wook、Polkadot and Substrate</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#gavin-wook%E4%B8%8E%E6%B3%A2%E5%8D%A1%E8%B7%A8%E9%93%BE">Gavin Wook与波卡跨链</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E4%BB%8E%E6%B3%A2%E5%8D%A1%E5%88%B0substrate">从波卡到Substrate</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E8%B7%A8%E9%93%BE%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7">跨链的重要性</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1">总体设计</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%B8%B8%E8%A7%81%E5%8C%BA%E5%9D%97%E9%93%BE%E8%AE%BE%E8%AE%A1">常见区块链设计</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%8C%BA%E5%9D%97%E9%93%BE%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86">区块链系统基础部分</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E9%93%BE%E7%9A%84%E5%8A%9F%E8%83%BD">链的功能</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate%E7%90%86%E5%BF%B5">Substrate理念</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%85%88%E8%AE%A4%E8%AF%86%E4%B8%80%E4%B8%8B%E4%BB%80%E4%B9%88%E6%98%AF%E5%8C%BA%E5%9D%97%E9%93%BE%E6%A1%86%E6%9E%B6">先认识一下：什么是区块链框架</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E6%8E%A5%E7%9D%80%E8%AF%B4%E8%AF%B4substrate%E4%B8%8Eweb3">接着说说Substrate与web3</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E7%94%A8web%E6%A1%86%E6%9E%B6%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%B1%BB%E6%AF%94">用web框架、游戏引擎类比</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate-architecture">Substrate Architecture</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%BC%80%E5%8F%91%E8%80%85%E5%8F%AA%E9%9C%80%E8%A6%81%E5%85%B3%E6%B3%A8runtime%E9%93%BE%E5%8A%9F%E8%83%BD">开发者只需要关注Runtime(链功能)</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E6%98%8E%E6%99%B0runtime">明晰Runtime</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%88%A4%E6%96%AD%E6%A0%87%E5%87%86">判断标准</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate%E7%9A%84runtime">Substrate的Runtime</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E4%B8%AD%E5%BF%83%E5%8C%96%E5%8D%87%E7%BA%A7%E6%B5%81%E7%A8%8B">中心化升级流程</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E6%97%A0%E5%A4%AE%E5%8C%96%E5%8D%87%E7%BA%A7%E6%B5%81%E7%A8%8B%E5%8E%9F%E5%85%88">无央化升级流程(原先)</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate%E7%9A%84%E4%B8%8D%E5%90%8C">Substrate的不同</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%90%88%E7%BA%A6%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5">以太坊合约更新策略</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate%E5%AF%B9%E5%BA%94%E5%90%88%E7%BA%A6%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5">Substrate对应‘合约更新策略’</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84">项目结构</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9E%B6%E6%9E%84">客户端架构</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E6%9E%B6%E6%9E%84%E5%9B%BE">架构图</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E6%A8%A1%E5%9D%97%E8%AF%B4%E6%98%8E">模块说明</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%AD%98%E5%82%A8">存储</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#runtime">Runtime</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#p2p%E7%BD%91%E7%BB%9C">p2p网络</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%85%B1%E8%AF%86">共识</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#rpc">RPC</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#telemetry-%E9%81%A5%E6%B5%8B">telemetry （遥测）</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#tree-level1">Tree Level1</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E7%94%A8cargo%E7%BB%84%E7%BB%87%E4%BB%A3%E7%A0%81">用Cargo组织代码</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E4%B8%BB%E8%A6%81%E9%83%A8%E5%88%86%E4%BB%8B%E7%BB%8Dnodeframecore">主要部分介绍：Node、Frame、Core</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate-node">Substrate Node:</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E9%87%8D%E7%82%B9%E8%AF%B4%E8%AF%B4nodepallets%E5%92%8Cruntime">重点说说node、pallets和runtime</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate-frame">Substrate FRAME</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate-coreclient">Substrate Core(client)</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%85%B6%E4%BB%96">其他</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#primitives">primitives</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#scriptsci">scripts/ci</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#utils">utils</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%8A%9F%E8%83%BD%E9%80%BB%E8%BE%91">功能逻辑</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E7%89%B9%E8%89%B2%E4%BB%A3%E7%A0%81">特色代码</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#online-book">online-book</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#fragment">fragment</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#runtime-1">Runtime</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:37 UTC 2022 -->
<!--te-->
<h2 id="gavin-wookpolkadot-and-substrate"><a class="header" href="#gavin-wookpolkadot-and-substrate">Gavin Wook、Polkadot and Substrate</a></h2>
<h3 id="gavin-wook与波卡跨链"><a class="header" href="#gavin-wook与波卡跨链">Gavin Wook与波卡跨链</a></h3>
<p>所以对于开发人员来说，比起大家耳熟能详的v神(Vitalik Buterin)，更重要的人是实际上撑起整个以太坊世界的灵魂人物<strong>Gavin Wood</strong>。更何况很多山寨币实际上就是在以太坊的模型上修修改改，所以在我看来Gavin
Wood是撑起了当前半个区块链世界的人。</p>
<p>而Gavin Wood 离开了以太坊之后，开启的一个新项目叫做Polkadot(波卡)，这个项目的<strong>目的就是跨链，为了把各个割裂的区块链孤岛能够联系一起</strong>
。虽然目前有很多的项目都号称自己在做跨链，但是目前在我看来唯一在推进，逻辑上是可推理，之后可能成功的跨链项目就只有波卡能够成功。（后半段可能存在一定误导性，Polkadot的跨链可能在大部分人理解下应该是分片的变种，也就是基于Substrate开发的区块链可以部署到Polkadot上，经过Polkadot平台互相沟通）。</p>
<h3 id="从波卡到substrate"><a class="header" href="#从波卡到substrate">从波卡到Substrate</a></h3>
<p>而Gavin Wood 在开发的波卡的过程中，经过不断地思考，认为其实区块链发展这几年，大家做的很多事情都是相同的。</p>
<div id="admonition-抽离共同点开始造轮子" class="admonition abstract">
<div class="admonition-title">
<p>抽离共同点，开始造&quot;轮子&quot;</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-抽离共同点开始造轮子"></a></p>
</div>
<div>
<p>那么在以往的软件开发中，当大家发现大家都在做相同的事情的时候，就会将这件事情进行抽象，然后造“轮子”，将这些高层次的东西做封装，成为“开发框架”，将背后复杂的基础设施都封装起来，而使用这个“框架”的开发人员，就可以更加专注于自己的业务逻辑，而不必花费大量的精力去造“轮子”去完成那些每个链都要做的事情。</p>
</div>
</div>
<p>Gavin Wood 在开发波卡的中途先暂停了波卡的开发，将波卡及以太坊已有的成果进行抽象，命名为substrate作为区块链开发的基础框架，并把全部精力都转移到了substrate开发中。</p>
<div id="admonition-第一个轮子" class="admonition tip">
<div class="admonition-title">
<p>第一个轮子</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-第一个轮子"></a></p>
</div>
<div>
<p>所以“substrate”就是区块链世界的第一个“轮子”。</p>
</div>
</div>
<h3 id="跨链的重要性"><a class="header" href="#跨链的重要性">跨链的重要性</a></h3>
<p>另一方面，在软件开发领域或者互联网领域，大家其实都发现了占据了框架的地位实际上一定程度上占据了这个领域开发的生态，更何况对于跨链来说，当大家的链都比较同质化后，跨链会更加的方便。现在大家都把跨链当作区块链下一个引爆点，而跨链的属性界定了做“跨链”的人基本上只能一家独大，成为垄断地位。而接入跨链的链越多，这个跨链就越垄断(
因为大家使用跨链就是为了在不同的链之间兑换代币，能换的代币越多，使用这个跨链的人就越多，生态就越集中)，</p>
<p>而Gavin Wood 提供的substrate框架又<strong>能解决大部分链都在重复解决的问题</strong>，所以大家就更倾向于使用substrate开发自己的链。</p>
<div id="admonition-三角关系" class="admonition quote">
<div class="admonition-title">
<p>三角关系</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-三角关系"></a></p>
</div>
<div>
<p>这样就会在“用户-链-跨链”这个三角关系中将三方的利益绑定在一起，互惠互利，共同进步。</p>
</div>
</div>
<h2 id="总体设计"><a class="header" href="#总体设计">总体设计</a></h2>
<h3 id="常见区块链设计"><a class="header" href="#常见区块链设计">常见区块链设计</a></h3>
<p>目前所有的区块链系统几乎都是从比特币/以太坊模型演变而来。一般来说，一个区块链系统应该具有：</p>
<h4 id="区块链系统基础部分"><a class="header" href="#区块链系统基础部分">区块链系统基础部分</a></h4>
<ul>
<li>共识系统 （区块链分布式基石）</li>
<li>p2p连接与广播系统</li>
<li>存储系统</li>
<li>交易池系统</li>
<li>rpc系统（区块链与外界交互主要通道）</li>
</ul>
<div id="admonition-基础通用" class="admonition info">
<div class="admonition-title">
<p>基础通用</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-基础通用"></a></p>
</div>
<div>
<p>基础部分是当前区块链模型下都会具备的组件，其中共识与P2P体现区块链的分布式本质</p>
</div>
</div>
<h4 id="链的功能"><a class="header" href="#链的功能">链的功能</a></h4>
<div id="admonition-竞争关键" class="admonition info">
<div class="admonition-title">
<p>竞争关键</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-竞争关键"></a></p>
</div>
<div>
<p>链功能是区块链间相互竞争的关键部分. 与系统基础部分相比，这部分差异很大，提供的是除去区块链模型外，这条链能够提供的功能。另一方面在区块链升级中，一般来说系统基础部分改动较小，而链的功能部分改动较大，特别是许多链为了追求开发速度，一开始只能提供转账功能，在后续的版本中才慢慢升级其他功能</p>
</div>
</div>
<p>例如：</p>
<ul>
<li>比特币的UTXO结构加上交易脚本</li>
<li>以太坊的虚拟机与智能合约</li>
<li>eos的账户系统及虚拟机</li>
<li>有的山寨币特化部分智能合约或部分native层成为系统级功能：
<ul>
<li>提供随机数</li>
<li>提供质押对赌</li>
<li>oracle数据输入</li>
<li>引入复杂密码学方案</li>
<li>等等。。。</li>
</ul>
</li>
</ul>
<h4 id="substrate理念"><a class="header" href="#substrate理念">Substrate理念</a></h4>
<div id="admonition-分离变与不变" class="admonition tip">
<div class="admonition-title">
<p>分离变与不变</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-分离变与不变"></a></p>
</div>
<div>
<p>Substrate作为一个区块链框架，认为所有的链都应该具备区块链系统基础部分，而由开发者自由定制链的功能部分</p>
</div>
</div>
<h3 id="先认识一下什么是区块链框架"><a class="header" href="#先认识一下什么是区块链框架">先认识一下：什么是区块链框架</a></h3>
<p>简单来说，或者从本质上讲，区块链框架是一个（巨大的）工具和库的集合，用于构建一个完整的、可运行的、安全的、功能完整的（尽管是基本的）区块链。</p>
<p>区块链框架负责处理以下方面的大部分繁重工作：</p>
<ul>
<li>共识P2P网络</li>
<li>帐户管理</li>
<li>基本的区块链逻辑（区块、交易等）</li>
<li>区块链交互的客户端</li>
</ul>
<h3 id="接着说说substrate与web3"><a class="header" href="#接着说说substrate与web3">接着说说Substrate与web3</a></h3>
<p>Substrate 可以被描述为一个区块链框架——具体来说，一个用于构建定制区块链的框架。这些区块链可以完全自主运行，这意味着它们不依赖任何外部技术来运行。</p>
<p>然而，Substrate 背后的公司 Parity（由以太坊联合创始人 Gavin Wood 共同创立）也建立了 Polkadot 网络。 Polkadot 本质上是一个分散的、基于协议的区块链平台，用于实现安全的跨区块链通信。</p>
<div id="admonition-波卡本身就是跨链桥梁" class="admonition tip">
<div class="admonition-title">
<p>波卡本身就是跨链桥梁</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-波卡本身就是跨链桥梁"></a></p>
</div>
<div>
<p>这意味着 Polkadot可以用作区块链之间的一种桥梁，负责链之间的通信层，并使不同区块链（甚至是以太坊和比特币等系统）之间的交互成为可能。</p>
</div>
</div>
<div id="admonition-web3愿景" class="admonition quote">
<div class="admonition-title">
<p>web3愿景</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-web3愿景"></a></p>
</div>
<div>
<p>这代表着在实现 Web3 的愿景（一个分散的、基于区块链的互联网版本）方面取得了重大进展。</p>
</div>
</div>
<p>由于它们是由同一个人开发的，因此 Substrate 对与Polkadot的集成具有一流的支持，因此您使用Substrate创建的任何区块链都可以无缝连接到 Polkadot。</p>
<p>Substrate 还提供无分叉运行时升级——在不触发硬分叉的情况下升级区块链状态转换功能的能力。</p>
<div id="admonition-文档教程" class="admonition info">
<div class="admonition-title">
<p>文档教程</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-文档教程"></a></p>
</div>
<div>
<p>当然，由于提供了大量的代码，Substrate 附带了大量的文档和教程来帮助您入门。</p>
</div>
</div>
<h3 id="用web框架游戏引擎类比"><a class="header" href="#用web框架游戏引擎类比">用web框架、游戏引擎类比</a></h3>
<div id="admonition-sustrate与web框架大有不同" class="admonition warning">
<div class="admonition-title">
<p>Sustrate与web框架大有不同</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-sustrate与web框架大有不同"></a></p>
</div>
<div>
<p>如果你以前使用过一个广泛的 Web 框架，那么区块链框架就是——根本不是这样的。范围、活动部件的数量、相关概念和扩展点只是处于不同的规模。</p>
</div>
</div>
<blockquote>
<p>一个更好的比较可能是一个成熟的游戏引擎（想想 Unity），它为你需要的一切功能提供基本实现，以及可能需要的许多扩展点，供自定义。</p>
</blockquote>
<p>当然，这意味着已经在架构方面做出了一些决定：你将无法轻易更改。</p>
<p>根据你的用例，可能需要更多的可定制性，而框架可能会以某种方式对其进行限制。</p>
<p>这是标准的权衡：区块链框架可以节省你的时间，但代价是你不得不忍受的一些事情。</p>
<p>然而，正如我们将在下面更详细地探讨的那样，Substrate在这方面提供了一些灵活性。</p>
<p>使您能够在多个阶段在更多的技术自由和易于开发之间进行选择。</p>
<p>Substrate的后端是用 Rust 构建的。它（以及 Parity 通常所做的大部分工作）也是完全开源的。</p>
<blockquote>
<p>因此，您不仅可以使用 Substrate，还可以通过回馈和分叉其中的一部分来改进它，以根据您自己的需求进行定制。</p>
</blockquote>
<h3 id="substrate-architecture"><a class="header" href="#substrate-architecture">Substrate Architecture</a></h3>
<p>Gavin Wood 作为以太坊实际核心的开发者，自然早已对这套系统的框架了然于心，所以从Substrate框架提出的开始（2018年9月），就对区块链系统作出了2个关键的区分：</p>
<div id="admonition-coreruntime" class="admonition info">
<div class="admonition-title">
<p>Core&amp;Runtime</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-coreruntime"></a></p>
</div>
<div>
<p>Substrate Core: 系统基础部分
Runtime：链功能</p>
</div>
</div>
<div id="admonition-substrte-architecture" class="admonition tip">
<div class="admonition-title">
<p>Substrte Architecture</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-substrte-architecture"></a></p>
</div>
<div>
<pre><code class="language-text">┌───────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                       │
│                                                                                                       │
│      ┌─────────────────┐     ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐        │
│      │ fund management │     │     Account     │    │    Contract     │    │   Democratic    │        │
│      │    transfer     │     │     system      │    │       VM        │    │   referendum    │        │
│      └─────────────────┘     └─────────────────┘    └─────────────────┘    └─────────────────┘        │
│                                                                                                       │
│                                                  ######  #     # #     # ####### ### #     # #######  │
│      ┌─────────────────┐     ┌─────────────────┐ #     # #     # ##    #    #     #  ##   ## #        │
│      │     Equity      │     │      etc.       │ #     # #     # # #   #    #     #  # # # # #        │
│      │   calculation   │     │                 │ ######  #     # #  #  #    #     #  #  #  # #####    │
│      └─────────────────┘     └─────────────────┘ #   #   #     # #   # #    #     #  #     # #        │
│                                                  #    #  #     # #    ##    #     #  #     # #        │
│                                                  #     #  #####  #     #    #    ### #     # #######  │
├───────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                       │
│      ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐    ┌─────────────────┐       │
│      │    Consensus    │     │ Network system  │     │     Trading     │    │                 │       │
│      │    mechanism    │     │      (p2p)      │     │      Pool       │    │       RPC       │       │
│      └─────────────────┘     └─────────────────┘     └─────────────────┘    │                 │       │
│                                                                             └─────────────────┘       │
│                                                             #####  ####### ######  #######            │
│      ┌─────────────────┐                                   #     # #     # #     # #                  │
│      │      etc.       │                                   #       #     # #     # #                  │
│      │                 │                                   #       #     # ######  #####              │
│      └─────────────────┘                                   #       #     # #   #   #                  │
│                                                            #     # #     # #    #  #                  │
│                                                             #####  ####### #     # #######            │
│                                                                                                       │
└───────────────────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
</div>
</div>
<h3 id="开发者只需要关注runtime链功能"><a class="header" href="#开发者只需要关注runtime链功能">开发者只需要关注Runtime(链功能)</a></h3>
<p>根据这样的划分，当开发者使用Substrate框架的时候，无需关心区块链基础功能也就是Core部分的工作，而只需关心自己链能够提供的功能，也就是Runtime部分的工作。</p>
<div id="admonition-vm类似以太坊的智能合约" class="admonition tip">
<div class="admonition-title">
<p>VM类似以太坊的智能合约</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-vm类似以太坊的智能合约"></a></p>
</div>
<div>
<p>注意图中虚拟机EVM也是Runtime的一个组件。与以太坊的结构相比，相当于把以太坊的智能合约功能也能随意作为一个链的功能组件添加进入使用Substrate开发的链中</p>
</div>
</div>
<h3 id="明晰runtime"><a class="header" href="#明晰runtime">明晰Runtime</a></h3>
<p>这里一直强调Runtime是“链的功能”有一些通俗与不严谨，这里使用一个更抽象的描述：</p>
<div id="admonition-runtime明确" class="admonition danger">
<div class="admonition-title">
<p>Runtime明确</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-runtime明确"></a></p>
</div>
<div>
<p>需要对运行结果进行共识的功能部分应该归属于Runtime</p>
</div>
</div>
<p>这个定义比较抽象，且由于需要对“世界状态”或类似概念有比较深入的了解才好解释，故不展开讲解。更严格来说，“需要对运行结果进行共识的功能组件”是“链的功能”的一个子集。</p>
<h4 id="判断标准"><a class="header" href="#判断标准">判断标准</a></h4>
<div id="admonition-判断标准" class="admonition tip">
<div class="admonition-title">
<p>判断标准</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-判断标准"></a></p>
</div>
<div>
<p>这里有一个简单的判定标准判断某个功能是否应该放在Runtime内：</p>
<p>对于某个功能，若只改动一个节点的代码对于所有的逻辑运行的结果与其他不改动的节点运行的结果相同，则认为这个部分应该放在Runtime之外，如果运行结果不同，则认为应该放在Runtime之内。</p>
</div>
</div>
<div id="admonition-举例" class="admonition example">
<div class="admonition-title">
<p>举例</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-举例"></a></p>
</div>
<div>
<p>举个例子：比如我改变了交易池的排序代码，使得对某个账户有利的交易能优先打包。这个改动会令自己这个节点产出的区块不公平的打包交易，但是只要打包出来的区块大家都可以认可，则所有节点共识的“状态的变化”仍然是一致的。很明显，这个功能组件不应该是Runtime的功能，因为它不会改变对于验证一个区块时的“状态变化”的验证。比如我改变了转账功能的代码，能给某个账户凭空增加钱，那么显然，这种改动对于这个改动过的节点执行的结果将会与其他节点不同，则共识不会通过。所以转账这个功能就应该放在Runtime当中，让所有节点执行的都是一致的。</p>
</div>
</div>
<p>这部分结合native与wasm后会容易理解</p>
<p>所以到底什么是Runtime，我认为使用“链上功能”来描述最为恰当，因为其隐含了对于执行结果的共识问题。</p>
<h3 id="substrate的runtime"><a class="header" href="#substrate的runtime">Substrate的Runtime</a></h3>
<p>Substrate的Runtime当然没有止步于仅将区块链系统做了模块化划分，提供框架功能这一步，事实上，由于抽象出了Runtime，Substrate实现了以往所有区块链都无法实现的一个功能：区块链系统升级。</p>
<h4 id="中心化升级流程"><a class="header" href="#中心化升级流程">中心化升级流程</a></h4>
<div id="admonition-centralized-system-upgrading" class="admonition tip">
<div class="admonition-title">
<p>Centralized System Upgrading</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-centralized-system-upgrading"></a></p>
</div>
<div>
<pre><code class="language-text">┌────────────────────────────────Centralized System Upgrading(Internet App)────────────────────────────────┐
│                                                                                                          │
│                                                                                                          │
│                         ┌───────────────────┐      ┌─────────────┐    ┌─────────────┐    ┌─────────────┐ │
│                     ┌──▶│    Update Code    │      │   Deploy    │    │   Upgrade   │    │ Centralized │ │
│     .─────────.     │   │(Backend/Frontend)─┼──────▶   Server    │───▶│  Sucessful  │────▶Upgrade Easy │ │
│    ╱           ╲    │   └───────────────────┘      └─────────────┘    └─────────────┘    └─────────────┘ │
│   ( Bug/Upgrade )───┤                                                 ┌─────────────┐                    │
│    `.         ,'    │                                                 │  Somebody   │                    │
│      `───────'      │                                              ┌─▶│   Upgrade   ├─┐                  │
│                     │   ┌───────────────────┐      ┌─────────────┐ │  └─────────────┘ │  ┌─────────────┐ │
│                     └──▶│    Update Code    │      │   Publish   │ │                  │  │ Fragmented  │ │
│                         │       (App)      ─┼──────▶  App Store  │─┤  ┌─────────────┐ ├─▶│   version   │ │
│                         └───────────────────┘      └─────────────┘ │  │  Somebody   │ │  └─────────────┘ │
│                                                                    └─▶│   Reject    │─┘                  │
│                                                                       └─────────────┘                    │
│                                                                                                          │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
</div>
</div>
<p>对于中心化的互联网系统而言，由于代码与数据的控制权在自己手上，所以可以随时进行版本的升级与修改。但是即便如此，也只有网页H5，后台代码可以做到随时升级，在移动互联网中，app还是需要用户自行更新。其中android生态尤为突出，apk版本的碎片化一度是困扰开发者的难题。为了应对app应用的碎片化，推出了许多功能各异的框架能够用户在不更新app的情况下进行“热更新”，一度成为技术的热门追捧。这些热更新的框架本质上都是允许从后台下载一段更新代码，通过各种方式加载运行新的代码来完成。一般情况下通过这种热更新提供的功能都会带来一定的性能损耗以运行最新的热更新代码。但是即便是热更新，更新代码的控制权也同样处于中心化组织的手中。</p>
<h4 id="无央化升级流程原先"><a class="header" href="#无央化升级流程原先">无央化升级流程(原先)</a></h4>
<div id="admonition-decentralized-system-upgradingpre" class="admonition tip">
<div class="admonition-title">
<p>Decentralized System Upgrading(pre)</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-decentralized-system-upgradingpre"></a></p>
</div>
<div>
<pre><code class="language-text">┌───────────────────────────────────Decentralized System Upgrading(Blockchain Dapp)────────────────────────────────────┐
│                                                                                                 ┌─────────────┐      │
│                                                                                                 │   Upgrade   │      │
│                                                                                  ┌───Yes───────▶│  Sucessful  │      │
│                                                                                  │              └─────────────┘      │
│                                                                                  Λ                                   │
│                                                                                 ╱ ╲                                  │
│                                                                                ╱   ╲                                 │
│                                                                               ╱     ╲                                │
│                                                          ┌────────┐          ╱       ╲                               │
│                                                          │ Deploy │      Most deployments                            │
│                                              ┌──Support─▶│  Node  │─────▶(Under Byzantine                            │
│                                              │           └────────┘      Fault Tolerance)                            │
│                                              │                               ╲       ╱                               │
│                                              Λ                                ╲     ╱                                │
│                                             ╱ ╲                                ╲   ╱                                 │
│                                            ╱   ╲                                ╲ ╱                                  │
│                                           ╱     ╲                                V              ┌──────────────────┐ │
│     .─────────.      ┌─────────────┐     ╱       ╲                               │              │   Upgrade Fail   │ │
│    ╱           ╲     │ Update Node │    ╱ Running ╲                              └───No────────▶│(Cause Fragmented)│ │
│   ( Bug/Upgrade ─────▶    Code     ├────▶  Node    ▏                                            └──────────────────┘ │
│    `.         ,'     └─────────────┘    ╲ (Minner ╱                                                       ▲          │
│      `───────'                           ╲       ╱                                                        │          │
│                                           ╲     ╱                                                         │          │
│                                            ╲   ╱                                                          │          │
│     .─────────.                             ╲ ╱                                                           │          │
│  ,─'           '─.                           V                                                            │          │
│ ;    Community    :                          │           ┌────────┐                                       │          │
│ :    proposal     ;                          │           │ Reject │                                       │          │
│  ╲   (BIP/EIP)   ╱                           └───Reject─▶│ Deploy │───────────────────────────────────────┘          │
│   '─.         ,─'                                        └────────┘                                                  │
│      `───────'                                                                                                       │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
</div>
</div>
<p>区块链领域就大大不同了。 即便代码更新的权力在某个组织的手上，但是运行这些代码的人可不一定会听这个组织的指挥，无法容易的命令分散节点统一的进行新代码的部署更新。</p>
<div id="admonition-分布式自治的优缺点" class="admonition tip">
<div class="admonition-title">
<p>分布式自治的优缺点</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-分布式自治的优缺点"></a></p>
</div>
<div>
<p>这是区块链带来的分布式自治的优点，同时也是一个巨大的缺点。</p>
</div>
</div>
<p>比特币社区就是这个领域下的一个典型，由于比特币社区的分裂，部分人并不认同不更改区块大小而是采用隔离见证的方案，分裂出了BCH，对BTC的生态产生的极大的损害。ETH的升级同样也困难重重，每次升级都需要进行长时间的等待以防有节点未升级而产生的分叉。</p>
<p>EOS由于其中心化的特点使得升级稍微简单一些，但仍然出现了由于升级带来的分叉的恶性事件。我们可以形象把区块链下的系统升级称为“全球升级”，因为其要求分布式环境下的大部分节点都更新了代码才使得升级能够成功。相较于中心化控制的系统，区块链系统的升级困难重重且充满风险。</p>
<div id="admonition-高度判断" class="admonition tip">
<div class="admonition-title">
<p>高度判断</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-高度判断"></a></p>
</div>
<div>
<p>同时区块链的升级还有另一个问题：高度判断</p>
<p>一个区块链系统升级后，不得不在代码中加入许多的“高度判断”，以区分不同高度下运行的代码，保证同步能够正常执行，兼容老数据。这种做法很原始但是又无法绕开，给开发者带来极大的思维负担，且需要大量的测试来保证不出现Bug。</p>
</div>
</div>
<p>比如目前比特币的源码中就有许多的区块高度判定使得在同步老区块的时候执行老代码，新区块的时候执行新代码。而中心化系统的数据控制权在自己手上，并且也不存在需要从某个数据源同步的情况，所以完全不需要担心这个问题。</p>
<h4 id="substrate的不同"><a class="header" href="#substrate的不同">Substrate的不同</a></h4>
<p>Substrate横空而出，推出了目前区块链领域最完美的升级方案。其采用“链上代码”的思想，将整个Runtime都做成了可直接更新的组件，让所有节点能够强制运行最新的Runtime代码。</p>
<div id="admonition-substrate-runtime" class="admonition info">
<div class="admonition-title">
<p>Substrate Runtime</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-substrate-runtime"></a></p>
</div>
<div>
<p>简单来说，Runtime在Substrate框架下，将会用同一份代码编译出两份可执行文件：</p>
<ol>
<li>一份Rust的本地代码，我们一般称为native代码，native与其他代码无异，是这个执行文件中的二进制数据，直接运行。在Substrate的相关代码以native命名</li>
<li>一份wasm的链上代码，我们一般成为wasm代码，wasm被部署到链上，所有人可获取，wasm通过构建一个wasm的运行时环境执行 。在Substrate的相关代码以wasm命名 在节点启动的时候可以选择执行策略，使用native, possible，wasm或者both。不同的执行策略会执行不同的执行文件</li>
</ol>
</div>
</div>
<p>由于这两份代码是由相同的代码编译出来的，所以其执行逻辑完全相同 (有一些很小的暗坑要注意)。其中wasm将会部署到链上，所有人都可以获取到，也就是说即使本地运行的不是最新版本的节点，只要同步了区块，一定可以获取到最新的wasm代码。</p>
<p>换句话说，一个写在Runtime内部的代码，也就是代表这条链功能性的代码，存在两份，分别是native与wasm。wasm代码被部署到链上，是“链上数据”，可以通过同步区块所有人统一获取并执行。这样就可以保证在区块链中所有矿工执行的都是最新的代码。</p>
<div id="admonition-哪种更合理" class="admonition tip">
<div class="admonition-title">
<p>哪种更合理</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-哪种更合理"></a></p>
</div>
<div>
<p>这里需要强调，代码的部署可以通过“民主提议”，“sudo控制权限”，“开发者自定一种部署条件”等方式进行，到底哪种方式“更区块链”，“更合理”，不在本文讨论范围内，这与这条链的设计目的相关。Substrate只是提供了这种“热更新”的强大机制，如何使用这种机制是这条链的问题。</p>
</div>
</div>
<h4 id="以太坊合约更新策略"><a class="header" href="#以太坊合约更新策略">以太坊合约更新策略</a></h4>
<div id="admonition-合约更新策略" class="admonition info">
<div class="admonition-title">
<p>合约更新策略</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-合约更新策略"></a></p>
</div>
<div>
<p>我们使用以太坊中“合约更新策略”来解释Substrate的Runtime机制：</p>
</div>
</div>
<p>由于以太坊部署一个合约后，其地址已经被固定，且数据完全存储在这个合约地址下，若这个合约需要升级功能或出现Bug，将会带来许多的问题（比如许多垃圾山寨币的ERC20合约有溢出漏洞，被攻击后损失惨重，只能通过重新部署合约，**
并将老合约的数据重新导入的方式**进行合约升级，且此时的合约地址只能使用新的了）。</p>
<p>许多开发人员不断探索后发展出了如下的以太坊合约升级方式：</p>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Substrate_runtime_intro.jpeg" alt="Substrate_runtime_intro" /></p>
<p>熟悉以太坊的开发人员应该很容易理解上图表达的意思。</p>
<p>其核心思想是将一个合约拆分成为“逻辑合约”与“数据合约”，并使用一个“核心合约”将它们串在一起，这个核心合约就是用户的入口。</p>
<p>由于以太坊部署后的地址是固定的，所以将逻辑合约做成一个独立的合约，并将其地址设置在核心合约当中。那么只要更改核心合约中设置的地址，就可以更改核心合约执行的逻辑了。</p>
<p>并且由于以太坊的合约部署后都存在于“世界状态”当中，那么在同步区块时，老数据就会自动使用老的逻辑合约执行，而新的数据使用新的逻辑合约执行。</p>
<div id="admonition-链上代码" class="admonition tip">
<div class="admonition-title">
<p>链上代码</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-链上代码"></a></p>
</div>
<div>
<p>这里的“逻辑合约”就是“链上代码”的概念，它存在于被共识的数据当中，具备历史的意义</p>
</div>
</div>
<h4 id="substrate对应合约更新策略"><a class="header" href="#substrate对应合约更新策略">Substrate对应‘合约更新策略’</a></h4>
<p>那么将Substrate的框架对应过来，其中：</p>
<ul>
<li>“核心合约”的部分就是节点采用wasm执行去从“状态”存储中加载出最新的合约代码</li>
<li>“逻辑合约”的部分就是这条链的Runtime</li>
<li>“数据合约”的部分就是这条链自己的状态数据</li>
</ul>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/v2-b9bb441d00298a06de67ab8fdd368c08_720w.jpg" alt="img" /></p>
<div id="admonition-wasm" class="admonition tip">
<div class="admonition-title">
<p>wasm</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-wasm"></a></p>
</div>
<div>
<p>由此可见，由于wasm代码的存在，可以保证即使节点没有更新到最新版本，仍然能够<strong>以最新的代码运行</strong>，保证不会因为代码的不同而分叉。同时在节点同步老数据的过程中也<strong>不会因为本地代码是最新的而导致同步出错</strong></p>
</div>
</div>
<h2 id="项目结构"><a class="header" href="#项目结构">项目结构</a></h2>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/substrate_github.gif" alt="substrate_github" /></p>
<h3 id="客户端架构"><a class="header" href="#客户端架构">客户端架构</a></h3>
<h4 id="架构图"><a class="header" href="#架构图">架构图</a></h4>
<div id="admonition-substrate-client" class="admonition tip">
<div class="admonition-title">
<p>Substrate Client</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-substrate-client"></a></p>
</div>
<div>
<pre><code class="language-text">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃         ___ _   _ ___ ___ _____ ___    _ _____ ___    ___ _    ___ ___ _  _ _____        ┃
┃        / __| | | | _ ) __|_   _| _ \  /_\_   _| __|  / __| |  |_ _| __| \| |_   _|       ┃
┃        \__ \ |_| | _ \__ \ | | |   / / _ \| | | _|  | (__| |__ | || _|| .` | | |         ┃
┃        |___/\___/|___/___/ |_| |_|_\/_/ \_\_| |___|  \___|____|___|___|_|\_| |_|         ┃
┃                                                                                          ┃
┃                                                                                          ┃
┃     ┌───────────────┐     ┌──────────────────────────────────────────────────────────┐   ┃
┃     │               │     │                                                          │   ┃
┃     │               │     │                                                          │   ┃
┃     │               │     │                           RPC                            │   ┃
┃     │               │     │                                                          │   ┃
┃     │      P2P      │     │                                                          │   ┃
┃     │    NETWORK    │     └──────────────────────────────────────────────────────────┘   ┃
┃     │               │     ┌────────────────────────────────────────┐ ┌───────────────┐   ┃
┃     │               │     │                                        │ │               │   ┃
┃     │               │     │            ┌───────────────┐           │ │               │   ┃
┃     │               │     │            │               │           │ │   CONSENSUS   │   ┃
┃     └───────────────┘     │            │     Wasm      │           │ │               │   ┃
┃          .───────.        │            │    Runtime    │           │ │               │   ┃
┃       ,─'         '─.     │            │               │           │ └───────────────┘   ┃
┃      ╱               ╲░   │            └───────────────┘           │                     ┃
┃     ;     NATIVE      :░  │                                        │ ┌───────────────┐   ┃
┃     :     RUNTIME     ;░░ │                                        │ │               │   ┃
┃      ╲               ╱░░░ │                STORAGE                 │ │               │   ┃
┃       ╲             ╱░░░  │                                        │ │   TELEMETRY   │   ┃
┃        '─.       ,─'░░░   │                                        │ │               │   ┃
┃          ░`─────'░░░░░    │                                        │ │               │   ┃
┃             ░░░░░░░       └────────────────────────────────────────┘ └───────────────┘   ┃
┃                                                                                          ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
</code></pre>
</div>
</div>
<p>现在我们知道了 Substrate 是什么，让我们对框架、它的移动部分以及我们可以用来创建自定义区块链的扩展点进行高级概述。 
由于我们在这里处理的是去中心化的点对点系统，所以我们谈论的基本单元是节点,这是我们的区块链运行的地方。
该节点在客户端内部运行，并提供系统运行所需的所有基本组件，例如p2p网络、区块链的存储、块处理和共识的逻辑，以及从外部与区块链交互的能力。</p>
<h4 id="模块说明"><a class="header" href="#模块说明">模块说明</a></h4>
<blockquote>
<p>substrate客户端是基于substrate实现的区块链的节点客户端（可以理解为全节点），
它主要由以下几个组件组成（以下也就是告诉我们实现一条链由哪几部分组成）：</p>
</blockquote>
<h5 id="存储"><a class="header" href="#存储">存储</a></h5>
<p>用来维持区块链系统所呈现的状态演变。substrate提供了的存储方式是一种简单有效的key-value对存储机制的方式。</p>
<h5 id="runtime"><a class="header" href="#runtime">Runtime</a></h5>
<p>这里就可以回答上面的问题，什么是runtime？runtime定义了区块的处理方式，主要是状态转换的逻辑。在substrate中，runtime code被编译成wasm作为区块链存储状态的一部分。</p>
<h5 id="p2p网络"><a class="header" href="#p2p网络">p2p网络</a></h5>
<p>允许客户端和其它网络参与者进行通信。</p>
<h5 id="共识"><a class="header" href="#共识">共识</a></h5>
<p>提供了一种逻辑，能使网络参与者就区块链的状态达成一致。 substrate 支持提供自定义的共识引擎。</p>
<h5 id="rpc"><a class="header" href="#rpc">RPC</a></h5>
<p>远程过程调用。</p>
<h5 id="telemetry-遥测"><a class="header" href="#telemetry-遥测">telemetry （遥测）</a></h5>
<p>通过嵌入式Prometheus服务器的方式对外展示（我理解应该是类似于区块链浏览器一样的东西，或者是提供信息给区块链浏览器展示）。</p>
<h3 id="tree-level1"><a class="header" href="#tree-level1">Tree Level1</a></h3>
<p>首先来看看项目的整理结构：</p>
<pre><code class="language-shell"> tree -L 1 | pbcopy                                                                                                                                                                                                                        ─╯
.
├── Cargo.lock
├── Cargo.toml
├── HEADER-APACHE2
├── HEADER-GPL3
├── LICENSE-APACHE2
├── LICENSE-GPL3
├── README.md
├── bin
├── client
├── docker
├── docs
├── frame
├── primitives
├── rustfmt.toml
├── scripts
├── shell.nix
├── test-utils
└── utils

9 directories, 9 files
</code></pre>
<h4 id="用cargo组织代码"><a class="header" href="#用cargo组织代码">用Cargo组织代码</a></h4>
<p>Substrate非常明显使用Cargo来组织代码：</p>
<ol>
<li>项目根目录的Cargo.toml会用workspace+members导入各子模块</li>
</ol>
<pre><code class="language-yaml">[ workspace ]
  resolver = &quot;2&quot;

  members = [...]
</code></pre>
<div id="admonition-workspacememgers" class="admonition info">
<div class="admonition-title">
<p>workspace+memgers</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-workspacememgers"></a></p>
</div>
<div>
<p>在[workspace]项下, members 属性表示工作区目录中的程序库列表</p>
</div>
</div>
<ol start="2">
<li>各子模块之间也用Cargo.toml来相互导入使用</li>
</ol>
<pre><code class="language-yaml">[ dependencies ]
  sc-consensus = { version = &quot;0.10.0-dev&quot;, path = &quot;../../client/consensus/common&quot; }
</code></pre>
<div id="admonition-高内聚低耦合" class="admonition tip">
<div class="admonition-title">
<p>高内聚，低耦合</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-高内聚低耦合"></a></p>
</div>
<div>
<p>这里正是通过Cargo.toml的语法，将模块功能内聚之后供调用</p>
</div>
</div>
<h3 id="主要部分介绍nodeframecore"><a class="header" href="#主要部分介绍nodeframecore">主要部分介绍：Node、Frame、Core</a></h3>
<h4 id="substrate-node"><a class="header" href="#substrate-node">Substrate Node:</a></h4>
<p>我们将从 Substrate Node 开始。这是我们可以开始的最高级别；</p>
<p>它提供了最多的预建功能和最少的技术自由度。它是完全可运行的，包括所有基本组件的默认实现，例如:</p>
<ul>
<li>账户管理</li>
<li>特权访问</li>
<li>共识</li>
<li>...</li>
</ul>
<p>我们可以自定义链的创世块（即初始状态）以开始。 在这里，我们可以运行节点并熟悉 Substrate 提供的开箱即用的功能，玩转状态并与正在运行的区块链交互以熟悉。</p>
<p>另一种实现相同目的的方法是使用 <a href="https://substrate.io/developers/playground/">Substrate Playground</a>，您可以在其中查看后端和前端模板以熟悉它们。
然而，一旦我们准备好真正构建自己的区块链，我们最好降低一层并使用 FRAME。</p>
<pre><code class="language-shell">tree bin -L 2 | pbcopy                                                                                                                                                                                                                       ─╯
bin
├── node
│   ├── bench
│   ├── cli
│   ├── executor
│   ├── inspect
│   ├── primitives
│   ├── rpc
│   ├── runtime
│   └── testing
├── node-template: 使用Substrate写项目的基础模版
│   ├── LICENSE
│   ├── README.md
│   ├── docker-compose.yml
│   ├── docs
│   ├── node
│   ├── pallets
│   ├── runtime
│   ├── scripts
│   └── shell.nix
└── utils
    ├── chain-spec-builder
    └── subkey

18 directories, 4 files
</code></pre>
<h5 id="重点说说nodepallets和runtime"><a class="header" href="#重点说说nodepallets和runtime">重点说说node、pallets和runtime</a></h5>
<div id="admonition-nodepalletsruntimes" class="admonition tip">
<div class="admonition-title">
<p>node、pallets、runtimes</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-nodepalletsruntimes"></a></p>
</div>
<div>
<p>│   ├── node: 链的一些基础功能的实现（或者说比较底层的实现，如网络、rpc，搭建链的最基础的code)
│   ├── pallets: 放置的就是各个pallet，也就是业务相关的模块
│   ├── runtime: 可以简单理解为把所有pallet组合到一起，也就是业务相关的逻辑</p>
</div>
</div>
<p>三者的关系大致如下：</p>
<div id="admonition-nodepalletsruntime的关系" class="admonition tip">
<div class="admonition-title">
<p>node、pallets、runtime的关系</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-nodepalletsruntime的关系"></a></p>
</div>
<div>
<pre><code class="language-text">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃             ___ _   _ ___ ___ _____ ___    _ _____ ___   _  _  ___  ___  ___             ┃
┃            / __| | | | _ ) __|_   _| _ \  /_\_   _| __| | \| |/ _ \|   \| __|            ┃
┃            \__ \ |_| | _ \__ \ | | |   / / _ \| | | _|  | .` | (_) | |) | _|             ┃
┃            |___/\___/|___/___/ |_| |_|_\/_/ \_\_| |___| |_|\_|\___/|___/|___|            ┃
┃                                                                                          ┃
┃                                                                                          ┃
┃                                                                                          ┃
┃  ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ ┃
┃  ┃                         ___ _   _ _  _ _____ ___ __  __ ___                         ┃ ┃
┃  ┃                        | _ \ | | | \| |_   _|_ _|  \/  | __|                        ┃ ┃
┃  ┃                        |   / |_| | .` | | |  | || |\/| | _|                         ┃ ┃
┃  ┃                        |_|_\\___/|_|\_| |_| |___|_|  |_|___|                        ┃ ┃
┃  ┃                                                                                     ┃ ┃
┃  ┃                                                                                     ┃ ┃
┃  ┃                                                                                     ┃ ┃
┃  ┃                                                                                     ┃ ┃
┃  ┃    ┌───────────────┐    ┌───────────────┐    ┌───────────────┐   ┌───────────────┐  ┃ ┃
┃  ┃    │               │    │               │    │               │   │               │  ┃ ┃
┃  ┃    │   pallet 1    │    │   pallet 2    │    │      ...      │   │   pallet n    │  ┃ ┃
┃  ┃    │               │    │               │    │               │   │               │  ┃ ┃
┃  ┃    └───────────────┘    └───────────────┘    └───────────────┘   └───────────────┘  ┃ ┃
┃  ┃                                                                                     ┃ ┃
┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛ ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
</code></pre>
</div>
</div>
<blockquote>
<p>当然，对于pallets来说，在runtime中使用的pallet，有些是我们自己开发的pallet，有些是substrate中已经开发好的pallet，甚至还有些是pallet是第三方开发的pallet。</p>
</blockquote>
<h4 id="substrate-frame"><a class="header" href="#substrate-frame">Substrate FRAME</a></h4>
<p>FRAME (Framework for Runtime Aggregation of Modularized Entities) 是一个框架，用于从现有库构建 Substrate 运行时(Runtime)
，并具有高度的自由度来确定我们的区块链逻辑。</p>
<p>我们基本上是从 Substrate 的预构建节点模板开始，可以添加所谓的托盘（pallet, Substrate 库模块的名称）来定制和扩展我们的链。</p>
<p>在这个抽象级别，我们还能够完全自定义我们区块链的逻辑、状态和数据类型。这当然是大多数旨在接近 Substrate 的基本定制项目在易于开发和技术自由之间利用两全其美的地方。</p>
<div id="admonition-专注定制" class="admonition tip">
<div class="admonition-title">
<p>专注定制</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-专注定制"></a></p>
</div>
<div>
<p>从这个起点开始，我们必须投入最少的时间来建立我们的区块链，并且可以完全专注于我们自己的定制。</p>
</div>
</div>
<p>我们仍然需要在它们到来时采用一些默认值——或者更确切地说，因为它们可以被配置——但是如果我们从根本上想要做不同的事情，我们可以从 Core 开始再降低一步。</p>
<div id="admonition-frame" class="admonition info">
<div class="admonition-title">
<p>FRAME</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-frame"></a></p>
</div>
<div>
<p>The Framework for Runtime Aggregation of Modularized Entities (FRAME) is a set of modules and support libraries that simplify runtime development. 
In Substrate , these modules are called Pallets, each hosting domain-specific logic to include in a chain's runtime.</p>
<p>FRAME also provides some helper modules to interact with important Substrate Primitives that provide the interface to the core client.</p>
<p>The following diagram shows the architectural overview of FRAME and its support libraries:</p>
</div>
</div>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/frame-arch.png" alt="frame-arch" /></p>
<p><a href="https://docs.substrate.io/v3/runtime/frame/">FRAME | Substrate_</a></p>
<pre><code class="language-shell">tree frame -L 1 | pbcopy
frame
├── alliance: The Alliance Pallet provides a collective that curates a list of accounts and URLs, deemed by the voting members to be unscrupulous actors.
├── assets: A simple, secure module for dealing with fungible assets. The Assets module provides functionality for asset management of fungible asset classes with a fixed supply
├── atomic-swap: A module for atomically sending funds.
├── aura: The Aura module extends Aura consensus by managing offline reporting.
├── authority-discovery: This module is used by the client/authority-discovery to retrieve the current set of authorities.
├── authorship
├── babe
├── bags-list
├── balances: The Balances module provides functionality for handling accounts and balances.
├── beefy
├── beefy-mmr
├── benchmarking
├── bounties
├── child-bounties
├── collective
├── contracts
├── conviction-voting
├── democracy
├── election-provider-multi-phase
├── election-provider-support
├── elections-phragmen
├── examples
├── executive
├── gilt
├── grandpa
├── identity
├── im-online
├── indices
├── lottery
├── membership
├── merkle-mountain-range
├── multisig
├── nicks
├── node-authorization
├── nomination-pools
├── offences
├── preimage
├── proxy
├── randomness-collective-flip
├── ranked-collective
├── recovery
├── referenda
├── remark
├── scheduler
├── scored-pool
├── session
├── society
├── staking
├── state-trie-migration
├── sudo
├── support
├── system
├── timestamp
├── tips
├── transaction-payment
├── transaction-storage
├── treasury
├── try-runtime
├── uniques
├── utility
├── vesting
└── whitelist

62 directories, 0 files

</code></pre>
<h4 id="substrate-coreclient"><a class="header" href="#substrate-coreclient">Substrate Core(client)</a></h4>
<p>Substrate Core 本质上意味着我们可以以任何我们想要的方式实现我们的运行时，只要它以 WebAssembly 为目标并遵守 Substrate 块创建的基本法则。</p>
<p>然后，我们可以使用这个运行时并在 Substrate 节点中运行它。</p>
<div id="admonition-最高自由度" class="admonition info">
<div class="admonition-title">
<p>最高自由度</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-最高自由度"></a></p>
</div>
<div>
<p>这种方法当然需要最多的工作和最高的难度，但它也具有最高的技术自由度，同时仍然能够在 Substrate 生态系统中无缝工作。</p>
</div>
</div>
<p>说到 Substrate 的生态系统，有一个充满活力（充满活力）的开发者社区，他们在自己的项目中使用 Substrate，其中许多人通过共享自己的托盘(pallet)来回馈生态系统。</p>
<p>您可以通过使用诸如 <a href="https://substratemarketplace.com/">Substrate Market</a>
之类的站点或仅在托管 <a href="https://crates.io/">crates.io: Rust Package Registry</a> 的任何地方找到托盘(pallet)，因为 Substrate 托盘本质上是自包含的 Rust
库，您可以将其集成到您的 Substrate 项目中, 并根据需要进行配置。</p>
<p>与任何其他库一样，建议首先审核代码，并了解依赖外部代码与编写自己的代码之间的权衡。</p>
<p>在玩了一点预建节点之后，我们应该专注于 FRAME，学习如何通过在 Substrate 模板节点之上构建自定义区块链。这也是许多精彩教程的起点。</p>
<pre><code class="language-shell"> tree client -L 1 | pbcopy                                                                                                                                                                                                                    ─╯
client
├── allocator
├── api
├── authority-discovery
├── basic-authorship
├── beefy
├── block-builder
├── chain-spec
├── cli
├── consensus
├── db
├── executor
├── finality-grandpa
├── informant
├── keystore
├── network
├── network-gossip
├── offchain
├── peerset
├── proposer-metrics
├── rpc
├── rpc-api
├── rpc-servers
├── service
├── state-db
├── sync-state-rpc
├── sysinfo
├── telemetry
├── tracing
├── transaction-pool
└── utils

30 directories, 0 files
</code></pre>
<h3 id="其他"><a class="header" href="#其他">其他</a></h3>
<h4 id="primitives"><a class="header" href="#primitives">primitives</a></h4>
<pre><code class="language-shell">tree primitives -L 1 | pbcopy
primitives
├── api
├── application-crypto
├── arithmetic
├── authority-discovery
├── authorship
├── beefy
├── block-builder
├── blockchain
├── consensus
├── core
├── database
├── debug-derive
├── externalities
├── finality-grandpa
├── inherents
├── io
├── keyring
├── keystore
├── maybe-compressed-blob
├── merkle-mountain-range
├── npos-elections
├── offchain
├── panic-handler
├── rpc
├── runtime
├── runtime-interface
├── sandbox
├── serializer
├── session
├── staking
├── state-machine
├── std
├── storage
├── tasks
├── test-primitives
├── timestamp
├── tracing
├── transaction-pool
├── transaction-storage-proof
├── trie
├── version
└── wasm-interface

42 directories, 0 files

</code></pre>
<h4 id="scriptsci"><a class="header" href="#scriptsci">scripts/ci</a></h4>
<pre><code class="language-shell">tree scripts/ci | pbcopy
scripts/ci
├── common
│   └── lib.sh
├── deny.toml
├── docker
│   ├── subkey.Dockerfile
│   └── substrate.Dockerfile
├── github
│   ├── check_labels.sh
│   └── generate_changelog.sh
├── gitlab
│   ├── check_runtime.sh
│   ├── check_signed.sh
│   ├── ensure-deps.sh
│   ├── pipeline
│   │   ├── build.yml
│   │   ├── check.yml
│   │   ├── publish.yml
│   │   └── test.yml
│   ├── publish_draft_release.sh
│   └── skip_if_draft.sh
├── monitoring
│   ├── alerting-rules
│   │   ├── alerting-rule-tests.yaml
│   │   └── alerting-rules.yaml
│   └── grafana-dashboards
│       ├── README_dashboard.md
│       ├── substrate-networking.json
│       └── substrate-service-tasks.json
├── node-template-release
│   ├── Cargo.toml
│   └── src
│       └── main.rs
└── node-template-release.sh

10 directories, 23 files

</code></pre>
<h4 id="utils"><a class="header" href="#utils">utils</a></h4>
<pre><code class="language-shell">tree utils -L 1 | pbcopy
utils
├── build-script-utils
├── fork-tree
├── frame
├── prometheus
└── wasm-builder

5 directories, 0 files

</code></pre>
<h2 id="功能逻辑"><a class="header" href="#功能逻辑">功能逻辑</a></h2>
<div id="admonition-注意" class="admonition tip">
<div class="admonition-title">
<p>注意</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-注意"></a></p>
</div>
<div>
<p>这里将结合前面提到的runtim/core分块方式来进行功能模块说明</p>
</div>
</div>
<h2 id="特色代码"><a class="header" href="#特色代码">特色代码</a></h2>
<h2 id="参考资源"><a class="header" href="#参考资源">参考资源</a></h2>
<h3 id="online-book"><a class="header" href="#online-book">online-book</a></h3>
<ul>
<li><a href="https://github.com/paritytech/substrate">paritytech/substrate: Substrate: The platform for blockchain innovators</a></li>
<li><a href="https://docs.substrate.io/v3/getting-started/architecture/">Architecture | Substrate_</a></li>
<li><a href="https://www.bilibili.com/video/BV1KT4y1Y7Uf">substrate轻松学</a></li>
</ul>
<h3 id="fragment"><a class="header" href="#fragment">fragment</a></h3>
<ul>
<li><a href="https://www.zhihu.com/column/c_74315572">链块与分散的数据 - 知乎</a></li>
<li><a href="https://web.archive.org/web/20220627112702/https://mp.weixin.qq.com/s/MP0LXWVqUn5R4C6fAbe1nQ">区块链与substrate</a></li>
<li><a href="https://web.archive.org/web/20220618042220/https://zhuanlan.zhihu.com/p/47805322">substrate 源码解析与运用 - 介绍 - 知乎</a></li>
<li><a href="https://www.zhihu.com/column/substrate">Substrate区块链开发 - 知乎</a></li>
<li><a href="https://substrate.io/ecosystem/">Substrate Ecosystem | Substrate_</a></li>
<li><a href="https://blog.logrocket.com/substrate-blockchain-framework-core-concepts/"><strong>Substrate blockchain development: Core concepts - LogRocket
Blog</strong></a>：对Substrate的简要介绍</li>
<li><a href="https://substrate.io/developers/playground/">Playground | Substrate_</a></li>
<li><a href="https://substratemarketplace.com/">Substrate Market</a></li>
<li><a href="https://crates.io/">crates.io: Rust Package Registry</a></li>
<li><a href="https://docs.substrate.io/quick-start/">Quick start | Substrate Docs</a></li>
<li><a href="https://docs.substrate.io/tutorials/">Tutorials | Substrate Docs</a></li>
<li><a href="https://substrate.io/ecosystem/projects/">Projects | Substrate_</a>: 一些基于Substrate建立的项目，值得参考</li>
<li><a href="https://docs.substrate.io/tutorials/v3/kitties/pt1/">Build the Substrate Kitties Chain | Substrate_</a>: 教你建立一个nft平台</li>
<li><a href="https://docs.substrate.io/v3/runtime/frame/">FRAME | Substrate_</a></li>
<li><a href="https://medium.com/frctls/the-substrate-guide-i-wish-i-had-6bc76b10ddd2">The Substrate Guide I Wish I Had. Fractal’s blockchain lead Shelby… | by Fractal | Fractal | Medium</a></li>
<li><a href="https://docs.substrate.io/reference/how-to-guides/">How-to quick reference guides | Substrate Docs</a></li>
</ul>
<h3 id="runtime-1"><a class="header" href="#runtime-1">Runtime</a></h3>
<ul>
<li><a href="https://web.archive.org/web/20220627114404/https://zhuanlan.zhihu.com/p/79539782">剖析Substrate Runtime - 知乎</a>
<blockquote>
<p>基于Substrate开发自己的运行时模块，会遇到一个比较大的挑战，就是理解Substrate运行时（Runtime）。
本文首先介绍了Runtime的架构，类型，常用宏，并结合一个实际的演示项目，做了具体代码分析，以帮助大家更好地理解在Substrate中它们是如何一起工作的。</p>
</blockquote>
</li>
</ul>
<h3 id="local"><a class="header" href="#local">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="漫话rust"><a class="header" href="#漫话rust">漫话Rust</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/1_learning_resource/talks.html#%E6%BC%AB%E8%AF%9Drust">漫话Rust</a>
<ul>
<li><a href="layer5_ecosystem/1_learning_resource/talks.html#%E8%AF%9D%E9%A2%98">话题</a>
<ul>
<li><a href="layer5_ecosystem/1_learning_resource/talks.html#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A7%89%E5%BE%97-rust-%E9%9A%BE%E4%B8%8A%E6%89%8B%E5%B0%A4%E5%85%B6%E6%98%AF%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F---%E7%9F%A5%E4%B9%8E">为什么觉得 Rust 难上手，尤其是生命周期？ - 知乎</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:21 UTC 2022 -->
<!--te-->
<h2 id="话题"><a class="header" href="#话题">话题</a></h2>
<h3 id="为什么觉得-rust-难上手尤其是生命周期---知乎"><a class="header" href="#为什么觉得-rust-难上手尤其是生命周期---知乎">为什么觉得 Rust 难上手，尤其是生命周期？ - 知乎</a></h3>
<ul>
<li><a href="https://www.zhihu.com/question/537491826">为什么觉得 Rust 难上手，尤其是生命周期？ - 知乎</a></li>
</ul>
<div id="admonition-把技巧掺杂在上手过程里" class="admonition quote">
<div class="admonition-title">
<p>把技巧掺杂在上手过程里</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/1_learning_resource/talks.html#admonition-把技巧掺杂在上手过程里"></a></p>
</div>
<div>
<p>因为其他语言上手真的就只是上手而已，你还得买《Effective Xxxx》甚至《More Effective Xxxx》，以及《Xxx并发编程》《深入理解Xxx虚拟机》等等各种书籍来学习各种避坑、省力、debug技巧。而Rust的上手是把这些技巧直接掺在上手过程里了，编译器以及配套工具（比如错误提示里的help，fmt、clippy）逼着你把代码写对，上手Rust等于同时被迫学会了这一堆技巧。</p>
</div>
</div>
<div id="admonition-区分编译期抽象和运行期抽象" class="admonition quote">
<div class="admonition-title">
<p>区分编译期抽象和运行期抽象</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/1_learning_resource/talks.html#admonition-区分编译期抽象和运行期抽象"></a></p>
</div>
<div>
<ol>
<li>学习 rust 上手难一般是因为缺乏丰富的 Cpp 经验。因此，大家会对【胖指针】【瘦指针】【虚表 vtable 】等基础概念缺少深刻的理解。而这些概念正是区分 rust 中【编译期间-抽象 — 单态化】与【运行期间-抽象 — <code>trait Object</code> 】的认知“门槛”。</li>
<li>另一方面，学习lifetime 上手难是因为大家已经习惯了“颐指气使”地向计算机“发号施令”和下达指示了。</li>
<li>但是， lifetime  完全是另一码事。就【生命周期】而言， rustc 的角色是【仲裁者】，而不是【执行者】。</li>
</ol>
<blockquote>
<p>【生命周期·标注】被设计用来：由 @程序员 向【仲裁者 rustc 】表述自己的代码设计意图（这些意图通过直接扫描代码不容易被揣测出来）。然后，再由【仲裁者】判断你的代码意图是否可行，因为代码首先得足够安全。</p>
</blockquote>
<p>所以，你不能命令 rustc ：我要求某某变量一定得活多长时间（一切皆可操控，那是 Cpp）；而是，询问 rustc ：我如此设计代码，想让某某变量活这么长时间，你看行得通吗？若 rustc 判定行不通，那么一个编译错误就等着你了。</p>
<p>比如说，函数的【生命周期_泛型参数】是被用来将</p>
<ol>
<li>引用类型的函数入参的生命周期与</li>
<li>引用类型的函数返回值的生命周期关联起来。</li>
</ol>
<p>以便，在对代码做【静态分析】时，编译器能够根据（已知）入参推断出函数返回值的生命周期。</p>
<blockquote>
<p>这是帮助编译器理解咱们代码的“脚注”，而不是给编译器下达的“指示”。得和 <code>rustc</code> “商量”着来。</p>
</blockquote>
</div>
</div>
<div id="admonition-对c不熟悉" class="admonition quote">
<div class="admonition-title">
<p>对C++不熟悉</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/1_learning_resource/talks.html#admonition-对c不熟悉"></a></p>
</div>
<div>
<p>最直接的原因就是对C++不熟悉，如果你明白移动语义，完美转发，智能指针这些东西。Rust也不过是强制我们在正确使用C++里面的某些工具而已。</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="底层抽象"><a class="header" href="#底层抽象">底层抽象</a></h1>
<!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/layer1_underlying_abstract.html#%E5%BA%95%E5%B1%82%E6%8A%BD%E8%B1%A1">底层抽象</a></li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:09 UTC 2022 -->
<!--te--><div style="break-before: page; page-break-before: always;"></div><!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/virtual_memory.html#%E4%BB%8B%E7%BB%8D">介绍</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/virtual_memory.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/virtual_memory.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/virtual_memory.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/virtual_memory.html#local">local</a></li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:03 UTC 2022 -->
<!--te-->
<h2 id="介绍"><a class="header" href="#介绍">介绍</a></h2>
<p>从计算机组成原理了解到操作系统，当一个程序开始运行的时候，不论是可执行程序还是命令行，都会从创建进程，申请进程资源开始，再到堆栈(stack/heap)
的使用，申请与释放资源。这一系列操作对于编程来说重要性不言而喻，只不过根据编程语言的高级程度不同，开发者需要掌握的知识也有不同。</p>
<p>而在rust语言编程中，内存的管理方式及其重要。所以这一层主要先介绍虚拟内存管理以及相关出现的内容安全问题，接着介绍rust是如何通过所有权、作用域和生命周期，引申出借用、移动语义、复制语义等一系列内容来解决内存安全问题。</p>
<h2 id="参考资源-1"><a class="header" href="#参考资源-1">参考资源</a></h2>
<h3 id="online-book-1"><a class="header" href="#online-book-1">online-book</a></h3>
<h3 id="fragment-1"><a class="header" href="#fragment-1">fragment</a></h3>
<h3 id="local-1"><a class="header" href="#local-1">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="内存管理与内存安全"><a class="header" href="#内存管理与内存安全">内存管理与内存安全</a></h1>
<!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/memory_manage_safety.html#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E4%B8%8E%E5%86%85%E5%AD%98%E5%AE%89%E5%85%A8">内存管理与内存安全</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/memory_manage_safety.html#%E5%8F%82%E8%80%83">参考</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/memory_manage_safety.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/memory_manage_safety.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/memory_manage_safety.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:01 UTC 2022 -->
<!--te-->
<h2 id="参考"><a class="header" href="#参考">参考</a></h2>
<h3 id="online-book-2"><a class="header" href="#online-book-2">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/stable/reference/memory-model.html">Memory model - The Rust Reference</a></li>
</ul>
<h3 id="fragment-2"><a class="header" href="#fragment-2">fragment</a></h3>
<ul>
<li><a href="https://segmentfault.com/a/1190000020338427">Go内存分配那些事，就这么简单！ - SegmentFault 思否</a></li>
</ul>
<h3 id="local-2"><a class="header" href="#local-2">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="所有权三件套所有权借用与生命周期"><a class="header" href="#所有权三件套所有权借用与生命周期">所有权三件套：所有权、借用与生命周期</a></h1>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Ownership.jpeg" alt="Ownership" /></p>
<!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E6%89%80%E6%9C%89%E6%9D%83%E4%B8%89%E4%BB%B6%E5%A5%97%E6%89%80%E6%9C%89%E6%9D%83%E5%80%9F%E7%94%A8%E4%B8%8E%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">所有权三件套：所有权、借用与生命周期</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E7%BB%BC%E8%BF%B0">综述</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E6%89%80%E6%9C%89%E6%9D%83">所有权</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E8%B5%84%E6%BA%90%E6%89%80%E6%9C%89%E8%80%85">资源所有者</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E8%B5%84%E6%BA%90%E6%89%80%E6%9C%89%E8%80%85%E8%B4%9F%E8%B4%A3%E9%87%8A%E6%94%BE">资源所有者负责释放</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%8A%A8%E6%80%81%E8%AF%AD%E8%A8%80%E9%9D%A0gc%E5%9C%A8%E8%BF%90%E8%A1%8C%E6%9C%9F%E5%A4%84%E7%90%86">动态语言靠GC在运行期处理</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E9%9D%99%E6%80%81%E8%AF%AD%E8%A8%80%E5%9C%A8%E7%BC%96%E8%AF%91%E6%9C%9F%E8%A7%84%E5%AE%9A">静态语言在编译期规定</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#rust%E7%9A%84%E6%89%80%E6%9C%89%E6%9D%83%E8%A7%84%E5%88%99">Rust的所有权规则</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E6%8F%A3%E6%91%A9%E6%89%80%E6%9C%89%E6%9D%83%E5%90%AB%E4%B9%89">揣摩所有权含义</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%89%80%E6%9C%89%E6%9D%83%E8%80%83%E8%99%91%E5%9B%A0%E7%B4%A0">作用域：所有权考虑因素</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%A4%9A%E4%BD%9C%E7%94%A8%E5%9F%9F%E7%9A%84%E6%83%85%E5%86%B5%E5%88%86%E6%9E%90">多作用域的情况分析</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%98%AF%E6%8E%A8%E6%96%AD%E6%89%80%E6%9C%89%E6%9D%83%E6%97%B6%E7%9A%84%E4%B8%80%E4%B8%AA%E9%87%8D%E8%A6%81%E5%B1%9E%E6%80%A7">作用域是推断所有权时的一个重要属性</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%BC%95%E5%85%A5%E7%A7%BB%E5%8A%A8%E5%92%8C%E5%A4%8D%E5%88%B6%E8%AF%AD%E4%B9%89">引入移动和复制语义</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E8%AF%AD%E4%B9%89%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D">语义是什么意思</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E7%A7%BB%E5%8A%A8%E8%AF%AD%E4%B9%89%E5%8F%98%E9%87%8F%E8%AE%BF%E9%97%AE%E6%88%96%E9%87%8D%E6%96%B0%E5%88%86%E9%85%8D%E6%97%B6%E9%BB%98%E8%AE%A4">移动语义：变量访问或重新分配时默认</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%A4%8D%E5%88%B6%E8%AF%AD%E4%B9%89">复制语义</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E4%BD%BF%E7%94%A8copy%E7%89%B9%E5%BE%81%E6%9B%B4%E6%94%B9%E8%AF%AD%E4%B9%89">使用Copy特征更改语义</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#copy-%E7%89%B9%E5%BE%81%E4%BE%9D%E8%B5%96%E4%BA%8Eclone-%E7%89%B9%E5%BE%81">Copy 特征依赖于Clone 特征</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%8C%BA%E5%88%AB%E4%B8%80%E4%B8%8Bcopy%E4%B8%8Eclone-trait">区别一下Copy与Clone trait</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#copy">Copy</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#clone">Clone</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#copy%E4%B8%8Eclone%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%88%99">Copy与Clone的使用原则</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E4%BD%95%E6%97%B6%E5%9C%A8%E7%B1%BB%E5%9E%8B%E4%B8%8A%E5%AE%9E%E7%8E%B0-copy">何时在类型上实现 Copy</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E4%BD%95%E6%97%B6%E5%9C%A8%E7%B1%BB%E5%9E%8B%E4%B8%8A%E5%AE%9E%E7%8E%B0-clone">何时在类型上实现 Clone。</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E6%89%80%E6%9C%89%E6%9D%83%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">所有权使用场景</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#let%E7%BB%91%E5%AE%9A%E7%A4%BA%E4%BE%8B">let绑定示例</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%B0%86%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%E7%BB%99%E5%87%BD%E6%95%B0">将参数传递给函数</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#match%E8%A1%A8%E8%BE%BE%E5%BC%8F">match表达式</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#impl%E4%BB%A3%E7%A0%81%E5%9D%97">impl代码块</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E9%97%AD%E5%8C%85">闭包</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%80%9F%E7%94%A8-%E9%80%9A%E8%BF%87%E5%BC%95%E7%94%A8%E8%A7%84%E9%81%BF%E6%89%80%E6%9C%89%E6%9D%83%E8%A7%84%E5%88%99%E9%99%90%E5%88%B6">借用: 通过引用规避所有权规则限制</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E4%B8%BA%E4%BD%95%E9%9C%80%E8%A6%81%E5%80%9F%E7%94%A8%E5%BC%95%E7%94%A8">为何需要借用/引用</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%80%9F%E7%94%A8-or-%E5%BC%95%E7%94%A8">借用 or 引用？</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E4%B8%A4%E7%A7%8D%E5%80%9F%E7%94%A8%E6%96%B9%E5%BC%8F">两种借用方式</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%80%9F%E7%94%A8">不可变借用：&amp;</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%8F%AF%E5%8F%98%E5%80%9F%E7%94%A8mut">可变借用：&amp;mut</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%80%9F%E7%94%A8%E8%A7%84%E5%88%99">借用规则</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%A6%82%E6%9E%9C%E8%BF%9D%E5%8F%8D%E5%80%9F%E7%94%A8%E8%A7%84%E5%88%99">如果违反借用规则</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%87%BD%E6%95%B0%E4%B8%AD%E7%9A%84%E5%80%9F%E7%94%A8">函数中的借用</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%8C%B9%E9%85%8D%E4%B8%AD%E7%9A%84%E5%80%9F%E7%94%A8">匹配中的借用</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E4%BB%8E%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%BC%95%E7%94%A8">从函数返回引用：</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%9F%BA%E4%BA%8E%E5%80%9F%E7%94%A8%E8%A7%84%E5%88%99%E7%9A%84%E6%96%B9%E6%B3%95%E7%B1%BB%E5%9E%8B">基于借用规则的方法类型</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%88%E5%AF%B9%E5%BC%95%E7%94%A8%E9%99%84%E5%8A%A0%E7%9A%84%E4%BF%A1%E6%81%AF">生命周期：针对引用附加的信息</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E4%BB%8E%E5%8F%98%E9%87%8F%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%BC%80%E5%A7%8B">从变量生命周期开始</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%99%90%E5%AE%9A">生命周期限定</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%B3%A8%E8%A7%A3">生命周期注解</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9C%81%E7%95%A5lifetime-elision">生命周期省略(Lifetime Elision)</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E9%94%80%E6%AF%81destructors">销毁(Destructors)</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:03 UTC 2022 -->
<!--te-->
<h2 id="综述"><a class="header" href="#综述">综述</a></h2>
<pre><code class="language-text">┌───────────────────────────────────┐
│                                   │
│                                   │
│         .───────.       ┌──────┐  │
│       ,'         `.     │Borrow│  │
│     ,'             `.   └──────┘  │
│    ;   ┌─────────┐   :            │
│    │   │OwnerShip│   │            │
│    │   └─────────┘   │            │
│    :     ┌─────┐     ; ┌────────┐ │
│     ╲    │Scope│    ╱  │Lifetime│ │
│      `.  └─────┘  ,'   └────────┘ │
│        `.       ,'                │
│          `─────'                  │
│                                   │
│                                   │
└───────────────────────────────────┘
</code></pre>
<p>所有权、作用域、借用与生命周期是 Rust 的内存安全及其零成本抽象原则的核心。 它们让 Rust 能够在编译期检测程序中内存安全违规,在离开作用域时自动释放相关资源等情况。
所有权有点类似核心原则,而借用和生命周期是对语言类型系统的扩展。在代码的不同上下文中加强或有时放松所有权原则,可确保编译期内存管理正常运作。</p>
<h2 id="所有权"><a class="header" href="#所有权">所有权</a></h2>
<h3 id="资源所有者"><a class="header" href="#资源所有者">资源所有者</a></h3>
<p>程序中资源的真正所有者的概念因语言而异。这里的含义是通过资源, 主要包含下列内容：</p>
<ol>
<li>共同引用在堆或堆栈上保存值的任何变量</li>
<li>或者是包含打开文件描述符、数据库连接套接字、网络套接字及类似内容的变量。</li>
</ol>
<p>从它们存在到完成程序调用及其之后的时间,都会占用一些内存。</p>
<h3 id="资源所有者负责释放"><a class="header" href="#资源所有者负责释放">资源所有者负责释放</a></h3>
<blockquote>
<p>资源所有者的一个重要职责就是明智地释放它们使用的内存,因为如果无法在适当的位置和时间执行取消内存分配,就可能导致内存泄漏。</p>
</blockquote>
<h4 id="动态语言靠gc在运行期处理"><a class="header" href="#动态语言靠gc在运行期处理">动态语言靠GC在运行期处理</a></h4>
<p>在使用 Python 等动态语言编程时,可以将多个所有者或别名添加到 list 对象中,从而使用执行该对象的众多变量之一添加或删除 list 中的项目。变量不需要关心如何释放对象使用过的内存,因为 GC
会处理这些事情,并且一旦指向对象的所有引用都消失,GC 就会释放相关的内存。</p>
<h4 id="静态语言在编译期规定"><a class="header" href="#静态语言在编译期规定">静态语言在编译期规定</a></h4>
<p>对于 C/C++/Golang之类的编译语言,在智能指针出现之前,程序库对代码使用完毕的相关资源 API 的调用方或者被调用方是否负责释放内存有明确的规定。存在这些规则是因为编译器不会在这些语言中强制限定所有权。在
C++中不使用智能指针仍然有可能出现问题。在C++中,存在多个变量指向堆上的某个值是完全没问题的(尽管我们不建议这么做) ,这就是所谓的别名。由于具有指向资源的多个指针或别名的灵活性,程序员会遇到各种各样的问题,其中之一就是
C++中的迭代器失效问题。</p>
<blockquote>
<p>具体而言,当给定作用域中资源的其他不可变别名相对存在至少一个可变别名时,就会出现问题</p>
</blockquote>
<h3 id="rust的所有权规则"><a class="header" href="#rust的所有权规则">Rust的所有权规则</a></h3>
<p>Rust 试图为程序中值的所有权设定适当的语义。Rust 的所有权规则遵循以下原则。</p>
<ul>
<li>使用 let 语句创建值或资源,并将其分配给变量时,该变量将成为资源的所有者。</li>
<li>当值从一个变量重新分配给另一个变量时, 值的所有权将转移至另一个变量, 原来的变量将失效以便另作他用。</li>
<li>值和变量在其作用域的末尾会被清理、释放。</li>
</ul>
<h3 id="揣摩所有权含义"><a class="header" href="#揣摩所有权含义">揣摩所有权含义</a></h3>
<p>需要注意的是,Rust 中的值只有一个所有者,即创建它们的变量。其理念很简单,但是它的含义值得揣摩：</p>
<pre><pre class="playground"><code class="language-rust  editable">// ownership_basics.rs

#[derive(Debug)]
struct Foo(u32);

fn main() {
    // 根据所有权规则, foo 是 Foo 实例的所有者
    let foo = Foo(2048);
    /*
        bar 成为Foo 实例的新所有者, 而旧的 foo 是一个废弃变量.
        经过此变动之后不能在其他任何地方使用
    */
    let bar = foo; // value moved here
    /*
        每当我们将变量分配给某个其他变量或从变量读取数据时,Rust 会默认移动变量指向的值。
        所有权规则可以防止你通过多个访问点来修改值,这可能导致访问已被释放的变量.
        即使在单线程上下文中,使用允许多个值的可变别名的语言也是如此
    */
    println!(&quot;Foo is {:?}&quot;, foo);  // value borrowed here after move
    println!(&quot;Bar is {:?}&quot;, bar);
}
</code></pre></pre>
<p>每当我们将变量分配给某个其他变量或从变量读取数据时,Rust 会默认移动变量指向的值。所有权规则可以防止你通过多个访问点来修改值,这可能导致访问已被释放的变量,即使在单线程上下文中,使用允许多个值的可变别名的语言也是如此</p>
<h3 id="作用域所有权考虑因素"><a class="header" href="#作用域所有权考虑因素">作用域：所有权考虑因素</a></h3>
<blockquote>
<p>为了分析某个值何时超出作用域,所有权规则还会考虑变量的作用域</p>
</blockquote>
<ol>
<li>在 Rust 的背景下, 所有权与作用域协同工作。</li>
<li>因此,作用域只不过是变量和值存在的环境。你声明的每个变量都与作用域有关。</li>
<li>代码中的作用域是由一对花括号表示的。无论何时使用块表达式都会创建一个作用域,即任何以花括号开头和结尾的表达式。</li>
<li>此外,作用域支持互相嵌套,并且可以在子作用域中访问父作用域的元素,但反过来不行</li>
</ol>
<h4 id="多作用域的情况分析"><a class="header" href="#多作用域的情况分析">多作用域的情况分析</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">// scopes.rs

/*
由于函数可以创建新的作用域, 因此 main 函数引入了根级别作用域 0,
在代码中定义为 level_0_str
*/
fn main() {
    let level_0_str = String::from(&quot;foo&quot;);
    /*
        在 0 级作用域中, 创建了一个新的作用域,即作用域 1,
        并且带有一个花括号,其中包含变量level_1_number。
    */
    {
        let level_1_number = 9;
        /*
            在 1 级作用域中, 创建了一个块表达式, 它成为 2 级作用域。
            在其中, 声明了另一个变量 level_2_vector,
            以便可以将 level_1_number 添加到其中,
            而level_1_number 来自其父级作用域 1
        */
        {
            let mut level_2_vector = vec![1, 2, 3];
            level_2_vector.push(level_1_number);    // can access
        } // level_2_vector goes out of scope here 

        level_2_vector.push(4);    // no longer exists
    } // level_1_number goes out of scope here
} // level_0_str goes out of scope here
</code></pre></pre>
<h4 id="作用域是推断所有权时的一个重要属性"><a class="header" href="#作用域是推断所有权时的一个重要属性">作用域是推断所有权时的一个重要属性</a></h4>
<blockquote>
<p>作用域还会被用来推断后续介绍的借用和生命周期。</p>
</blockquote>
<ol>
<li>当作用域结束时,拥有值的任何变量都会运行相关代码以取消分配该值,并且其自身在作用域之外是无效的。</li>
<li>特别是对在堆上分配的值,drop 方法会被放在作用域结束标记}之前调用。</li>
<li>这类似于在 C 语言中调用 free 函数,但这里是隐式的, 并且可以避免程序员忘记释放值。</li>
<li>drop 方法来自 Drop 特征,它是为 Rust 中大部分堆分配类型实现的,可以轻松地自动释放资源。</li>
</ol>
<h3 id="引入移动和复制语义"><a class="header" href="#引入移动和复制语义">引入移动和复制语义</a></h3>
<blockquote>
<p>结合作用域判断一下下列代码是否正确</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// ownership_primitives.rs

fn main() {
    let foo = 4623;
    /*
        4623 的所有权不会从 foo 转移到 bar,但 bar 会获得4623 的单独副本。
        看起来基元类型在 Rust 中会被特殊对待,它们会被移动而不是复制。
        这意味着根据我们在 Rust 中使用的类型,存在不同的所有权语义,这将引入移动和复制语义的概念
    */
    let bar = foo;
    println!(&quot;{:?} {:?}&quot;, foo, bar); 
}
</code></pre></pre>
<h4 id="语义是什么意思"><a class="header" href="#语义是什么意思">语义是什么意思</a></h4>
<p>以移动语义为例，在 Rust
中,变量绑定默认具有移动语义。但这究竟意味着什么?要理解这一点,我们需要考虑如何在程序中使用变量。我们创建值或资源并将它们分配给变量,以便在程序中可以方便地引用它们。这些变量是指向值所在内存地址的名称。现在,诸如读取、赋值、添加及将它们传递给函数等对变量的操作,在访问变量指向值的方式上可能具有不同的语义或含义。在静态类型语言中,这些语义大致分为移动语义和复制语义。</p>
<h4 id="移动语义变量访问或重新分配时默认"><a class="header" href="#移动语义变量访问或重新分配时默认">移动语义：变量访问或重新分配时默认</a></h4>
<blockquote>
<p>通过变量访问或重新分配给变量时移动到接收项的值表示移动语义。</p>
</blockquote>
<p>由于Rust 的仿射类型系统,它默认会采用移动语义。仿射类型系统的一个突出特点是值或资源只能使用一次,而 Rust 通过所有权规则展示此属性。</p>
<h4 id="复制语义"><a class="header" href="#复制语义">复制语义</a></h4>
<p>默认情况下,通过变量分配或访问,以及从函数返回时复制的值(例如按位复制)具有复制语义。这意味着该值可以使用任意次数,每个值都是全新的。</p>
<h4 id="使用copy特征更改语义"><a class="header" href="#使用copy特征更改语义">使用Copy特征更改语义</a></h4>
<p>Rust 中的移动语义有时会受到限制。幸运的是,通过实现 Copy 特征可以更改类型的行为以遵循复制语义。基元和其他仅适用于堆栈的数据类型在默认情况下实现了上述特征,这也是前面的基元代码能够正常工作的原因</p>
<pre><pre class="playground"><code class="language-rust  editable">// making_copy_types.rs

#[derive(Copy, Debug)]  // the trait `Clone` is not implemented for `Dummy`
struct Dummy;

fn main() {
    let a = Dummy;
    let b = a;
    println!(&quot;{:?}&quot;, a);
    println!(&quot;{:?}&quot;, b);
}
</code></pre></pre>
<h4 id="copy-特征依赖于clone-特征"><a class="header" href="#copy-特征依赖于clone-特征">Copy 特征依赖于Clone 特征</a></h4>
<blockquote>
<p>Clone 是 Copy 的父级特征, 任何实现 Copy 特征的类型必须实现 Clone。</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// making_copy_types.rs

// 可以在派生注释中的 Copy 旁边添加 Clone 特征来让该示例通过编译
#[derive(Copy, Clone, Debug)]
struct Dummy;

fn main() {
    let a = Dummy;
    let b = a;
    println!(&quot;{:?}&quot;, a);
    println!(&quot;{:?}&quot;, b);
}
</code></pre></pre>
<h3 id="区别一下copy与clone-trait"><a class="header" href="#区别一下copy与clone-trait">区别一下Copy与Clone trait</a></h3>
<blockquote>
<p>Copy 和 Clone 特征传达了在代码中使用类型时如何进行复制的原理。</p>
</blockquote>
<p>| 特征  |     复制方式     | 复制内容 |               使用场景               |
| :---: | :--------------: | :------: | :----------------------------------: |
| Copy  | 隐式，自动化特征 |   堆栈   |     可以在堆栈上单独表示的小型值     |
| Clone |  显式调用clone   |  堆+栈   | 在堆上还包含一个值作为其表示的一部分 |</p>
<h4 id="copy"><a class="header" href="#copy">Copy</a></h4>
<ol>
<li>Copy 特征通常用于可以在堆栈上完全表示的类型, 也就是说它们自身没有任何部分位于堆上。</li>
<li>如果出现了这种情况,那么 Copy 将是开销很大的操作,因为它必须从堆中复制值。这直接影响到赋值运算符的工作方式。</li>
<li>如果类型实现了 Copy,则从一个变量到另一个变量的赋值操作将隐式复制数据。</li>
</ol>
<h4 id="clone"><a class="header" href="#clone">Clone</a></h4>
<p>Clone 特征用于显式复制, 并附带 clone 方法, 类型可以实现该方法以获取自身的副本</p>
<p>Clone 有一个名为 clone 的方法,用于获取接收者的不可变引用,即&amp;self,并返回相同类型的新值。用户自定义类型或任何需要提供能够复制自身的包装器类型,应通过实现clone 方法来实现 Clone 特征</p>
<blockquote>
<p>一个通过 Clone 特征复制类型的示例</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// explicit_copy.rs

// 在 derive 属性中添加了一个 Clone 特征。
#[derive(Clone, Debug)]
struct Dummy {
    items: u32,
}

fn main() {
    let a = Dummy { items: 54 };
    // 有了Clone, 我们就可以在 a 上调用 clone 方法来获得它的新副本
    let b = a.clone();
    println!(&quot;a: {:?}, b: {:?}&quot;, a, b);
}
</code></pre></pre>
<h3 id="copy与clone的使用原则"><a class="header" href="#copy与clone的使用原则">Copy与Clone的使用原则</a></h3>
<h4 id="何时在类型上实现-copy"><a class="header" href="#何时在类型上实现-copy">何时在类型上实现 Copy</a></h4>
<blockquote>
<p>可以在堆栈上单独表示的小型值如下所示。</p>
</blockquote>
<ul>
<li>如果类型仅依赖于在其上实现了 Copy 特征的其他类型, 则 Copy 特征是为其隐式实现的。</li>
<li>Copy 特征隐式影响赋值运算符的工作方式。 使用 Copy 特征构建自定义外部可见类型需要考虑它是否会对赋值运算符产生影响。 如果在开发的早期阶段,
你的类型是Copy,后续将它移除之后则会影响使用该类型进行赋值的所有环节。你可以通过这种方式轻松地破坏 API。</li>
</ul>
<h4 id="何时在类型上实现-clone"><a class="header" href="#何时在类型上实现-clone">何时在类型上实现 Clone。</a></h4>
<ul>
<li>Clone 特征只是声明一个 clone 方法,需要被显式调用。</li>
<li>如果你的类型在堆上还包含一个值作为其表示的一部分, 那么可选择实现 Clone 特征,这也需要向复制堆数据的用户明确表示。</li>
<li>如果要实现智能指针类型(例如引用计数类型) ,那么应该在类型上实现 Clone 特征,以便仅复制堆栈上的指针。</li>
</ul>
<h3 id="所有权使用场景"><a class="header" href="#所有权使用场景">所有权使用场景</a></h3>
<blockquote>
<p>重要的是我们能够识别它和编译器给出的错误提示信息</p>
</blockquote>
<h4 id="let绑定示例"><a class="header" href="#let绑定示例">let绑定示例</a></h4>
<h4 id="将参数传递给函数"><a class="header" href="#将参数传递给函数">将参数传递给函数</a></h4>
<blockquote>
<p>如果将参数传递给函数,那么相同的所有权规则也同样有效</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// ownership_functions.rs

fn take_the_n(n: u8) {}

fn take_the_s(s: String) {}

fn main() {
    let n = 5;
    let s = String::from(&quot;string&quot;);
    // take_the_n 函数能够正常工作,是因为 u8(基元类型)实现了 Copy 特征
    take_the_n(n);
    /*
        String 并没有实现 Copy 特征,因此值的所有权在 take_the_s 函数中会发生移动。
        当函数返回时,相关值的作用域也随之结束,并且会在 s 上调用 drop 方法,
        这会释放 s 所使用的堆内存。
        因此,在函数调用结束后 s 将失效
        使用clone即可通过编译：take_the_s(s.clone())
    */
    take_the_s(s);

    println!(&quot;n is {}&quot;, n);
    println!(&quot;s is {}&quot;, s);
}
</code></pre></pre>
<blockquote>
<p>如果我们只需要变量 s 的读取访问权限,那么可以让该代码正常工作的另一种方法是将字符串 s 传递回 main 函数</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// ownership_functions_back.rs

fn take_the_n(n: u8) {}

// 添加了一个返回类型
fn take_the_s(s: String) -&gt; String {
    println!(&quot;inside function: {}&quot;, s);
    // 并将传递的字符串返回给调用者
    s
}

fn main() {
    let n = 5;
    let s = String::from(&quot;string&quot;);

    take_the_n(n);
    let s = take_the_s(s);

    println!(&quot;n is {}&quot;, n);
    println!(&quot;s is {}&quot;, s);
}
</code></pre></pre>
<h4 id="match表达式"><a class="header" href="#match表达式">match表达式</a></h4>
<blockquote>
<p>在 match 表达式中,移动类型默认也会被移动</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// ownership_match.rs

#[derive(Debug)]
enum Food {
    Cake,
    Pizza,
    Salad,
}

#[derive(Debug)]
struct Bag {
    food: Food,
}

fn main() {
    let bag = Bag { food: Food::Cake };
    match bag.food {
        Food::Cake =&gt; println!(&quot;I got cake&quot;),
        a =&gt; println!(&quot;I got {:?}&quot;, a) // value partially moved here
    }

    println!(&quot;{:?}&quot;, bag); // value borrowed here after partial move
}
</code></pre></pre>
<h4 id="impl代码块"><a class="header" href="#impl代码块">impl代码块</a></h4>
<blockquote>
<p>impl 代码块中,任何以 self 作为第一个参数的方法都将获取调用该方法的值的所有权。这意味着对值调用方法后,你无法再次使用该值</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// ownership_methods.rs

struct Item(u32);

impl Item {
    fn new() -&gt; Self {
        Item(1024)
    }
    /*
        以 self 作为第 1 个参数的实例方法。
        在调用之后, 它将在方法内移动, 并在函数作用域结束时被释放。
        后续我们将不能再使用它
    */
    fn take_item(self) {
        // does nothing
    }
}

fn main() {
    let it = Item::new(); // move occurs because `it` has type `Item`, which does not implement the `Copy` trait
    it.take_item(); // `it` moved due to this method call
    println!(&quot;{}&quot;, it.0); // value borrowed here after move
}
</code></pre></pre>
<h4 id="闭包"><a class="header" href="#闭包">闭包</a></h4>
<blockquote>
<p>闭包接收不同的值取决于在其内部使用变量的方式</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// ownership_closures.rs

#[derive(Debug)]
struct Foo;

fn main() {
    let a = Foo;

    /*
        Foo 的所有权在闭包中已经默认移动到了 b,
        用户将无法再次访问 a。
    */
    // let closure = move || {
    let closure = || {
        let b = a;
    };

    println!(&quot;{:?}&quot;, a);
}
</code></pre></pre>
<h2 id="借用-通过引用规避所有权规则限制"><a class="header" href="#借用-通过引用规避所有权规则限制">借用: 通过引用规避所有权规则限制</a></h2>
<h3 id="为何需要借用引用"><a class="header" href="#为何需要借用引用">为何需要借用/引用</a></h3>
<p>Rust的所有权规则非常严格, 因为它只允许我们使用类型一次。 如果函数只需要对值的读取访问权限,那么我们需要再次从函数返回值,或者在它传递给函数之前复制它。如果类型没有实现 Clone 特征,那么后者可能无法实现其目的。
复制类型看起来似乎很容易绕过所有权规则,但是由于 Clone 总是复制类型,可能会调用内存分配器 API,这是一种涉及系统调用,并且开销高昂的操作,因此它无法满足零成本抽象承诺的所有要点。 随着移动语义和所有权规则的实施,在 Rust
中编写程序很快就会变得困难重重。幸运的是,我们引入了借用和引用类型的概念,它们放宽了规则所施加的限制,但仍然能够在编译期确保兼容所有权规则。</p>
<p>借用的概念是规避所有权规则的限制。进行借用时,你不会获取值的所有权,而是根据需要提供数据。这是通过借用值,即获取值的引用来实现的。为了借用值,我们需要将运算符&amp;放在变量之前,&amp;表示指向变量的地址。</p>
<h3 id="借用-or-引用"><a class="header" href="#借用-or-引用">借用 or 引用？</a></h3>
<h3 id="两种借用方式"><a class="header" href="#两种借用方式">两种借用方式</a></h3>
<h4 id="不可变借用"><a class="header" href="#不可变借用">不可变借用：&amp;</a></h4>
<blockquote>
<p>当我们在类型之前使用运算符&amp;时,就会创建一个不可变借用。</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// ownership_basics.rs

#[derive(Debug)]
struct Foo;

fn main() {
    let foo = Foo;
    /*
        注意变量 foo 之前的&amp;。我们借用 foo 并将借用结果分配给 bar。
        bar 的类型为&amp;Foo, 这是一种引用类型。
        作为一个不可变借用,我们不能通过 bar 改变 Foo 中的值
     */
    let bar = &amp;foo;
    println!(&quot;Foo is {:?}&quot;, foo);
    println!(&quot;Bar is {:?}&quot;, bar);
}
</code></pre></pre>
<h4 id="可变借用mut"><a class="header" href="#可变借用mut">可变借用：&amp;mut</a></h4>
<blockquote>
<p>可以使用&amp;mut 运算符对某个值进行可变借用。 通过可变借用, 你可以改变该值。</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// mutable_borrow.rs

fn main() {
    // 可变借用需要可变变量，所以这里会报错，可以加上mut
    let a = String::from(&quot;Owned string&quot;);
    /*
        用&amp;mut a 创建了一个该值的可变借用。
        这并没有将 a 移动到 b
        只是可变地对它借用。
    */
    let a_ref = &amp;mut a;
    a_ref.push('!');
}
</code></pre></pre>
<blockquote>
<p>可变借用可以改变值,但是不能销毁该值,因为它不是所有者。
如果a 在借用它的代码行之前被销毁,则借用失效</p>
</blockquote>
<p>{{#check 检查是否更新 | 借用失效情况并不存在}}</p>
<pre><pre class="playground"><code class="language-rust  editable">// exclusive_borrow.rs

fn main() {
    let mut a = String::from(&quot;Owned string&quot;);
    let a_ref = &amp;mut a;
    a_ref.push('!');
    println!(&quot;{}&quot;, a);
}
</code></pre></pre>
<div id="admonition-bug" class="admonition bug">
<div class="admonition-title">
<p>Bug</p>
<p><a class="admonition-anchor-link" href="layer1_underlying_abstract/1_virtual_memory/ownership_borrow_lifetime.html#admonition-bug"></a></p>
</div>
<div>
<p>(存疑🤨，待修正🤔️)</p>
</div>
</div>
<h3 id="借用规则"><a class="header" href="#借用规则">借用规则</a></h3>
<blockquote>
<p>通过引用来维护单一的所有权语义。这些规则如下所示</p>
</blockquote>
<ol>
<li>一个引用的生命周期可能不会超过其被引用的时间。 这是显而易见的, 因为如果它的生命周期超过其被借用的时间,那么它将指向一个垃圾值(被销毁的值) 。</li>
<li>如果存在一个值的可变借用,那么不允许其他引用(可变借用或不可变借用)在该作用域下指向相同的值。可变借用是一种独占性借用。</li>
<li>如果不存在指向某些东西的可变借用, 那么在该作用域下允许出现对同一值的任意数量的不可变借用</li>
</ol>
<h3 id="如果违反借用规则"><a class="header" href="#如果违反借用规则">如果违反借用规则</a></h3>
<h4 id="函数中的借用"><a class="header" href="#函数中的借用">函数中的借用</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">// borrowing_functions.rs

// 接收可变借用作为参数
fn take_the_n(n: &amp;mut u8) {
    *n += 2;
}

fn take_the_s(s: &amp;mut String) {
    s.push_str(&quot;ing&quot;);
}

fn main() {
    // 变量绑定必须是可变
    let mut n = 5;
    let mut s = String::from(&quot;Borrow&quot;);
    // 因为函数内做了修改，所以调用时也需要使用可变借用
    take_the_n(&amp;mut n);
    take_the_s(&amp;mut s);

    println!(&quot;n changed to {}&quot;, n);
    println!(&quot;s changed to {}&quot;, s);
}
</code></pre></pre>
<h4 id="匹配中的借用"><a class="header" href="#匹配中的借用">匹配中的借用</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">// ownership_match.rs

#[derive(Debug)]
enum Food {
    Cake,
    Pizza,
    Salad
}

#[derive(Debug)]
struct Bag {
    food: Food
}

fn main() {
    let bag = Bag { food: Food::Cake };
    match bag.food {
        Food::Cake =&gt; println!(&quot;I got cake&quot;),
        // 以 ref 作为前缀。
        // 关键字 ref 可以通过引用来匹配元素,而不是根据值来捕获它们。
        ref a =&gt; println!(&quot;I got {:?}&quot;, a)
    }
    
    println!(&quot;{:?}&quot;, bag);
}
</code></pre></pre>
<h4 id="从函数返回引用"><a class="header" href="#从函数返回引用">从函数返回引用：</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">// return_func_ref.rs

fn get_a_borrowed_value() -&gt; &amp;u8 { // expected named lifetime parameter
    let x = 1;
    &amp;x
}

fn main() {
    let value = get_a_borrowed_value();
}
</code></pre></pre>
<h3 id="基于借用规则的方法类型"><a class="header" href="#基于借用规则的方法类型">基于借用规则的方法类型</a></h3>
<blockquote>
<p>借用规则还规定了如何定义类型的固有方法和特征的实例方法。以下是它们接收实例的方式,并且是根据限制由少到多排列的。</p>
</blockquote>
<ul>
<li>&amp;self 方法:这些方法只对其成员具有不可变的访问权限。</li>
<li>&amp;mut self 方法:这些方法能够可变地借用 self 实例。</li>
<li>self 方法:这些方法拥有调用它的实例的所有权,并且类型在后续调用时将失效。</li>
</ul>
<p>对于自定义类型,相同的借用规则也适用于其作用域成员。</p>
<h2 id="生命周期针对引用附加的信息"><a class="header" href="#生命周期针对引用附加的信息">生命周期：针对引用附加的信息</a></h2>
<h3 id="从变量生命周期开始"><a class="header" href="#从变量生命周期开始">从变量生命周期开始</a></h3>
<h3 id="生命周期限定"><a class="header" href="#生命周期限定">生命周期限定</a></h3>
<h3 id="生命周期注解"><a class="header" href="#生命周期注解">生命周期注解</a></h3>
<h3 id="生命周期省略lifetime-elision"><a class="header" href="#生命周期省略lifetime-elision">生命周期省略(Lifetime Elision)</a></h3>
<h2 id="销毁destructors"><a class="header" href="#销毁destructors">销毁(Destructors)</a></h2>
<h2 id="参考资源-2"><a class="header" href="#参考资源-2">参考资源</a></h2>
<h3 id="online-book-3"><a class="header" href="#online-book-3">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html">What is Ownership? - The Rust Programming Language</a></li>
<li><a href="https://doc.rust-lang.org/stable/reference/lifetime-elision.html#lifetime-elision-in-functions">生命周期省略规则(Lifetime elision) - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/stable/reference/destructors.html">Destructors - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/stable/reference/lifetime-elision.html">Lifetime elision - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html">Understanding Ownership - The Rust Programming Language</a></li>
</ul>
<h3 id="fragment-3"><a class="header" href="#fragment-3">fragment</a></h3>
<ul>
<li><a href="https://www.ditsing.com/object-lifetime-and-ownership/">Object lifetime and ownership</a></li>
<li><a href="https://www.zhihu.com/question/58863427">go没有虚拟机怎么运行gc的？ - 知乎</a></li>
<li><a href="https://hashrust.com/blog/lifetimes-in-rust/">Lifetimes in Rust</a></li>
</ul>
<h3 id="local-3"><a class="header" href="#local-3">local</a></h3>
<ul>
<li><a href="marginnote3app://note/72B2EE33-36EE-4FE6-A088-FEBE54D61E8D">&lt;精通rust(第二版)&gt;-5.7 内存安全三原则</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E8%B5%B7%E6%BA%90">类型系统起源</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#%E6%88%91%E4%BB%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%9C%A8%E8%AF%AD%E8%A8%80%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%B1%BB%E5%9E%8B">我们为什么需要在语言中使用类型?</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#1-%E4%BB%8E%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%88%B0%E6%B1%87%E7%BC%96">1. 从二进制数据格式到汇编</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#2-%E4%BB%8E%E6%B1%87%E7%BC%96%E5%88%B0%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E5%BA%94%E8%BF%90%E8%80%8C%E7%94%9F">2. 从汇编到编程语言，类型系统应运而生</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#3-%E5%86%8D%E6%9D%A5%E8%AE%A4%E7%9C%9F%E7%9C%8B%E7%9C%8B%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F">3. 再来认真看看类型系统</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#4-%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E5%85%B6%E5%AE%9E%E6%98%AF%E4%B8%80%E7%BB%84%E8%A7%84%E5%88%99">4. 类型系统其实是一组规则</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#5-%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E6%98%AF%E5%AF%B9%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%AE%89%E5%85%A8%E7%9A%84%E6%8A%BD%E8%B1%A1">5. 类型系统是对内存管理/安全的抽象</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#%E5%8A%A8%E6%80%81%E7%B1%BB%E5%9E%8B%E5%A4%A7%E5%B0%8F">动态类型大小</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#%E7%B1%BB%E5%9E%8B%E5%B8%83%E5%B1%80">类型布局</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#%E5%86%85%E9%83%A8%E5%8F%AF%E5%8F%98%E6%80%A7">内部可变性</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#%E5%AD%90%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%8D%8F%E5%8F%98">子类型与协变</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#%E5%BC%BA%E5%88%B6%E8%BD%AC%E6%8D%A2type-coercions">强制转换(type coercions)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/type_system.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:05 UTC 2022 -->
<!--te-->
<h1 id="类型系统起源"><a class="header" href="#类型系统起源">类型系统起源</a></h1>
<h2 id="我们为什么需要在语言中使用类型"><a class="header" href="#我们为什么需要在语言中使用类型">我们为什么需要在语言中使用类型?</a></h2>
<blockquote>
<p>这是一个很好的问题,可以作为理解编程语言类型系统的契机。</p>
</blockquote>
<h3 id="1-从二进制数据格式到汇编"><a class="header" href="#1-从二进制数据格式到汇编">1. 从二进制数据格式到汇编</a></h3>
<p>作为程序员,我们知道为计算机编写的程序在最底层是以 0 和 1
组成的二进制数据格式表示的。实际上,最早的计算机必须使用机器代码手动编程。最终,程序员意识到这样做非常容易出错,并且乏味、耗时。对大部分人来说,在二进制层面操作和推断这些实体是不切实际的。 到了 20 世纪 50 年代,
编程社区提出了机器代码助记符的概念, 这些助记符变成了今天我们熟知的汇编语言。</p>
<h3 id="2-从汇编到编程语言类型系统应运而生"><a class="header" href="#2-从汇编到编程语言类型系统应运而生">2. 从汇编到编程语言，类型系统应运而生</a></h3>
<p>然后,编程语言应运而生,它们被编译成汇编代码,并允许编程人员编写人类可理解的代码,以方便计算机将其编译成机器代码。然而,大家平时所说的语言表达某些语义比较模糊,因此需要制定一套规则和条件,来表述用类似人类语言编写的计算机程序中可能或不可能存在的内容,即程序语义。这使得我们提出了类型和类型系统的理念。</p>
<h3 id="3-再来认真看看类型系统"><a class="header" href="#3-再来认真看看类型系统">3. 再来认真看看类型系统</a></h3>
<p>类型是一组具名的可能值。例如,u8 是一种可能包含 0~255 的正数值类型。类型提供了一种方法来弥合我们创建的这些实体的底层表示与心理模型之间的差距。除此之外, 类型还为我们提供了<strong>表示实体的意图、行为和约束的方法</strong>：</p>
<blockquote>
<p>它们定义了用户通过类型能够(不能够) 做什么。 例如, 它没有定义将字符串类型的值和数值类型的值相加的结果是什么。</p>
</blockquote>
<h3 id="4-类型系统其实是一组规则"><a class="header" href="#4-类型系统其实是一组规则">4. 类型系统其实是一组规则</a></h3>
<p>从类型来看,语言设计者构建了类型系统,这些系统是一组规则,用于管理不同类型在编程语言中的交互。它们可以用作推断程序的工具,并有助于确保程序能够正常运行并符合规范。类型系统根据其表达力进行限定,这仅表示你可以使用类型表达逻辑的程度,以及程序中的不变量。</p>
<blockquote>
<p>例如 Haskell 是一种高级语言,它具有非常丰富的表现力的类型系统,而C 语言是一种低级语言,它只为我们提供了很少的基于类型的抽象。Rust 试图在这两个极端之间找到一种平衡。</p>
</blockquote>
<h3 id="5-类型系统是对内存管理安全的抽象"><a class="header" href="#5-类型系统是对内存管理安全的抽象">5. 类型系统是对内存管理/安全的抽象</a></h3>
<h4 id="动态类型大小"><a class="header" href="#动态类型大小">动态类型大小</a></h4>
<h4 id="类型布局"><a class="header" href="#类型布局">类型布局</a></h4>
<h4 id="内部可变性"><a class="header" href="#内部可变性">内部可变性</a></h4>
<h4 id="子类型与协变"><a class="header" href="#子类型与协变">子类型与协变</a></h4>
<h4 id="强制转换type-coercions"><a class="header" href="#强制转换type-coercions">强制转换(type coercions)</a></h4>
<h2 id="参考资料"><a class="header" href="#参考资料">参考资料</a></h2>
<h3 id="online-book-4"><a class="header" href="#online-book-4">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/stable/reference/dynamically-sized-types.html">Dynamically Sized Types - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/stable/reference/type-layout.html">Type layout - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/stable/reference/interior-mutability.html">Interior mutability - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/stable/reference/subtyping.html">Subtyping and Variance - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/stable/reference/type-coercions.html">Type coercions - The Rust Reference</a></li>
</ul>
<h3 id="fragment-4"><a class="header" href="#fragment-4">fragment</a></h3>
<h3 id="local-4"><a class="header" href="#local-4">local</a></h3>
<ul>
<li><a href="marginnote3app://note/7D37028B-C1FB-47BC-AA50-4EBA22EB9CC7">&lt;精通Rust(第二版)&gt;-4.1 类型系统及其重要性</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="基础内置类型"><a class="header" href="#基础内置类型">基础内置类型</a></h1>
<!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/built_in_types.html#%E5%9F%BA%E7%A1%80%E5%86%85%E7%BD%AE%E7%B1%BB%E5%9E%8B">基础内置类型</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/built_in_types.html#%E5%9F%BA%E5%85%83%E7%B1%BB%E5%9E%8B">基元类型</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/built_in_types.html#%E5%BA%8F%E5%88%97%E7%B1%BB%E5%9E%8B">序列类型</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/built_in_types.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B">自定义类型</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/built_in_types.html#%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B">函数类型</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/built_in_types.html#%E6%8C%87%E9%92%88%E7%B1%BB%E5%9E%8B">指针类型</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/built_in_types.html#%E7%89%B9%E5%BE%81%E7%B1%BB%E5%9E%8B">特征类型</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/built_in_types.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/built_in_types.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/built_in_types.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/built_in_types.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:03 UTC 2022 -->
<!--te-->
<h2 id="基元类型"><a class="header" href="#基元类型">基元类型</a></h2>
<h2 id="序列类型"><a class="header" href="#序列类型">序列类型</a></h2>
<h2 id="自定义类型"><a class="header" href="#自定义类型">自定义类型</a></h2>
<h2 id="函数类型"><a class="header" href="#函数类型">函数类型</a></h2>
<h2 id="指针类型"><a class="header" href="#指针类型">指针类型</a></h2>
<h2 id="特征类型"><a class="header" href="#特征类型">特征类型</a></h2>
<h2 id="参考资源-3"><a class="header" href="#参考资源-3">参考资源</a></h2>
<h3 id="online-book-5"><a class="header" href="#online-book-5">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/stable/reference/types.html">Types - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/book/ch15-00-smart-pointers.html">Smart Pointers - The Rust Programming Language</a></li>
</ul>
<h3 id="fragment-5"><a class="header" href="#fragment-5">fragment</a></h3>
<h3 id="local-5"><a class="header" href="#local-5">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="集合类型"><a class="header" href="#集合类型">集合类型</a></h1>
<!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/collections.html#%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B">集合类型</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/collections.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/collections.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/collections.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/collections.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:04 UTC 2022 -->
<!--te-->
<h2 id="参考资源-4"><a class="header" href="#参考资源-4">参考资源</a></h2>
<h3 id="online-book-6"><a class="header" href="#online-book-6">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch08-00-common-collections.html">Common Collections - The Rust Programming Language</a></li>
</ul>
<h3 id="fragment-6"><a class="header" href="#fragment-6">fragment</a></h3>
<h3 id="local-6"><a class="header" href="#local-6">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="自定义类型-1"><a class="header" href="#自定义类型-1">自定义类型</a></h1>
<!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/user_defined_types.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B">自定义类型</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/user_defined_types.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/user_defined_types.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/user_defined_types.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/user_defined_types.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:06 UTC 2022 -->
<!--te-->
<h2 id="参考资源-5"><a class="header" href="#参考资源-5">参考资源</a></h2>
<h3 id="online-book-7"><a class="header" href="#online-book-7">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch05-00-structs.html">Using Structs to Structure Related Data - The Rust Programming Language</a></li>
</ul>
<h3 id="fragment-7"><a class="header" href="#fragment-7">fragment</a></h3>
<h3 id="local-7"><a class="header" href="#local-7">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="泛型特征及特征对象"><a class="header" href="#泛型特征及特征对象">泛型、特征及特征对象</a></h1>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/rust-traits-deep-dive.png" alt="rust-traits-deep-dive" /></p>
<!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B%E7%89%B9%E5%BE%81%E5%8F%8A%E7%89%B9%E5%BE%81%E5%AF%B9%E8%B1%A1">泛型、特征及特征对象</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B">泛型</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E4%BB%8E%E4%BB%A3%E7%A0%81%E5%A4%8D%E7%94%A8%E5%87%BA%E5%8F%91">从代码复用出发</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E4%B8%8D%E8%B6%B3">函数作用不足</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E9%9D%99%E6%80%81%E7%B1%BB%E5%9E%8B%E8%AF%AD%E8%A8%80%E8%BF%98%E9%9C%80%E8%A6%81%E6%B3%9B%E5%9E%8B%E6%9D%A5%E5%A4%8D%E7%94%A8%E4%BB%A3%E7%A0%81">静态类型语言还需要泛型来复用代码</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B%E6%9C%AC%E8%B4%A8%E4%B8%8A%E6%98%AF%E4%B8%80%E7%A7%8D%E5%8D%95%E6%80%81%E5%8C%96">泛型本质上是一种单态化</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F">泛型使用方式</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B%E5%87%BD%E6%95%B0">泛型函数</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B%E7%BB%93%E6%9E%84%E4%BD%93">泛型结构体</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B%E6%9E%9A%E4%B8%BE%E4%BD%93">泛型枚举体</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B%E7%89%B9%E5%BE%81">泛型特征</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B%E6%96%B9%E6%B3%95">泛型方法</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#impl-%E6%B3%9B%E5%9E%8B%E5%AE%9E%E7%8E%B0%E5%9D%97">impl: 泛型实现块</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B%E5%AE%9E%E7%8E%B0">泛型实现</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E4%B8%93%E9%97%A8%E5%8C%96%E6%B3%9B%E5%9E%8B">专门化泛型</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%8C%87%E5%AE%9A%E7%B1%BB%E5%9E%8B%E8%BF%9B%E8%A1%8C%E5%AE%9E%E4%BE%8B%E5%8C%96">指定类型进行实例化</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E5%9F%BA%E4%BA%8E%E7%B1%BB%E5%9E%8B%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%8E%A8%E6%96%AD">基于类型实例化推断</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%9F%90%E4%BA%9B%E6%96%B9%E6%B3%95">泛型函数调用某些方法</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#turbofish-">turbofish: ::&lt;&gt;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E7%89%B9%E5%BE%81">特征</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E4%BB%8E%E5%A4%9A%E6%80%81%E5%92%8C%E4%BB%A3%E7%A0%81%E5%A4%8D%E7%94%A8%E7%9A%84%E8%A7%92%E5%BA%A6%E6%9D%A5%E7%9C%8B-%E6%8E%A5%E5%8F%A3%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B%E8%BF%98%E6%98%AF%E7%89%B9%E5%BE%81">从多态和代码复用的角度来看: 接口、鸭子类型还是特征？</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%8E%A5%E5%8F%A3">接口</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B">鸭子类型</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E7%89%B9%E5%BE%81-1">特征</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E7%89%B9%E5%BE%81%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88">特征到底是什么？</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E7%89%B9%E5%BE%81%E7%9A%84%E5%A4%9A%E7%A7%8D%E8%A1%A8%E7%8E%B0%E5%BD%A2%E5%BC%8F">特征的多种表现形式</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%A0%87%E8%AE%B0%E7%89%B9%E5%BE%81">标记(特征)</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E7%AE%80%E5%8D%95%E7%89%B9%E5%BE%81">简单(特征)</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B%E7%89%B9%E5%BE%81-1">泛型(特征)</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E5%85%B3%E8%81%94%E7%B1%BB%E5%9E%8B%E7%89%B9%E5%BE%81">关联类型(特征)</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E7%BB%A7%E6%89%BF%E7%89%B9%E5%BE%81">继承(特征)</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E5%86%85%E7%BD%AE%E7%89%B9%E5%BE%81">一些常用内置特征</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E8%87%AA%E5%8A%A8%E7%89%B9%E5%BE%81auto-traits">自动特征(Auto Traits)</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#send--sync">Send &amp; Sync</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#unpin-unwindsafe--refunwindsafe">Unpin、 UnwindSafe &amp; RefUnwindSafe</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#debug">Debug</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#partialeq-%E5%92%8C-eq">PartialEq 和 Eq</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#copy%E5%92%8Cclone">Copy和Clone</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#display">Display</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#add">Add</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#into-%E5%92%8C-from">Into 和 From</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#drop">Drop</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#deref--derefmut">Deref &amp; DerefMut</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#sizedspecial-types-and-traits---the-rust-reference">Sized<a href="https://doc.rust-lang.org/stable/reference/special-types-and-traits.html" rel="nofollow">Special types and traits - The Rust Reference</a>
</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E4%BE%8B%E5%AD%90">一个完整例子</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E7%89%B9%E5%BE%81%E5%8C%BA%E9%97%B4%E6%B3%9B%E5%9E%8B%E7%89%B9%E5%BE%81">特征区间：泛型+特征</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E5%BC%95%E5%87%BA%E7%89%B9%E5%BE%81%E5%8C%BA%E9%97%B4">引出特征区间</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E4%BB%A3%E7%A0%81%E5%8D%95%E4%BD%93%E5%8C%96">代码单体化</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%8C%87%E5%AE%9A%E7%89%B9%E5%BE%81%E5%8C%BA%E9%97%B4%E7%9A%84%E5%9B%9B%E4%B8%AA%E6%96%B9%E6%B3%95">指定特征区间的四个方法</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E5%8C%BA%E9%97%B4%E5%86%85%E6%B3%9B%E5%9E%8B-fn-fn_namet-target_traitval-t">区间内泛型: fn fn_name&lt;T: target_trait&gt;(val: T)</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#where%E8%AF%AD%E5%8F%A5-%E5%BD%93%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E6%B3%95%E7%AD%BE%E5%90%8D%E8%BF%87%E9%95%BF%E6%97%B6%E4%BD%BF%E7%94%A8">where语句: 当第一种方法签名过长时使用</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E4%BD%BF%E7%94%A8%E7%BB%84%E5%90%88%E5%A4%9A%E4%B8%AA%E7%89%B9%E5%BE%81">使用&quot;+&quot;组合多个特征</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E4%BD%BF%E7%94%A8impl%E7%89%B9%E5%BE%81%E8%AF%AD%E6%B3%95-%E9%97%AD%E5%8C%85%E5%B8%B8%E7%94%A8">使用impl特征语法: 闭包常用</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E7%89%B9%E5%BE%81%E5%8C%BA%E9%97%B4%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">特征区间的使用场景</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E5%9C%A8%E7%B1%BB%E5%9E%8B%E4%B8%8A%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%BB%BA%E8%AE%AE">在类型上使用：不建议</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%B3%9B%E5%9E%8B%E5%87%BD%E6%95%B0impl%E4%BB%A3%E7%A0%81%E5%9D%97">泛型函数+impl代码块</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E7%89%B9%E5%BE%81%E5%AF%B9%E8%B1%A1-%E5%A4%9A%E6%80%81%E7%89%B9%E5%BE%81%E7%B1%BB%E5%9E%8B">特征对象: 多态特征类型</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E5%88%86%E5%8F%91dispatch">分发(dispatch)</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E5%88%86%E5%8F%91%E6%96%B9%E5%BC%8F%E9%9D%99%E6%80%81-or-%E5%8A%A8%E6%80%81">分发方式：静态 or 动态</a></li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E5%8C%BA%E5%88%AB%E7%89%B9%E5%BE%81%E5%8C%BA%E9%97%B4%E4%B8%8E%E7%89%B9%E5%BE%81%E5%AF%B9%E8%B1%A1">区别特征区间与特征对象</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E7%89%B9%E5%BE%81%E5%AF%B9%E8%B1%A1%E5%85%B7%E4%BD%93%E8%AF%B4%E8%AF%B4">特征对象具体说说</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%8C%87%E5%AE%9A%E4%B8%BA%E5%AE%9E%E7%8E%B0%E6%9F%90%E4%B8%AA%E7%89%B9%E5%BE%81">指定为实现某个特征</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E7%94%A8%E8%83%96%E6%8C%87%E9%92%88%E5%AE%9E%E7%8E%B0">用胖指针实现</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%98%AFrust%E6%89%A7%E8%A1%8C%E5%8A%A8%E6%80%81%E5%88%86%E5%8F%91%E7%9A%84%E6%96%B9%E5%BC%8F">是Rust执行动态分发的方式</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E4%B8%8D%E5%AE%9A%E9%95%BF%E7%B1%BB%E5%9E%8B%E5%8F%AA%E8%83%BD%E4%BD%9C%E4%B8%BA%E5%BC%95%E7%94%A8%E5%88%9B%E5%BB%BA">不定长类型只能作为引用创建</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E6%80%BB%E7%BB%93%E7%89%B9%E5%BE%81%E7%89%B9%E5%BE%81%E5%8C%BA%E9%97%B4%E5%92%8C%E7%89%B9%E5%BE%81%E5%AF%B9%E8%B1%A1">总结特征、特征区间和特征对象</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/2_type_system/generics_traits_objects.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:05 UTC 2022 -->
<!--te-->
<h2 id="泛型"><a class="header" href="#泛型">泛型</a></h2>
<h3 id="从代码复用出发"><a class="header" href="#从代码复用出发">从代码复用出发</a></h3>
<h4 id="函数作用不足"><a class="header" href="#函数作用不足">函数作用不足</a></h4>
<p>一直以来，函数的实现方式就是基于c语言的goto指令：</p>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/image-20220613150721312.png" alt="image-20220613150721312" /></p>
<p>通过进一步强化，就得到函数的实现方式：</p>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/image-20220613150804039.png" alt="image-20220613150804039" /></p>
<blockquote>
<p>但是也就这样了，函数只能实现流程上的复用，不能实现类型上的复用。这一点其实在python、js这些动态类型语言上面就不存在这个问题。对于Rust这种静态类型语言，对函数入参类型要求十分严格，于是泛型就应运而生。</p>
</blockquote>
<h4 id="静态类型语言还需要泛型来复用代码"><a class="header" href="#静态类型语言还需要泛型来复用代码">静态类型语言还需要泛型来复用代码</a></h4>
<blockquote>
<p>泛型编程是一种仅适用于静态类型编程语言的技术。它首次出现在 ML 语言中,是一种静态类型的函数式语言。</p>
</blockquote>
<p>像 Python 这样的动态语言采用的是简单类型 (duck typing) , 其中的 API 是根据它们可以做什么,而不是它们是什么来处理参数的,因此不依赖于泛型。</p>
<p>泛型是语言设计特性的一部分, 可以实现代码复用, 并遵循不重复自己的原则 (Don't Repeat Yourself,DRY) 。采用这种技术,你可以使用类型占位符来编写算法、函数、方法及类型, 并在这些类型上指定一个类型变量(
使用单个字母,通常是 T、K 或 V) ,告知编译器在任何代码中实例化它们时要填充的实际类型。这些类型被称为泛型或元素。单个字母(例如类型 T)被称为泛型参数。当你使用或实例化任何泛型元素时,它们会被替换成诸如 u32 这样的具体类型。</p>
<h3 id="泛型本质上是一种单态化"><a class="header" href="#泛型本质上是一种单态化">泛型本质上是一种单态化</a></h3>
<p>每次将泛型元素与具体类型一起使用时,都会在编译时用类型变量 T 生成该代码的特定副本,并将其替换为具体类型。<strong>这种在编译时生成包含具体类型的专用函数的过程被称为单态化,这是执行与多态函数相反的过程。</strong></p>
<h3 id="泛型使用方式"><a class="header" href="#泛型使用方式">泛型使用方式</a></h3>
<blockquote>
<p>在使用泛型时，应该多去考虑它与不同元素结合使用的场景背后的思维方式。泛型可以与结构体、枚举、函数、特征、方法及代码实现块。它们的一个共同特征是泛型的参数是由一对尖头括号分隔,并包含于其中。</p>
</blockquote>
<h4 id="泛型函数"><a class="header" href="#泛型函数">泛型函数</a></h4>
<p>为了创建泛型函数,我们需要将泛型参数放在函数名之后和圆括号之前,如下所示:</p>
<pre><pre class="playground"><code class="language-rust  editable">// generic_function.rs

fn give_me&lt;T&gt;(value: T) {
    let _ = value;
}

fn main() {
    let a = &quot;generics&quot;;
    let b = 1024;
    give_me(a);
    give_me(b);
}
</code></pre></pre>
<h4 id="泛型结构体"><a class="header" href="#泛型结构体">泛型结构体</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">// generic_struct.rs

struct Container&lt;T&gt; {
    item: T,
}

impl&lt;T&gt; Container&lt;T&gt; {
    fn new(item: T) -&gt; Self {
        Container { item }
    }
}

impl Container&lt;u32&gt; {
    fn sum(item: u32) -&gt; Self {
        Container { item }
    }
}

fn main() {
    // todo
}
</code></pre></pre>
<h4 id="泛型枚举体"><a class="header" href="#泛型枚举体">泛型枚举体</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">// generic_enum.rs

enum Transmission&lt;T&gt; {
    Signal(T),
    NoSignal,
}

fn main() {
    // stuff
}
</code></pre></pre>
<h4 id="泛型特征"><a class="header" href="#泛型特征">泛型特征</a></h4>
<h4 id="泛型方法"><a class="header" href="#泛型方法">泛型方法</a></h4>
<h3 id="impl-泛型实现块"><a class="header" href="#impl-泛型实现块">impl: 泛型实现块</a></h3>
<h4 id="泛型实现"><a class="header" href="#泛型实现">泛型实现</a></h4>
<blockquote>
<p>当为任何泛型编写 impl 代码块时,都需要在使用它之前声明泛型参数。T 就像一个变量—— 一个类型变量,我们需要先声明它 impl代码块实际上意味着我们正在为所有类型 T 实现这些方法,它们会出现在 Container<T>中。这个 impl 代码块是一个泛型实现。 因此,生成的每个具体 Container 都将有这些方法。</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// generic_struct_impl.rs

struct Container&lt;T&gt; {
    item: T,
}

impl&lt;T&gt; Container&lt;T&gt; {
    fn new(item: T) -&gt; Self {
        Container { item }
    }
}

fn main() {
    // stuff
}
</code></pre></pre>
<h4 id="专门化泛型"><a class="header" href="#专门化泛型">专门化泛型</a></h4>
<blockquote>
<p>在这里, 由于 u32 是作为具体类型存在的, 因此我们不需要 impl 之后的<T>, 这是 impl 代码块的另外一个特性,它允许你通过独立实现方法来专门化泛型。 现在,我们也可以通过将 T 替换为任何具体类型来为 Container<T>编写更具体的 impl 代码块。以下就是它的实例:</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">impl Container&lt;u32&gt; { 
    fn sum(item: u32) -&gt; Self {
        Container { item }
    } 
}
</code></pre></pre>
<h3 id="指定类型进行实例化"><a class="header" href="#指定类型进行实例化">指定类型进行实例化</a></h3>
<blockquote>
<p>每当我们进行实例化时, 编译器需要在其类型签名中知道 T 的具体类型以便替换,这为其提供了将泛型代码单态化的类型信息。 而具体类型的确定主要有三种方式：</p>
</blockquote>
<ol>
<li>大多数情况下,具体类型是基于类型的实例化推断.</li>
<li>对泛型函数调用某些方法来接收具体类型。</li>
<li>在极个别情况下, 我们需要通过使用 <code>turbofish (::&lt;&gt;)</code>运算符输入具体类型来替代泛型以便辅助编译器识别。</li>
</ol>
<h4 id="基于类型实例化推断"><a class="header" href="#基于类型实例化推断">基于类型实例化推断</a></h4>
<p>这是最常见的方式，主要基于类型特征(trait)。</p>
<h4 id="泛型函数调用某些方法"><a class="header" href="#泛型函数调用某些方法">泛型函数调用某些方法</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">// using_generic_func.rs

use std::str;

fn main() {
    let num_from_str = str::parse::&lt;u8&gt;(&quot;34&quot;).unwrap();
    println!(&quot;Parsed number {}&quot;, num_from_str);
}
</code></pre></pre>
<h4 id="turbofish-"><a class="header" href="#turbofish-">turbofish: ::&lt;&gt;</a></h4>
<ol>
<li>如果没有任何类型特征，代码将无法编译：👇</li>
</ol>
<pre><pre class="playground"><code class="language-rust  editable">fn main() {
    let a = Vec::new();
}
</code></pre></pre>
<ol start="2">
<li>这时可以用下列三种方式指定</li>
</ol>
<pre><pre class="playground"><code class="language-rust  editable">// using_generic_vec.rs

fn main() {
    // providing a type
    let v1: Vec&lt;u8&gt; = Vec::new();

    // or calling method
    let mut v2 = Vec::new();
    v2.push(2); // v2 is now Vec&lt;i32&gt;

    // or using turbofish
    let v3 = Vec::&lt;u8&gt;::new(); // not so readable
}
</code></pre></pre>
<h2 id="特征"><a class="header" href="#特征">特征</a></h2>
<h3 id="从多态和代码复用的角度来看-接口鸭子类型还是特征"><a class="header" href="#从多态和代码复用的角度来看-接口鸭子类型还是特征">从多态和代码复用的角度来看: 接口、鸭子类型还是特征？</a></h3>
<p>从多态和代码复用的角度来看, 在代码中将类型的共享行为和公共属性与其自身隔离通常是一个好主意,并且能拥有专属于自己的方法。在这样做时,我们允许不同类型通过通用属性互相关联,使我们能够为 API 编程,使其参数更通用或更具包容性。</p>
<blockquote>
<p>这意味着我们可以接收具有这些通用属性的类型,而不仅限于某种特定类型。</p>
</blockquote>
<h4 id="接口"><a class="header" href="#接口">接口</a></h4>
<p>类似 Java 和 C#的面向对象编程语言中,接口表达了相同的理念,我们可以在其中定义多种类型能够实现的共享行为。例如,我们可以使用单个 sort 函数接收实现 Comparable 或者 Comparator
接口的元素列表,而不是使用多个 sort 函数接收整数值列表,以及用其他函数接收字符串值列表。这使得我们可以将任何可比较(Comparable)的内容传递给 sort 函数。</p>
<h4 id="鸭子类型"><a class="header" href="#鸭子类型">鸭子类型</a></h4>
<p>而Python同样有明确的特性，被称为&quot;鸭子类型&quot;.</p>
<blockquote>
<p>“当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被称为鸭子。”</p>
</blockquote>
<p>在鸭子类型中，关注点在于对象的行为，能做什么；而不是关注对象所属的类型。例如，在不使用鸭子类型的语言中，我们可以编写一个函数，它接受一个类型为“鸭子”的对象，并调用它的“走”和“叫”方法。在使用鸭子类型的语言中，这样的一个函数可以接受一个任意类型的对象，并调用它的“走”和“叫”方法。如果这些需要被调用的方法不存在，那么将引发一个运行时错误。任何拥有这样的正确的“走”和“叫”方法的对象都可被函数接受的这种行为引出了以上表述，这种决定类型的方式因此得名。</p>
<p>鸭子类型通常得益于“不”测试方法和函数中参数的类型，而是依赖文档、清晰的代码和测试来确保正确使用。</p>
<p>在常规类型中，我们能否在一个特定场景中使用某个对象取决于这个对象的类型，而在鸭子类型中，则取决于这个对象是否具有某种属性或者方法——即只要具备特定的属性或方法，能通过鸭子测试，就可以使用。</p>
<h4 id="特征-1"><a class="header" href="#特征-1">特征</a></h4>
<p>Rust也有一个类似且功能强大的结构,被称为特征。Rust中的特征以多种形式存在, 我们将介绍一些最常见的形式并了解一些与它们简单交互的方式。此外,当特征与泛型搭配使用时,可以限制传递到 API
的参数范围。我们将会对特征进行比较深入的了解。</p>
<h3 id="特征到底是什么"><a class="header" href="#特征到底是什么">特征到底是什么？</a></h3>
<h3 id="特征的多种表现形式"><a class="header" href="#特征的多种表现形式">特征的多种表现形式</a></h3>
<h4 id="标记特征"><a class="header" href="#标记特征">标记(特征)</a></h4>
<h4 id="简单特征"><a class="header" href="#简单特征">简单(特征)</a></h4>
<h4 id="泛型特征-1"><a class="header" href="#泛型特征-1">泛型(特征)</a></h4>
<h4 id="关联类型特征"><a class="header" href="#关联类型特征">关联类型(特征)</a></h4>
<h4 id="继承特征"><a class="header" href="#继承特征">继承(特征)</a></h4>
<h3 id="一些常用内置特征"><a class="header" href="#一些常用内置特征">一些常用内置特征</a></h3>
<h4 id="自动特征auto-traits"><a class="header" href="#自动特征auto-traits">自动特征(Auto Traits)</a></h4>
<h5 id="send--sync"><a class="header" href="#send--sync">Send &amp; Sync</a></h5>
<h5 id="unpin-unwindsafe--refunwindsafe"><a class="header" href="#unpin-unwindsafe--refunwindsafe">Unpin、 UnwindSafe &amp; RefUnwindSafe</a></h5>
<h4 id="debug"><a class="header" href="#debug">Debug</a></h4>
<p>这个特征有助于在控制台上输出类型以便进行调试。在组合类型的情况下,类型将以类似 JSON 的格式输出,其中带有花括号和其他括号,如果类型是字符串,将会用引号标识。这适用于 Rust 中的大多数内置类型。</p>
<h4 id="partialeq-和-eq"><a class="header" href="#partialeq-和-eq">PartialEq 和 Eq</a></h4>
<p>这些特征允许两个元素相互比较以验证是否相等</p>
<h4 id="copy和clone"><a class="header" href="#copy和clone">Copy和Clone</a></h4>
<p>这些特征定义了类型的复制方式。 简而言之,当在任何自定义类型上自动派生时,这些特征允许用户从实例创建新的副本:</p>
<ol>
<li>可以在实现 Copy 时隐式创建</li>
<li>也可以在实现 Clone 时通过调用 clone() 显式创建。</li>
</ol>
<blockquote>
<p>请注意,Copy 依赖于在类型上实现的 Clone 特征</p>
</blockquote>
<h4 id="display"><a class="header" href="#display">Display</a></h4>
<h4 id="add"><a class="header" href="#add">Add</a></h4>
<h4 id="into-和-from"><a class="header" href="#into-和-from">Into 和 From</a></h4>
<h4 id="drop"><a class="header" href="#drop">Drop</a></h4>
<h4 id="deref--derefmut"><a class="header" href="#deref--derefmut">Deref &amp; DerefMut</a></h4>
<h4 id="sizedspecial-types-and-traits---the-rust-reference"><a class="header" href="#sizedspecial-types-and-traits---the-rust-reference">Sized<a href="https://doc.rust-lang.org/stable/reference/special-types-and-traits.html">Special types and traits - The Rust Reference</a></a></h4>
<h3 id="一个完整例子"><a class="header" href="#一个完整例子">一个完整例子</a></h3>
<pre><pre class="playground"><code class="language-rust  editable">// complex/src/lib.rs

use std::ops::Add;

/*
将#[derive(Default)] 属性实现为一个过程宏,可以自动实现它修饰的类型的特征。
此自动派生要求任何自定义类型的字段(例如结构体或枚举)本身必须实现 Default 特征。
使用它们继承特征仅适用于结构体、枚举及联合。
*/
#[derive(Default, Debug, PartialEq, Copy, Clone)]
struct Complex&lt;T&gt; {
    // Real part
    re: T,
    // Complex part
    im: T,
}

impl&lt;T&gt; Complex&lt;T&gt; {
    // new 函数实际上并不是一个特殊的构造函数(如果你只了解带有构造函数的语言),
    // 而是社区采用的一个常用名称(作为创建新类型实例的方法名) 。
    fn new(re: T, im: T) -&gt; Self {
        Complex { re, im }
    }
}

// 来自 std::ops 模块的 Add 特征允许我们使用“+”运算符将两个复数相加
/*
1. impl&lt;T: Add&lt;T, Output=T&gt;表示我们正在为泛型 T 实现 Add,其中 T 实现 Add&lt;T, Output=T&gt;。
2. &lt;T, Output=T&gt;部分表示 Add 特征的实现必须具有相同的输入和输出类型
3. Add for Complex&lt;T&gt;部分表示为 Complex&lt;T&gt;类型实现 Add 特征
4. T:Add 表示必须实现 Add 特征。如果没有实现,那么我们不能使用“+”运算符
*/
impl&lt;T: Add&lt;T, Output=T&gt;&gt; Add for Complex&lt;T&gt; {
    type Output = Complex&lt;T&gt;;
    // Add 特征提供的核心功能,是我们在两种实现类型之间使用“+”运算符时调用的方法。
    // 它是一个实例方法,通过值获取 self 并接收 rhs 作为参数,即特征定义中的 RHS。
    fn add(self, rhs: Complex&lt;T&gt;) -&gt; Self::Output {
        Complex { re: self.re + rhs.re, im: self.im + rhs.im }
    }
}

// 来自 std::convert 模块的 Into 和 From 特征使用户能够根据其他类型创建复数类型
/*
1. 如果我们可以从内置基元类型 (例如双元素元组) 构造 Complex 类型
   其中第 1 个元素是实部,第 2 个元素是虚部,将会很方便。
   我们可以通过实现 From 特征来达到此目的。
2. 此特征定义了一个 from 方法, 为我们提供了在类型之间进行转换的一般方法
3. 第一个&lt;T&gt;是泛型 T 的声明, 第二个和第三个&lt;T&gt;是泛型类型 T 的用途。 我们会根据(T,T) 类型创建它
*/
impl&lt;T&gt; From&lt;(T, T)&gt; for Complex&lt;T&gt; {
    /*
        当我们实现它时, 只需要用我们希望实现它的类型替换 T 并实现 from 方法,
        然后我们就可以在相关类型上调用该方法。
        这是一个将 Complex 值转换为双元素元组类型的实现, Rust本身就能识别它
    */
    fn from(value: (T, T)) -&gt; Complex&lt;T&gt; {
        Complex { re: value.0, im: value.1 }
    }
}

use std::fmt::{Formatter, Display, Result};

// Display 特征能够输出人类可读版本的复数类型
impl&lt;T: Display&gt; Display for Complex&lt;T&gt; {
    fn fmt(&amp;self, f: &amp;mut Formatter) -&gt; Result {
        // 为了让用户能够以数学符号的形式查看复数类型
        write!(f, &quot;{} + {}i&quot;, self.re, self.im)
    }
}

// 一个简单的初始化测试用例。
#[cfg(test)]
mod tests {
    use crate::Complex;

    #[test]
    fn complex_basics() {
        let first = Complex::new(3, 5);
        let second: Complex&lt;i32&gt; = Complex::default();
        assert_eq!(first.re, 3);
        assert_eq!(first.im, 5);
        assert!(second.re == second.im);
    }

    #[test]
    fn complex_addition() {
        let a = Complex::new(1, -2);
        let b = Complex::default();
        let res = a + b;
        assert_eq!(res, a);
    }

    #[test]
    fn complex_from() {
        let a = (2345, 456);
        let complex = Complex::from(a);
        assert_eq!(complex.re, 2345);
        assert_eq!(complex.im, 456);
    }

    #[test]
    fn complex_display() {
        let my_imaginary = Complex::new(2345, 456);
        println!(&quot;{}&quot;, my_imaginary);
    }
}
// 最后使用cargo test -- --nocapture执行
</code></pre></pre>
<h2 id="特征区间泛型特征"><a class="header" href="#特征区间泛型特征">特征区间：泛型+特征</a></h2>
<h3 id="引出特征区间"><a class="header" href="#引出特征区间">引出特征区间</a></h3>
<p>首先看一下如下代码：</p>
<pre><pre class="playground"><code class="language-rust  editable">// trait_bounds_intro.rs

struct Game;

struct Enemy;

struct Hero;
/*
在 Game 类型上我们有一个泛型函数 load,它可以接收任何游戏实体,
并通过任意 T 调用 init()将其加载到我们的游戏世界中。
但是,这个示例无法通过编译
*/
impl Game {
    fn load&lt;T&gt;(&amp;self, entity: T) {
        entity.init(); // method not found in `T`
    }
}

fn main() {
    let game = Game;
    game.load(Enemy);
    game.load(Hero);
}
</code></pre></pre>
<ol>
<li>因此, 任何类型为 T 的泛型函数都不能知道或默认假定 init()方法存在于 T 之上。</li>
<li>如果确实如此,那么它根本不是泛型,并且它们只能接收具有 init()方法的类型。</li>
<li><strong>因此,有一种方法可以让编译器知道这一点,并约束 load 通过特征能够接收的类型集,这就需要用到特征区间</strong>。</li>
</ol>
<blockquote>
<p>我们可以定义一个名为 Loadable 的特征,并在我们的 Enemy 和 Hero 类型上实现它。</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// trait_bounds_intro.rs

struct Game;

struct Enemy;

struct Hero;

trait Loadable {
    fn init(&amp;self);
}
/*
我们分别为 Enemy 和 Hero 实现了 Loadable,还修改了 load 方法
*/
impl Loadable for Enemy {
    fn init(&amp;self) {
        println!(&quot;Enemy loaded&quot;);
    }
}

impl Loadable for Hero {
    fn init(&amp;self) {
        println!(&quot;Hero loaded&quot;);
    }
}

impl Game {
    /*
        我们必须在泛型声明旁边放置几个符号来指定特征,我们称之为特征区间
    */
    fn load&lt;T: Loadable&gt;(&amp;self, entity: T) {
        entity.init();
    }
}

fn main() {
    let game = Game;
    game.load(Enemy);
    game.load(Hero);
}
</code></pre></pre>
<ol>
<li>注意, “:Loadable”部分表明了我们指定特征范围的方式。特征区间允许我们限制泛型 API 可以接收的参数范围。</li>
</ol>
<h3 id="代码单体化"><a class="header" href="#代码单体化">代码单体化</a></h3>
<ol>
<li>指定泛型元素上的绑定的特征类似于我们为变量指定类型的方式</li>
<li>但是此处的变量是泛型 T,类型是某些特征。例如 <strong>T:SomeTrait</strong>。</li>
<li>定义泛型函数时几乎总是会用到特征区间。</li>
<li>如果定义的泛型函数中的 T 不包含任何特征区间,我们就不能通过任何方法调用,因 Rust 不知道给定方法实现的方式。</li>
<li>它需要知道 T 是否具有某个 foo 方法,以便<strong>将代码单体化</strong></li>
</ol>
<pre><pre class="playground"><code class="language-rust  editable">// trait_bounds_basics.rs

// 我们有一个方法 add_thing,它可以添加任何类型 T。
fn add_thing&lt;T&gt;(fst: T, snd: T) {
    // 编译器向用户建议在 T 上添加特征区间 Add
    // help: consider restricting type parameter `T`
    let _ = fst + snd;
}

fn main() {
    add_thing(2, 2);
}
</code></pre></pre>
<blockquote>
<p>修正后</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">// trait_bound_basics_fixed.rs

use std::ops::Add;

// 代码修改之后,我们将“:Add”添加到了 T 的后面,之后代码通过了编译
fn add_thing&lt;T: Add&gt;(fst: T, snd: T) {
    let _ = fst + snd;
}

fn main() {
    add_thing(2, 2);
}
</code></pre></pre>
<h3 id="指定特征区间的四个方法"><a class="header" href="#指定特征区间的四个方法">指定特征区间的四个方法</a></h3>
<h4 id="区间内泛型-fn-fn_namet-target_traitval-t"><a class="header" href="#区间内泛型-fn-fn_namet-target_traitval-t">区间内泛型: fn fn_name&lt;T: target_trait&gt;(val: T)</a></h4>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 指定特征区间的一种方法, 它会接收任何实现了 Display 特征的类型
fn show_me&lt;T: Display&gt;(val: T) {
    //可以使用{}格式化字符串，因为有Display特征区间
    printin!(&quot;{}&quot;, val);
}
<span class="boring">}
</span></code></pre></pre>
<ol>
<li>这是在泛型函数的类型签名的长度较短时声明特征区间的常见语法。</li>
<li>在指定类型的特征区间时,此语法也有效</li>
</ol>
<h4 id="where语句-当第一种方法签名过长时使用"><a class="header" href="#where语句-当第一种方法签名过长时使用">where语句: 当第一种方法签名过长时使用</a></h4>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn parse&lt;F&gt;(&amp;self) -&gt; Result&lt;F, &lt;F as FromStr&gt;::Err&gt;
    where F: FromStr { ... }
<span class="boring">}
</span></code></pre></pre>
<blockquote>
<p>注意“where F: FromStr”部分告诉我们 F 类型必须实现 FromStr 特征。where 语句将特征区间和函数签名解耦,并使其可读</p>
</blockquote>
<h4 id="使用组合多个特征"><a class="header" href="#使用组合多个特征">使用&quot;+&quot;组合多个特征</a></h4>
<ul>
<li>先看一下标准库中 HashMap 类型的 impl 代码块:</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// HashMap 键类型的 K 必须实现 Hash 特征和 Eq 特征
impl&lt;K: Hash + Eq, V&gt; HashMap&lt;K, V, RandomState&gt;
{}
<span class="boring">}
</span></code></pre></pre>
<ul>
<li>一个更加具体的例子</li>
</ul>
<pre><pre class="playground"><code class="language-rust  editable">// traits_composition.rs

trait Eat {
    fn eat(&amp;self) {
        println!(&quot;eat&quot;);
    }
}

trait Code {
    fn code(&amp;self) {
        println!(&quot;code&quot;);
    }
}

trait Sleep {
    fn sleep(&amp;self) {
        println!(&quot;sleep&quot;);
    }
}

// 创建了一个新的特征 Programmer,它由 3 个特征组合而成:Eat、Code、 Sleep。
// 通过这种方式, 我们对类型设置了约束:
// 因此如果类型 T 实现了 Programmer, 那么它必须实现上述所有特征
trait Programmer: Eat + Code + Sleep {
    fn animate(&amp;self) {
        self.eat();
        self.code();
        self.sleep();
        println!(&quot;repeat!&quot;);
    }
}

struct Bob;

impl Programmer for Bob {}

impl Eat for Bob {}

impl Code for Bob {}

impl Sleep for Bob {}

fn main() {
    Bob.animate();
}
</code></pre></pre>
<h4 id="使用impl特征语法-闭包常用"><a class="header" href="#使用impl特征语法-闭包常用">使用impl特征语法: 闭包常用</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">// impl_trait_syntax.rs

use std::fmt::Display;

/*
直接使用了 impl Display,而不是指定 T:Display。这是 impl 特征语法。
这为我们返回复杂或不方便表示的类型(例如函数的闭包)提供了便利
*/
fn show_me(val: impl Display) {
    println!(&quot;{}&quot;, val);
}

fn main() {
    show_me(&quot;Trait bounds are awesome&quot;);
}
</code></pre></pre>
<blockquote>
<p>如果没有这种语法,则必须使用 Box 智能指针类型将其放在指针后面返回,这涉及堆分配。
闭包的底层结构由实现了一系列特征的结构体组成。<strong>Fn(T) -&gt; U</strong> 特征就是其中之一</p>
</blockquote>
<p>闭包使用示例：</p>
<pre><pre class="playground"><code class="language-rust  editable">// impl_trait_closure.rs
// 它接收两个数字,并返回将这两个数字相加的闭包
fn lazy_adder(a: u32, b: u32) -&gt; impl Fn() -&gt; u32 {
    move || a + b
}

fn main() {
    // 调用 lazy_adder,传入两个数字。
    // 这会在 lazy_adder 中创建一个闭包,但不会对其进行求值
    let add_later = lazy_adder(1024, 2048);
    println!(&quot;{:?}&quot;, add_later());
}
</code></pre></pre>
<p>还可以在入参和返回使用：</p>
<pre><pre class="playground"><code class="language-rust  editable">// impl_trait_both.rs

use std::fmt::Display;

/*
1. 会接收任何 Display 特征的参数
2. 返回的类型是 impl Display
*/
fn surround_with_braces(val: impl Display) -&gt; impl Display {
    format!(&quot;{{{}}}&quot;, val)
}

fn main() {
    println!(&quot;{}&quot;, surround_with_braces(&quot;Hello&quot;));
}
</code></pre></pre>
<ol>
<li>通常建议将特征区间的 impl 特征语法用做函数的返回类型。</li>
<li>在参数位置使用它意味着我们不能使用 turbofish 运算符。</li>
<li>如果某些相关代码使用 turbofish 运算符来调用软件包中的某个方法,那么可能导致 API 不兼容。</li>
<li>只有当我们没有可用的具体类型时才应该使用它, 就像闭包那样。</li>
</ol>
<h3 id="特征区间的使用场景"><a class="header" href="#特征区间的使用场景">特征区间的使用场景</a></h3>
<h4 id="在类型上使用不建议"><a class="header" href="#在类型上使用不建议">在类型上使用：不建议</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">// trait_bounds_types.rs

use std::fmt::Display;

// 写法一：区间内泛型
struct Foo&lt;T: Display&gt; {
    bar: T,
}

// 写法二：where语句解耦
struct Bar&lt;F&gt;
    where
        F: Display,
{
    inner: F,
}

fn main() {}
</code></pre></pre>
<blockquote>
<p>不过,我们并不鼓励在类型上使用特征区间,因为它对类型自身施加了限制。
通常, 我们希望类型尽可能是泛型,从而允许我们使用任何类型创建实例,并使用函数或方法中的特征区间对其行为进行限制。</p>
</blockquote>
<h4 id="泛型函数impl代码块"><a class="header" href="#泛型函数impl代码块">泛型函数+impl代码块</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">// trait_bounds_functions.rs

use std::fmt::Debug;

trait Eatable {
    fn eat(&amp;self);
}

// 指定类型必须是 Debug,以便其可以在方法内部输出到控制台
#[derive(Debug)]
struct Food&lt;T&gt;(T);

#[derive(Debug)]
struct Apple;

// 为了让 apple 是“可食用”的,我们实现了 Food 的 Eatable 特征
impl&lt;T&gt; Eatable for Food&lt;T&gt;
    where
        T: Debug,
{
    fn eat(&amp;self) {
        println!(&quot;Eating {:?}&quot;, self);
    }
}

// 注意 eat 的特点,类型 T 必须实现 Eatable 特征。
fn eat&lt;T&gt;(val: T)
    where
        T: Eatable,
{
    val.eat();
}

fn main() {
    let apple = Food(Apple);
    eat(apple);
}
</code></pre></pre>
<h2 id="特征对象-多态特征类型"><a class="header" href="#特征对象-多态特征类型">特征对象: 多态特征类型</a></h2>
<h3 id="分发dispatch"><a class="header" href="#分发dispatch">分发(dispatch)</a></h3>
<blockquote>
<p>分发是一个从面向对象编程范式中借鉴的概念,主要用于描述被称为多态的上下文中的一种特性。 在面向对象程序设计(Object-Oriented Programming,OOP)中,当 API 是泛型或者接收实现为接口的参数时,必须弄清楚参数在传递给 API 的类型实例上调用什么方法实现。多态的上下文中的方法解析过程被称为分发,调用该方法被称为分发化(dispatching) 。</p>
</blockquote>
<h4 id="分发方式静态-or-动态"><a class="header" href="#分发方式静态-or-动态">分发方式：静态 or 动态</a></h4>
<blockquote>
<p>在支持多态的主流语言中,分发可以通过以下任意一种方式进行。</p>
</blockquote>
<ol>
<li>静态分发：编译期决定</li>
</ol>
<p>当在编译期决定要调用的方法时,它被称为静态分发或早期绑定。方法的签名用于决定调用的方法,所有这些都在编译期决定。在 Rust 中,泛型展示了这种形式的分发, 因为即使泛型函数可以接收许多参数, 也会在编译期使用具体类型生成函数的专用副本。</p>
<p>2.动态分发: 运行期决定，资源开销更大</p>
<p>在面向对象的语言中,有时直到运行时才能确定调用的方法。这是因为具体类型被隐藏,并且只有接口方法可用于调用该类型。 在 Java 中,当函数只有参数时就是这种情况,即接口。 这种情况只能通过动态分发来处理。在动态分发过程中,可通过对
vtable 接口的实现列表进行查找,并调用该方法来动态确定相关方法。vtable 是一个函数指针列表,指向每个类型的实现方法。由于方法调用过程中存在额外的间接指针引用,所以这需要更多的资源开销</p>
<h3 id="区别特征区间与特征对象"><a class="header" href="#区别特征区间与特征对象">区别特征区间与特征对象</a></h3>
<p>| 特征使用方式 | 分发方式 | 实现方式 |       绑定时期       |      |
| :----------: | :------: | :------: | :------------------: | ---- |
|   特征区间   | 静态分发 | 限定泛型 |   编译期(早期绑定)   |      |
|   特征对象   | 动态分发 |  胖指针  | 运行期多态(后期绑定) |      |</p>
<h3 id="特征对象具体说说"><a class="header" href="#特征对象具体说说">特征对象具体说说</a></h3>
<h4 id="指定为实现某个特征"><a class="header" href="#指定为实现某个特征">指定为实现某个特征</a></h4>
<p>特征对象是一种创建多态 API 的方法,可以将参数指定为实现某个特征的东西,而不是泛型或具体类型。这种方法被声明为实现某个特征 API,即特征对象。</p>
<h4 id="用胖指针实现"><a class="header" href="#用胖指针实现">用胖指针实现</a></h4>
<p>特征对象类似 C++中的虚方法。特征对象实现为胖指针,并且是不定长类型,这意味着它们只能在引用符号(&amp;)后面使用。特征对象胖指针具有指向与对象关联的实际数据的第一指针,而第二指针指向虚拟表(vtable)
,它是在固定偏移处为每个对象的方法保留一个函数指针的结构体。</p>
<h4 id="是rust执行动态分发的方式"><a class="header" href="#是rust执行动态分发的方式">是Rust执行动态分发的方式</a></h4>
<p>特征对象是 Rust 执行动态分发的方式,我们没有实际的具体类型信息。通过跳转到vtable 并调用适当的方法完成方法解析。</p>
<p>特征对象的另一个用例是,它们允许用户对可以具有多种类型的集合进行操作,但是在运行时需要额外的间接指针引用开销</p>
<pre><pre class="playground"><code class="language-rust  editable">// trait_objects.rs

use std::fmt::Debug;

#[derive(Debug)]
struct Square(f32);

#[derive(Debug)]
struct Rectangle(f32, f32);

trait Area: Debug {
    fn get_area(&amp;self) -&gt; f32;
}

impl Area for Square {
    fn get_area(&amp;self) -&gt; f32 {
        self.0 * self.0
    }
}

impl Area for Rectangle {
    fn get_area(&amp;self) -&gt; f32 {
        self.0 * self.1
    }
}

fn main() {
    /*
        shapes 的元素类型是&amp;dyn Area,这是一种表示为特征的类型。
        特征对象是由 dyn Area 表示的, 意味着它是指向 Area 特征某些实现的指针。
        特征对象形式的类型允许用户在集合类型(例如 Vec)中存储不同类型

        Square 和 Rectangle 会隐式转换成特征对象,因为我们给它们推送了一个引用。
        我们还可以通过手动转换某个特征对象来构造一个类型,但这是一种比较少见的情况.
        只有在编译器自身无法将类型作为特征对象转换时使用。
    */
    let shapes: Vec&lt;&amp;dyn Area&gt; = vec![&amp;Square(3f32), &amp;Rectangle(4f32, 2f32)];
    for s in shapes {
        println!(&quot;{:?}&quot;, s);
    }
}
</code></pre></pre>
<h4 id="不定长类型只能作为引用创建"><a class="header" href="#不定长类型只能作为引用创建">不定长类型只能作为引用创建</a></h4>
<blockquote>
<p>请注意,我们只能创建在编译时知道类型尺寸的特征对象。</p>
</blockquote>
<p>dyn Trait 是一个不定长类型,只能作为引用创建。我们还可以通过将特征对象置于其他指针类型之后来创建特征对象,例如 Box、Rc、Arc 等</p>
<pre><pre class="playground"><code class="language-rust  editable">// dyn_trait.rs

use std::fmt::Display;

fn show_me(item: &amp;dyn Display) {
    println!(&quot;{}&quot;, item);
}

fn main() {
    show_me(&amp;&quot;Hello trait object&quot;);
}
</code></pre></pre>
<h2 id="总结特征特征区间和特征对象"><a class="header" href="#总结特征特征区间和特征对象">总结特征、特征区间和特征对象</a></h2>
<p>特征和泛型通过单态化(早期绑定)或运行时多态(后期绑定)提供了两种代码复用的方式。 何时使用它们取决于具体情况和相关应用程序的需求：</p>
<ol>
<li>通常,错误类型会被分配到动态分发的序列,因为它们应该是很少被执行的代码路径。</li>
<li>单态化对小型的应用场景来说非常方便,但是缺点是导致了代码的膨胀和重复,这会影响缓存效率,并增加二进制文件的大小。</li>
</ol>
<blockquote>
<p>但是,在这两个选项中,静态分发应该是首选,除非系统对二进制文件大小存在严格的限制。</p>
</blockquote>
<h2 id="参考资源-6"><a class="header" href="#参考资源-6">参考资源</a></h2>
<h3 id="online-book-8"><a class="header" href="#online-book-8">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch19-03-advanced-traits.html">Advanced Traits - The Rust Programming Language</a></li>
<li><a href="https://doc.rust-lang.org/stable/reference/trait-bounds.html">Trait and lifetime bounds - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/stable/reference/special-types-and-traits.html">Special types and traits - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/book/ch10-00-generics.html">Generic Types, Traits, and Lifetimes - The Rust Programming Language</a></li>
<li><a href="https://doc.rust-lang.org/book/ch19-03-advanced-traits.html">Advanced Traits - The Rust Programming Language</a></li>
</ul>
<h3 id="fragment-8"><a class="header" href="#fragment-8">fragment</a></h3>
<ul>
<li><a href="https://blog.logrocket.com/rust-traits-a-deep-dive/">Rust traits: A deep dive - LogRocket Blog</a></li>
<li><a href="https://zh.m.wikipedia.org/zh-hans/%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B">鸭子类型 - 维基百科，自由的百科全书</a></li>
</ul>
<h3 id="local-8"><a class="header" href="#local-8">local</a></h3>
<ul>
<li><a href="marginnote3app://note/91DC4A44-A289-4D0F-B1D1-89D75181E736">&lt;精通rust(第二版)&gt;-第四章：类型、泛型和特征</a></li>
<li><a href="marginnote3app://note/6D348DE0-2C5C-42E6-A404-4CF0CA1C5678">《代码之髓》- 第五章：函数</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/language_grammar.html#%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E8%AF%AD%E6%B3%95%E6%A6%82%E8%BF%B0">编程语言语法概述</a>
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/language_grammar.html#%E5%89%8D%E8%A8%80">前言</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/language_grammar.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/language_grammar.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/language_grammar.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/language_grammar.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:08 UTC 2022 -->
<!--te-->
<h1 id="编程语言语法概述"><a class="header" href="#编程语言语法概述">编程语言语法概述</a></h1>
<h2 id="前言"><a class="header" href="#前言">前言</a></h2>
<p>其实编程语言的语法本质上就分成三部分：确定使用什么类型、类型可以用的操作、通用逻辑操作。不过语法又不是这么简单，它担负着两方面的作用：</p>
<ol>
<li>
<p>与编译器交互：因为这些语法在编译器内部都有对应的操作，涉及一系列繁杂的自动化操作。所以当编写语法可以通过编译，至少说明程序可以跑起来。
这一点在rust中尤其明显，毕竟rust是出了名的“面向编译器”开发语言，编译器对语法的要求可以算作“苛刻”。但是这样也有好处，就是潜移默化之中，编程思维也被调整一番。</p>
</li>
<li>
<p>与编程人员交互：这里主要指编程需要可读且易读。这和代码质量息息相关，这里的编程人员不仅包括第一个写出这段代码的人，还包括后续开发以及协作的开发人员。</p>
</li>
</ol>
<h2 id="参考资源-7"><a class="header" href="#参考资源-7">参考资源</a></h2>
<h3 id="online-book-9"><a class="header" href="#online-book-9">online-book</a></h3>
<h3 id="fragment-9"><a class="header" href="#fragment-9">fragment</a></h3>
<h3 id="local-9"><a class="header" href="#local-9">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="注释与文档rustdoc"><a class="header" href="#注释与文档rustdoc">注释与文档(rustdoc)</a></h1>
<!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/annotation_rustdoc.html#%E6%B3%A8%E9%87%8A%E4%B8%8E%E6%96%87%E6%A1%A3rustdoc">注释与文档(rustdoc)</a>
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/annotation_rustdoc.html#%E6%B3%A8%E9%87%8A%E6%96%B9%E6%B3%95">注释方法</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/annotation_rustdoc.html#rustdoc%E4%BD%BF%E7%94%A8">rustdoc使用</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/annotation_rustdoc.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/annotation_rustdoc.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/annotation_rustdoc.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/annotation_rustdoc.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:06 UTC 2022 -->
<!--te-->
<h2 id="注释方法"><a class="header" href="#注释方法">注释方法</a></h2>
<h2 id="rustdoc使用"><a class="header" href="#rustdoc使用">rustdoc使用</a></h2>
<h2 id="参考资源-8"><a class="header" href="#参考资源-8">参考资源</a></h2>
<h3 id="online-book-10"><a class="header" href="#online-book-10">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/rustdoc/index.html">What is rustdoc? - The rustdoc book</a></li>
</ul>
<h3 id="fragment-10"><a class="header" href="#fragment-10">fragment</a></h3>
<h3 id="local-10"><a class="header" href="#local-10">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="词法关键字扫盲"><a class="header" href="#词法关键字扫盲">词法关键字扫盲</a></h1>
<h2 id="1-关键字"><a class="header" href="#1-关键字">1. 关键字</a></h2>
<h3 id="严格关键字"><a class="header" href="#严格关键字">严格关键字</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>as / break / const / continue / crate / if / else / struct / enum / true / false / fn / for / in / let / loop / impl / mod / match / move mut / pub / ref / return / self / Self / static / super /trait / type / unsafe /use / where / while / async /await/dyn/main
<span class="boring">}
</span></code></pre></pre>
<h3 id="弱关键字"><a class="header" href="#弱关键字">弱关键字</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>abstract / become / box / do / final / macro / override / priv / typeof / unsized / virtual / yield / try
<span class="boring">}
</span></code></pre></pre>
<h3 id="保留字"><a class="header" href="#保留字">保留字</a></h3>
<ul>
<li>2018 Edition:union,'static</li>
<li>2015 Edition:dyn</li>
</ul>
<blockquote>
<p>被保留的关键字不代表将来一定会使用</p>
</blockquote>
<h2 id="2-标识符"><a class="header" href="#2-标识符">2. 标识符</a></h2>
<h2 id="3-注释"><a class="header" href="#3-注释">3. 注释</a></h2>
<blockquote>
<p>//!, /<em>!, //!!, /</em>!!, /<strong>...<em>/, //, ////, /</em></strong>...*/</p>
</blockquote>
<h2 id="4-空白-nttab"><a class="header" href="#4-空白-nttab">4. 空白: \n、\t、tab</a></h2>
<blockquote>
<p>任何形式的空白字符在RuSt中只用于分隔标记，没有语义意义。</p>
</blockquote>
<h2 id="5-词条"><a class="header" href="#5-词条">5. 词条</a></h2>
<ol>
<li>语言项(item)</li>
<li>块(block)</li>
<li>语句（Stmt)</li>
<li>表达式（Expr)</li>
<li>模式（Pattern)</li>
<li>关键字（Keyword)</li>
<li>标识符（Ident)</li>
<li>字面量(Literal)</li>
<li>生命周期(Lifetime)</li>
<li>可见性(Vis)</li>
<li>标点符号（Punctuation)</li>
<li>分隔符（delimiter)</li>
<li>词条树(Token Tree)</li>
<li>属性（Attribute)</li>
</ol>
<h2 id="路径--"><a class="header" href="#路径--">路径: ::, ::&lt;&gt;</a></h2>
<h2 id="参考资源-9"><a class="header" href="#参考资源-9">参考资源</a></h2>
<h3 id="online-book-11"><a class="header" href="#online-book-11">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/stable/reference/lexical-structure.html">Lexical structure - The Rust Reference</a></li>
</ul>
<h3 id="fragment-11"><a class="header" href="#fragment-11">fragment</a></h3>
<ul>
<li><a href="https://time.geekbang.org/course/detail/100060601-286522">词法结构</a></li>
</ul>
<h3 id="local-11"><a class="header" href="#local-11">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="绑定赋值与匹配模式"><a class="header" href="#绑定赋值与匹配模式">绑定、赋值与匹配模式</a></h1>
<!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/binding_match_patterns.html#%E7%BB%91%E5%AE%9A%E8%B5%8B%E5%80%BC%E4%B8%8E%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%BC%8F">绑定、赋值与匹配模式</a>
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/binding_match_patterns.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/binding_match_patterns.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/binding_match_patterns.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/binding_match_patterns.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:07 UTC 2022 -->
<!--te-->
<h2 id="参考资源-10"><a class="header" href="#参考资源-10">参考资源</a></h2>
<h3 id="online-book-12"><a class="header" href="#online-book-12">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/stable/reference/patterns.html">Patterns - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/book/ch06-00-enums.html">Enums and Pattern Matching - The Rust Programming Language</a></li>
<li><a href="https://doc.rust-lang.org/book/ch18-00-patterns.html">Patterns and Matching - The Rust Programming Language</a></li>
</ul>
<h3 id="fragment-12"><a class="header" href="#fragment-12">fragment</a></h3>
<h3 id="local-12"><a class="header" href="#local-12">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="逻辑判断与循环"><a class="header" href="#逻辑判断与循环">逻辑判断与循环</a></h1>
<h2 id="参考资源-11"><a class="header" href="#参考资源-11">参考资源</a></h2>
<h3 id="online-book-13"><a class="header" href="#online-book-13">online-book</a></h3>
<h3 id="fragment-13"><a class="header" href="#fragment-13">fragment</a></h3>
<h3 id="local-13"><a class="header" href="#local-13">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="语句与表达式"><a class="header" href="#语句与表达式">语句与表达式</a></h1>
<!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/statements_expressions.html#%E8%AF%AD%E5%8F%A5%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F">语句与表达式</a>
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/statements_expressions.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/statements_expressions.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/statements_expressions.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/statements_expressions.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:09 UTC 2022 -->
<!--te-->
<h2 id="参考资源-12"><a class="header" href="#参考资源-12">参考资源</a></h2>
<h3 id="online-book-14"><a class="header" href="#online-book-14">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/stable/reference/statements.html">Statements - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/stable/reference/expressions.html">Expressions - The Rust Reference</a></li>
</ul>
<h3 id="fragment-14"><a class="header" href="#fragment-14">fragment</a></h3>
<h3 id="local-14"><a class="header" href="#local-14">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="代码质量异常测试与日志"><a class="header" href="#代码质量异常测试与日志">代码质量：异常、测试与日志</a></h1>
<!--ts-->
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/code_quality.html#%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E5%BC%82%E5%B8%B8%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%97%A5%E5%BF%97">代码质量：异常、测试与日志</a>
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/code_quality.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer1_underlying_abstract/3_language_grammar/code_quality.html#online-book">online-book</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/code_quality.html#fragment">fragment</a></li>
<li><a href="layer1_underlying_abstract/3_language_grammar/code_quality.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:07 UTC 2022 -->
<!--te-->
<h2 id="参考资源-13"><a class="header" href="#参考资源-13">参考资源</a></h2>
<h3 id="online-book-15"><a class="header" href="#online-book-15">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch11-00-testing.html">Writing Automated Tests - The Rust Programming Language</a></li>
</ul>
<h3 id="fragment-15"><a class="header" href="#fragment-15">fragment</a></h3>
<h3 id="local-15"><a class="header" href="#local-15">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="设计抽象"><a class="header" href="#设计抽象">设计抽象</a></h1>
<!--ts-->
<ul>
<li><a href="layer2_design_abstract/layer2_design_abstract.html#%E8%AE%BE%E8%AE%A1%E6%8A%BD%E8%B1%A1">设计抽象</a>
<ul>
<li><a href="layer2_design_abstract/layer2_design_abstract.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer2_design_abstract/layer2_design_abstract.html#online-book">online-book</a></li>
<li><a href="layer2_design_abstract/layer2_design_abstract.html#fragment">fragment</a></li>
<li><a href="layer2_design_abstract/layer2_design_abstract.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:14 UTC 2022 -->
<!--te-->
<h2 id="参考资源-14"><a class="header" href="#参考资源-14">参考资源</a></h2>
<h3 id="online-book-16"><a class="header" href="#online-book-16">online-book</a></h3>
<h3 id="fragment-16"><a class="header" href="#fragment-16">fragment</a></h3>
<h3 id="local-16"><a class="header" href="#local-16">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="编程范式"><a class="header" href="#编程范式">编程范式</a></h1>
<!--ts-->
<ul>
<li><a href="layer2_design_abstract/4_programming_paradigm/4_programming_paradigm.html#%E7%BC%96%E7%A8%8B%E8%8C%83%E5%BC%8F">编程范式</a>
<ul>
<li><a href="layer2_design_abstract/4_programming_paradigm/4_programming_paradigm.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer2_design_abstract/4_programming_paradigm/4_programming_paradigm.html#online-book">online-book</a></li>
<li><a href="layer2_design_abstract/4_programming_paradigm/4_programming_paradigm.html#fragment">fragment</a></li>
<li><a href="layer2_design_abstract/4_programming_paradigm/4_programming_paradigm.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:10 UTC 2022 -->
<!--te-->
<h2 id="参考资源-15"><a class="header" href="#参考资源-15">参考资源</a></h2>
<h3 id="online-book-17"><a class="header" href="#online-book-17">online-book</a></h3>
<h3 id="fragment-17"><a class="header" href="#fragment-17">fragment</a></h3>
<h3 id="local-17"><a class="header" href="#local-17">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="函数式编程"><a class="header" href="#函数式编程">函数式编程</a></h1>
<!--ts-->
<ul>
<li><a href="layer2_design_abstract/4_programming_paradigm/fp.html#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B">函数式编程</a>
<ul>
<li><a href="layer2_design_abstract/4_programming_paradigm/fp.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer2_design_abstract/4_programming_paradigm/fp.html#online-book">online-book</a></li>
<li><a href="layer2_design_abstract/4_programming_paradigm/fp.html#fragment">fragment</a></li>
<li><a href="layer2_design_abstract/4_programming_paradigm/fp.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:10 UTC 2022 -->
<!--te-->
<h2 id="参考资源-16"><a class="header" href="#参考资源-16">参考资源</a></h2>
<h3 id="online-book-18"><a class="header" href="#online-book-18">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch13-00-functional-features.html">Functional Language Features: Iterators and Closures - The Rust Programming Language</a></li>
<li><a href="https://doc.rust-lang.org/book/ch19-05-advanced-functions-and-closures.html">Advanced Functions and Closures - The Rust Programming Language</a></li>
</ul>
<h3 id="fragment-18"><a class="header" href="#fragment-18">fragment</a></h3>
<h3 id="local-18"><a class="header" href="#local-18">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="面向对象编程"><a class="header" href="#面向对象编程">面向对象编程</a></h1>
<!--ts-->
<ul>
<li><a href="layer2_design_abstract/4_programming_paradigm/oop.html#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B">面向对象编程</a>
<ul>
<li><a href="layer2_design_abstract/4_programming_paradigm/oop.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer2_design_abstract/4_programming_paradigm/oop.html#online-book">online-book</a></li>
<li><a href="layer2_design_abstract/4_programming_paradigm/oop.html#fragment">fragment</a></li>
<li><a href="layer2_design_abstract/4_programming_paradigm/oop.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:11 UTC 2022 -->
<!--te-->
<h2 id="参考资源-17"><a class="header" href="#参考资源-17">参考资源</a></h2>
<h3 id="online-book-19"><a class="header" href="#online-book-19">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch17-00-oop.html">Object Oriented Programming Features of Rust - The Rust Programming Language</a></li>
</ul>
<h3 id="fragment-19"><a class="header" href="#fragment-19">fragment</a></h3>
<h3 id="local-19"><a class="header" href="#local-19">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="泛型编程"><a class="header" href="#泛型编程">泛型编程</a></h1>
<!--ts-->
<ul>
<li><a href="layer2_design_abstract/4_programming_paradigm/gp.html#%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B">泛型编程</a>
<ul>
<li><a href="layer2_design_abstract/4_programming_paradigm/gp.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer2_design_abstract/4_programming_paradigm/gp.html#online-book">online-book</a></li>
<li><a href="layer2_design_abstract/4_programming_paradigm/gp.html#fragment">fragment</a></li>
<li><a href="layer2_design_abstract/4_programming_paradigm/gp.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:10 UTC 2022 -->
<!--te-->
<h2 id="参考资源-18"><a class="header" href="#参考资源-18">参考资源</a></h2>
<h3 id="online-book-20"><a class="header" href="#online-book-20">online-book</a></h3>
<h3 id="fragment-20"><a class="header" href="#fragment-20">fragment</a></h3>
<h3 id="local-20"><a class="header" href="#local-20">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="设计模式"><a class="header" href="#设计模式">设计模式</a></h1>
<!--ts-->
<ul>
<li><a href="layer2_design_abstract/5_design_pattern/5_design_pattern.html#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">设计模式</a>
<ul>
<li><a href="layer2_design_abstract/5_design_pattern/5_design_pattern.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer2_design_abstract/5_design_pattern/5_design_pattern.html#online-book">online-book</a></li>
<li><a href="layer2_design_abstract/5_design_pattern/5_design_pattern.html#fragment">fragment</a></li>
<li><a href="layer2_design_abstract/5_design_pattern/5_design_pattern.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:11 UTC 2022 -->
<!--te-->
<h2 id="参考资源-19"><a class="header" href="#参考资源-19">参考资源</a></h2>
<h3 id="online-book-21"><a class="header" href="#online-book-21">online-book</a></h3>
<h3 id="fragment-21"><a class="header" href="#fragment-21">fragment</a></h3>
<h3 id="local-21"><a class="header" href="#local-21">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="项目模块管理及扩展"><a class="header" href="#项目模块管理及扩展">项目模块管理及扩展</a></h1>
<!--ts-->
<ul>
<li><a href="layer2_design_abstract/6_module_manage/6_module_manage.html#%E9%A1%B9%E7%9B%AE%E6%A8%A1%E5%9D%97%E7%AE%A1%E7%90%86%E5%8F%8A%E6%89%A9%E5%B1%95">项目模块管理及扩展</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/6_module_manage.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/6_module_manage.html#online-book">online-book</a></li>
<li><a href="layer2_design_abstract/6_module_manage/6_module_manage.html#fragment">fragment</a></li>
<li><a href="layer2_design_abstract/6_module_manage/6_module_manage.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:12 UTC 2022 -->
<!--te-->
<p>对于一门编程语言，是否能够成为工程化开发工具的主要标准在于两点：</p>
<ol>
<li>包管理、模块管理</li>
<li>扩展工具是否方便加入</li>
</ol>
<p>这里面包含一些通用的设计抽象，因此专门作为单独的一层。</p>
<h2 id="参考资源-20"><a class="header" href="#参考资源-20">参考资源</a></h2>
<h3 id="online-book-22"><a class="header" href="#online-book-22">online-book</a></h3>
<h3 id="fragment-22"><a class="header" href="#fragment-22">fragment</a></h3>
<h3 id="local-22"><a class="header" href="#local-22">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="模块系统相关workspacepackagecratemodule"><a class="header" href="#模块系统相关workspacepackagecratemodule">模块系统相关：Workspace、Package、Crate、Module</a></h1>
<!--ts-->
<ul>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3workspacepackagecratemodule">模块系统相关：Workspace、Package、Crate、Module</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E5%8E%98%E6%B8%85workspacepackagecrate%E5%92%8Cmodule%E7%9A%84%E5%85%B3%E7%B3%BB">厘清Workspace、Package、crate和module的关系</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#package-%E5%8C%85%E5%90%ABcargotoml">Package: 包含Cargo.toml</a></li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#workspace%E4%B8%8Epackage">workspace与package</a></li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E5%85%B7%E4%BD%93%E5%AF%B9%E6%AF%94package%E5%92%8Ccrate">具体对比package和crate</a>
<ul>
<li>[在Cargo.toml的[bin]/[lib]中指明](#在cargotoml的binlib中指明)</li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E5%86%8D%E6%9D%A5%E5%AF%B9%E6%AF%94workspacepackage%E5%92%8Ccrate">再来对比workspace、package和crate</a></li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#module">module</a></li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E6%95%B4%E7%90%86%E8%AF%B4%E4%B8%80%E4%B8%8Brust%E7%9A%84%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F">整理说一下rust的模块系统</a></li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E8%81%94%E6%83%B3%E5%AF%B9%E6%AF%94">联想对比</a></li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#module-tree">module tree</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E6%A8%A1%E5%9D%97%E5%91%88%E7%8E%B0%E6%96%B9%E5%BC%8F">模块呈现方式</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E5%B5%8C%E5%A5%97%E6%A8%A1%E5%9D%97">嵌套模块</a></li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E6%96%87%E4%BB%B6%E6%A8%A1%E5%9D%97">文件模块</a></li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E7%9B%AE%E5%BD%95%E6%A8%A1%E5%9D%97">目录模块</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E9%9A%90%E7%A7%81%E4%B8%8E%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA">隐私与导入导出</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E9%9A%90%E7%A7%81%E7%AE%A1%E7%90%86">隐私管理</a></li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E5%B5%8C%E5%A5%97%E5%AF%BC%E5%85%A5">嵌套导入</a></li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E5%86%8D%E6%AC%A1%E5%AF%BC%E5%87%BA">再次导出</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#online-book">online-book</a></li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#fragment">fragment</a></li>
<li><a href="layer2_design_abstract/6_module_manage/module_system.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:14 UTC 2022 -->
<!--te-->
<h2 id="厘清workspacepackagecrate和module的关系"><a class="header" href="#厘清workspacepackagecrate和module的关系">厘清Workspace、Package、crate和module的关系</a></h2>
<h3 id="package-包含cargotoml"><a class="header" href="#package-包含cargotoml">Package: 包含Cargo.toml</a></h3>
<p>package就是cargo new的产物，里面包含一个cargo.toml，包名就写在里面的package里。比如substrate的一个包代码：</p>
<blockquote>
<p><a href="https://github.com/paritytech/substrate/blob/master/client/allocator/Cargo.toml">substrate/Cargo.toml at master · paritytech/substrate</a></p>
</blockquote>
<pre><code class="language-toml">[package]
name = &quot;sc-allocator&quot;
version = &quot;4.1.0-dev&quot;
authors = [&quot;Parity Technologies &lt;admin@parity.io&gt;&quot;]
edition = &quot;2021&quot;
license = &quot;Apache-2.0&quot;
homepage = &quot;https://substrate.io&quot;
repository = &quot;https://github.com/paritytech/substrate/&quot;
description = &quot;Collection of allocator implementations.&quot;
documentation = &quot;https://docs.rs/sc-allocator&quot;
readme = &quot;README.md&quot;

[package.metadata.docs.rs]
targets = [&quot;x86_64-unknown-linux-gnu&quot;]

[dependencies]
log = &quot;0.4.17&quot;
thiserror = &quot;1.0.30&quot;
sp-core = { version = &quot;6.0.0&quot;, path = &quot;../../primitives/core&quot; }
sp-wasm-interface = { version = &quot;6.0.0&quot;, path = &quot;../../primitives/wasm-interface&quot; }
</code></pre>
<ol>
<li>package表明该package的基本信息</li>
<li>dependencies表示该package依赖的其他package</li>
</ol>
<h3 id="workspace与package"><a class="header" href="#workspace与package">workspace与package</a></h3>
<ul>
<li>workspace+members: 并发代表当前package包含的所有subpackage，只是指明一个工作区的所有package</li>
</ul>
<blockquote>
<p>A Cargo.toml file can simultaneously define a package and a workspace to which it belongs, but that package is still a
member of that workspace, not the other way around.</p>
</blockquote>
<h3 id="具体对比package和crate"><a class="header" href="#具体对比package和crate">具体对比package和crate</a></h3>
<div id="admonition-package和crate" class="admonition tip">
<div class="admonition-title">
<p>package和crate</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/module_system.html#admonition-package和crate"></a></p>
</div>
<div>
<p>在rust中，最小编译单元叫crate，package是一个或多个crate的集合。</p>
<blockquote>
<p>也就是说，如果package没有指明crate，本身就是一个crate</p>
</blockquote>
</div>
</div>
<h4 id="在cargotoml的binlib中指明"><a class="header" href="#在cargotoml的binlib中指明">在Cargo.toml的[bin]/[lib]中指明</a></h4>
<h3 id="再来对比workspacepackage和crate"><a class="header" href="#再来对比workspacepackage和crate">再来对比workspace、package和crate</a></h3>
<div id="admonition-hierarchy" class="admonition info">
<div class="admonition-title">
<p>hierarchy</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/module_system.html#admonition-hierarchy"></a></p>
</div>
<div>
<p>Workspace → Package → Crate</p>
</div>
</div>
<p>Generally, a package exposes only one crate. Most library crates don't even have an associated binary crate(s) in their
package. It's due to this that package/crate terminology is often used interchangeably; for lib crates it is in the 90%
case. Package is also a generic term that people not familiar with Rust's ecosystem can understand, where crate is a
Rust-specific piece of jargon.</p>
<p>The two concepts are still meaningfully different -- while conventionally package and lib crate have the same name (
modulo hyphens vs underscores), this is not required in any way -- but for the most part there isn't an appreciable
difference unless you're paying attention to the weeds and edge cases.</p>
<h3 id="module"><a class="header" href="#module">module</a></h3>
<p>在rust中，module(模块)更多还是一种逻辑上的概念，主要使用mod关键字，下面会具体说说</p>
<div id="admonition-模块主要还是为了控制作用域scope和隐私privacy" class="admonition tip">
<div class="admonition-title">
<p>模块主要还是为了控制作用域(scope)和隐私(privacy)</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/module_system.html#admonition-模块主要还是为了控制作用域scope和隐私privacy"></a></p>
</div>
<div>
</div>
</div>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod say {
    pub fn hello() {
        println!(&quot;Hello, world!&quot;);
    }
}
<span class="boring">}
</span></code></pre></pre>
<h3 id="整理说一下rust的模块系统"><a class="header" href="#整理说一下rust的模块系统">整理说一下rust的模块系统</a></h3>
<figure><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1172.4426px" preserveAspectRatio="none" style="width:900px;height:1172px;background:#000000;" version="1.1" viewBox="0 0 900 1172" width="900.9395px" zoomAndPan="magnify"><defs/><g><rect fill="#333333" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="101.4614" x="9.3946" y="568.5551"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="82.6722" x="18.7891" y="590.158">Rust模块系统</text><rect fill="#2E2E2E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="71.3987" x="157.8288" y="136.3974"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="52.6096" x="167.2234" y="158.0004">两种视角</text><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="58.2463" x="276.2004" y="18.7891"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="39.4572" x="285.595" y="40.3921">程序猿</text><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="71.3987" x="381.4196" y="18.7891"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="52.6096" x="390.8142" y="40.3921">文件结构</text><path d="M334.4468,35.8388 L343.8413,35.8388 C357.9332,35.8388 357.9332,35.8388 372.0251,35.8388 L381.4196,35.8388 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><path d="M229.2276,153.4471 L238.6221,153.4471 C252.714,153.4471 252.714,35.8388 266.8058,35.8388 L276.2004,35.8388 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="143.737" x="276.2004" y="162.8417"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="124.9478" x="285.595" y="184.4446">rustc：module tree</text><rect fill="#0E0E0E" height="64.7198" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="407.7244" x="466.9102" y="71.6776"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="65.762" x="476.3048" y="93.2806">可执行root</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="82.6722" x="476.3048" y="108.5908">src/main.rs</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="388.9353" x="476.3048" y="123.901">-&gt; binary crate(默认与cargo.toml-&gt;[package].name同名)</text><path d="M419.9374,179.8914 L429.3319,179.8914 C443.4238,179.8914 443.4238,104.0375 457.5157,104.0375 L466.9102,104.0375 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#0E0E0E" height="64.7198" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="385.1775" x="466.9102" y="155.1866"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="39.4572" x="476.3048" y="176.7895">库root</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="75.1566" x="476.3048" y="192.0997">src/lib.rs</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="366.3883" x="476.3048" y="207.4099">-&gt; lib crate(默认与cargo.toml-&gt;[package].name同名)</text><path d="M419.9374,179.8914 L429.3319,179.8914 C443.4238,179.8914 443.4238,187.5465 457.5157,187.5465 L466.9102,187.5465 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#0E0E0E" height="49.4096" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="252.714" x="466.9102" y="238.6955"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="32.881" x="476.3048" y="260.2985">crate</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="233.9248" x="476.3048" y="275.6087">&lt;code&gt;编译的最小基本单位&lt;/code&gt;</text><path d="M419.9374,179.8914 L429.3319,179.8914 C443.4238,179.8914 443.4238,263.4003 457.5157,263.4003 L466.9102,263.4003 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><path d="M229.2276,153.4471 L238.6221,153.4471 C252.714,153.4471 252.714,179.8914 266.8058,179.8914 L276.2004,179.8914 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><path d="M110.8559,585.6048 L120.2505,585.6048 C134.3424,585.6048 134.3424,153.4471 148.4342,153.4471 L157.8288,153.4471 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#2E2E2E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="129.6451" x="157.8288" y="412.6713"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="110.8559" x="167.2234" y="434.2742">project的五个层级</text><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="89.2484" x="334.4468" y="306.8942"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="70.4593" x="343.8413" y="328.4972">workspace</text><path d="M287.4739,429.7209 L296.8685,429.7209 C310.9603,429.7209 310.9603,323.9439 325.0522,323.9439 L334.4468,323.9439 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="74.2171" x="334.4468" y="359.7828"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="55.428" x="343.8413" y="381.3857">package</text><path d="M287.4739,429.7209 L296.8685,429.7209 C310.9603,429.7209 310.9603,376.8324 325.0522,376.8324 L334.4468,376.8324 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="59.1858" x="334.4468" y="412.6713"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="40.3967" x="343.8413" y="434.2742">crates</text><path d="M287.4739,429.7209 L296.8685,429.7209 C310.9603,429.7209 310.9603,429.7209 325.0522,429.7209 L334.4468,429.7209 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="75.1566" x="334.4468" y="465.5598"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="56.3674" x="343.8413" y="487.1627">modules</text><path d="M287.4739,429.7209 L296.8685,429.7209 C310.9603,429.7209 310.9603,482.6094 325.0522,482.6094 L334.4468,482.6094 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="55.428" x="334.4468" y="518.4483"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="36.6388" x="343.8413" y="540.0512">paths</text><path d="M287.4739,429.7209 L296.8685,429.7209 C310.9603,429.7209 310.9603,535.4979 325.0522,535.4979 L334.4468,535.4979 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><path d="M110.8559,585.6048 L120.2505,585.6048 C134.3424,585.6048 134.3424,429.7209 148.4342,429.7209 L157.8288,429.7209 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#2E2E2E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="224.5303" x="157.8288" y="571.3368"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="205.7411" x="167.2234" y="592.9397">bin文件夹：可以直接使用src/lib.rs</text><path d="M110.8559,585.6048 L120.2505,585.6048 C134.3424,585.6048 134.3424,588.3864 148.4342,588.3864 L157.8288,588.3864 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#383838" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="153.1315" x="157.8288" y="871.2732"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="134.3424" x="167.2234" y="892.8761">crates.io保存的什么？</text><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="71.3987" x="357.9332" y="829.5187"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="52.6096" x="367.3278" y="851.1216">发布流程</text><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="90.1879" x="476.3048" y="624.2253"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="71.3987" x="485.6994" y="645.8282">cargo login</text><path d="M429.3319,846.5684 L438.7265,846.5684 C452.8184,846.5684 452.8184,641.275 466.9102,641.275 L476.3048,641.275 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#383838" height="233.1322" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="413.3612" x="476.3048" y="677.1138"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="95.8246" x="485.6994" y="698.7167">cargo package</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="150.3132" x="485.6994" y="714.0269">$ cargo help package</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="251.7745" x="485.6994" y="729.3371">从帮助信息结合substrate源码实验&#129514;可知：</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="394.572" x="485.6994" y="744.6474">1. 从当前目录开始执行路径开始，首先去父文件夹找Cargo.toml,</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="272.4426" x="485.6994" y="759.9576">然后找当前目录的Cargo.toml，找不到就报错</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="283.7161" x="485.6994" y="775.2678">2. 找到的Cargo.toml如果有workspace配置，</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="313.7787" x="485.6994" y="790.578">就按照workspace里面的subpackage顺序来依次打包</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="319.4154" x="485.6994" y="805.8882">3. 每次打包的标志为src/main.rs或者src/lib.rs,</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="353.2359" x="485.6994" y="821.1984">且src同级存在Cargo.toml,Cargo.toml里面有[package]</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="227.3486" x="485.6994" y="836.5087">4. 开始打包为上传到crate.io的格式</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="75.1566" x="485.6994" y="851.8189">5. 依次打包</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="345.7203" x="485.6994" y="867.1291">6. 所有依赖必须是在crate.io可以找到的，找不到就报错</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="281.8372" x="485.6994" y="882.4393">7. 以包含Cargo.toml父文件夹为项目根目录，</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="157.8288" x="485.6994" y="897.7495">放在target/package里面</text><path d="M429.3319,846.5684 L438.7265,846.5684 C452.8184,846.5684 452.8184,793.6799 466.9102,793.6799 L476.3048,793.6799 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="106.1587" x="476.3048" y="929.0351"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="87.3695" x="485.6994" y="950.638">cargo publish</text><path d="M429.3319,846.5684 L438.7265,846.5684 C452.8184,846.5684 452.8184,946.0848 466.9102,946.0848 L476.3048,946.0848 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="89.2484" x="476.3048" y="981.9236"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="70.4593" x="485.6994" y="1003.5265">cargo yank</text><path d="M429.3319,846.5684 L438.7265,846.5684 C452.8184,846.5684 452.8184,998.9733 466.9102,998.9733 L476.3048,998.9733 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#0E0E0E" height="34.0994" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="99.5825" x="476.3048" y="1034.8121"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="80.7933" x="485.6994" y="1056.415">cargo owner</text><path d="M429.3319,846.5684 L438.7265,846.5684 C452.8184,846.5684 452.8184,1051.8618 466.9102,1051.8618 L476.3048,1051.8618 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><path d="M310.9603,888.3228 L320.3549,888.3228 C334.4468,888.3228 334.4468,846.5684 348.5386,846.5684 L357.9332,846.5684 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><rect fill="#383838" height="64.7198" rx="11.7432" ry="11.7432" style="stroke:#E7E7E7;stroke-width:1.4091858037578289;" width="505.428" x="357.9332" y="1087.7006"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13.1524" lengthAdjust="spacing" textLength="126.8267" x="367.3278" y="1109.3035">crate.io包含代码总结</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="486.6388" x="367.3278" y="1124.6138">1. 只包含最小crate内容，也就是src/main.rs或者src/lib.rs + Cargo.toml</text><text fill="#FFFFFF" font-family="monospace" font-size="13.1524" lengthAdjust="spacing" textLength="366.3883" x="367.3278" y="1139.924">2. rust只能允许一级嵌套，使用workspace分出subpackage</text><path d="M310.9603,888.3228 L320.3549,888.3228 C334.4468,888.3228 334.4468,1120.0605 348.5386,1120.0605 L357.9332,1120.0605 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/><path d="M110.8559,585.6048 L120.2505,585.6048 C134.3424,585.6048 134.3424,888.3228 148.4342,888.3228 L157.8288,888.3228 " fill="none" style="stroke:#E7E7E7;stroke-width:0.9394572025052192;"/></g></svg></figure>
<h3 id="联想对比"><a class="header" href="#联想对比">联想对比</a></h3>
<ol>
<li>golang的模块系统</li>
<li>python/js的模块系统</li>
<li>mdbook的所有文章只能挂到SUMMARY才能生成链接。</li>
</ol>
<h3 id="module-tree"><a class="header" href="#module-tree">module tree</a></h3>
<ul>
<li>module Tree只有一个入口（根），src/main.rs或src/lib.rs</li>
<li>默认情况下，lib.rs和main.rs的crate都和cargo.toml里面的[package].name同名</li>
<li>但是cargo.toml里面可以给crate重命名：[lib]重命名lib.rs, [binary]重命名main.rs</li>
<li>crate.io上面的名字还有优先级：[lib]-&gt;src/lib.rs &gt; [package]/name.
比如这里：<a href="https://github.com/tkaitchuck/ahash/blob/master/smhasher/ahash-cbindings/Cargo.toml">aHash/Cargo.toml at master · tkaitchuck/aHash</a>
. cargo search ahash-cbindings没有结果，cargo search ahash_c就有返回</li>
</ul>
<h2 id="模块呈现方式"><a class="header" href="#模块呈现方式">模块呈现方式</a></h2>
<figure><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="303px" preserveAspectRatio="none" style="width:378px;height:303px;background:#FFFFFF;" version="1.1" viewBox="0 0 378 303" width="378px" zoomAndPan="magnify"><defs/><g><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="104" x="10" y="132.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="20" y="155.5889">模块使用方式</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="76" x="164" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="174" y="99.292">存在形式</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="76" x="290" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="300" y="42.9951">嵌套模块</text><path d="M240,94.4453 L250,94.4453 C265,94.4453 265,38.1484 280,38.1484 L290,38.1484 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="76" x="290" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="300" y="99.292">文件模块</text><path d="M240,94.4453 L250,94.4453 C265,94.4453 265,94.4453 280,94.4453 L290,94.4453 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="76" x="290" y="132.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="300" y="155.5889">目录模块</text><path d="M240,94.4453 L250,94.4453 C265,94.4453 265,150.7422 280,150.7422 L290,150.7422 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M114,150.7422 L124,150.7422 C139,150.7422 139,94.4453 154,94.4453 L164,94.4453 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="76" x="164" y="132.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="174" y="155.5889">隐私管理</text><path d="M114,150.7422 L124,150.7422 C139,150.7422 139,150.7422 154,150.7422 L164,150.7422 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="76" x="164" y="217.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="174" y="240.0342">导入导出</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="76" x="290" y="188.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="300" y="211.8857">嵌套导入</text><path d="M240,235.1875 L250,235.1875 C265,235.1875 265,207.0391 280,207.0391 L290,207.0391 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="76" x="290" y="245.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="300" y="268.1826">再次导入</text><path d="M240,235.1875 L250,235.1875 C265,235.1875 265,263.3359 280,263.3359 L290,263.3359 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M114,150.7422 L124,150.7422 C139,150.7422 139,235.1875 154,235.1875 L164,235.1875 " fill="none" style="stroke:#181818;stroke-width:1.0;"/></g></svg></figure>
<h3 id="嵌套模块"><a class="header" href="#嵌套模块">嵌套模块</a></h3>
<h3 id="文件模块"><a class="header" href="#文件模块">文件模块</a></h3>
<h3 id="目录模块"><a class="header" href="#目录模块">目录模块</a></h3>
<h2 id="隐私与导入导出"><a class="header" href="#隐私与导入导出">隐私与导入导出</a></h2>
<h3 id="隐私管理"><a class="header" href="#隐私管理">隐私管理</a></h3>
<h3 id="嵌套导入"><a class="header" href="#嵌套导入">嵌套导入</a></h3>
<h3 id="再次导出"><a class="header" href="#再次导出">再次导出</a></h3>
<div id="admonition-pubcrate-fn-fn_name-" class="admonition info">
<div class="admonition-title">
<p>pub(crate) fn fn_name() {}</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/module_system.html#admonition-pubcrate-fn-fn_name-"></a></p>
</div>
<div>
<p>Rust 中元素的隐私性是从模块层面开始的。作为程序库的作者,要从模块向用户公开一些内容可以使用关键字 pub。</p>
<blockquote>
<p>但是对于有一些元素,我们只想暴露给软件包中的其他模块,而不是用户。</p>
</blockquote>
<p>在这种情况下,我们可以对元素使用 pub(crate)修饰符,这允许元素仅在软件包内部暴露</p>
</div>
</div>
<h2 id="参考资源-21"><a class="header" href="#参考资源-21">参考资源</a></h2>
<div id="admonition-不要把其他人的话直接照抄" class="admonition note">
<div class="admonition-title">
<p>不要把其他人的话直接照抄！</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/module_system.html#admonition-不要把其他人的话直接照抄"></a></p>
</div>
<div>
<p>保持批判，有所取舍，知行合一, 方见真我</p>
</div>
</div>
<h3 id="online-book-23"><a class="header" href="#online-book-23">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/stable/reference/visibility-and-privacy.html">Visibility and privacy - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/stable/reference/visibility-and-privacy.html#pubin-path-pubcrate-pubsuper-and-pubself">pub(in path), pub(crate), pub(super), and pub(self) - The Rust Reference</a></li>
<li><a href="https://doc.rust-lang.org/book/ch07-00-managing-growing-projects-with-packages-crates-and-modules.html">Managing Growing Projects with Packages, Crates, and Modules - The Rust Programming Language</a></li>
<li><a href="https://doc.rust-lang.org/stable/rust-by-example/mod.html">Modules - Rust By Example</a></li>
<li><a href="https://doc.rust-lang.org/stable/rust-by-example/crates.html">Crates - Rust By Example</a></li>
</ul>
<h3 id="fragment-23"><a class="header" href="#fragment-23">fragment</a></h3>
<ul>
<li>
<p><a href="https://web.archive.org/web/20220620093333/https://mp.weixin.qq.com/s/mQ0zh_tcLEZZNpGIbz6BVA">了解下Rust 模块使用方式</a></p>
</li>
<li>
<p><a href="https://www.reddit.com/r/rust/comments/lvtzri/confused_about_package_vs_crate_terminology/">Confused about Package vs. Crate terminology. : rust</a></p>
</li>
<li>
<p><a href="https://course.rs/basic/crate-module/intro.html">包和模块 - Rust语言圣经(Rust Course)</a></p>
<ul>
<li>项目(Packages)：一个 Cargo 提供的 feature，可以用来构建、测试和分享包</li>
<li>包(Crate)：一个由多个模块组成的树形结构，可以作为三方库进行分发，也可以生成可执行文件进行运行</li>
<li>模块(Module)：可以一个文件多个模块，也可以一个文件一个模块，模块可以被认为是真实项目中的代码组织单元</li>
</ul>
</li>
<li>
<p><a href="https://doc.rust-lang.org/cargo/reference/workspaces.html">Workspaces - The Cargo Book</a>
默认情况下，一个Cargo.toml只能指明一个package，但是在workspace里面就可以指明多个(此时可以理解为这个package包含多个subpackage)，比如substrate的根cargo：</p>
</li>
<li>
<p><a href="https://github.com/paritytech/substrate/blob/master/Cargo.toml">substrate/Cargo.toml at master · paritytech/substrate</a></p>
</li>
</ul>
<pre><code class="language-toml">[workspace]
resolver = &quot;2&quot;

members = [
    &quot;bin/node-template/node&quot;,
]
[profile.dev.package]
blake2 = { opt-level = 3 }
</code></pre>
<ul>
<li><a href="https://doc.rust-lang.org/cargo/reference/cargo-targets.html?highlight=bin#library">Cargo Targets - The Cargo Book</a></li>
</ul>
<div id="admonition-crate" class="admonition tip">
<div class="admonition-title">
<p>crate</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/module_system.html#admonition-crate"></a></p>
</div>
<div>
<p>A crate is the [lib] or [[bin]] tables in the Cargo.toml. 
At most one lib crate may be present, but an arbitrary number of bin crates may be present. </p>
<p>You won't see these tables added explicitly too often, 
because they're implicitly present if you have src/lib.rs (lib crate) and/or src/main.rs (bin crate).</p>
</div>
</div>
<pre><code class="language-toml"># Example of customizing the library in Cargo.toml.
[lib]
crate-type = [&quot;cdylib&quot;]
bench = false
</code></pre>
<pre><code class="language-toml"># Example of customizing binaries in Cargo.toml.
[[bin]]
name = &quot;cool-tool&quot;
test = false
bench = false

[[bin]]
name = &quot;frobnicator&quot;
required-features = [&quot;frobnicate&quot;]

</code></pre>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch07-01-packages-and-crates.html">Packages and Crates - The Rust Programming Language</a></li>
</ul>
<div id="admonition-the-rust-programming-language相关整理" class="admonition quote">
<div class="admonition-title">
<p>《The Rust Programming Language》相关整理</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/module_system.html#admonition-the-rust-programming-language相关整理"></a></p>
</div>
<div>
<ol>
<li>一个包是一个或多个提供一组功能的 crates。一个package包含一个 Cargo.toml 文件，该文件描述了如何构建这些crate。</li>
<li>crate 可以是二进制 crate 或库 crate。</li>
</ol>
<ul>
<li>二进制 crate 是可以编译成可执行文件的程序，可以运行，例如命令行程序或服务器。</li>
</ul>
<blockquote>
<p>它们必须有一个名为 main 的函数，该函数定义了可执行文件运行时会发生什么。到目前为止，我们创建的所有 crate 都是二进制 crate。</p>
</blockquote>
<ol start="3">
<li>库 crates 没有 main 函数，它们不会编译为可执行文件。它们定义了旨在与多个项目共享的功能。</li>
</ol>
<blockquote>
<p>例如，我们在第 2 章中使用的 rand crate 提供了生成随机数的功能。</p>
</blockquote>
<ol start="4">
<li>下面是一些规则：</li>
</ol>
<ul>
<li>一个包最多可以包含一个库 crate。它可以包含任意数量的二进制 crate，但它必须至少包含一个 crate（库或二进制）。</li>
<li>当我们输入<strong>cargo new</strong>时，Cargo 创建了一个 Cargo.toml 文件，cargo将会给我们一个package。</li>
<li>查看 Cargo.toml 的内容，没有提到 src/main.rs，因为 Cargo 遵循一个约定，即 src/main.rs 是与包同名的二进制 crate 的 crate 根。</li>
<li>同样，Cargo 知道如果包目录包含 src/lib.rs，则该包包含一个与包同名的库 crate，并且 src/lib.rs 是它的 crate 根。 </li>
</ul>
<blockquote>
<p>Cargo 将 crate 根文件传递给 rustc 以构建库或二进制文件。</p>
</blockquote>
<ul>
<li>在这里，我们有一个只包含 src/main.rs 的包，这意味着它只包含一个名为 my-project 的二进制 crate。</li>
<li>如果一个包包含 src/main.rs 和 src/lib.rs，它有两个 crate：一个二进制文件和一个库，两者都与包同名。</li>
</ul>
<blockquote>
<p>通过将文件放在 src/bin 目录中，一个包可以有多个二进制 crate：每个文件都是一个单独的二进制crate</p>
</blockquote>
</div>
</div>
<ul>
<li>
<p><a href="https://web.archive.org/web/20220704161217/https://zhuanlan.zhihu.com/p/106251259">Rust的模块化系统: 包Packages, 箱Crates, 和模块Modules - 知乎</a>
包 Packages: Cargo提供的让我们创建, 测试和分享Crates的工具. 箱 Crates: 提供类库或可执行文件的模块树 模块 Modules and use: 管理和组织路径, 及其作用域和访问权限 路径 Paths:
如结构体(structs), 函数(function), 或模块(module)等事物的命名方式</p>
</li>
<li>
<p><a href="https://web.archive.org/web/20220704161255/https://zhuanlan.zhihu.com/p/365735504">三言两语理解Rust module System - 知乎</a></p>
</li>
</ul>
<p>Module System</p>
<p>一个问题几乎总会由许多小问题组成。module system是为了定义清楚各个小问题的边界。这样更容易和更方便的管理问题。而大问题的解法，就是把小问题的解法组合起来。</p>
<p>project，package， crate， module这些概念感觉相似。实际上，一个package/project可以包含多个 binary crates和一个或者零个library
binary。一个crate可以包含多个module。可以认为package就是一个project，一个crate就是一个暴露给外界的逻辑单元，一个module就是一个小问题的解法。</p>
<p>当project里面有lib.rs说明这个project是一个library crate，这个library的名字是project的名字。main.rs/main2.rs都可以直接使用这个library
crate。我们可以认为bin文件夹里面是单独的crate，它们默认导入了这个library crate。</p>
<p>一个crate就是一个暴露给外界的逻辑单元，一个module就是一个小问题的解法</p>
<p>关于找不到模块： 这就是module tree的体现，<strong>be explicit</strong>。所有模块都需要添加到crate root(src/main.rs或者src/lib.rs)里面。也就是要显示地指明module
tree的结构。这也就是我们经常在main.rs/lib.rs里面看到许多mod xxx的原因。比如<a href="https://github.com/Celthi/rsnova/blob/master/src/lib.rs#L20">这里的代码</a></p>
<p>它们的存在就是为了将project里面的modules 加到这个crate里面。比如在main.rs 里面看到mod channel，就是将module channel加进crate的module tree来。</p>
<p>相关引用：
<a href="https://web.archive.org/web/20220419042941/https://manishearth.github.io/blog/2017/05/14/mentally-modelling-modules/">Mentally Modelling Modules - In Pursuit of Laziness</a></p>
<ul>
<li>
<p><a href="https://web.archive.org/web/20220614192155/https://www.sheshbabu.com/posts/rust-module-system/">Clear explanation of Rust’s module system</a>
作者通过举例，详细介绍了rust编译器与程序猿看到的不同项目结构。</p>
</li>
<li>
<p><a href="https://web.archive.org/web/20220704161820/https://zhuanlan.zhihu.com/p/360342782">Rust那些难理解的点(大量更新于6月16日） - 知乎</a></p>
</li>
<li>
<p><a href="https://web.archive.org/web/20220704162217/https://news.ycombinator.com/item?id=23894172">The confusion around Rust's modules reminds me of the different ways that people... | Hacker News</a>
The confusion around Rust's modules reminds me of the different ways that people learn how to use car indicators. Some
people learn that you push the stalk up to indicate your intent to turn left, or down to turn right. And then they
might eventually learn that in a European car, you push the stalk down to turn left, and up to turn right. And then of
course some of these people get confused when switching between different cars. Yes, I've seen plenty of people on the
road who indicate one direction and then turn another. It's... kind of frightening .</p>
</li>
</ul>
<p>The other way of learning to use car indicators is much simpler: push the stalk in the direction that you would turn the
wheel. Of course this still leaves the possibility that some people will push the wrong stalk, and briefly activate
their windshield wipers . But it's a much easier mistake to <em>notice</em>, and the consequences are minor.</p>
<p>Back to Rust's modules. I keep seeing articles trying to offer a simple or clear explanation of how they work, that end
up unnecessarily complicated in a way that feels a lot like the &quot;up/down&quot; model of car indicators. The explanation that
makes the basics of Rust modules clear to me is this:</p>
<ul>
<li>
<p>Child modules must always be <em>declared</em> in the parent module, or they don't exist.</p>
</li>
<li>
<p>The content of child modules may be <em>defined</em> either inline in the parent as <code>mod child { ... }</code>, or in a file with a
relative path of './child.rs' or './child/mod.rs'.</p>
</li>
</ul>
<p>Did I miss anything important?</p>
<p>Without this basic explanation up-front, I have no idea what to do with the stream of information I'm reading in a
lengthy article on the topic -- I've been given no scaffolding onto which to bolt all the details and examples. So this
is the &quot;bottom line&quot; that I would like to see &quot;up front&quot; in descriptions of Rust's modules.</p>
<p>Other misunderstandings, e.g., around item visibility, are explained really well by the compiler if you get them mixed
up, so I'm not sure how much value there is in mixing them in to articles about how modules are <em>structured</em> before
those two basic facts are presented.</p>
<ul>
<li><a href="https://web.archive.org/web/20220705022801/https://stackoverflow.com/questions/63515853/how-to-better-understand-crate-in-rust">How to better understand Crate in Rust? - Stack Overflow</a></li>
</ul>
<blockquote>
<p>The processing of that source file may result in other source files being loaded as modules.
It is not that one source file makes up a crate: it's that starting from that one source file, you can find all the
files making up the crate, as opposed to other compilation models where the compiler might be given many file names to
start from.</p>
</blockquote>
<p>其实从代码完整性考虑，crate确实就是编译的最小基本单位。因为它不仅指一个源码文件(xx.rs)，而是包含这个源码文件里面引入的所有其他module。这个时候，rustc才会开始编译这个crate</p>
<ul>
<li><a href="https://web.archive.org/web/20220609151503/https://stackoverflow.com/questions/52024304/what-exactly-is-a-crate-in-the-cargo-ecosystem-and-what-is-the-mapping-to-what?rq=1">rust - What exactly is a 'crate' in the Cargo ecosystem and what is the mapping to what is on crates.io? - Stack Overflow</a></li>
</ul>
<blockquote>
<p>The exact things hosted on crates.io are crates inside packages. A crate is the output artifact of the compiler.
The compilation model centers on artifacts called crates. Each compilation processes a single crate in source form,
and if successful, produces a single crate in binary form: either an executable or some sort of library.
A package is an artifact managed by Cargo, the Rust package manager.</p>
</blockquote>
<h3 id="local-23"><a class="header" href="#local-23">local</a></h3>
<ul>
<li><a href="marginnote3app://note/CF61A2D3-C05C-49B2-943A-777D4A4A6434">&lt;精通Rust(第二版)&gt;-2.2模块</a></li>
<li><a href="marginnote3app://note/72AB7939-56B0-4797-8307-09E7F9905417">&lt;精通Rust(第二版)&gt;-7.9 模块、路径和导入</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cargo与crate生命周期"><a class="header" href="#cargo与crate生命周期">Cargo与crate生命周期</a></h1>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/cargo_ship.jpeg" alt="cargo_ship" /></p>
<!--ts-->
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo%E4%B8%8Ecrate%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">Cargo与crate生命周期</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo--%E7%94%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%90%86%E8%A7%A3cargo%E6%8C%87%E4%BB%A4%E7%B3%BB%E5%88%97">cargo : 用生命周期理解Cargo指令系列</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#%E6%96%B0%E5%BB%BA">新建</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-new">cargo new</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-init">cargo init</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#%E5%BC%80%E5%8F%91">开发</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-clean">cargo clean</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-doc">cargo doc</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86">依赖管理</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-check">cargo check</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-fix">cargo fix</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-fetch">cargo fetch</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-searchinstalluninstall">cargo search/install/uninstall</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-report">cargo report</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-generate-lockfile">cargo generate-lockfile</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-locate-project">cargo locate-project</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-metadata">cargo metadata</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-pkgid">cargo pkgid</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-tree">cargo tree</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-update">cargo update</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-vendor">cargo vendor</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-verify-project">cargo verify-project</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#%E6%B5%8B%E8%AF%95">测试</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-test">cargo test</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-bench">cargo bench</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#%E8%BF%90%E8%A1%8C">运行</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-run">cargo run</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#%E6%9E%84%E5%BB%BA">构建</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-rustc">cargo rustc</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-build">cargo build</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-rustdoc">cargo rustdoc</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#%E5%8F%91%E5%B8%83">发布</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-login">cargo login</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-owner">cargo owner</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-package">cargo package</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-publish">cargo publish</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargo-yank">cargo yank</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#%E7%BB%B4%E6%8A%A4">维护</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#%E5%88%86%E5%8C%BA">分区</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#cargotoml%E7%BB%86%E8%AF%B4">Cargo.toml细说</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#rust%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93">Rust程序运行方式总结</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#%E8%84%9A%E6%9C%AC">脚本</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#%E9%A1%B9%E7%9B%AE">项目</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#online-book">online-book</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#fragment">fragment</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_crate_lifetime.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:12 UTC 2022 -->
<!--te-->
<h2 id="cargo--用生命周期理解cargo指令系列"><a class="header" href="#cargo--用生命周期理解cargo指令系列">cargo <cmd>: 用生命周期理解Cargo指令系列</a></h2>
<h3 id="新建"><a class="header" href="#新建">新建</a></h3>
<h4 id="cargo-new"><a class="header" href="#cargo-new">cargo new</a></h4>
<h4 id="cargo-init"><a class="header" href="#cargo-init">cargo init</a></h4>
<h3 id="开发"><a class="header" href="#开发">开发</a></h3>
<h4 id="cargo-clean"><a class="header" href="#cargo-clean">cargo clean</a></h4>
<h4 id="cargo-doc"><a class="header" href="#cargo-doc">cargo doc</a></h4>
<h3 id="依赖管理"><a class="header" href="#依赖管理">依赖管理</a></h3>
<h4 id="cargo-check"><a class="header" href="#cargo-check">cargo check</a></h4>
<p>该命令用来快速检查当前代码是否可以通过编译，但是不去生成真正可执行的程序。这样可以加快我们的检查速度。</p>
<h4 id="cargo-fix"><a class="header" href="#cargo-fix">cargo fix</a></h4>
<h4 id="cargo-fetch"><a class="header" href="#cargo-fetch">cargo fetch</a></h4>
<h4 id="cargo-searchinstalluninstall"><a class="header" href="#cargo-searchinstalluninstall">cargo search/install/uninstall</a></h4>
<h4 id="cargo-report"><a class="header" href="#cargo-report">cargo report</a></h4>
<h4 id="cargo-generate-lockfile"><a class="header" href="#cargo-generate-lockfile">cargo generate-lockfile</a></h4>
<h4 id="cargo-locate-project"><a class="header" href="#cargo-locate-project">cargo locate-project</a></h4>
<h4 id="cargo-metadata"><a class="header" href="#cargo-metadata">cargo metadata</a></h4>
<h4 id="cargo-pkgid"><a class="header" href="#cargo-pkgid">cargo pkgid</a></h4>
<h4 id="cargo-tree"><a class="header" href="#cargo-tree">cargo tree</a></h4>
<h4 id="cargo-update"><a class="header" href="#cargo-update">cargo update</a></h4>
<h4 id="cargo-vendor"><a class="header" href="#cargo-vendor">cargo vendor</a></h4>
<h4 id="cargo-verify-project"><a class="header" href="#cargo-verify-project">cargo verify-project</a></h4>
<h3 id="测试"><a class="header" href="#测试">测试</a></h3>
<h4 id="cargo-test"><a class="header" href="#cargo-test">cargo test</a></h4>
<h4 id="cargo-bench"><a class="header" href="#cargo-bench">cargo bench</a></h4>
<h3 id="运行"><a class="header" href="#运行">运行</a></h3>
<h4 id="cargo-run"><a class="header" href="#cargo-run">cargo run</a></h4>
<h3 id="构建"><a class="header" href="#构建">构建</a></h3>
<h4 id="cargo-rustc"><a class="header" href="#cargo-rustc">cargo rustc</a></h4>
<h4 id="cargo-build"><a class="header" href="#cargo-build">cargo build</a></h4>
<pre><code class="language-shell">cargo build --release
</code></pre>
<blockquote>
<p>该命令将会在 target/release/目录下生成优化过的可执行程序。这样生成的可执行程序拥有更好的性能。</p>
</blockquote>
<h4 id="cargo-rustdoc"><a class="header" href="#cargo-rustdoc">cargo rustdoc</a></h4>
<h3 id="发布"><a class="header" href="#发布">发布</a></h3>
<h4 id="cargo-login"><a class="header" href="#cargo-login">cargo login</a></h4>
<h4 id="cargo-owner"><a class="header" href="#cargo-owner">cargo owner</a></h4>
<h4 id="cargo-package"><a class="header" href="#cargo-package">cargo package</a></h4>
<h4 id="cargo-publish"><a class="header" href="#cargo-publish">cargo publish</a></h4>
<h4 id="cargo-yank"><a class="header" href="#cargo-yank">cargo yank</a></h4>
<h3 id="维护"><a class="header" href="#维护">维护</a></h3>
<h3 id="分区"><a class="header" href="#分区">分区</a></h3>
<h2 id="cargotoml细说"><a class="header" href="#cargotoml细说">Cargo.toml细说</a></h2>
<h2 id="rust程序运行方式总结"><a class="header" href="#rust程序运行方式总结">Rust程序运行方式总结</a></h2>
<h3 id="脚本"><a class="header" href="#脚本">脚本</a></h3>
<h3 id="项目"><a class="header" href="#项目">项目</a></h3>
<h2 id="参考资源-22"><a class="header" href="#参考资源-22">参考资源</a></h2>
<h3 id="online-book-24"><a class="header" href="#online-book-24">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/cargo/commands/index.html">Cargo Commands - The Cargo Book</a></li>
<li><a href="https://doc.rust-lang.org/stable/rust-by-example/cargo.html">Cargo - Rust By Example</a></li>
</ul>
<h3 id="fragment-24"><a class="header" href="#fragment-24">fragment</a></h3>
<h3 id="local-24"><a class="header" href="#local-24">local</a></h3>
<ul>
<li><a href="marginnote3app://note/607C0511-4592-4F59-A8C0-AD8017A503FE">&lt;精通Rust(第二版)&gt;-2.3 Cargo和程序库</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cargo与rustc"><a class="header" href="#cargo与rustc">cargo与rustc</a></h1>
<!--ts-->
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#cargo%E4%B8%8Erustc">cargo与rustc</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#rustc">rustc</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#rustc%E6%98%AF%E4%BB%80%E4%B9%88">rustc是什么</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8">基础使用</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#rustc%E4%B8%8Ecargo%E7%9A%84%E5%85%B3%E7%B3%BB">rustc与cargo的关系</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#cargo-style">cargo style</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#cargo-essential-structure">cargo essential structure</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#cargo-%E6%89%A9%E5%B1%95">.cargo 扩展</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#tree-overview">tree overview</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#bin">bin</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#env">env</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#git">git</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#registry">registry</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#cargo-%E4%B8%8E-git-%E7%9A%84%E5%85%B3%E8%81%94">Cargo 与 git 的关联！</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#cargo-tree">cargo tree</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#git-1">git</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#%E5%85%B3%E4%BA%8E%E4%BE%9D%E8%B5%96%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98">关于依赖冲突问题</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#cargo%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3">Cargo相关问题解决</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#%E7%89%88%E6%9C%AC%E5%86%B2%E7%AA%81failed-to-select-a-version-for-the-requirement">版本冲突：failed to select a version for the requirement</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#cargo%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84">Cargo项目结构</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#%E5%9F%BA%E7%A1%80%E8%AF%B4%E6%98%8E">基础说明</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#cargotoml%E5%92%8Ccargolock">cargo.toml和cargo.lock</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#%E6%9E%84%E5%BB%BA%E6%B8%85%E7%90%86%E6%9B%B4%E6%96%B0%E4%BB%A5%E5%8F%8A%E5%AE%89%E8%A3%85">构建、清理、更新以及安装</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#mainrs-%E5%92%8C-librs">main.rs 和 lib.rs</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8substrate%E7%9A%84substrate-node-template">实际应用：Substrate的substrate-node-template</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#%E5%8C%BA%E5%88%ABcargo-run%E4%B8%8Ecargo-build">区别cargo run与cargo build</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#%E5%9C%A8node%E5%8C%85%E9%87%8C%E9%9D%A2%E5%AD%98%E5%9C%A8mainrs">在node包里面存在main.rs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#online-book">online-book</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#fragment">fragment</a></li>
<li><a href="layer2_design_abstract/6_module_manage/cargo_rustc.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:13 UTC 2022 -->
<!--te-->
<h2 id="rustc"><a class="header" href="#rustc">rustc</a></h2>
<h3 id="rustc是什么"><a class="header" href="#rustc是什么">rustc是什么</a></h3>
<p>全称应该是&quot;rust complier&quot;, 是 Rust 编程语言的编译器，由项目本身提供。编译器获取源代码并生成二进制代码，作为库或可执行文件。</p>
<h3 id="基础使用"><a class="header" href="#基础使用">基础使用</a></h3>
<pre><code class="language-shell">rustc target_file.rs
</code></pre>
<h3 id="rustc与cargo的关系"><a class="header" href="#rustc与cargo的关系">rustc与cargo的关系</a></h3>
<p>这其实就类似前端webpack.config和package.json的关系, cargo在运行时会默认调用rustc指令。</p>
<div id="admonition-查看cargo如何调用rustc" class="admonition tip">
<div class="admonition-title">
<p>查看cargo如何调用rustc</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-查看cargo如何调用rustc"></a></p>
</div>
<div>
<pre><code class="language-shell">$ cargo build --verbose
</code></pre>
<blockquote>
<p>verbose：就是详细信息的意思，运行后将会打印出每次调用rustc的过程。</p>
</blockquote>
</div>
</div>
<h2 id="cargo-style"><a class="header" href="#cargo-style">cargo style</a></h2>
<p>cargo可以看作是基于rustc的&quot;管理框架&quot;，主要还是对于项目用到的包的管理。</p>
<div id="admonition-查看cargo" class="admonition tip">
<div class="admonition-title">
<p>查看cargo</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-查看cargo"></a></p>
</div>
<div>
<p><a href="layer2_design_abstract/6_module_manage//layer2_design_abstract/6_module_manage/cargo_crate_lifetime">这里</a>可以看到具体有哪些功能</p>
</div>
</div>
<h2 id="cargo-essential-structure"><a class="header" href="#cargo-essential-structure">cargo essential structure</a></h2>
<p>但是对于大多数场景下，一般采用如下的项目结构</p>
<div id="admonition-rust-package-structure" class="admonition tip">
<div class="admonition-title">
<p>rust package structure</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-rust-package-structure"></a></p>
</div>
<div>
<pre><code class="language-shell">$ tree use-benchmarking -L 2                                                                                                                                                                                                             ─╯
use-benchmarking
├── Cargo.toml
├── README.md
└── src
    ├── benchmarking.rs
    ├── lib.rs
    ├── mock.rs
    ├── tests.rs
    └── weights.rs

1 directory, 7 files
</code></pre>
</div>
</div>
<h2 id="cargo-扩展"><a class="header" href="#cargo-扩展">.cargo 扩展</a></h2>
<p>除了cargo, 它的全局相关配置文件都会放在$HOME/.cargo目录下，这里值得看看</p>
<h3 id="tree-overview"><a class="header" href="#tree-overview">tree overview</a></h3>
<pre><code class="language-shell">tree -L 1 $HOME/.cargo                                                                                                                                                                                                                 ─╯
├── bin # 安装的二进制相关可执行文件
├── env # rustup的环境变量设置脚本
├── git
└── registry
</code></pre>
<h3 id="bin"><a class="header" href="#bin">bin</a></h3>
<pre><code class="language-shell">tree -L 1 $HOME/.cargo/bin                                                                                                                                                                                                             ─╯
├── cargo -&gt; /usr/local/bin/rustup-init
├── cargo-clippy -&gt; /usr/local/bin/rustup-init
├── cargo-fmt -&gt; /usr/local/bin/rustup-init
├── cargo-miri -&gt; /usr/local/bin/rustup-init
├── clippy-driver -&gt; /usr/local/bin/rustup-init
├── mdbook
├── mdbook-admonish
├── mdbook-checklist
├── mdbook-mermaid
├── mdbook-pdf
├── mdbook-rss
├── mdbook-template
├── rls -&gt; /usr/local/bin/rustup-init
├── rust-gdb -&gt; /usr/local/bin/rustup-init
├── rust-lldb -&gt; /usr/local/bin/rustup-init
├── rustc -&gt; /usr/local/bin/rustup-init
├── rustdoc -&gt; /usr/local/bin/rustup-init
├── rustfmt -&gt; /usr/local/bin/rustup-init
└── rustup -&gt; /usr/local/bin/rustup-init

0 directories, 19 files
</code></pre>
<h3 id="env"><a class="header" href="#env">env</a></h3>
<pre><code class="language-shell">#!/bin/sh
# rustup shell setup
# affix colons on either side of $PATH to simplify matching
case &quot;:${PATH}:&quot; in
    *:&quot;$HOME/.cargo/bin&quot;:*)
        ;;
    *)
        # Prepending path in case a system-installed rustc needs to be overridden
        export PATH=&quot;$HOME/.cargo/bin:$PATH&quot;
        ;;
esac
</code></pre>
<h3 id="git"><a class="header" href="#git">git</a></h3>
<pre><code class="language-shell">tree -L 3 $HOME/.cargo/git                                                                                                                                                                                                             ─╯
/Users/kuanhsiaokuo/.cargo/git
├── checkouts
│   ├── substrate-7e08433d4c370a21
│   │   ├── 174735e
│   │   ├── 257cdb5
│   │   ├── 279593d
│   │   ├── 3348e14
│   │   ├── 346471d
│   │   ├── 4d28ebe
│   │   ├── 7ba4e4c
│   │   ├── 7eb671f
│   │   ├── 814752f
│   │   ├── 852bab0
│   │   ├── b6c1c1b
│   │   └── bf9683e
│   └── unveil-rs-403565214a7cc66c
│       └── 3d8e9ad
└── db
    ├── substrate-7e08433d4c370a21
    │   ├── FETCH_HEAD
    │   ├── HEAD
    │   ├── config
    │   ├── description
    │   ├── hooks
    │   ├── info
    │   ├── objects
    │   └── refs
    └── unveil-rs-403565214a7cc66c
        ├── FETCH_HEAD
        ├── HEAD
        ├── config
        ├── description
        ├── hooks
        ├── info
        ├── objects
        └── refs

27 directories, 8 files
</code></pre>
<h3 id="registry"><a class="header" href="#registry">registry</a></h3>
<pre><code class="language-shell">tree -L 2 $HOME/.cargo/registry                                                                                                                                                                                                        ─╯
/Users/kuanhsiaokuo/.cargo/registry
├── cache
│   └── github.com-1ecc6299db9ec823
├── index
│   └── github.com-1ecc6299db9ec823
└── src
    └── github.com-1ecc6299db9ec823

6 directories, 0 files
</code></pre>
<h2 id="cargo-与-git-的关联"><a class="header" href="#cargo-与-git-的关联">Cargo 与 git 的关联！</a></h2>
<h3 id="cargo-tree-1"><a class="header" href="#cargo-tree-1">cargo tree</a></h3>
<ol>
<li>Cargo.toml是分等级的，最外层的Cargo.toml里面可以只用一个members，然后里面列出内部包含的其他packages</li>
</ol>
<div id="admonition-substrate-node-template为例" class="admonition info">
<div class="admonition-title">
<p>substrate-node-template为例</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-substrate-node-template为例"></a></p>
</div>
<div>
<blockquote>
<p>最外层的Cargo.toml</p>
</blockquote>
<pre><code class="language-toml">[workspace]
members = [
    &quot;node&quot;,
    &quot;pallets/template&quot;,
    &quot;runtime&quot;,
]
[profile.release]
panic = &quot;unwind&quot;
</code></pre>
</div>
</div>
<ol start="2">
<li>然后内部的其他packages就需要列出用到的[dependencies]</li>
<li>dependencies的完整使用参数如下：</li>
</ol>
<div id="admonition-dependencies写法一" class="admonition info">
<div class="admonition-title">
<p>dependencies写法一</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-dependencies写法一"></a></p>
</div>
<div>
<pre><code class="language-toml">[dependencies]
pallet-aura = { version = &quot;4.0.0-dev&quot;, default-features = false, git = &quot;https://github.com/paritytech/substrate.git&quot;, branch = &quot;polkadot-v0.9.24&quot; }
</code></pre>
</div>
</div>
<div id="admonition-dependencies写法二" class="admonition info">
<div class="admonition-title">
<p>dependencies写法二</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-dependencies写法二"></a></p>
</div>
<div>
<pre><code class="language-toml">[dependencies.pallet-aura]
version = &quot;4.0.0-dev&quot;
default-features = false
git = &quot;https://github.com/paritytech/substrate.git&quot;
branch = &quot;polkadot-v0.9.24&quot;
</code></pre>
<blockquote>
<p>这里的branch也可以用tag(git tag)</p>
</blockquote>
</div>
</div>
<h3 id="git-1"><a class="header" href="#git-1">git</a></h3>
<blockquote>
<p>上面dependencie里面的git+branch/tag唯一确定了一份代码，cargo下载对应的git代码之后，会从最外层Cargo.toml顺着members一层层找到[package]如下所示的Cargo.toml来确定对应的依赖包</p>
</blockquote>
<div id="admonition-substrateframeauracargotoml" class="admonition tip">
<div class="admonition-title">
<p>substrate/frame/aura/Cargo.toml</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-substrateframeauracargotoml"></a></p>
</div>
<div>
<pre><code class="language-toml">[package]
name = &quot;pallet-aura&quot;
version = &quot;4.0.0-dev&quot;
authors = [&quot;Parity Technologies &lt;admin@parity.io&gt;&quot;]
edition = &quot;2021&quot;
license = &quot;Apache-2.0&quot;
homepage = &quot;https://substrate.io&quot;
repository = &quot;https://github.com/paritytech/substrate/&quot;
description = &quot;FRAME AURA consensus pallet&quot;
readme = &quot;README.md&quot;
</code></pre>
</div>
</div>
<h3 id="关于依赖冲突问题"><a class="header" href="#关于依赖冲突问题">关于依赖冲突问题</a></h3>
<p>目前Cargo无法解决依赖冲突问题，一般都会是因为dependencies里面的git+branch/tag对应的依赖更新导致。</p>
<div id="admonition-顺藤摸瓜一一排查" class="admonition tip">
<div class="admonition-title">
<p>顺藤摸瓜，一一排查</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-顺藤摸瓜一一排查"></a></p>
</div>
<div>
<p>这时需要根据冲突的包，切换分支/tag, 找到对应的branch/tag来更新</p>
</div>
</div>
<blockquote>
<p>应用场景: <a href="layer2_design_abstract/6_module_manage//layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96-cargotomldependincies">substrate添加pallet</a></p>
</blockquote>
<h2 id="cargo相关问题解决"><a class="header" href="#cargo相关问题解决">Cargo相关问题解决</a></h2>
<h3 id="版本冲突failed-to-select-a-version-for-the-requirement"><a class="header" href="#版本冲突failed-to-select-a-version-for-the-requirement">版本冲突：failed to select a version for the requirement</a></h3>
<ul>
<li>删除registry
<a href="https://web.archive.org/web/20220702104818/https://blog.illixion.com/2021/10/fix-failed-to-select-a-version-cargo/">How to fix &quot;failed to select a version for the requirement&quot; in Rust's Cargo - Manual</a></li>
</ul>
<pre><code class="language-admonist info title='解决方案'">Apparently, Cargo can sometimes get into a state where its local registry cache will corrupt itself, and Cargo won’t be able to discover new versions of the dependencies. To resolve this, delete the ~/.cargo/registry folder and run the build command again.
</code></pre>
<ul>
<li>修改dependencies
<a href="https://web.archive.org/web/20220702110637/https://qiita.com/bc_yuuuuuki/items/6f566ddef60a201af1bc">cargo install 出现需求版本选择失败怎么办--Qiita</a></li>
</ul>
<h2 id="cargo项目结构"><a class="header" href="#cargo项目结构">Cargo项目结构</a></h2>
<h3 id="基础说明"><a class="header" href="#基础说明">基础说明</a></h3>
<p><img src="https://web.archive.org/web/20220621034241im_/https://pp88.org/rust.zui.jia.shi.jian.rust.zui.jia.shi.jian/cargo.xiang.mu.pei.zhi.ji.jie.gou/project-structure.png" alt="hello_world_project_sturcture" /></p>
<ul>
<li>cargo.toml和cargo.lock文件总是位于项目根目录下。</li>
<li>源代码位于src目录下。</li>
<li>默认的库入口文件是src/lib.rs。</li>
<li>默认的可执行程序入口文件是src/main.rs。</li>
<li>其他可选的可执行文件位于src/bin/*.rs(这里每一个rs文件均对应一个可执行文件)。</li>
<li>外部测试源代码文件位于tests目录下。</li>
<li>示例程序源代码文件位于examples。</li>
<li>基准测试源代码文件位于benches目录下。</li>
</ul>
<h3 id="cargotoml和cargolock"><a class="header" href="#cargotoml和cargolock">cargo.toml和cargo.lock</a></h3>
<p>cargo.toml和cargo.lock是cargo项目代码管理的核心两个文件，cargo工具的所有活动均基于这两个文件。</p>
<p>cargo.toml是cargo特有的项目数据描述文件，对于猿们而言，cargo.toml文件存储了项目的所有信息，它直接面向rust猿，猿们如果想让自己的rust项目能够按照期望的方式进行构建、测试和运行，那么，必须按照合理的方式构建’cargo.toml’。</p>
<p>而cargo.lock文件则不直接面向猿，猿们也不需要直接去修改这个文件。lock文件是cargo工具根据同一项目的toml文件生成的项目依赖详细清单文件，所以我们一般不用不管他，只需要对着cargo.toml文件撸就行了。</p>
<h3 id="构建清理更新以及安装"><a class="header" href="#构建清理更新以及安装">构建、清理、更新以及安装</a></h3>
<blockquote>
<p>领会了toml描述文件的写法，是一个重要的方面。另一个重要的方面，就是cargo工具本身为我们程序猿提供的各种好用的工具。如果大家感兴趣，自己在终端中输入’cargo –help’查看即可。</p>
</blockquote>
<ol>
<li>其中开发时最常用的命令就是'cargo build'，用于构建项目。</li>
<li>此外，'cargo clean'命令可以清理target文件夹中的所有内容；</li>
<li>'cargo update'根据toml描述文件重新检索并更新各种依赖项的信息，并写入lock文件，例如依赖项版本的更新变化等等；</li>
<li>'cargo install'可用于实际的生产部署。这些命令在实际的开发部署中均是非常有用的。</li>
</ol>
<h3 id="mainrs-和-librs"><a class="header" href="#mainrs-和-librs">main.rs 和 lib.rs</a></h3>
<div id="admonition-mainrs-vs-librs" class="admonition info">
<div class="admonition-title">
<p>main.rs vs lib.rs</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-mainrs-vs-librs"></a></p>
</div>
<div>
<pre><code class="language-text">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓                                              
┃                                     _                                        ┃                                              
┃                          _ __  __ _(_)_ _    _ _ ___                         ┃                                              
┃                         | '  \/ _` | | ' \ _| '_(_-&lt;                         ┃                                              
┃                         |_|_|_\__,_|_|_||_(_)_| /__/                         ┃                                              
┃                                                                              ┃                                              
┃ _                 _ _                             _             _   _        ┃                                              
┃| |_  __ _ _ _  __| | |___ ___  _ _ _  _ _ _  _ _ (_)_ _  __ _  | |_| |_  ___ ┃                                              
┃| ' \/ _` | ' \/ _` | / -_|_-&lt; | '_| || | ' \| ' \| | ' \/ _` | |  _| ' \/ -_)┃                                              
┃|_||_\__,_|_||_\__,_|_\___/__/ |_|  \_,_|_||_|_||_|_|_||_\__, |  \__|_||_\___|┃                                              
┃                                                         |___/                ┃                                              
┃                                                                              ┃                                              
┃                       _ __ _ _ ___  __ _ _ _ __ _ _ __                       ┃                                              
┃                      | '_ \ '_/ _ \/ _` | '_/ _` | '  \                      ┃                                              
┃                      | .__/_| \___/\__, |_| \__,_|_|_|_|                     ┃                                              
┃                      |_|           |___/                                     ┃                                              
┃                                                                              ┃                                              
┃1. cargo new --bin                                                            ┃                                              
┃- Calling the command line parsing logic with the argument values             ┃                                              
┃- Setting up any other configuration                                          ┃                                              
┃- Calling a run function in lib.rs           ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃- Handling the error if run returns an error ┃All are rust basic entry:       ╳    _ _ _                                    ┃
┃                                             ┃1. main.rs is the running entry ╳   | (_) |__   _ _ ___                       ┃
┃                                             ┃2. lib.rs is the library entry  ╳   | | | '_ \_| '_(_-&lt;                       ┃
┃                                             ┃╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳╳    |_|_|_.__(_)_| /__/                       ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫                                                                              ┃
                                              ┃   _                 _ _               _ _   _   _          _           _     ┃
                                              ┃  | |_  __ _ _ _  __| | |___ ___  __ _| | | | |_| |_  ___  | |___  __ _(_)__  ┃
                                              ┃  | ' \/ _` | ' \/ _` | / -_|_-&lt; / _` | | | |  _| ' \/ -_) | / _ \/ _` | / _| ┃
                                              ┃  |_||_\__,_|_||_\__,_|_\___/__/ \__,_|_|_|  \__|_||_\___| |_\___/\__, |_\__| ┃
                                              ┃                                                                  |___/       ┃
                                              ┃        __   _   _          _           _          _     _                 _  ┃
                                              ┃   ___ / _| | |_| |_  ___  | |_ __ _ __| |__  __ _| |_  | |_  __ _ _ _  __| | ┃
                                              ┃  / _ \  _| |  _| ' \/ -_) |  _/ _` (_-&lt; / / / _` |  _| | ' \/ _` | ' \/ _` | ┃
                                              ┃  \___/_|    \__|_||_\___|  \__\__,_/__/_\_\ \__,_|\__| |_||_\__,_|_||_\__,_| ┃
                                              ┃                                                                              ┃
                                              ┃                                                                              ┃
                                              ┃                                                                              ┃
                                              ┃                                                                              ┃
                                              ┃                                                                              ┃
                                              ┃                                                                              ┃
                                              ┃                                                                              ┃
                                              ┃                                                                              ┃
                                              ┃                                                                              ┃
                                              ┃                                                                              ┃
                                              ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
</code></pre>
</div>
</div>
<ul>
<li>
<p><a href="https://web.archive.org/web/20220703121446/https://juejin.cn/post/6919738138135003150">Rust 模块系统 - 掘金</a></p>
<blockquote>
<p>包（package）创建规则：</p>
</blockquote>
<pre><code>- 一个包中至多只能包含一个库Crate。
- 包中可以包含任意多个二进制Crate。
- 包中至少包含一个 crate，无论是库的还是二进制的。
- 包中应该包含一个 Cargo.toml 配置文件，用来说明如何去构建这些 crate。
</code></pre>
<blockquote>
<p>示例一：cargo new --bin 创建一个包含 二进制Crate 的包
示例二：cargo new --lib 创建一个包含库(lib)crate的包
示例三：--lib和--bin不可以同时使用，这种情况下可以示例一的基础上自己创建一个lib.rs文件</p>
</blockquote>
<ul>
<li>一般情况下，我们将与程序运行相关的代码放在 main.rs 文件，其他真正的任务逻辑放在 lib.rs 文件中。</li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220703121604/https://stackoverflow.com/questions/57756927/rust-modules-confusion-when-there-is-main-rs-and-lib-rs">Rust modules confusion when there is main.rs and lib.rs - Stack Overflow</a></p>
</li>
</ul>
<blockquote>
<p>这里有人详细介绍了只有lib.rs/main.rs的情况下，执行cargo run的情况。没有main.rs的时候，cargo run会告诉你：error: a bin target must be available for <code>cargo run</code></p>
</blockquote>
<ul>
<li><a href="https://www.reddit.com/r/rust/comments/c41iph/mainrs_vs_librs/">main.rs vs lib.rs : rust</a></li>
</ul>
<blockquote>
<p>A common pattern, even for binary-only crates, is to declare a &quot;library&quot; providing the majority of functionality, and then have main.rs just implement argument parsing and use that library.
This allows for integration tests written against the library, which might otherwise be hard to do with only main.rs.</p>
</blockquote>
<ul>
<li>
<p><a href="https://web.archive.org/web/20220703121647/https://users.rust-lang.org/t/main-rs-and-lib-rs-at-same-level/42499">Main.rs and lib.rs at same level - help - The Rust Programming Language Forum</a></p>
<blockquote>
<p>这里有人跟着官方文档制作命令行工具时发现同样的疑惑点，底下有人引用了这个链接</p>
</blockquote>
<ul>
<li><a href="https://web.archive.org/web/20220424212816/https://doc.rust-lang.org/book/ch12-03-improving-error-handling-and-modularity.html#separation-of-concerns-for-binary-projects">Separation of Conerns for Binary Projects - The Rust Programming Language</a></li>
</ul>
</li>
</ul>
<div id="admonition-allocating-responsibilty-for-multiple-tasks" class="admonition quote">
<div class="admonition-title">
<p>Allocating Responsibilty for Multiple Tasks</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-allocating-responsibilty-for-multiple-tasks"></a></p>
</div>
<div>
<p>The organizational problem of allocating responsibility for multiple tasks to the main function is common to many binary projects. As a result, the Rust community has developed a process to use as a guideline for splitting the separate concerns of a binary program when main starts getting large. The process has the following steps:</p>
<ol>
<li>Split your program into a main.rs and a lib.rs and move your program’s logic to lib.rs.</li>
<li>As long as your command line parsing logic is small, it can remain in main.rs.</li>
<li>When the command line parsing logic starts getting complicated, extract it from main.rs and move it to lib.rs.</li>
</ol>
<blockquote>
<p>The responsibilities that remain in the main function after this process should be limited to the following:</p>
</blockquote>
<ul>
<li>Calling the command line parsing logic with the argument values</li>
<li>Setting up any other configuration</li>
<li>Calling a run function in lib.rs</li>
<li>Handling the error if run returns an error</li>
</ul>
<blockquote>
<p>This pattern is about separating concerns:</p>
</blockquote>
<ol>
<li>main.rs handles running the program</li>
<li>and lib.rs handles all the logic of the task at hand. </li>
</ol>
<blockquote>
<p>Because you can’t test the main function directly, this structure lets you test all of your program’s logic by moving it into functions in lib.rs. 
The only code that remains in main.rs will be small enough to verify its correctness by reading it. 
Let’s rework our program by following this process.</p>
</blockquote>
</div>
</div>
<div id="admonition-明确职责-用mvc类比" class="admonition tip">
<div class="admonition-title">
<p>明确职责, 用MVC类比</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-明确职责-用mvc类比"></a></p>
</div>
<div>
<blockquote>
<p>也就是说</p>
</blockquote>
<ol>
<li>main.rs只负责调用、配置和处理异常， 类似View</li>
<li>lib.rs主要负责具体的业务逻辑, 类似Control+Model</li>
</ol>
</div>
</div>
<div id="admonition-用crate来区分" class="admonition quote">
<div class="admonition-title">
<p>用crate来区分</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-用crate来区分"></a></p>
</div>
<div>
<p>Note that the main.rs does not declare any modules with mod, it only imports them with use (the distinction between the two is something a lot of new Rust programmers struggle with!).</p>
<p>The reason for this is that, in projects with both a lib.rs and a main.rs:</p>
<blockquote>
<p>Cargo effectively treats lib.rs as the root of your crate, and main.rs as a seperate binary that depends on your crate.</p>
</blockquote>
</div>
</div>
<div id="admonition-用binary和library来区分" class="admonition quote">
<div class="admonition-title">
<p>用binary和library来区分</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-用binary和library来区分"></a></p>
</div>
<div>
<p><strong>main.rs is always the root of your binary, and lib.rs is always the root of your library.</strong></p>
<blockquote>
<p>The important things to realize are:</p>
</blockquote>
<ul>
<li>These two roots are compiled seperately, and have their own entirely seperate module structure.</li>
<li>When you use the mod keyword, you are creating a module, not importing a module.</li>
<li>You almost never want to have multiple mod statements for a single file, as you'll be duplicating the content.</li>
<li>If you want to use something from an existing module or from a library, that's what the use keyword is for.</li>
</ul>
<blockquote>
<p>Let's walk through your example:</p>
</blockquote>
<ol>
<li>In lib.rs, you use <strong>mod</strong> to declare that your library has two top level modules, cli and internal. There are corresponding files in the right place in your project, so Cargo knows how to link it all up. This part is fine, and what you intended to happen!</li>
<li>However, when you write mod lib in your main.rs, you're not importing your library! You're actually declaring that your binary has it's own top level module, which just happens to be called lib. Cargo then sees that there is a file called lib.rs in the folder, and links that in, even though that's not what you intended. It then sees that the lib.rs file has two mod statements and treats these as submodules of the binary's lib module. The files aren't in the right place for that to work, so compilation fails.</li>
<li>So the root cause of your issue is that you've effectively told the compiler to create your module structure twice, <strong>once in your library and once in your binary</strong>. </li>
<li>You really only meant to define these modules in your library, and then use them into your binary.</li>
</ol>
</div>
</div>
<h3 id="实际应用substrate的substrate-node-template"><a class="header" href="#实际应用substrate的substrate-node-template">实际应用：Substrate的substrate-node-template</a></h3>
<blockquote>
<p>根据官方文档知道，substrate是各种lib包，那么开发时如何运行呢？</p>
</blockquote>
<h4 id="区别cargo-run与cargo-build"><a class="header" href="#区别cargo-run与cargo-build">区别cargo run与cargo build</a></h4>
<ul>
<li><a href="https://kaisery.github.io/trpl-zh-cn/ch01-03-hello-cargo.html#%E6%9E%84%E5%BB%BA%E5%B9%B6%E8%BF%90%E8%A1%8C-cargo-%E9%A1%B9%E7%9B%AE">构建并运行Cargo - Rust 程序设计语言 简体中文版</a></li>
</ul>
<h4 id="在node包里面存在mainrs"><a class="header" href="#在node包里面存在mainrs">在node包里面存在main.rs</a></h4>
<ol>
<li>根Cargo.toml里面告诉cargo，这个项目总共有三个包</li>
</ol>
<div id="admonition-根cargotoml" class="admonition info">
<div class="admonition-title">
<p>根Cargo.toml</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-根cargotoml"></a></p>
</div>
<div>
<pre><code class="language-toml">[workspace]
members = [
    &quot;node&quot;,
    &quot;pallets/template&quot;,
    &quot;runtime&quot;,
]
[profile.release]
panic = &quot;unwind&quot;
</code></pre>
</div>
</div>
<ol start="2">
<li>然后cargo找到包含main.rs的node包作为入口</li>
</ol>
<div id="admonition-node-tree" class="admonition tip">
<div class="admonition-title">
<p>node tree</p>
<p><a class="admonition-anchor-link" href="layer2_design_abstract/6_module_manage/cargo_rustc.html#admonition-node-tree"></a></p>
</div>
<div>
<pre><code class="language-shell"> tree -L 2 node                                                                                                                                                                                                                         ─╯
node
├── Cargo.toml
├── build.rs
└── src
    ├── chain_spec.rs
    ├── cli.rs
    ├── command.rs
    ├── command_helper.rs
    ├── lib.rs
    ├── main.rs
    ├── rpc.rs
    └── service.rs

1 directory, 10 files
</code></pre>
</div>
</div>
<ol start="3">
<li>node/main.rs里面使用了文件名crate</li>
</ol>
<pre><pre class="playground"><code class="language-rust">//! Substrate Node Template CLI library.
#![warn(missing_docs)]

mod chain_spec;
#[macro_use]
// 对应service.rs
mod service;
// 对应cli.rs
mod cli;
// 对应command.rs
mod command;
// 对应command_helper.rs
mod command_helper;
// 对应rpc.rs
mod rpc;

fn main() -&gt; sc_cli::Result&lt;()&gt; {
    command::run()

</code></pre></pre>
<h2 id="参考资源-23"><a class="header" href="#参考资源-23">参考资源</a></h2>
<h3 id="online-book-25"><a class="header" href="#online-book-25">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/rustc/what-is-rustc.html">What is rustc? - The rustc book</a></li>
</ul>
<h3 id="fragment-25"><a class="header" href="#fragment-25">fragment</a></h3>
<ul>
<li><a href="https://skyao.io/learning-rust/docs/build/rustc.html">Rustc | Rust学习笔记</a></li>
<li><a href="https://web.archive.org/web/20220621034241/https://pp88.org/rust.zui.jia.shi.jian.rust.zui.jia.shi.jian/cargo.xiang.mu.pei.zhi.ji.jie.gou/">Cargo项目配置及结构 | 皮皮爸(pp8)</a></li>
</ul>
<h3 id="local-25"><a class="header" href="#local-25">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust扩展工具介绍"><a class="header" href="#rust扩展工具介绍">Rust扩展工具介绍</a></h1>
<!--ts-->
<ul>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#rust%E6%89%A9%E5%B1%95%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D">Rust扩展工具介绍</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#cargo%E5%AD%90%E5%91%BD%E4%BB%A4%E7%B3%BB%E5%88%97-cargo-install-">Cargo子命令系列: cargo install </a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#cargo-watch">cargo-watch</a></li>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#cargo-edit">cargo-edit</a></li>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#cargo-deb">cargo-deb</a></li>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#cargo-outdated">cargo-outdated</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#rustup%E7%B3%BB%E5%88%97-rust-component-add-tool_name">rustup系列: rust component add &lt;tool_name&gt;</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#clippy">clippy</a></li>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#rustc">rustc</a></li>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#rustfmt">rustfmt</a></li>
</ul>
</li>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#online-book">online-book</a></li>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#fragment">fragment</a></li>
<li><a href="layer2_design_abstract/6_module_manage/rust_plugins.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:14 UTC 2022 -->
<!--te-->
<h2 id="cargo子命令系列-cargo-install"><a class="header" href="#cargo子命令系列-cargo-install">Cargo子命令系列: cargo install <binary crate name></a></h2>
<h3 id="cargo-watch"><a class="header" href="#cargo-watch">cargo-watch</a></h3>
<h3 id="cargo-edit"><a class="header" href="#cargo-edit">cargo-edit</a></h3>
<h3 id="cargo-deb"><a class="header" href="#cargo-deb">cargo-deb</a></h3>
<h3 id="cargo-outdated"><a class="header" href="#cargo-outdated">cargo-outdated</a></h3>
<h2 id="rustup系列-rust-component-add-tool_name"><a class="header" href="#rustup系列-rust-component-add-tool_name">rustup系列: rust component add &lt;tool_name&gt;</a></h2>
<h3 id="clippy"><a class="header" href="#clippy">clippy</a></h3>
<h3 id="rustc-1"><a class="header" href="#rustc-1">rustc</a></h3>
<h3 id="rustfmt"><a class="header" href="#rustfmt">rustfmt</a></h3>
<h2 id="参考资源-24"><a class="header" href="#参考资源-24">参考资源</a></h2>
<h3 id="online-book-26"><a class="header" href="#online-book-26">online-book</a></h3>
<ul>
<li><a href="https://rust-lang.github.io/rustup/concepts/components.html">Components - The rustup book</a></li>
<li><a href="https://rust-lang.github.io/rustup/concepts/channels.html#nightly-availability">Channels - The rustup book</a></li>
</ul>
<h3 id="fragment-26"><a class="header" href="#fragment-26">fragment</a></h3>
<ul>
<li><a href="https://rust-lang.github.io/rustup-components-history/">Rustup packages availability on x86_64-unknown-linux-gnu</a></li>
</ul>
<h3 id="local-26"><a class="header" href="#local-26">local</a></h3>
<ul>
<li><a href="marginnote3app://note/5D418160-6AC9-4FEF-843F-DA262F6A7DEB">&lt;精通Rust(第二版)&gt;-2.4 Cargo工具扩展</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="任务抽象"><a class="header" href="#任务抽象">任务抽象</a></h1>
<!--ts-->
<ul>
<li><a href="layer3_task_abstract/layer3_task_abstract.html#%E4%BB%BB%E5%8A%A1%E6%8A%BD%E8%B1%A1">任务抽象</a>
<ul>
<li><a href="layer3_task_abstract/layer3_task_abstract.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer3_task_abstract/layer3_task_abstract.html#online-book">online-book</a></li>
<li><a href="layer3_task_abstract/layer3_task_abstract.html#fragment">fragment</a></li>
<li><a href="layer3_task_abstract/layer3_task_abstract.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:17 UTC 2022 -->
<!--te-->
<h2 id="参考资源-25"><a class="header" href="#参考资源-25">参考资源</a></h2>
<h3 id="online-book-27"><a class="header" href="#online-book-27">online-book</a></h3>
<h3 id="fragment-27"><a class="header" href="#fragment-27">fragment</a></h3>
<h3 id="local-27"><a class="header" href="#local-27">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="并发"><a class="header" href="#并发">并发</a></h1>
<!--ts-->
<ul>
<li><a href="layer3_task_abstract/7_concurrency/7_concurrency.html#%E5%B9%B6%E5%8F%91">并发</a>
<ul>
<li><a href="layer3_task_abstract/7_concurrency/7_concurrency.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer3_task_abstract/7_concurrency/7_concurrency.html#online-book">online-book</a></li>
<li><a href="layer3_task_abstract/7_concurrency/7_concurrency.html#fragment">fragment</a></li>
<li><a href="layer3_task_abstract/7_concurrency/7_concurrency.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:16 UTC 2022 -->
<!--te-->
<h2 id="参考资源-26"><a class="header" href="#参考资源-26">参考资源</a></h2>
<h3 id="online-book-28"><a class="header" href="#online-book-28">online-book</a></h3>
<h3 id="fragment-28"><a class="header" href="#fragment-28">fragment</a></h3>
<h3 id="local-28"><a class="header" href="#local-28">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="从io模型开始"><a class="header" href="#从io模型开始">从IO模型开始</a></h1>
<!--ts-->
<ul>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#%E4%BB%8Eio%E6%A8%A1%E5%9E%8B%E5%BC%80%E5%A7%8B">从IO模型开始</a>
<ul>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#1-%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%E9%98%BB%E5%A1%9E%E9%9D%9E%E9%98%BB%E5%A1%9E%E6%A6%82%E5%BF%B5%E5%8C%BA%E5%88%AB">1. 同步/异步、阻塞/非阻塞概念区别</a>
<ul>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#%E5%90%8C%E6%AD%A5%E5%92%8C%E5%BC%82%E6%AD%A5%E5%85%B3%E6%B3%A8%E7%9A%84%E6%98%AF%E6%B6%88%E6%81%AF%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E8%B0%83%E7%94%A8%E8%80%85%E8%A7%86%E8%A7%92">同步和异步，关注的是消息通信机制。（调用者视角）</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#%E9%98%BB%E5%A1%9E%E5%92%8C%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%85%B3%E6%B3%A8%E7%9A%84%E6%98%AF%E7%A8%8B%E5%BA%8F%E7%AD%89%E5%BE%85%E8%B0%83%E7%94%A8%E7%BB%93%E6%9E%9C%E7%9A%84%E7%8A%B6%E6%80%81%E8%A2%AB%E8%B0%83%E7%94%A8%E8%80%85%E8%A7%86%E8%A7%92">阻塞和非阻塞，关注的是程序等待调用结果的状态。（被调用者视角）</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#%E9%98%BB%E5%A1%9E%E4%B8%8E%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E6%9C%89%E5%85%B3">阻塞，与系统调用有关。</a></li>
</ul>
</li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#2-%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5io-%E6%A8%A1%E5%9E%8B%E5%88%86%E7%B1%BB">2. 同步/异步IO 模型分类</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#3-%E5%90%8C%E6%AD%A5%E9%98%BB%E5%A1%9Eio-blocking-io">3. 同步阻塞I/O (blocking I/O)</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#4-io-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8io-multiplexing-">4. I/O 多路复用（I/O Multiplexing )</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#5-epoll-%E5%90%8C%E6%AD%A5%E9%98%BB%E5%A1%9E%E9%9D%9E%E9%98%BB%E5%A1%9E%E6%A8%A1%E5%9E%8B">5. epoll: 同步阻塞/非阻塞模型</a>
<ul>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#epoll%E4%B8%89%E4%B8%AA%E5%87%BD%E6%95%B0">epoll三个函数</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#epoll-%E4%B8%A4%E7%A7%8D%E8%A7%A6%E5%8F%91%E6%9C%BA%E5%88%B6">epoll 两种触发机制：</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#%E6%83%8A%E7%BE%A4%E9%97%AE%E9%A2%98">惊群问题：</a></li>
</ul>
</li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#6-%E5%BC%82%E6%AD%A5-io-%E6%A8%A1%E5%9E%8B-io_uring">6. 异步 I/O 模型: io_uring</a>
<ul>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#1-reactor%E5%8F%8D%E5%BA%94%E5%99%A8-%E6%A8%A1%E5%BC%8F">1. Reactor（反应器） 模式</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#2-preactor%E4%B8%BB%E5%8A%A8%E5%99%A8-%E6%A8%A1%E5%BC%8F">2. Preactor（主动器） 模式</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#reactor-model">Reactor Model:</a>
<ul>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#%E4%B8%89%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F">三种实现方式：</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#%E8%AF%BB%E5%86%99%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B">读写操作流程：</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#%E5%8F%82%E4%B8%8E%E8%80%85">参与者：</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#online-book">online-book</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#fragment">fragment</a></li>
<li><a href="layer3_task_abstract/7_concurrency/io_models.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:16 UTC 2022 -->
<!--te-->
<h2 id="1-同步异步阻塞非阻塞概念区别"><a class="header" href="#1-同步异步阻塞非阻塞概念区别">1. 同步/异步、阻塞/非阻塞概念区别</a></h2>
<h3 id="同步和异步关注的是消息通信机制调用者视角"><a class="header" href="#同步和异步关注的是消息通信机制调用者视角">同步和异步，关注的是消息通信机制。（调用者视角）</a></h3>
<ul>
<li>同步，发出一个调用，在没有得到结果之前不返回。</li>
<li>异步，发出一个调用，在没有得到结果之前返回。</li>
</ul>
<h3 id="阻塞和非阻塞关注的是程序等待调用结果的状态被调用者视角"><a class="header" href="#阻塞和非阻塞关注的是程序等待调用结果的状态被调用者视角">阻塞和非阻塞，关注的是程序等待调用结果的状态。（被调用者视角）</a></h3>
<ul>
<li>阻塞，在调用结果返回之前，线程被挂起。</li>
<li>非阻塞，在调用结果返回之前，线程不会被挂起。</li>
</ul>
<h3 id="阻塞与系统调用有关"><a class="header" href="#阻塞与系统调用有关">阻塞，与系统调用有关。</a></h3>
<h2 id="2-同步异步io-模型分类"><a class="header" href="#2-同步异步io-模型分类">2. 同步/异步IO 模型分类</a></h2>
<pre><code class="language-text">                                 +-+ 阻 塞 I/O (BIO)
                                 |
                                 +-+ 非 阻 塞 I/O (NIO)
                                 |
              +----+ 同 步 I/O +--+
              |                  |
              |                  +-+ I/O 多 路 复 用
              |                  |
              |                  +-+ 信 号 驱 动 I/O
I/O 模 型  +---+
              |
              |
              |                  +-+ Linux (AIO)
              |                  |         (io_uring)
              +----+ 异 步 I/O +--+
                                 |
                                 +-+ windows (IOCP)

</code></pre>
<h2 id="3-同步阻塞io-blocking-io"><a class="header" href="#3-同步阻塞io-blocking-io">3. 同步阻塞I/O (blocking I/O)</a></h2>
<pre><code class="language-text">Application               kernel
+---------+            +-----------+  +---+
|         |   syscall  | no        |      |
|   Read  | +--------&gt; | datagram  |      |
| recvfrom|            | ready     |      |
|         |            |    +      |      +-+ wait for
|         |            |    |      |      +-+ data
|         |            |    v      |      |
|         |            | datagram  |      |
|         |            | ready     |  +---+
|         |            |           |
|         |            | copy      |  +---+
|         |            | datagram  |      |
|process  |            |    +      |      +-+ copy data
|datagram |   return   |    |      |      +-+ from kernel to user
|         | &lt;--------+ |    v      |      |
|         |            |  copy     |  +---+
|         |            |  complete |
+---------+            +-----------+
</code></pre>
<blockquote>
<p>输入操作两个阶段：</p>
</blockquote>
<ol>
<li>进程等待内核把数据准备好；这个阶段可以阻塞也可非阻塞，设置socket属性。
<ul>
<li>阻塞： recvfrom 阻塞线程直到返回数据就绪的结果。</li>
<li>非阻塞：立即返回一个错误，轮询直到数据就绪。</li>
</ul>
</li>
<li>从内核缓冲区向进程缓冲区复制数据。（一直阻塞）</li>
</ol>
<p>异步I/O，recvfrom总是立即返回，两个阶段都由内核完成。</p>
<h2 id="4-io-多路复用io-multiplexing-"><a class="header" href="#4-io-多路复用io-multiplexing-">4. I/O 多路复用（I/O Multiplexing )</a></h2>
<p>IO多路复用是一种同步IO模型，实现一个线程可以监视多个文件句柄。</p>
<p>支持I/O多路复用的系统调用有 select/pselect/poll/epoll，本质都是同步I/O，因为数据拷贝都是阻塞的。 通过 select/epoll 来判断数据报是否准备好，即判断可读可写状态。</p>
<h2 id="5-epoll-同步阻塞非阻塞模型"><a class="header" href="#5-epoll-同步阻塞非阻塞模型">5. epoll: 同步阻塞/非阻塞模型</a></h2>
<pre><code class="language-text">                        +--------------------------------+     +-------------------------+
                        | epoll_ctl                      |     | epoll_wait              |
                        |                                |     |                         |
                        |                                |     |         +----+          |
                        |                 +---+          |     |         |    |          |
                        |                 |   |          |     |         |    |          |
                        |               +-+---+--+       |     |         +--+-+          |
                        |               |        |       |     |            |            |
                        |            +--++     +-++      |     |            |            |
epoll_create  +----&gt;    |            |   |     |  |      |     |         +--+-+          |
                        |            +-+-+     +--+      +----&gt;+         |    |          |
                        |              |                 |event|         |    |          |
                        |         +----+--+              |     |         +--+-+          |
                        |         |       |              |     |            |            |
                        |         ++      |              |     |            |            |
                        |        +--+   +-+-+            |     |         +--+-+          |
                        |        |  |   |   |            |     |         |    |          |
                        |        +--+   +---+            |     |         |    |          |
                        |                                |     |         +----+          |
                        |                    红 黑 树     |     |                 链 表    |
                        +--------------------------------+     +-------------------------+


</code></pre>
<h3 id="epoll三个函数"><a class="header" href="#epoll三个函数">epoll三个函数</a></h3>
<ul>
<li>epoll_create(int size) : 内核产生一个epoll实例数据结构，并返回一个epfd</li>
<li>epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)：将被监听的描述符添加到红黑树或从红黑树中删除或者对监听事件进行修改。</li>
<li>epoll_wait(int epfd, struct epoll_event *events, int maxevents, int timeout): 阻塞等待注册的事件发生，返回事件的数目，并将触发的事件写入events数组中</li>
</ul>
<h3 id="epoll-两种触发机制"><a class="header" href="#epoll-两种触发机制">epoll 两种触发机制：</a></h3>
<ul>
<li>水平触发机制（LT)。缓冲区只要有数据就触发读写。epoll 默认工作方式。select/poll只支持该方式。</li>
<li>边缘触发机制（ET)。缓冲区空或满的状态才触发读写。nginx 使用该方式，避免频繁读写。</li>
</ul>
<h3 id="惊群问题"><a class="header" href="#惊群问题">惊群问题：</a></h3>
<p>当多个进程/线程调用epoll_wait时会阻塞等待，当内核触发可读写事件，所有进程/线程都会进行响应，但是实际上只有一个进程/线程真实处理这些事件。 Liux 4.5 通过引入 EPOLLEXCLUSIVE
标识来保证一个事件发生时候只有一个线程会被唤醒，以避免多侦听下的惊群问题。</p>
<h2 id="6-异步-io-模型-io_uring"><a class="header" href="#6-异步-io-模型-io_uring">6. 异步 I/O 模型: io_uring</a></h2>
<p>Linux AIO 实现的并不理想，所以引入了新的异步I/O接口 io_uring。</p>
<pre><code class="language-text">+----+ Head  +---------+               +----------+ Head
|            |         |               |          |
|            |         |               |          |
|            +---------+               +----------+
|            |         |               |          |
|            |         |               |          |
|            +---------+               +----------+
|            |         |               |          |
|            |         |               |          |
|            +---------+               +----------+
|            |         |               |          |
|      Tail  +---------+               +----------+ Tail &lt;--+
|        +--------------------------------------------+     |
|        | Kernel                                     |     |
|        |                                            |     |
|        |        +-------+              +-------+    |     |
|        |        |       |              |       |    |     |
+---------------&gt; | SQ    |              |  CQ   | +--------+
         |        |       |              |       |    |
         |        +-------+              +-------+    |
         |                                            |
         +--------------------------------------------+

</code></pre>
<p>io_uring接口通过两个主要数据结构工作：</p>
<ul>
<li>提交队列条目（sqe）</li>
<li>完成队列条目（cqe）</li>
</ul>
<p>这些结构的实例位于内核和应用程序之间的<strong>共享内存</strong>单生产者单消费者环形缓冲区中。</p>
<p>参考：</p>
<p><a href="https://thenewstack.io/how-io_uring-and-ebpf-will-revolutionize-programming-in-linux/">https://thenewstack.io/how-io_uring-and-ebpf-will-revolutionize-programming-in-linux/</a></p>
<p><a href="https://cor3ntin.github.io/posts/iouring/#io_uring">https://cor3ntin.github.io/posts/iouring/#io_uring</a></p>
<blockquote>
<p>因为处理 I/O 复用的编程模型相当复杂，为了简化编程，引入了下面两种模型:</p>
</blockquote>
<h3 id="1-reactor反应器-模式"><a class="header" href="#1-reactor反应器-模式">1. Reactor（反应器） 模式</a></h3>
<p>对应同步I/O，被动的事件分离和分发模型。服务等待请求事件的到来，再通过不受间断的同步处理事件，从而做出反应。</p>
<h3 id="2-preactor主动器-模式"><a class="header" href="#2-preactor主动器-模式">2. Preactor（主动器） 模式</a></h3>
<p>对应异步I/O，主动的事件分离和分发模型。这种设计允许多个任务并发的执行，从而提高吞吐量；并可执行耗时长的任务（各个任务间互不影响）。</p>
<h3 id="reactor-model"><a class="header" href="#reactor-model">Reactor Model:</a></h3>
<pre><code class="language-text">                                                     +----------------+
req                                        Dispatch  |                |
+------+                                  +--------&gt; | req handler    |
|      |                                  |          +----------------+
|      | +----+                           |
+------+      | event    +------------+   |
              |          |            |   |
              +--------&gt; |  Service   |   |Dispatch  +----------------+
                         |  Handler   +------------&gt; |                |
req          +---------&gt; |            |   |          | req handler    |
+------+     |           +------------+   |          +----------------+
|      |     | event                      |
|      +----+                             |
+------+                                  | Dispatch +----------------+
                                          +---------&gt;+                |
                                                     | req handler    |
                                                     +----------------+

</code></pre>
<h4 id="三种实现方式"><a class="header" href="#三种实现方式">三种实现方式：</a></h4>
<ul>
<li>单线程模式。 accept()、read()、write()以及connect()操作 都在同一线程。</li>
<li>工作者线程池模式。非 I/O 操作交给线程池处理</li>
<li>多线程模式。主Reactor (master) ，负责网络监听 ， 子Reactor(worker) 读写网络数据。</li>
</ul>
<h4 id="读写操作流程"><a class="header" href="#读写操作流程">读写操作流程：</a></h4>
<ol>
<li>应用注册读写就绪事件和相关联的事件处理器</li>
<li>事件分离器等待事件发生</li>
<li>当发生读写就绪事件，事件分离器调用已注册的事件处理器</li>
<li>事件处理器执行读写操作</li>
</ol>
<h4 id="参与者"><a class="header" href="#参与者">参与者：</a></h4>
<ol>
<li>描述符（handle）：操作系统提供的资源，识别 socket等。</li>
<li>同步事件多路分离器。开启事件循环，等待事件的发生。封装了 多路复用函数 select/poll/epoll等。</li>
<li>事件处理器。提供回调函数，用于描述与应用程序相关的某个事件的操作。</li>
<li>具体的事件处理器。事件处理器接口的具体实现。使用描述符来识别事件和程序提供的服务。</li>
<li>Reactor 管理器。事件处理器的调度核心。分离每个事件，调度事件管理器，调用具体的函数处理某个事件。</li>
</ol>
<h2 id="参考资源-27"><a class="header" href="#参考资源-27">参考资源</a></h2>
<h3 id="online-book-29"><a class="header" href="#online-book-29">online-book</a></h3>
<ul>
<li><a href="https://time.geekbang.org/course/detail/100060601-365835">88. IO模型</a></li>
<li><a href="https://time.geekbang.org/course/detail/100060601-365838">89. epoll和io_uring</a></li>
<li><a href="https://time.geekbang.org/course/detail/100060601-367808">90. 事件驱动编程模型</a></li>
</ul>
<h3 id="fragment-29"><a class="header" href="#fragment-29">fragment</a></h3>
<h3 id="local-29"><a class="header" href="#local-29">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="多线程并发模型"><a class="header" href="#多线程并发模型">多线程并发模型</a></h1>
<!--ts-->
<ul>
<li><a href="layer3_task_abstract/7_concurrency/1_multi_models/multi_models.html#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B">多线程并发模型</a>
<ul>
<li><a href="layer3_task_abstract/7_concurrency/1_multi_models/multi_models.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer3_task_abstract/7_concurrency/1_multi_models/multi_models.html#online-book">online-book</a></li>
<li><a href="layer3_task_abstract/7_concurrency/1_multi_models/multi_models.html#fragment">fragment</a></li>
<li><a href="layer3_task_abstract/7_concurrency/1_multi_models/multi_models.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:15 UTC 2022 -->
<!--te-->
<h2 id="参考资源-28"><a class="header" href="#参考资源-28">参考资源</a></h2>
<h3 id="online-book-30"><a class="header" href="#online-book-30">online-book</a></h3>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch16-00-concurrency.html">Fearless Concurrency - The Rust Programming Language</a></li>
<li><a href="https://doc.rust-lang.org/book/ch20-00-final-project-a-web-server.html">Final Project: Building a Multithreaded Web Server - The Rust Programming Language</a></li>
</ul>
<h3 id="fragment-30"><a class="header" href="#fragment-30">fragment</a></h3>
<h3 id="local-30"><a class="header" href="#local-30">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="异步模型"><a class="header" href="#异步模型">异步模型</a></h1>
<!--ts-->
<ul>
<li><a href="layer3_task_abstract/7_concurrency/2_async_models/async_models.html#%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%9E%8B">异步模型</a>
<ul>
<li><a href="layer3_task_abstract/7_concurrency/2_async_models/async_models.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer3_task_abstract/7_concurrency/2_async_models/async_models.html#online-book">online-book</a></li>
<li><a href="layer3_task_abstract/7_concurrency/2_async_models/async_models.html#fragment">fragment</a></li>
<li><a href="layer3_task_abstract/7_concurrency/2_async_models/async_models.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:15 UTC 2022 -->
<!--te-->
<h2 id="参考资源-29"><a class="header" href="#参考资源-29">参考资源</a></h2>
<h3 id="online-book-31"><a class="header" href="#online-book-31">online-book</a></h3>
<h3 id="fragment-31"><a class="header" href="#fragment-31">fragment</a></h3>
<h3 id="local-31"><a class="header" href="#local-31">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="元编程"><a class="header" href="#元编程">元编程</a></h1>
<!--ts-->
<ul>
<li><a href="layer3_task_abstract/8_meta_programming/8_meta_programming.html#%E5%85%83%E7%BC%96%E7%A8%8B">元编程</a>
<ul>
<li><a href="layer3_task_abstract/8_meta_programming/8_meta_programming.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer3_task_abstract/8_meta_programming/8_meta_programming.html#online-book">online-book</a></li>
<li><a href="layer3_task_abstract/8_meta_programming/8_meta_programming.html#fragment">fragment</a></li>
<li><a href="layer3_task_abstract/8_meta_programming/8_meta_programming.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:17 UTC 2022 -->
<!--te-->
<h2 id="参考资源-30"><a class="header" href="#参考资源-30">参考资源</a></h2>
<h3 id="online-book-32"><a class="header" href="#online-book-32">online-book</a></h3>
<h3 id="fragment-32"><a class="header" href="#fragment-32">fragment</a></h3>
<h3 id="local-32"><a class="header" href="#local-32">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="协议抽象"><a class="header" href="#协议抽象">协议抽象</a></h1>
<!--ts-->
<ul>
<li><a href="layer4_protocol_abstract/layer4_protocol_abstract.html#%E5%8D%8F%E8%AE%AE%E6%8A%BD%E8%B1%A1">协议抽象</a>
<ul>
<li><a href="layer4_protocol_abstract/layer4_protocol_abstract.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer4_protocol_abstract/layer4_protocol_abstract.html#online-book">online-book</a></li>
<li><a href="layer4_protocol_abstract/layer4_protocol_abstract.html#fragment">fragment</a></li>
<li><a href="layer4_protocol_abstract/layer4_protocol_abstract.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:19 UTC 2022 -->
<!--te-->
<h2 id="参考资源-31"><a class="header" href="#参考资源-31">参考资源</a></h2>
<h3 id="online-book-33"><a class="header" href="#online-book-33">online-book</a></h3>
<h3 id="fragment-33"><a class="header" href="#fragment-33">fragment</a></h3>
<h3 id="local-33"><a class="header" href="#local-33">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="多语言编程"><a class="header" href="#多语言编程">多语言编程</a></h1>
<!--ts-->
<ul>
<li><a href="layer4_protocol_abstract/9_multilingual_programming/9_multilingual_programming.html#%E5%A4%9A%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B">多语言编程</a>
<ul>
<li><a href="layer4_protocol_abstract/9_multilingual_programming/9_multilingual_programming.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer4_protocol_abstract/9_multilingual_programming/9_multilingual_programming.html#online-book">online-book</a></li>
<li><a href="layer4_protocol_abstract/9_multilingual_programming/9_multilingual_programming.html#fragment">fragment</a></li>
<li><a href="layer4_protocol_abstract/9_multilingual_programming/9_multilingual_programming.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:18 UTC 2022 -->
<!--te-->
<h2 id="参考资源-32"><a class="header" href="#参考资源-32">参考资源</a></h2>
<h3 id="online-book-34"><a class="header" href="#online-book-34">online-book</a></h3>
<h3 id="fragment-34"><a class="header" href="#fragment-34">fragment</a></h3>
<h3 id="local-34"><a class="header" href="#local-34">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="计算机网络"><a class="header" href="#计算机网络">计算机网络</a></h1>
<!--ts-->
<ul>
<li><a href="layer4_protocol_abstract/10_computer_network/10_computer_network.html#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C">计算机网络</a>
<ul>
<li><a href="layer4_protocol_abstract/10_computer_network/10_computer_network.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer4_protocol_abstract/10_computer_network/10_computer_network.html#online-book">online-book</a></li>
<li><a href="layer4_protocol_abstract/10_computer_network/10_computer_network.html#fragment">fragment</a></li>
<li><a href="layer4_protocol_abstract/10_computer_network/10_computer_network.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:18 UTC 2022 -->
<!--te-->
<h2 id="参考资源-33"><a class="header" href="#参考资源-33">参考资源</a></h2>
<h3 id="online-book-35"><a class="header" href="#online-book-35">online-book</a></h3>
<h3 id="fragment-35"><a class="header" href="#fragment-35">fragment</a></h3>
<h3 id="local-35"><a class="header" href="#local-35">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="生态系统"><a class="header" href="#生态系统">生态系统</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/layer5_ecosystem.html#%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F">生态系统</a>
<ul>
<li><a href="layer5_ecosystem/layer5_ecosystem.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer5_ecosystem/layer5_ecosystem.html#online-book">online-book</a></li>
<li><a href="layer5_ecosystem/layer5_ecosystem.html#fragment">fragment</a></li>
<li><a href="layer5_ecosystem/layer5_ecosystem.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:41 UTC 2022 -->
<!--te-->
<h2 id="参考资源-34"><a class="header" href="#参考资源-34">参考资源</a></h2>
<h3 id="online-book-36"><a class="header" href="#online-book-36">online-book</a></h3>
<h3 id="fragment-36"><a class="header" href="#fragment-36">fragment</a></h3>
<h3 id="local-36"><a class="header" href="#local-36">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="学习资源"><a class="header" href="#学习资源">学习资源</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/1_learning_resource/learning_resource.html#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90">学习资源</a></li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:21 UTC 2022 -->
<!--te--><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="官方动态"><a class="header" href="#官方动态">官方动态</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="社区特点"><a class="header" href="#社区特点">社区特点</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="学术动态"><a class="header" href="#学术动态">学术动态</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="开源观察"><a class="header" href="#开源观察">开源观察</a></h1>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="命令行工具"><a class="header" href="#命令行工具">命令行工具</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="数据处理"><a class="header" href="#数据处理">数据处理</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="嵌入式"><a class="header" href="#嵌入式">嵌入式</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="操作系统"><a class="header" href="#操作系统">操作系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="性能工具"><a class="header" href="#性能工具">性能工具</a></h1>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="云原生"><a class="header" href="#云原生">云原生</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="前端开发"><a class="header" href="#前端开发">前端开发</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="网络基建"><a class="header" href="#网络基建">网络基建</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ipfs-星际文件系统interplanetary-file-system"><a class="header" href="#ipfs-星际文件系统interplanetary-file-system">IPFS: 星际文件系统(InterPlanetary File System)</a></h1>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/ipfs.jpeg" alt="ipfs" /></p>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs-%E6%98%9F%E9%99%85%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9Finterplanetary-file-system">IPFS: 星际文件系统(InterPlanetary File System)</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E4%BB%8B%E7%BB%8D">IPFS介绍</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#1-%E4%BB%80%E4%B9%88%E6%98%AFipfs">1 什么是IPFS</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#2-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89ipfs">2 为什么有IPFS</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#http%E7%9A%84%E4%B8%AD%E5%BF%83%E5%8C%96%E6%98%AF%E4%BD%8E%E6%95%88%E7%9A%84-%E5%B9%B6%E4%B8%94%E6%88%90%E6%9C%AC%E5%BE%88%E9%AB%98">HTTP的中心化是低效的, 并且成本很高</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#web%E6%96%87%E4%BB%B6%E7%BB%8F%E5%B8%B8%E8%A2%AB%E5%88%A0%E9%99%A4">Web文件经常被删除</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#%E4%B8%AD%E5%BF%83%E5%8C%96%E9%99%90%E5%88%B6%E4%BA%86web%E7%9A%84%E6%88%90%E9%95%BF">中心化限制了web的成长</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#%E4%BA%92%E8%81%94%E7%BD%91%E5%BA%94%E7%94%A8%E9%AB%98%E5%BA%A6%E4%BE%9D%E8%B5%96%E4%B8%BB%E5%B9%B2%E7%BD%91">互联网应用高度依赖主干网</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#3-ipfs%E7%9A%84%E7%9B%AE%E6%A0%87">3 IPFS的目标</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#4-ipfs%E5%8C%85%E5%90%AB%E5%93%AA%E4%BA%9B%E5%86%85%E5%AE%B9">4 IPFS包含哪些内容</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8D%8F%E8%AE%AE%E7%B1%BB%E4%BC%BChttp%E5%8D%8F%E8%AE%AE">IPFS是一个协议，类似http协议</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E6%98%AF%E4%B8%80%E4%B8%AAweb%E5%8D%8F%E8%AE%AE">IPFS是一个web协议</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E6%98%AF%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9A%84%E5%8D%8F%E8%AE%AE">IPFS是模块化的协议</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E6%98%AF%E4%B8%80%E4%B8%AAp2p%E7%B3%BB%E7%BB%9F">IPFS是一个p2p系统</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E5%A4%A9%E7%94%9F%E6%98%AF%E4%B8%80%E4%B8%AAcdn">IPFS天生是一个CDN</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E6%8B%A5%E6%9C%89%E5%91%BD%E5%90%8D%E6%9C%8D%E5%8A%A1">IPFS拥有命名服务</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C">IPFS如何工作</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E4%B8%AD%E5%BF%83%E5%8C%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%BA%E7%82%B9">IPFS如何解决中心化服务器缺点</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#1-%E4%B8%8B%E8%BD%BD%E9%80%9F%E5%BA%A6%E5%BF%AB-%E4%B8%8D%E5%86%8D%E4%BE%9D%E8%B5%96%E4%B8%BB%E5%B9%B2%E7%BD%91-%E4%B8%AD%E5%BF%83%E5%8C%96%E6%9C%8D%E5%8A%A1%E5%99%A8">1 下载速度快, 不再依赖主干网, 中心化服务器</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#2-%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4%E5%8F%98%E5%BE%97%E9%9D%9E%E5%B8%B8%E4%BE%BF%E5%AE%9C">2 存储空间变得非常便宜</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#3-%E5%AE%89%E5%85%A8">3 安全</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#4-%E5%BC%80%E6%94%BE">4 开放</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E7%9A%84%E7%94%A8%E9%80%94">IPFS的用途</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E7%9A%84pow%E6%9C%BA%E5%88%B6">IPFS的POW机制</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E5%AE%B6%E6%97%8F">IPFS家族</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#main-projects">Main Projects</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#contributions">Contributions</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#movements">Movements</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs-%E4%B8%8E-filecoin">IPFS 与 Filecoin</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E6%95%B0%E6%8D%AE%E7%9A%84%E5%88%86%E5%8F%91%E5%92%8C%E5%AE%9A%E4%BD%8D%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE%E7%B1%BB%E4%BC%BChttp%E5%8D%8F%E8%AE%AE">IPFS：数据的分发和定位（数据传输协议，类似HTTP协议）</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#filecoin-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%B1%BB%E4%BC%BC%E4%B8%80%E4%B8%AA%E4%BA%91%E5%AD%98%E5%82%A8">Filecoin: 数据存储（类似一个云存储）</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E5%92%8Cfilecoin%E5%85%B1%E5%90%8C%E4%BE%9D%E8%B5%96libp2p%E9%A1%B9%E7%9B%AE">IPFS和Filecoin共同依赖libp2p项目。</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#%E4%BD%BF%E7%94%A8ipfs%E7%9A%84%E5%BA%94%E7%94%A8">使用IPFS的应用</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E7%BD%91%E7%BB%9C%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C">IPFS网络如何运行</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs-nat-traversal">IPFS: NAT traversal</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#bitswap">BitSwap</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#ipfs%E9%9D%9Erust%E5%AE%9E%E7%8E%B0%E7%89%88%E6%9C%AC">IPFS非rust实现版本</a></li>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a></li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:26 UTC 2022 -->
<!--te-->
<h2 id="ipfs介绍"><a class="header" href="#ipfs介绍">IPFS介绍</a></h2>
<h3 id="1-什么是ipfs"><a class="header" href="#1-什么是ipfs">1 什么是IPFS</a></h3>
<p>星际文件系统(InterPlanetary File System). IPFS 是一个分布式的web, 点到点超媒体协议. 可以让我们的互联网速度更快, 更加安全, 并且更加开放. IPFS协议的目标是取代传统的互联网协议HTTP。</p>
<h3 id="2-为什么有ipfs"><a class="header" href="#2-为什么有ipfs">2 为什么有IPFS</a></h3>
<p>众所周知, 互联网是建立在HTTP协议上的. HTTP协议是个伟大的发明, 让我们的互联网得以快速发展.但是互联网发展到了今天HTTP逐渐出来了不足.</p>
<h4 id="http的中心化是低效的-并且成本很高"><a class="header" href="#http的中心化是低效的-并且成本很高">HTTP的中心化是低效的, 并且成本很高</a></h4>
<p>使用HTTP协议每次需要从中心化的服务器下载完整的文件(网页, 视频, 图片等), 速度慢, 效率低. 如果改用P2P的方式下载, 可以节省近60%的带宽. P2P将文件分割为小的块, 从多个服务器同时下载, 速度非常快.</p>
<h4 id="web文件经常被删除"><a class="header" href="#web文件经常被删除">Web文件经常被删除</a></h4>
<p>回想一下是不是经常你收藏的某个页面, 在使用的时候浏览器返回404(无法找到页面), http的页面平均生存周期大约只有100天. Web文件经常被删除(由于存储成本太高), 无法永久保存. IPFS提供了文件的历史版本回溯功能(就像git版本控制工具一样), 可以很容易的查看文件的历史版本, 数据可以得到永久保存</p>
<h4 id="中心化限制了web的成长"><a class="header" href="#中心化限制了web的成长">中心化限制了web的成长</a></h4>
<p>我们的现有互联网是一个高度中心化的网络. 互联网是人类的伟大发明, 也是科技创新的加速器. 各种管制将对这互联网的功能造成威胁, 例如: 互联网封锁, 管制, 监控等等.这些都源于互联网的中心化.而分布式的IPFS可以克服这些web的缺点.</p>
<h4 id="互联网应用高度依赖主干网"><a class="header" href="#互联网应用高度依赖主干网">互联网应用高度依赖主干网</a></h4>
<p>主干网受制于诸多因素的影响, 战争, 自然灾害, 互联网管制, 中心化服务器宕机等等, 都可能是我们的互联网应用中断服务. IPFS可以是互联网应用极大的降低互联网应用对主干网的依赖.</p>
<h3 id="3-ipfs的目标"><a class="header" href="#3-ipfs的目标">3 IPFS的目标</a></h3>
<p>IPFS不仅仅是为了加速web. 而是为了最终取代HTTP协议, 使互联网更加美好</p>
<h3 id="4-ipfs包含哪些内容"><a class="header" href="#4-ipfs包含哪些内容">4 IPFS包含哪些内容</a></h3>
<h4 id="ipfs是一个协议类似http协议"><a class="header" href="#ipfs是一个协议类似http协议">IPFS是一个协议，类似http协议</a></h4>
<ul>
<li>定义了基于内容的寻址文件系统</li>
<li>内容分发</li>
<li>使用的技术分布式哈希、p2p传输、版本管理系统</li>
<li>IPFS是一个文件系统</li>
</ul>
<p>有文件夹和文件 可挂载文件系统</p>
<h4 id="ipfs是一个web协议"><a class="header" href="#ipfs是一个web协议">IPFS是一个web协议</a></h4>
<ul>
<li>可以像http那样查看互联网页面</li>
<li>未来浏览器可以直接支持 ipfs:/ 或者 fs:/ 协议</li>
</ul>
<h4 id="ipfs是模块化的协议"><a class="header" href="#ipfs是模块化的协议">IPFS是模块化的协议</a></h4>
<ul>
<li>连接层：通过其他任何网络协议连接</li>
<li>路由层：寻找定位文件所在位置</li>
<li>数据块交换：采用BitTorrent技术</li>
</ul>
<h4 id="ipfs是一个p2p系统"><a class="header" href="#ipfs是一个p2p系统">IPFS是一个p2p系统</a></h4>
<ul>
<li>世界范围内的p2p文件传输网络</li>
<li>分布式网络结构</li>
<li>没有单点失效问题</li>
</ul>
<h4 id="ipfs天生是一个cdn"><a class="header" href="#ipfs天生是一个cdn">IPFS天生是一个CDN</a></h4>
<ul>
<li>文件添加到IPFS网络，将会在全世界进行CDN加速</li>
<li>bittorrent的带宽管理</li>
</ul>
<h4 id="ipfs拥有命名服务"><a class="header" href="#ipfs拥有命名服务">IPFS拥有命名服务</a></h4>
<ul>
<li>IPNS：基于SFS（自认证系统）命名体系</li>
<li>可以和现有域名系统绑定</li>
</ul>
<h2 id="ipfs如何工作"><a class="header" href="#ipfs如何工作">IPFS如何工作</a></h2>
<ol>
<li>IPFS为每一个文件分配一个独一无二的哈希值(文件指纹: 根据文件的内容进行创建), 即使是两个文件内容只有1个比特的不相同, 其哈希值也是不相同的.所以IPFS是基于文件内容进行寻址, 而不像传统的HTTP协议一样基于域名寻址.</li>
<li>IPFS在整个网络范围内去掉重复的文件, 并且为文件建立版本管理, 也就是说每一个文件的变更历史都将被记录(这一点类似版本控制工具git, svn等), 可以很容易个回到文件的历史版本查看数据.</li>
<li>当查询文件的时候, IPFS网络根据文件的哈希值(全网唯一)进行查找. 由于每个文件的哈希值全网唯一, 查询将很容易进行.</li>
<li>如果仅仅使用哈希值来区分文件的话, 会给传播造成困难, 因为哈希值不容易记忆, 就像ip地址一样不容易记忆, 于是人类发明的域名. IPFS利用IPNS将哈希值映射为容易记的名字</li>
<li>每个节点除了存储自己需要的数据, 还存储了一张哈希表, 用来记录文件存储所在的位置. 用来进行文件的查询下载.</li>
</ol>
<h2 id="ipfs如何解决中心化服务器缺点"><a class="header" href="#ipfs如何解决中心化服务器缺点">IPFS如何解决中心化服务器缺点</a></h2>
<h3 id="1-下载速度快-不再依赖主干网-中心化服务器"><a class="header" href="#1-下载速度快-不再依赖主干网-中心化服务器">1 下载速度快, 不再依赖主干网, 中心化服务器</a></h3>
<p>整个IPFS系统是一个分布式的文件存储系统, 那么在下载相关数据的时候, 将从多个节点同时下载, 相比于HTTP从中心服务器的下载速度要快很多, 大家都用过P2P下载(比如: 迅雷, BitTorrent), IPFS下载过程跟这个类似.</p>
<h3 id="2-存储空间变得非常便宜"><a class="header" href="#2-存储空间变得非常便宜">2 存储空间变得非常便宜</a></h3>
<p>由于IPFS使用的是区块链技术, 利用 Filecoin(也就是挖矿)来激励矿工分享自己的硬盘, 并且IFPS从全网去掉了冗余存储(从整个网络空间考虑, 这将大大节省网络存储空间), 将来的IPFS存储将会变得非常便宜(与我们现在的云盘, 各种中心化的CND相比较).</p>
<h3 id="3-安全"><a class="header" href="#3-安全">3 安全</a></h3>
<p>中心化服务器目前很难抵挡DDoS攻击, 当大量的访问请求从四面八方涌来, 中心化的服务器几乎会在一瞬间瘫痪, 巨大的访问量随时可能造成服务器宕机. IPFS天生就拥有抵挡这种攻击的能力. 因为所有的访问将会被分散到不同的节点. 甚至攻击者自己也是节点之一. 某种程度上讲, IPFS甚至能抵挡量子计算的攻击.</p>
<h3 id="4-开放"><a class="header" href="#4-开放">4 开放</a></h3>
<p>众所周知, 比特币是一种去中心化, 匿名的数据货币, 这些特性使得比特币无法被管制, 交易无法篡改. IPFS同样, 由于是建立在去中心化的分布式网络上的, 所以IFPS很难被中心化管理, 限制. 互联网将更加开放.</p>
<h2 id="ipfs的用途"><a class="header" href="#ipfs的用途">IPFS的用途</a></h2>
<blockquote>
<p>IPFS主要解决现有中心化服务器中的数据存储问题。它能够极大的降低数据存储的成本,提升数据下载速度。</p>
</blockquote>
<blockquote>
<p>那么凡是需要优化数据存储的地方几乎都可以使用IPFS来提升效率</p>
</blockquote>
<blockquote>
<p>下面是一张保存在ipfs网络的图片：</p>
</blockquote>
<p><img src="https://ipfs.io/ipfs/QmdDTor6dWzknFJPJuhJgrUYqd56WkFXYAxyxpEY7kUrEb" alt="" /></p>
<ul>
<li>在 /ipfs 和 /ipns 下面挂载全球文件系统：就是说我们所有的文件都可以存到上面.</li>
<li>挂载个人同步的文件夹, 可以自动进行版本管理, 自动备份. 也就意味着未来我们将拥有无限空间的网盘, 不用担心数据丢失, 不用担心隐私泄露(非对称加密). 国外的dropbox, 跟IPFS云盘相比, 都将变得微不足道 。</li>
<li>作为加密文件和数据共享系统。IPFS天生视乎就具备这样的能力, 文件加密, 数据共享, 都是小菜一碟.</li>
<li>作为带版本控制的软件包管理系统.</li>
<li>作为虚拟机的根文件系统</li>
<li>作为利用管理程序, 把IPFS作为虚拟机的引导文件系统：在线操作系统</li>
<li>作为数据库：应用可以直接操作IPFS的Merkle DAG数据结构, 并且可以使用IPFS的版本控制, 缓存. 试想一下我们的数据库直接存在IPFS的文件系统是什么体验? 自动备份, 永不丢失, 安全加密, 无限空间, 高速连接。</li>
<li>作为加密通讯平台，谁都别想窃听消息通信</li>
<li>作为加密CDN, 作为web的CDN, CDN功能全包.</li>
<li>永久web, 不存在不能访问的链接, 跟 404 说 byebye.</li>
</ul>
<h2 id="ipfs的pow机制"><a class="header" href="#ipfs的pow机制">IPFS的POW机制</a></h2>
<h2 id="ipfs家族"><a class="header" href="#ipfs家族">IPFS家族</a></h2>
<blockquote>
<p><a href="https://protocol.ai/work/">Work | Protocol Labs</a></p>
</blockquote>
<h3 id="main-projects"><a class="header" href="#main-projects">Main Projects</a></h3>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/image-20220618215731222.png" alt="image-20220618215731222" /></p>
<h3 id="contributions"><a class="header" href="#contributions">Contributions</a></h3>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/image-20220618220109640.png" alt="image-20220618220109640" /></p>
<h3 id="movements"><a class="header" href="#movements">Movements</a></h3>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/image-20220618220532130.png" alt="image-20220618220532130" /></p>
<h3 id="ipfs-与-filecoin"><a class="header" href="#ipfs-与-filecoin">IPFS 与 Filecoin</a></h3>
<h4 id="ipfs数据的分发和定位数据传输协议类似http协议"><a class="header" href="#ipfs数据的分发和定位数据传输协议类似http协议">IPFS：数据的分发和定位（数据传输协议，类似HTTP协议）</a></h4>
<ul>
<li>传输：数据在节点之间进行传输</li>
<li>定位：寻址，发现数据的存储位置</li>
<li>存储：自己提供存储（可以保证存储的安全性），其它节点不保证数据存储的安全性</li>
<li>用户：下载数据免费，自己提供服务器，自己搭建节点</li>
<li>存储内容：只存储节点自己感兴趣的内容</li>
</ul>
<h4 id="filecoin-数据存储类似一个云存储"><a class="header" href="#filecoin-数据存储类似一个云存储">Filecoin: 数据存储（类似一个云存储）</a></h4>
<ul>
<li>存储：付费存储，用户付费，矿工和Filecoin网络保证存储的安全性</li>
<li>下载：付费下载，用户付费，矿工负责发送数据</li>
<li>用户：不需要自己提供存储，也不需要自己提供节点</li>
<li>存储内容：收费存储一切</li>
</ul>
<h4 id="ipfs和filecoin共同依赖libp2p项目"><a class="header" href="#ipfs和filecoin共同依赖libp2p项目">IPFS和Filecoin共同依赖libp2p项目。</a></h4>
<blockquote>
<p>Filecoin是IPFS的激励层，二者互补形式一对协议。为我们的互联网提供了很好的基础设施。</p>
</blockquote>
<p>了解上述的基本内容后：</p>
<ul>
<li>如果开发者仅仅想要的是一个安全、快速的云存储，那么选择Filecoin即可。</li>
<li>如果开发者除了数据存储需求，还需要分发数据，那么选择IPFS即可。</li>
<li>如果开发者既有数据存储需求，又有数据的分发需求，那么可以单独选择IPFS，也可以IPFS+Filecoin一起。</li>
</ul>
<blockquote>
<p>注意：IPFS可以做Filecoin的事情，存储，而filecoin并不能做IPFS的事情，数据传输</p>
</blockquote>
<h2 id="使用ipfs的应用"><a class="header" href="#使用ipfs的应用">使用IPFS的应用</a></h2>
<ul>
<li><del><a href="https://github.com/AKASHAorg/Community/releases">akasha</a>： 基于以太坊和IPFS的社交网络</del></li>
<li><del>Alexandria：去中心化的内容发布平台</del></li>
<li><a href="https://github.com/MichaelMure/Arbore">Arbore</a>：朋友之间的文件共享系统--相信很快就可以抛弃某度的云盘了</li>
<li><a href="https://github.com/dtube/dtube">dtube</a>：利用IPFS作为存储的视频分享网站</li>
<li><a href="https://github.com/whyrusleeping/git-ipfs-rehost">git-ipfs-rehost</a>：可以把github上的项目存储到IPFS上</li>
<li><a href="https://github.com/ipfs-search/ipfs-search">ipfs-search</a>：基于IFPS的搜索引擎</li>
<li><a href="https://github.com/ipfs-shipyard/ipfs-share-files">ipfs-share</a>：基于IFPS的文件分享</li>
<li><a href="http://ipfs.pics/">ipfs.pics</a>：基于IFPS的图片分享网站</li>
<li><a href="https://github.com/orbitdb/orbit">Orbit</a>：基于IFPS的分布式聊天工具</li>
<li><a href="https://github.com/BusterLabs/Partyshare">Partyshare</a>：一个简单的文件共享系统</li>
<li>http://computes.io：基于IPFS的分布式计算机（这个牛，把世界上的计算资源收集起来，构建一个巨大的分布式计算机）</li>
<li><a href="https://github.com/OpenBazaar?type=source">OpenBazaar</a>：openbazaar是一个去中心化的淘宝，口号是“买卖自由/Buy and Sell
Freely”，问题是一旦用户停止运行软件，商店就下线了，借助于IPFS，openbazaar2.0 打造一个离线商店。</li>
<li>Ubuntu：著名的linux发行版本Ubuntu正在计算把发行版本转移到IPFS上来，目前正在讨论方案。</li>
</ul>
<blockquote>
<p>更多可在这里查看：
<a href="https://ipfs.io/ipfs/QmUQs8yuYbQ7VbMpRoL6RFz4dMuK4RqCCmPmJc5fK7P4Yc/">Awesome IPFS</a></p>
</blockquote>
<blockquote>
<p>一些过期项目：
<a href="https://github.com/ipfs-inactive?type=source">IPFS Inactive repositories</a></p>
</blockquote>
<h2 id="ipfs网络如何运行"><a class="header" href="#ipfs网络如何运行">IPFS网络如何运行</a></h2>
<h2 id="ipfs-nat-traversal"><a class="header" href="#ipfs-nat-traversal">IPFS: NAT traversal</a></h2>
<h2 id="bitswap"><a class="header" href="#bitswap">BitSwap</a></h2>
<h2 id="ipfs非rust实现版本"><a class="header" href="#ipfs非rust实现版本">IPFS非rust实现版本</a></h2>
<h2 id="参考资源-35"><a class="header" href="#参考资源-35">参考资源</a></h2>
<ul>
<li><a href="https://www.zhihu.com/column/ipfsguide">IPFS指南 - 知乎</a></li>
<li><a href="https://github.com/rs-ipfs/rust-ipfs">rs-ipfs/rust-ipfs: The InterPlanetary File System (IPFS), implemented in Rust.</a></li>
<li><a href="https://opencollective.com/rs-ipfs">Rust IPFS - Open Collective</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/33170031">IPFS网络是如何运行的(p2p网络) - 知乎</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/33057094">IPFS: NAT traversal(NAT穿越) - 知乎</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/33148036">IPFS: BitSwap协议(数据块交换) - 知乎</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/34158682">IPFS非rust实现版本</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="利用ipfs构建自己的去中心化分布式网站"><a class="header" href="#利用ipfs构建自己的去中心化分布式网站">利用IPFS构建自己的去中心化分布式网站</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs_website.html#%E5%88%A9%E7%94%A8ipfs%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%88%86%E5%B8%83%E5%BC%8F%E7%BD%91%E7%AB%99">利用IPFS构建自己的去中心化分布式网站</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs_website.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a></li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:28 UTC 2022 -->
<!--te-->
<h2 id="参考资源-36"><a class="header" href="#参考资源-36">参考资源</a></h2>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/32869413">如何基于IPFS建一个静态网站 - 知乎</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/32682117">如何在IPFS里面上传一张图片 - 知乎</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ipfspubsub功能使用"><a class="header" href="#ipfspubsub功能使用">IPFS：pubsub功能使用</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs_pubsub.html#ipfspubsub%E5%8A%9F%E8%83%BD%E4%BD%BF%E7%94%A8">IPFS：pubsub功能使用</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs_pubsub.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a></li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:28 UTC 2022 -->
<!--te-->
<h2 id="参考资源-37"><a class="header" href="#参考资源-37">参考资源</a></h2>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/36502849">IPFS: pubsub功能的使用 - 知乎</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ipfs伴侣插件使用"><a class="header" href="#ipfs伴侣插件使用">IPFS伴侣插件使用</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs_companion.html#ipfs%E4%BC%B4%E4%BE%A3%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8">IPFS伴侣插件使用</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs_companion.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a></li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:27 UTC 2022 -->
<!--te-->
<h2 id="参考资源-38"><a class="header" href="#参考资源-38">参考资源</a></h2>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/35566466">【应用】IPFS伴侣浏览器插件V2.2.0版本升级的重大意义 - 知乎</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="基于ipfs与ngrok构建网关"><a class="header" href="#基于ipfs与ngrok构建网关">基于IPFS与Ngrok构建网关</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs_ngrok.html#%E5%9F%BA%E4%BA%8Eipfs%E4%B8%8Engrok%E6%9E%84%E5%BB%BA%E7%BD%91%E5%85%B3">基于IPFS与Ngrok构建网关</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/network/ipfs/ipfs_ngrok.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a></li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:27 UTC 2022 -->
<!--te-->
<h2 id="参考资源-39"><a class="header" href="#参考资源-39">参考资源</a></h2>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/35151037">【应用】（入门）基于IPFS和Ngrok构建自维护资源网关 - 知乎</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/35951053">【应用】（进阶）基于IPFS和Ngrok构建自维护资源网关 - 知乎</a> </li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="网络开发"><a class="header" href="#网络开发">网络开发</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="基于rust尝试webassembly"><a class="header" href="#基于rust尝试webassembly">基于Rust尝试WebAssembly</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/web/webassembly_try.html#%E5%9F%BA%E4%BA%8Erust%E5%B0%9D%E8%AF%95webassembly">基于Rust尝试WebAssembly</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/web/webassembly_try.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer5_ecosystem/5_open_source/2_network/web/webassembly_try.html#%E5%85%B3%E4%BA%8E%E5%BA%B7%E5%A8%81%E6%B8%B8%E6%88%8Fconways-game">关于康威游戏(Conway's Game)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:29 UTC 2022 -->
<!--te-->
<h2 id="参考资源-40"><a class="header" href="#参考资源-40">参考资源</a></h2>
<ul>
<li><a href="https://rustwasm.github.io/docs/book/introduction.html">Introduction - Rust and WebAssembly</a></li>
<li><a href="https://web.archive.org/web/20220628021752/https://mp.weixin.qq.com/s/pEvCIZUmQkxBpgfG1IjWeQ">Rust和WebAssembly初体验</a></li>
<li><a href="https://web.archive.org/web/20220628021759/https://mp.weixin.qq.com/s/yZ-oeM8gvqaDLxbyHMq3cQ">安装Rust和WebAssembly工具链和helloworld</a></li>
<li><a href="https://web.archive.org/web/20220628021820/https://mp.weixin.qq.com/s/H-hXqMJ34rWgSGZU_WBBTA">Rust Assembly之实现康威生命游戏</a></li>
<li><a href="https://web.archive.org/web/20220628021845/https://mp.weixin.qq.com/s/RINEWLkLOXEAbzw_ZuZiyA">康威游戏之优化</a></li>
<li><a href="https://web.archive.org/web/20220628021902/https://mp.weixin.qq.com/s/Y_PL_rhLzdv4yXFNjrRNgw">Web Assembly之测试康威游戏代码</a></li>
<li><a href="https://web.archive.org/web/20220628021918/https://mp.weixin.qq.com/s/8GcasoM-K-T9EXY7LMuKnQ">Web Assembly之调试方法</a></li>
<li><a href="https://web.archive.org/web/20220628063042/https://mp.weixin.qq.com/s/3nn8on2ubRccgZxM8h2TJQ">Web Assembly康威游戏添加交互</a></li>
<li><a href="https://web.archive.org/web/20220628021938/https://mp.weixin.qq.com/s/t00GVCtN6iDKqlCi7zcA1A">Web Assembly之性能分析</a></li>
</ul>
<h3 id="关于康威游戏conways-game"><a class="header" href="#关于康威游戏conways-game">关于康威游戏(Conway's Game)</a></h3>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Conway's Game of Life - Wikipedia</a></li>
<li><a href="https://playgameoflife.com/">Play John Conway’s Game of Life</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/261431820">学术干货 | Conway’s Game of Life 生命游戏的建筑设计应用 - 知乎</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="音视频处理"><a class="header" href="#音视频处理">音视频处理</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="游戏与图像处理"><a class="header" href="#游戏与图像处理">游戏与图像处理</a></h1>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="rust与其他编程语言"><a class="header" href="#rust与其他编程语言">Rust与其他编程语言</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="科学艺术研究"><a class="header" href="#科学艺术研究">科学艺术研究</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="其他工具"><a class="header" href="#其他工具">其他工具</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="安全参考"><a class="header" href="#安全参考">安全参考</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="商业观察"><a class="header" href="#商业观察">商业观察</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="区块链"><a class="header" href="#区块链">区块链</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#%E5%8C%BA%E5%9D%97%E9%93%BE">区块链</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#layers">Layers</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#osi%E7%BD%91%E7%BB%9C%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B">OSI网络七层模型</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#%E6%95%B0%E6%8D%AE%E5%B1%82">数据层</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#%E7%BD%91%E7%BB%9C%E5%B1%82">网络层</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#%E5%85%B1%E8%AF%86%E5%B1%82">共识层</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#%E5%B7%A5%E4%BD%9C%E9%87%8F%E8%AF%81%E6%98%8E%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6-pow-">工作量证明共识机制（ PoW ）</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#%E6%BF%80%E5%8A%B1%E5%B1%82">激励层</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#%E5%90%88%E7%BA%A6%E5%B1%82">合约层</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#%E5%BA%94%E7%94%A8%E5%B1%82">应用层</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#blockchains">Blockchains</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#blockchain-frameworks">Blockchain Frameworks</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#cross-chain">Cross-Chain</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#virtual-machines">Virtual Machines</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#general-purpose-consensus">General-Purpose Consensus</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#p2p-network-libraries">P2P Network Libraries</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#cryptography">Cryptography</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#layer2">Layer2</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#dapps">Dapps</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#other">Other</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#online-book">online-book</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#fragment">fragment</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/blockchain.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:33 UTC 2022 -->
<!--te-->
<h2 id="layers"><a class="header" href="#layers">Layers</a></h2>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/df67d027097043d3d1c8b180558bb3cc.png" alt="img" /></p>
<h3 id="osi网络七层模型"><a class="header" href="#osi网络七层模型">OSI网络七层模型</a></h3>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/640.png" alt="图片" /></p>
<blockquote>
<p>下图详细说明了各层作用</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/640-20220621104210621.png" alt="图片" /></p>
<p>实际应用过程中，五层协议结构里面是没有表示层和会话层的。应该说它们和应用层合并了。</p>
<h3 id="数据层"><a class="header" href="#数据层">数据层</a></h3>
<p>区块链是通过区块（block）存储数据，每个数据节点之间都包含所有数据，即分布式账本。每个区块都包括了区块的大小、区块头、区块所包含的交易数量及部分或所有的近期新交易。</p>
<p>数据层主要是解决这些数据以什么样的形式组合在一起，形成一个有意义的区块。</p>
<p>区块链的数据结构中包括两种哈希指针，它们均是不可篡改特性的数据结构基础。</p>
<ol>
<li>
<p>一个是形成“区块+链”（block+chain）的链状数据结构</p>
</li>
<li>
<p>另一个是哈希指针形成的梅克尔树（如下图所示）。</p>
</li>
</ol>
<div id="admonition-用处" class="admonition tip">
<div class="admonition-title">
<p>用处</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/blockchain.html#admonition-用处"></a></p>
</div>
<div>
<p>链状数据结构使得对某一区块内的数据的修改很容易被发现；
梅克尔树的结构起类似作用，使得对其中的任何交易数据的修改很容易被发现。</p>
</div>
</div>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/9b432d8f0369921e21ac33f14c2bdeda.png" alt="img" /></p>
<h3 id="网络层"><a class="header" href="#网络层">网络层</a></h3>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/b93a9b3345d59f5e13c0ec662a46f05a.png" alt="img" /></p>
<p>区块链使用的是去中心化的网络架构，没有中心化服务器，依靠用户点对点交换信息，主要包括 P2P 组网机制、数据传播和验证机制。</p>
<div id="admonition-p2p特性" class="admonition tip">
<div class="admonition-title">
<p>P2P特性</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/blockchain.html#admonition-p2p特性"></a></p>
</div>
<div>
<p>正是由于节点的 P2P 特性，数据传输是分散在各个节点之间进行的，部分节点或网络遭到破坏对其他部分影响很小。</p>
</div>
</div>
<p>节点指的是区块链客户端软件（比如比特币客户端、以太坊客户端），一般分为全节点和轻节点，全节点包含了所有区块链的区块数据，轻节点仅包括与自己相关的数据。</p>
<h3 id="共识层"><a class="header" href="#共识层">共识层</a></h3>
<p>共识层的功能是让高度分散的节点在 P2P 网络中，针对区块数据的有效性达成共识，决定了谁可以将新的区块添加到主链中（挖矿机制）。</p>
<h4 id="工作量证明共识机制-pow-"><a class="header" href="#工作量证明共识机制-pow-">工作量证明共识机制（ PoW ）</a></h4>
<div id="admonition-pow" class="admonition info">
<div class="admonition-title">
<p>PoW</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/blockchain.html#admonition-pow"></a></p>
</div>
<div>
<p>矿工需要将网络中未确认的交易按梅克尔树组装成候选区块，在候选区块的头部有一个 32位的随机数区域，矿工需要反复调整随机数并计算，目标是让整个区块的哈希值小于一个“目标值”，谁先完成这个目标谁就有权力将交易记录到区块链分布式账本中并获得一定的奖励。</p>
</div>
</div>
<p>挖矿的过程比拼的就是各个矿工节点的算力，可以变相认为谁的算力高谁的工作量就高，就有权力记账和获得奖励。</p>
<ul>
<li>比特币使用的是 PoW 机制；</li>
<li>以太坊开始使用的是 PoW 机制，后来改成了 PoS 机制，原因是该机制交易速度更快、资源消耗更低。</li>
</ul>
<p>这种挖矿计算是非对称的，挖矿可能需要经过许多次哈希计算，而要验证的确找到有效的随机数，只需要一次计算就可以，因此其他节点能够很快验证交易是否已经被记入账本。</p>
<h3 id="激励层"><a class="header" href="#激励层">激励层</a></h3>
<p>激励层的功能主要是提供一些激励措施，鼓励节点参与记账，保证整个网络的安全运行。通过共识机制胜出取得记账权的节点能获得一定的奖励。</p>
<p>目前比特币的激励措施是新区块产生时系统会奖励矿工一定的比特币（系统产生的新比特币，也会记录在分布式账本，来源地址是 0，因此整个过程叫挖矿），奖励最初是 50 个比特币，每四年减半一次，分别为 25 个、12.5
个，以此类推。当比特币数量达到 2100 万枚的上限后（2140 年），激励就全靠交易的手续费了。以太坊交易是靠 gas 手续费来激励矿工。</p>
<h3 id="合约层"><a class="header" href="#合约层">合约层</a></h3>
<p>合约层封装了各类脚本、算法和智能合约，使得区块链具有可编程能力。例如，<strong>比特币的脚本</strong>中就规定了比特币的交易方式和过程中的种种细节，不过这种脚本使用不够便捷且不是图灵完备的。</p>
<p>以太坊提出了智能合约的解决方案，提供了一种图灵完备的高级编程语言来编写智能合约，并使智能合约能够运行在分布式的以太坊虚拟机 EVM 上。</p>
<div id="admonition-智能合约" class="admonition tip">
<div class="admonition-title">
<p>智能合约</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/blockchain.html#admonition-智能合约"></a></p>
</div>
<div>
<p>智能合约就是存储在区块链上的一段代码，它们可以被区块链上的交易所触发，触发后，这段代码可以从区块链上读取数据或者向区块链上写入数据。</p>
</div>
</div>
<p>区块链系统（比特币、以太坊）可以认为是一个分布式状态机，通过交易触发合约（脚本、智能合约）运行来改变状态机的状态。</p>
<h3 id="应用层"><a class="header" href="#应用层">应用层</a></h3>
<p>应用层封装了区块链的各种应用场景，具体应用可参见<strong>90+ #Ethereum Apps You Can Use Right Now</strong>。</p>
<p>以下为一笔比特币转账交易的过程</p>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/e6b83641ed6467b392d04a3e6fe69492.png" alt="img" /></p>
<h2 id="blockchains"><a class="header" href="#blockchains">Blockchains</a></h2>
<ul>
<li><a href="https://developer.aleo.org/aleo/getting_started/overview">Aleo</a>. Leo is a rust flavoured zk language.</li>
<li><a href="https://alephzero.org/">Aleph Zero</a>. DAG, PoS, snark smart contracts (substrate based).</li>
<li><a href="https://anoma.network/">Anoma.network</a>. PoS blockchain with privacy.</li>
<li><a href="https://github.com/be-cash/bitcoin-cash">Bitcoin Cash</a>. A library for creating and parsing Bitcoin Cash trasactions.</li>
<li><a href="https://github.com/cryptape/cita">CITA</a>. A high performance blockchain kernel for enterprise users.</li>
<li><a href="https://github.com/CodeChain-io/codechain">CodeChain</a>. Programmable multi-asset chain.</li>
<li><a href="https://concordium.com/">Concordium</a>. Privacy centric (zk) PoS chain, yet with built in identities and rust smart
contracts.</li>
<li><a href="https://github.com/Conflux-Chain/conflux-rust">Conflux</a>. The Rust implementation of Conflux protocol.</li>
<li><a href="https://github.com/darwinia-network/darwinia">Darwinia</a>. Relay chain of Darwinia Network, can connect to Polkadot as
parachain in Polkadot Model.</li>
<li><a href="https://dusk.network/">Dusk.network</a>. Privacy PoS using zk (plonk).</li>
<li><a href="https://github.com/enigmampc/enigma-core">Enigma</a> secures the decentralized web.</li>
<li><a href="https://elrond.com/">Elrond</a>. Elrond (EGOLD( - scalable and usable blockchain, written is Rust and has smart
contracts in Rust.</li>
<li><a href="https://github.com/exonum/exonum">Exonum</a>. An extensible open-source framework for creating private/permissioned
blockchain applications.</li>
<li><a href="https://github.com/ChainSafe/forest">Forest</a>. An implementation of Filecoin written in Rust.</li>
<li><a href="https://github.com/FuelLabs/fuel-core">Fuel</a>. Rust full node implementation of the Fuel v2 protocol.</li>
<li><a href="https://github.com/gear-tech/gear">Gear</a>. Computational component of Polkadot network.</li>
<li><a href="https://github.com/mimblewimble/grin">Grin</a>. Minimal implementation of the MimbleWimble protocol.</li>
<li><a href="https://github.com/holochain/holochain">Holochain</a>. The core Holochain framework written in rust, a container, and
hdk-rust library for writing Zomes.</li>
<li><a href="https://github.com/HuobiGroup/huobi-chain">Huobi Chain</a>. The next generation high performance public chain for
financial infrastructure.</li>
<li><a href="https://github.com/interledger-rs/interledger-rs">Interledger</a>. An easy-to-use, high-performance Interledger
implementation written in Rust.</li>
<li><a href="https://github.com/Internet-of-People/iop-rs">Internet of People</a>. Decentralized software stack that provides the
building blocks and tools to support a decentralized society.</li>
<li><a href="https://github.com/libra/libra">Libra</a>. Global currency and financial infrastructure that empowers billions of
people.</li>
<li><a href="https://github.com/sigp/lighthouse">Lighthouse</a>. Fast and secure Ethereum 2.0 client.</li>
<li><a href="https://github.com/nearprotocol/nearcore">NEAR</a>. NEAR Protocol - scalable and usable blockchain.</li>
<li><a href="https://github.com/nervosnetwork/ckb">Nervos CKB</a>. Nervos CKB is a public permissionless blockchain, the common
knowledge layer of Nervos network.</li>
<li><a href="https://github.com/nymtech/nym">NYM</a>. Selective privacy via a mixnet preventing metadata analysis.</li>
<li><a href="https://github.com/nomic-io/nomic">Nomic</a>. Nomic is a high-performance Bitcoin sidechain which is part of the Cosmos
network.</li>
<li><a href="https://github.com/ChainSafe/mina-rs">Mina Protocol</a>. A rust implementation of the mina succinct blockchain.</li>
<li><a href="https://mirprotocol.org/">Mir Protocol</a>. A succinct blockchain powered by zero-knowledge proofs. (plonk based)</li>
<li><a href="https://github.com/openethereum/openethereum">OpenEthereum</a>. The Ethereum Rust client</li>
<li><a href="https://github.com/paritytech/parity-bitcoin">Parity Bitcoin</a>. The Parity Bitcoin client.</li>
<li><a href="https://github.com/paritytech/parity-ethereum">Parity Ethereum</a>. The fast, light, and robust EVM and WASM client.</li>
<li><a href="https://github.com/paritytech/parity-zcash">Parity Zcash</a>. Rust implementation of Zcash protocol.</li>
<li><a href="https://github.com/paritytech/polkadot">Polkadot</a>. Polkadot Node Implementation.</li>
<li><a href="https://github.com/PolymathNetwork/Polymesh">Polymesh</a>. The Polymesh blockchain (built on Substrate) is an identity
orientated chain for the issuance, lifecycle management and settlement of regulated securities.</li>
<li><a href="https://github.com/QANplatform/its_alive">QAN</a>. Post-quantum blockchain.</li>
<li><a href="https://github.com/radixdlt/radixdlt-scrypto">Radix</a>. Sharded smart contract DeFi platform.</li>
<li><a href="https://github.com/Setheum-Labs/Setheum">Setheum</a>. SETHEUM : “Secure Evergreen Truthful Heterogeneous Economically
Unbiased Market” is an Ethical DeFi-friendly Blockchain (built on Substrate) working on achieving mass adoption,
security, scalability, affordability, inclusivity and ethical DeFi Governance.</li>
<li><a href="https://github.com/paritytech/shasper">Shasper</a>. Parity Shasper beacon chain implementation using the Substrate
framework.</li>
<li><a href="https://github.com/solana-labs/solana">Solana</a>. Blockchain Rebuilt for Scale.</li>
<li><a href="https://github.com/blockstack/stacks-blockchain">Stacks 2.0</a>. Proof of Transfer blockchain from Blockstack.</li>
<li><a href="https://github.com/tari-project">Tari</a>. The Tari Digital Assets Protocol.</li>
<li><a href="https://github.com/informalsystems/tendermint-rs">Tendermint</a>. Tendermint is a high-performance blockchain consensus
engine for Byzantine fault tolerant applications.</li>
<li><a href="https://github.com/witnet/witnet-rust">Witnet</a>. Open source implementation of Witnet decentralized oracle network
protocol in Rust.</li>
<li><a href="https://github.com/xx-labs/xxchain">xx-network</a>. Post-quantum blockchain, mixnet privacy preventing metadata
analysis. (Substrate rust+go)</li>
<li><a href="https://github.com/ZcashFoundation/zebra">Zebra</a>. An ongoing Rust implementation of a Zcash node.</li>
<li><a href="https://github.com/LayerXcom/zero-chain">Zero-chain</a>. A privacy-preserving blockchain on Substrate.</li>
</ul>
<h2 id="blockchain-frameworks"><a class="header" href="#blockchain-frameworks">Blockchain Frameworks</a></h2>
<ul>
<li><a href="https://github.com/paritytech/substrate">Substrate</a>. The platform for blockchain innovators.</li>
<li><a href="https://github.com/stellar/slingshot">slingshot</a>. A new blockchain architecture under active development, with a
strong focus on scalability, privacy and safety.</li>
<li><a href="https://github.com/tendermint/rust-abci">Tendermint ABCI</a>. Tendermint ABCI server, written in the Rust programming
language.</li>
<li><a href="https://github.com/nomic-io/orga">Orga</a>. A high-performance state machine engine designed for Tendermint-based
blockchain applications.</li>
</ul>
<h2 id="cross-chain"><a class="header" href="#cross-chain">Cross-Chain</a></h2>
<ul>
<li><a href="https://comit.network/">Comit</a> is an open protocol facilitating trustless cross-blockchain applications.</li>
<li><a href="https://github.com/informalsystems/ibc-rs">IBC</a>. Rust implementation of Cosmos' Interblockchain Communication
Protocol
(IBC).</li>
</ul>
<h2 id="virtual-machines"><a class="header" href="#virtual-machines">Virtual Machines</a></h2>
<ul>
<li><a href="https://github.com/nervosnetwork/ckb-vm">CKB-VM</a>. RISC-V virtual machine.</li>
<li><a href="https://www.cosmwasm.com">CosmWasm</a>. Multi-chain smart contract platform built for the Cosmos ecosystem.</li>
<li><a href="https://github.com/paritytech/parity-ethereum/tree/master/evmbin">EVM Parity</a>. Parity implementation of EVM.</li>
<li><a href="https://github.com/FuelLabs/fuel-vm">FuelVM</a>
FuelVM interpreter in Rust.</li>
<li><a href="https://github.com/lunatic-solutions/lunatic">Lunatic</a>. Erlang-inspired runtime for WebAssembly.</li>
<li><a href="https://github.com/maticnetwork/miden">Polygon Miden</a>. SNARK based VM.</li>
<li><a href="https://github.com/spacemeshos/svm">SVM</a>
Spacemesh Virtual Machine.</li>
<li><a href="https://github.com/paritytech/wasmi">Wasmi</a>. WebAssembly interpreter.</li>
<li><a href="https://wasmer.io/">Wasmer</a>. A convenient Rust wrapper over WebAssembly backends.</li>
<li><a href="https://github.com/CraneStation/wasmtime">Wasmtime</a>. Standalone JIT-style runtime for WebAssembly, using Cranelift.</li>
<li><a href="https://github.com/matter-labs/zinc">Zinc</a>. Zinc zk smart contract language.</li>
</ul>
<h2 id="general-purpose-consensus"><a class="header" href="#general-purpose-consensus">General-Purpose Consensus</a></h2>
<ul>
<li><a href="https://github.com/pingcap/raft-rs">Raft</a>. Raft distributed consensus algorithm implemented in Rust.</li>
<li><a href="https://github.com/poanetwork/hbbft">Honey Badger</a>. An implementation of the paper &quot;Honey Badger of BFT Protocols&quot; in
Rust.</li>
<li><a href="https://github.com/MystenLabs/narwhal">Narwhal</a>. The consensus layer used by Sui.</li>
</ul>
<h2 id="p2p-network-libraries"><a class="header" href="#p2p-network-libraries">P2P Network Libraries</a></h2>
<ul>
<li><a href="https://github.com/placefortea/chamomile">chamomile</a>. P2P library. Support build robust stable connection on
p2p/distributed network.</li>
<li><a href="https://github.com/maidsafe/crust">crust</a>. Reliable P2P network connections in Rust with NAT traversal. One of the
most needed libraries for any server-less / decentralised projects.</li>
<li><a href="https://github.com/libp2p/rust-libp2p">rust-libp2p</a>. The Rust Implementation of the libp2p networking stack.</li>
<li><a href="https://github.com/driftluo/tentacle">Tentacle</a>. A multiplexed p2p network framework that supports custom protocols</li>
<li><a href="https://github.com/ustulation/p2p">P2P NAT-Traversal</a>. NAT Traversal techniques for p2p communication.</li>
<li><a href="https://github.com/maidsafe/qp2p">qp2p</a>. Peer-to-peer communications library for Rust based on QUIC protocol.</li>
<li><a href="https://github.com/maidsafe/sn_routing">sn_routing</a>. Routing - specialised storage DHT.</li>
</ul>
<h2 id="cryptography"><a class="header" href="#cryptography">Cryptography</a></h2>
<ul>
<li><a href="https://github.com/rust-cc/awesome-cryptography-rust">Awesome Cryptography Rust</a>.</li>
<li><a href="https://github.com/dalek-cryptography">Dalek Cryptography</a>.</li>
<li><a href="https://github.com/adria0/za">Za!</a>. An experimental rust zksnarks compiler with embeeded bellman-bn128 prover.</li>
<li><a href="https://github.com/0xProject/OpenZKP">OpenZKP</a>. Pure Rust implementations of Zero-Knowledge Proof systems.</li>
<li><a href="https://github.com/microsoft/Nova">Microsoft Nova</a>. Rust recursive snark without trusted setup.</li>
<li><a href="https://github.com/arkworks-rs">Arkworks</a>. An ecosystem for developing and programming with zkSNARKs</li>
</ul>
<h2 id="layer2"><a class="header" href="#layer2">Layer2</a></h2>
<ul>
<li><a href="https://github.com/OffchainLabs/arb-os">Arbitrum's arb-os</a>
ArbOS is the &quot;operating system&quot; that runs an eth Layer 2 on an Arbitrum chain,</li>
<li><a href="https://github.com/noir-lang/noir">Noir language</a>. Noir is a Domain Specific Language for SNARK proving systems. (
Aztec eth L2)</li>
<li><a href="https://penumbra.zone/">Penumbra</a>. PoS network providing privacy to the Cosmos ecosystem.</li>
<li><a href="https://github.com/rust-bitcoin/rust-lightning">Rust-Lightning</a>
is a Bitcoin Lightning library written in Rust. The main crate, lightning, does not handle networking, persistence, or
any other I/O. Thus, it is runtime-agnostic, but users must implement basic networking logic, chain interactions, and
disk storage.</li>
<li><a href="https://github.com/matter-labs/zksync">zkSync</a>. Matter Labs' scaling eth L2 engine secured by zero-knowledge proofs.</li>
</ul>
<h2 id="dapps"><a class="header" href="#dapps">Dapps</a></h2>
<ul>
<li><a href="https://github.com/project-serum/serum-dex">Serum-dex</a>. A decentralized exchange built on Solana.</li>
<li><a href="https://github.com/second-state/SewUp">SewUp</a>. A library to help you build your Ethereum webassembly contract with
Rust and just like develop in a common backend.</li>
</ul>
<h2 id="other"><a class="header" href="#other">Other</a></h2>
<ul>
<li><a href="https://github.com/iqlusioninc/abscissa">abscissa</a>. Micro-framework for CLI tools with strong focus on security.</li>
<li><a href="https://github.com/adria0/tesseracts">tesseracts</a>. A small block explorer for geth PoAs written in rust.</li>
<li><a href="https://github.com/nomic-io/merk">merk</a>. High performance Merkle key/value store written in Rust, based on RocksDB.</li>
</ul>
<h2 id="参考资源-41"><a class="header" href="#参考资源-41">参考资源</a></h2>
<h3 id="online-book-37"><a class="header" href="#online-book-37">online-book</a></h3>
<h3 id="fragment-37"><a class="header" href="#fragment-37">fragment</a></h3>
<ul>
<li><a href="https://web.archive.org/web/20220620094224/https://jishuin.proginn.com/p/763bfbd79e0a">Web3.0开发入门-技术圈</a></li>
<li><a href="https://github.com/rust-in-blockchain/awesome-blockchain-rust">rust-in-blockchain/awesome-blockchain-rust: Collect libraries and packages about blockchain/cryptography in Rust</a></li>
<li><a href="https://mp.weixin.qq.com/s/jeoJeL7P7Q4J2vrIKVB5ZA">有了HTTP，为什么还要RPC？</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain//layer5_ecosystem/7_business/blockchain/build-a-block-in-rust.html">使用rust建立一个简单的区块链</a></li>
</ul>
<h3 id="local-37"><a class="header" href="#local-37">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="使用rust建立一个简单的区块链"><a class="header" href="#使用rust建立一个简单的区块链">使用rust建立一个简单的区块链</a></h1>
<h2 id="参考资源-42"><a class="header" href="#参考资源-42">参考资源</a></h2>
<h3 id="online-book-38"><a class="header" href="#online-book-38">online-book</a></h3>
<h3 id="fragment-38"><a class="header" href="#fragment-38">fragment</a></h3>
<ul>
<li><a href="https://blog.logrocket.com/how-to-build-a-blockchain-in-rust/">How to build a blockchain in Rust - LogRocket Blog</a></li>
</ul>
<h3 id="local-38"><a class="header" href="#local-38">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="substrate介绍与源码解读-1"><a class="header" href="#substrate介绍与源码解读-1">Substrate介绍与源码解读</a></h1>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/what_is_substrate.png" alt="what_is_substrate" /></p>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate%E4%BB%8B%E7%BB%8D%E4%B8%8E%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB">Substrate介绍与源码解读</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#gavin-wookpolkadot-and-substrate">Gavin Wook、Polkadot and Substrate</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#gavin-wook%E4%B8%8E%E6%B3%A2%E5%8D%A1%E8%B7%A8%E9%93%BE">Gavin Wook与波卡跨链</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E4%BB%8E%E6%B3%A2%E5%8D%A1%E5%88%B0substrate">从波卡到Substrate</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E8%B7%A8%E9%93%BE%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7">跨链的重要性</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1">总体设计</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%B8%B8%E8%A7%81%E5%8C%BA%E5%9D%97%E9%93%BE%E8%AE%BE%E8%AE%A1">常见区块链设计</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%8C%BA%E5%9D%97%E9%93%BE%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86">区块链系统基础部分</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E9%93%BE%E7%9A%84%E5%8A%9F%E8%83%BD">链的功能</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate%E7%90%86%E5%BF%B5">Substrate理念</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%85%88%E8%AE%A4%E8%AF%86%E4%B8%80%E4%B8%8B%E4%BB%80%E4%B9%88%E6%98%AF%E5%8C%BA%E5%9D%97%E9%93%BE%E6%A1%86%E6%9E%B6">先认识一下：什么是区块链框架</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E6%8E%A5%E7%9D%80%E8%AF%B4%E8%AF%B4substrate%E4%B8%8Eweb3">接着说说Substrate与web3</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E7%94%A8web%E6%A1%86%E6%9E%B6%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E7%B1%BB%E6%AF%94">用web框架、游戏引擎类比</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate-architecture">Substrate Architecture</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%BC%80%E5%8F%91%E8%80%85%E5%8F%AA%E9%9C%80%E8%A6%81%E5%85%B3%E6%B3%A8runtime%E9%93%BE%E5%8A%9F%E8%83%BD">开发者只需要关注Runtime(链功能)</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E6%98%8E%E6%99%B0runtime">明晰Runtime</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%88%A4%E6%96%AD%E6%A0%87%E5%87%86">判断标准</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate%E7%9A%84runtime">Substrate的Runtime</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E4%B8%AD%E5%BF%83%E5%8C%96%E5%8D%87%E7%BA%A7%E6%B5%81%E7%A8%8B">中心化升级流程</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E6%97%A0%E5%A4%AE%E5%8C%96%E5%8D%87%E7%BA%A7%E6%B5%81%E7%A8%8B%E5%8E%9F%E5%85%88">无央化升级流程(原先)</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate%E7%9A%84%E4%B8%8D%E5%90%8C">Substrate的不同</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%90%88%E7%BA%A6%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5">以太坊合约更新策略</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate%E5%AF%B9%E5%BA%94%E5%90%88%E7%BA%A6%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5">Substrate对应‘合约更新策略’</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84">项目结构</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9E%B6%E6%9E%84">客户端架构</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E6%9E%B6%E6%9E%84%E5%9B%BE">架构图</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E6%A8%A1%E5%9D%97%E8%AF%B4%E6%98%8E">模块说明</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%AD%98%E5%82%A8">存储</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#runtime">Runtime</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#p2p%E7%BD%91%E7%BB%9C">p2p网络</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%85%B1%E8%AF%86">共识</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#rpc">RPC</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#telemetry-%E9%81%A5%E6%B5%8B">telemetry （遥测）</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#tree-level1">Tree Level1</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E7%94%A8cargo%E7%BB%84%E7%BB%87%E4%BB%A3%E7%A0%81">用Cargo组织代码</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E4%B8%BB%E8%A6%81%E9%83%A8%E5%88%86%E4%BB%8B%E7%BB%8Dnodeframecore">主要部分介绍：Node、Frame、Core</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate-node">Substrate Node:</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E9%87%8D%E7%82%B9%E8%AF%B4%E8%AF%B4nodepallets%E5%92%8Cruntime">重点说说node、pallets和runtime</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate-frame">Substrate FRAME</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#substrate-coreclient">Substrate Core(client)</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%85%B6%E4%BB%96">其他</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#primitives">primitives</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#scriptsci">scripts/ci</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#utils">utils</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%8A%9F%E8%83%BD%E9%80%BB%E8%BE%91">功能逻辑</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E7%89%B9%E8%89%B2%E4%BB%A3%E7%A0%81">特色代码</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#online-book">online-book</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#fragment">fragment</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#runtime-1">Runtime</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:37 UTC 2022 -->
<!--te-->
<h2 id="gavin-wookpolkadot-and-substrate-1"><a class="header" href="#gavin-wookpolkadot-and-substrate-1">Gavin Wook、Polkadot and Substrate</a></h2>
<h3 id="gavin-wook与波卡跨链-1"><a class="header" href="#gavin-wook与波卡跨链-1">Gavin Wook与波卡跨链</a></h3>
<p>所以对于开发人员来说，比起大家耳熟能详的v神(Vitalik Buterin)，更重要的人是实际上撑起整个以太坊世界的灵魂人物<strong>Gavin Wood</strong>。更何况很多山寨币实际上就是在以太坊的模型上修修改改，所以在我看来Gavin
Wood是撑起了当前半个区块链世界的人。</p>
<p>而Gavin Wood 离开了以太坊之后，开启的一个新项目叫做Polkadot(波卡)，这个项目的<strong>目的就是跨链，为了把各个割裂的区块链孤岛能够联系一起</strong>
。虽然目前有很多的项目都号称自己在做跨链，但是目前在我看来唯一在推进，逻辑上是可推理，之后可能成功的跨链项目就只有波卡能够成功。（后半段可能存在一定误导性，Polkadot的跨链可能在大部分人理解下应该是分片的变种，也就是基于Substrate开发的区块链可以部署到Polkadot上，经过Polkadot平台互相沟通）。</p>
<h3 id="从波卡到substrate-1"><a class="header" href="#从波卡到substrate-1">从波卡到Substrate</a></h3>
<p>而Gavin Wood 在开发的波卡的过程中，经过不断地思考，认为其实区块链发展这几年，大家做的很多事情都是相同的。</p>
<div id="admonition-抽离共同点开始造轮子" class="admonition abstract">
<div class="admonition-title">
<p>抽离共同点，开始造&quot;轮子&quot;</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-抽离共同点开始造轮子"></a></p>
</div>
<div>
<p>那么在以往的软件开发中，当大家发现大家都在做相同的事情的时候，就会将这件事情进行抽象，然后造“轮子”，将这些高层次的东西做封装，成为“开发框架”，将背后复杂的基础设施都封装起来，而使用这个“框架”的开发人员，就可以更加专注于自己的业务逻辑，而不必花费大量的精力去造“轮子”去完成那些每个链都要做的事情。</p>
</div>
</div>
<p>Gavin Wood 在开发波卡的中途先暂停了波卡的开发，将波卡及以太坊已有的成果进行抽象，命名为substrate作为区块链开发的基础框架，并把全部精力都转移到了substrate开发中。</p>
<div id="admonition-第一个轮子" class="admonition tip">
<div class="admonition-title">
<p>第一个轮子</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-第一个轮子"></a></p>
</div>
<div>
<p>所以“substrate”就是区块链世界的第一个“轮子”。</p>
</div>
</div>
<h3 id="跨链的重要性-1"><a class="header" href="#跨链的重要性-1">跨链的重要性</a></h3>
<p>另一方面，在软件开发领域或者互联网领域，大家其实都发现了占据了框架的地位实际上一定程度上占据了这个领域开发的生态，更何况对于跨链来说，当大家的链都比较同质化后，跨链会更加的方便。现在大家都把跨链当作区块链下一个引爆点，而跨链的属性界定了做“跨链”的人基本上只能一家独大，成为垄断地位。而接入跨链的链越多，这个跨链就越垄断(
因为大家使用跨链就是为了在不同的链之间兑换代币，能换的代币越多，使用这个跨链的人就越多，生态就越集中)，</p>
<p>而Gavin Wood 提供的substrate框架又<strong>能解决大部分链都在重复解决的问题</strong>，所以大家就更倾向于使用substrate开发自己的链。</p>
<div id="admonition-三角关系" class="admonition quote">
<div class="admonition-title">
<p>三角关系</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-三角关系"></a></p>
</div>
<div>
<p>这样就会在“用户-链-跨链”这个三角关系中将三方的利益绑定在一起，互惠互利，共同进步。</p>
</div>
</div>
<h2 id="总体设计-1"><a class="header" href="#总体设计-1">总体设计</a></h2>
<h3 id="常见区块链设计-1"><a class="header" href="#常见区块链设计-1">常见区块链设计</a></h3>
<p>目前所有的区块链系统几乎都是从比特币/以太坊模型演变而来。一般来说，一个区块链系统应该具有：</p>
<h4 id="区块链系统基础部分-1"><a class="header" href="#区块链系统基础部分-1">区块链系统基础部分</a></h4>
<ul>
<li>共识系统 （区块链分布式基石）</li>
<li>p2p连接与广播系统</li>
<li>存储系统</li>
<li>交易池系统</li>
<li>rpc系统（区块链与外界交互主要通道）</li>
</ul>
<div id="admonition-基础通用" class="admonition info">
<div class="admonition-title">
<p>基础通用</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-基础通用"></a></p>
</div>
<div>
<p>基础部分是当前区块链模型下都会具备的组件，其中共识与P2P体现区块链的分布式本质</p>
</div>
</div>
<h4 id="链的功能-1"><a class="header" href="#链的功能-1">链的功能</a></h4>
<div id="admonition-竞争关键" class="admonition info">
<div class="admonition-title">
<p>竞争关键</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-竞争关键"></a></p>
</div>
<div>
<p>链功能是区块链间相互竞争的关键部分. 与系统基础部分相比，这部分差异很大，提供的是除去区块链模型外，这条链能够提供的功能。另一方面在区块链升级中，一般来说系统基础部分改动较小，而链的功能部分改动较大，特别是许多链为了追求开发速度，一开始只能提供转账功能，在后续的版本中才慢慢升级其他功能</p>
</div>
</div>
<p>例如：</p>
<ul>
<li>比特币的UTXO结构加上交易脚本</li>
<li>以太坊的虚拟机与智能合约</li>
<li>eos的账户系统及虚拟机</li>
<li>有的山寨币特化部分智能合约或部分native层成为系统级功能：
<ul>
<li>提供随机数</li>
<li>提供质押对赌</li>
<li>oracle数据输入</li>
<li>引入复杂密码学方案</li>
<li>等等。。。</li>
</ul>
</li>
</ul>
<h4 id="substrate理念-1"><a class="header" href="#substrate理念-1">Substrate理念</a></h4>
<div id="admonition-分离变与不变" class="admonition tip">
<div class="admonition-title">
<p>分离变与不变</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-分离变与不变"></a></p>
</div>
<div>
<p>Substrate作为一个区块链框架，认为所有的链都应该具备区块链系统基础部分，而由开发者自由定制链的功能部分</p>
</div>
</div>
<h3 id="先认识一下什么是区块链框架-1"><a class="header" href="#先认识一下什么是区块链框架-1">先认识一下：什么是区块链框架</a></h3>
<p>简单来说，或者从本质上讲，区块链框架是一个（巨大的）工具和库的集合，用于构建一个完整的、可运行的、安全的、功能完整的（尽管是基本的）区块链。</p>
<p>区块链框架负责处理以下方面的大部分繁重工作：</p>
<ul>
<li>共识P2P网络</li>
<li>帐户管理</li>
<li>基本的区块链逻辑（区块、交易等）</li>
<li>区块链交互的客户端</li>
</ul>
<h3 id="接着说说substrate与web3-1"><a class="header" href="#接着说说substrate与web3-1">接着说说Substrate与web3</a></h3>
<p>Substrate 可以被描述为一个区块链框架——具体来说，一个用于构建定制区块链的框架。这些区块链可以完全自主运行，这意味着它们不依赖任何外部技术来运行。</p>
<p>然而，Substrate 背后的公司 Parity（由以太坊联合创始人 Gavin Wood 共同创立）也建立了 Polkadot 网络。 Polkadot 本质上是一个分散的、基于协议的区块链平台，用于实现安全的跨区块链通信。</p>
<div id="admonition-波卡本身就是跨链桥梁" class="admonition tip">
<div class="admonition-title">
<p>波卡本身就是跨链桥梁</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-波卡本身就是跨链桥梁"></a></p>
</div>
<div>
<p>这意味着 Polkadot可以用作区块链之间的一种桥梁，负责链之间的通信层，并使不同区块链（甚至是以太坊和比特币等系统）之间的交互成为可能。</p>
</div>
</div>
<div id="admonition-web3愿景" class="admonition quote">
<div class="admonition-title">
<p>web3愿景</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-web3愿景"></a></p>
</div>
<div>
<p>这代表着在实现 Web3 的愿景（一个分散的、基于区块链的互联网版本）方面取得了重大进展。</p>
</div>
</div>
<p>由于它们是由同一个人开发的，因此 Substrate 对与Polkadot的集成具有一流的支持，因此您使用Substrate创建的任何区块链都可以无缝连接到 Polkadot。</p>
<p>Substrate 还提供无分叉运行时升级——在不触发硬分叉的情况下升级区块链状态转换功能的能力。</p>
<div id="admonition-文档教程" class="admonition info">
<div class="admonition-title">
<p>文档教程</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-文档教程"></a></p>
</div>
<div>
<p>当然，由于提供了大量的代码，Substrate 附带了大量的文档和教程来帮助您入门。</p>
</div>
</div>
<h3 id="用web框架游戏引擎类比-1"><a class="header" href="#用web框架游戏引擎类比-1">用web框架、游戏引擎类比</a></h3>
<div id="admonition-sustrate与web框架大有不同" class="admonition warning">
<div class="admonition-title">
<p>Sustrate与web框架大有不同</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-sustrate与web框架大有不同"></a></p>
</div>
<div>
<p>如果你以前使用过一个广泛的 Web 框架，那么区块链框架就是——根本不是这样的。范围、活动部件的数量、相关概念和扩展点只是处于不同的规模。</p>
</div>
</div>
<blockquote>
<p>一个更好的比较可能是一个成熟的游戏引擎（想想 Unity），它为你需要的一切功能提供基本实现，以及可能需要的许多扩展点，供自定义。</p>
</blockquote>
<p>当然，这意味着已经在架构方面做出了一些决定：你将无法轻易更改。</p>
<p>根据你的用例，可能需要更多的可定制性，而框架可能会以某种方式对其进行限制。</p>
<p>这是标准的权衡：区块链框架可以节省你的时间，但代价是你不得不忍受的一些事情。</p>
<p>然而，正如我们将在下面更详细地探讨的那样，Substrate在这方面提供了一些灵活性。</p>
<p>使您能够在多个阶段在更多的技术自由和易于开发之间进行选择。</p>
<p>Substrate的后端是用 Rust 构建的。它（以及 Parity 通常所做的大部分工作）也是完全开源的。</p>
<blockquote>
<p>因此，您不仅可以使用 Substrate，还可以通过回馈和分叉其中的一部分来改进它，以根据您自己的需求进行定制。</p>
</blockquote>
<h3 id="substrate-architecture-1"><a class="header" href="#substrate-architecture-1">Substrate Architecture</a></h3>
<p>Gavin Wood 作为以太坊实际核心的开发者，自然早已对这套系统的框架了然于心，所以从Substrate框架提出的开始（2018年9月），就对区块链系统作出了2个关键的区分：</p>
<div id="admonition-coreruntime" class="admonition info">
<div class="admonition-title">
<p>Core&amp;Runtime</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-coreruntime"></a></p>
</div>
<div>
<p>Substrate Core: 系统基础部分
Runtime：链功能</p>
</div>
</div>
<div id="admonition-substrte-architecture" class="admonition tip">
<div class="admonition-title">
<p>Substrte Architecture</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-substrte-architecture"></a></p>
</div>
<div>
<pre><code class="language-text">┌───────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                       │
│                                                                                                       │
│      ┌─────────────────┐     ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐        │
│      │ fund management │     │     Account     │    │    Contract     │    │   Democratic    │        │
│      │    transfer     │     │     system      │    │       VM        │    │   referendum    │        │
│      └─────────────────┘     └─────────────────┘    └─────────────────┘    └─────────────────┘        │
│                                                                                                       │
│                                                  ######  #     # #     # ####### ### #     # #######  │
│      ┌─────────────────┐     ┌─────────────────┐ #     # #     # ##    #    #     #  ##   ## #        │
│      │     Equity      │     │      etc.       │ #     # #     # # #   #    #     #  # # # # #        │
│      │   calculation   │     │                 │ ######  #     # #  #  #    #     #  #  #  # #####    │
│      └─────────────────┘     └─────────────────┘ #   #   #     # #   # #    #     #  #     # #        │
│                                                  #    #  #     # #    ##    #     #  #     # #        │
│                                                  #     #  #####  #     #    #    ### #     # #######  │
├───────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                       │
│      ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐    ┌─────────────────┐       │
│      │    Consensus    │     │ Network system  │     │     Trading     │    │                 │       │
│      │    mechanism    │     │      (p2p)      │     │      Pool       │    │       RPC       │       │
│      └─────────────────┘     └─────────────────┘     └─────────────────┘    │                 │       │
│                                                                             └─────────────────┘       │
│                                                             #####  ####### ######  #######            │
│      ┌─────────────────┐                                   #     # #     # #     # #                  │
│      │      etc.       │                                   #       #     # #     # #                  │
│      │                 │                                   #       #     # ######  #####              │
│      └─────────────────┘                                   #       #     # #   #   #                  │
│                                                            #     # #     # #    #  #                  │
│                                                             #####  ####### #     # #######            │
│                                                                                                       │
└───────────────────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
</div>
</div>
<h3 id="开发者只需要关注runtime链功能-1"><a class="header" href="#开发者只需要关注runtime链功能-1">开发者只需要关注Runtime(链功能)</a></h3>
<p>根据这样的划分，当开发者使用Substrate框架的时候，无需关心区块链基础功能也就是Core部分的工作，而只需关心自己链能够提供的功能，也就是Runtime部分的工作。</p>
<div id="admonition-vm类似以太坊的智能合约" class="admonition tip">
<div class="admonition-title">
<p>VM类似以太坊的智能合约</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-vm类似以太坊的智能合约"></a></p>
</div>
<div>
<p>注意图中虚拟机EVM也是Runtime的一个组件。与以太坊的结构相比，相当于把以太坊的智能合约功能也能随意作为一个链的功能组件添加进入使用Substrate开发的链中</p>
</div>
</div>
<h3 id="明晰runtime-1"><a class="header" href="#明晰runtime-1">明晰Runtime</a></h3>
<p>这里一直强调Runtime是“链的功能”有一些通俗与不严谨，这里使用一个更抽象的描述：</p>
<div id="admonition-runtime明确" class="admonition danger">
<div class="admonition-title">
<p>Runtime明确</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-runtime明确"></a></p>
</div>
<div>
<p>需要对运行结果进行共识的功能部分应该归属于Runtime</p>
</div>
</div>
<p>这个定义比较抽象，且由于需要对“世界状态”或类似概念有比较深入的了解才好解释，故不展开讲解。更严格来说，“需要对运行结果进行共识的功能组件”是“链的功能”的一个子集。</p>
<h4 id="判断标准-1"><a class="header" href="#判断标准-1">判断标准</a></h4>
<div id="admonition-判断标准" class="admonition tip">
<div class="admonition-title">
<p>判断标准</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-判断标准"></a></p>
</div>
<div>
<p>这里有一个简单的判定标准判断某个功能是否应该放在Runtime内：</p>
<p>对于某个功能，若只改动一个节点的代码对于所有的逻辑运行的结果与其他不改动的节点运行的结果相同，则认为这个部分应该放在Runtime之外，如果运行结果不同，则认为应该放在Runtime之内。</p>
</div>
</div>
<div id="admonition-举例" class="admonition example">
<div class="admonition-title">
<p>举例</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-举例"></a></p>
</div>
<div>
<p>举个例子：比如我改变了交易池的排序代码，使得对某个账户有利的交易能优先打包。这个改动会令自己这个节点产出的区块不公平的打包交易，但是只要打包出来的区块大家都可以认可，则所有节点共识的“状态的变化”仍然是一致的。很明显，这个功能组件不应该是Runtime的功能，因为它不会改变对于验证一个区块时的“状态变化”的验证。比如我改变了转账功能的代码，能给某个账户凭空增加钱，那么显然，这种改动对于这个改动过的节点执行的结果将会与其他节点不同，则共识不会通过。所以转账这个功能就应该放在Runtime当中，让所有节点执行的都是一致的。</p>
</div>
</div>
<p>这部分结合native与wasm后会容易理解</p>
<p>所以到底什么是Runtime，我认为使用“链上功能”来描述最为恰当，因为其隐含了对于执行结果的共识问题。</p>
<h3 id="substrate的runtime-1"><a class="header" href="#substrate的runtime-1">Substrate的Runtime</a></h3>
<p>Substrate的Runtime当然没有止步于仅将区块链系统做了模块化划分，提供框架功能这一步，事实上，由于抽象出了Runtime，Substrate实现了以往所有区块链都无法实现的一个功能：区块链系统升级。</p>
<h4 id="中心化升级流程-1"><a class="header" href="#中心化升级流程-1">中心化升级流程</a></h4>
<div id="admonition-centralized-system-upgrading" class="admonition tip">
<div class="admonition-title">
<p>Centralized System Upgrading</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-centralized-system-upgrading"></a></p>
</div>
<div>
<pre><code class="language-text">┌────────────────────────────────Centralized System Upgrading(Internet App)────────────────────────────────┐
│                                                                                                          │
│                                                                                                          │
│                         ┌───────────────────┐      ┌─────────────┐    ┌─────────────┐    ┌─────────────┐ │
│                     ┌──▶│    Update Code    │      │   Deploy    │    │   Upgrade   │    │ Centralized │ │
│     .─────────.     │   │(Backend/Frontend)─┼──────▶   Server    │───▶│  Sucessful  │────▶Upgrade Easy │ │
│    ╱           ╲    │   └───────────────────┘      └─────────────┘    └─────────────┘    └─────────────┘ │
│   ( Bug/Upgrade )───┤                                                 ┌─────────────┐                    │
│    `.         ,'    │                                                 │  Somebody   │                    │
│      `───────'      │                                              ┌─▶│   Upgrade   ├─┐                  │
│                     │   ┌───────────────────┐      ┌─────────────┐ │  └─────────────┘ │  ┌─────────────┐ │
│                     └──▶│    Update Code    │      │   Publish   │ │                  │  │ Fragmented  │ │
│                         │       (App)      ─┼──────▶  App Store  │─┤  ┌─────────────┐ ├─▶│   version   │ │
│                         └───────────────────┘      └─────────────┘ │  │  Somebody   │ │  └─────────────┘ │
│                                                                    └─▶│   Reject    │─┘                  │
│                                                                       └─────────────┘                    │
│                                                                                                          │
│                                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
</div>
</div>
<p>对于中心化的互联网系统而言，由于代码与数据的控制权在自己手上，所以可以随时进行版本的升级与修改。但是即便如此，也只有网页H5，后台代码可以做到随时升级，在移动互联网中，app还是需要用户自行更新。其中android生态尤为突出，apk版本的碎片化一度是困扰开发者的难题。为了应对app应用的碎片化，推出了许多功能各异的框架能够用户在不更新app的情况下进行“热更新”，一度成为技术的热门追捧。这些热更新的框架本质上都是允许从后台下载一段更新代码，通过各种方式加载运行新的代码来完成。一般情况下通过这种热更新提供的功能都会带来一定的性能损耗以运行最新的热更新代码。但是即便是热更新，更新代码的控制权也同样处于中心化组织的手中。</p>
<h4 id="无央化升级流程原先-1"><a class="header" href="#无央化升级流程原先-1">无央化升级流程(原先)</a></h4>
<div id="admonition-decentralized-system-upgradingpre" class="admonition tip">
<div class="admonition-title">
<p>Decentralized System Upgrading(pre)</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-decentralized-system-upgradingpre"></a></p>
</div>
<div>
<pre><code class="language-text">┌───────────────────────────────────Decentralized System Upgrading(Blockchain Dapp)────────────────────────────────────┐
│                                                                                                 ┌─────────────┐      │
│                                                                                                 │   Upgrade   │      │
│                                                                                  ┌───Yes───────▶│  Sucessful  │      │
│                                                                                  │              └─────────────┘      │
│                                                                                  Λ                                   │
│                                                                                 ╱ ╲                                  │
│                                                                                ╱   ╲                                 │
│                                                                               ╱     ╲                                │
│                                                          ┌────────┐          ╱       ╲                               │
│                                                          │ Deploy │      Most deployments                            │
│                                              ┌──Support─▶│  Node  │─────▶(Under Byzantine                            │
│                                              │           └────────┘      Fault Tolerance)                            │
│                                              │                               ╲       ╱                               │
│                                              Λ                                ╲     ╱                                │
│                                             ╱ ╲                                ╲   ╱                                 │
│                                            ╱   ╲                                ╲ ╱                                  │
│                                           ╱     ╲                                V              ┌──────────────────┐ │
│     .─────────.      ┌─────────────┐     ╱       ╲                               │              │   Upgrade Fail   │ │
│    ╱           ╲     │ Update Node │    ╱ Running ╲                              └───No────────▶│(Cause Fragmented)│ │
│   ( Bug/Upgrade ─────▶    Code     ├────▶  Node    ▏                                            └──────────────────┘ │
│    `.         ,'     └─────────────┘    ╲ (Minner ╱                                                       ▲          │
│      `───────'                           ╲       ╱                                                        │          │
│                                           ╲     ╱                                                         │          │
│                                            ╲   ╱                                                          │          │
│     .─────────.                             ╲ ╱                                                           │          │
│  ,─'           '─.                           V                                                            │          │
│ ;    Community    :                          │           ┌────────┐                                       │          │
│ :    proposal     ;                          │           │ Reject │                                       │          │
│  ╲   (BIP/EIP)   ╱                           └───Reject─▶│ Deploy │───────────────────────────────────────┘          │
│   '─.         ,─'                                        └────────┘                                                  │
│      `───────'                                                                                                       │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
</div>
</div>
<p>区块链领域就大大不同了。 即便代码更新的权力在某个组织的手上，但是运行这些代码的人可不一定会听这个组织的指挥，无法容易的命令分散节点统一的进行新代码的部署更新。</p>
<div id="admonition-分布式自治的优缺点" class="admonition tip">
<div class="admonition-title">
<p>分布式自治的优缺点</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-分布式自治的优缺点"></a></p>
</div>
<div>
<p>这是区块链带来的分布式自治的优点，同时也是一个巨大的缺点。</p>
</div>
</div>
<p>比特币社区就是这个领域下的一个典型，由于比特币社区的分裂，部分人并不认同不更改区块大小而是采用隔离见证的方案，分裂出了BCH，对BTC的生态产生的极大的损害。ETH的升级同样也困难重重，每次升级都需要进行长时间的等待以防有节点未升级而产生的分叉。</p>
<p>EOS由于其中心化的特点使得升级稍微简单一些，但仍然出现了由于升级带来的分叉的恶性事件。我们可以形象把区块链下的系统升级称为“全球升级”，因为其要求分布式环境下的大部分节点都更新了代码才使得升级能够成功。相较于中心化控制的系统，区块链系统的升级困难重重且充满风险。</p>
<div id="admonition-高度判断" class="admonition tip">
<div class="admonition-title">
<p>高度判断</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-高度判断"></a></p>
</div>
<div>
<p>同时区块链的升级还有另一个问题：高度判断</p>
<p>一个区块链系统升级后，不得不在代码中加入许多的“高度判断”，以区分不同高度下运行的代码，保证同步能够正常执行，兼容老数据。这种做法很原始但是又无法绕开，给开发者带来极大的思维负担，且需要大量的测试来保证不出现Bug。</p>
</div>
</div>
<p>比如目前比特币的源码中就有许多的区块高度判定使得在同步老区块的时候执行老代码，新区块的时候执行新代码。而中心化系统的数据控制权在自己手上，并且也不存在需要从某个数据源同步的情况，所以完全不需要担心这个问题。</p>
<h4 id="substrate的不同-1"><a class="header" href="#substrate的不同-1">Substrate的不同</a></h4>
<p>Substrate横空而出，推出了目前区块链领域最完美的升级方案。其采用“链上代码”的思想，将整个Runtime都做成了可直接更新的组件，让所有节点能够强制运行最新的Runtime代码。</p>
<div id="admonition-substrate-runtime" class="admonition info">
<div class="admonition-title">
<p>Substrate Runtime</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-substrate-runtime"></a></p>
</div>
<div>
<p>简单来说，Runtime在Substrate框架下，将会用同一份代码编译出两份可执行文件：</p>
<ol>
<li>一份Rust的本地代码，我们一般称为native代码，native与其他代码无异，是这个执行文件中的二进制数据，直接运行。在Substrate的相关代码以native命名</li>
<li>一份wasm的链上代码，我们一般成为wasm代码，wasm被部署到链上，所有人可获取，wasm通过构建一个wasm的运行时环境执行 。在Substrate的相关代码以wasm命名 在节点启动的时候可以选择执行策略，使用native, possible，wasm或者both。不同的执行策略会执行不同的执行文件</li>
</ol>
</div>
</div>
<p>由于这两份代码是由相同的代码编译出来的，所以其执行逻辑完全相同 (有一些很小的暗坑要注意)。其中wasm将会部署到链上，所有人都可以获取到，也就是说即使本地运行的不是最新版本的节点，只要同步了区块，一定可以获取到最新的wasm代码。</p>
<p>换句话说，一个写在Runtime内部的代码，也就是代表这条链功能性的代码，存在两份，分别是native与wasm。wasm代码被部署到链上，是“链上数据”，可以通过同步区块所有人统一获取并执行。这样就可以保证在区块链中所有矿工执行的都是最新的代码。</p>
<div id="admonition-哪种更合理" class="admonition tip">
<div class="admonition-title">
<p>哪种更合理</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-哪种更合理"></a></p>
</div>
<div>
<p>这里需要强调，代码的部署可以通过“民主提议”，“sudo控制权限”，“开发者自定一种部署条件”等方式进行，到底哪种方式“更区块链”，“更合理”，不在本文讨论范围内，这与这条链的设计目的相关。Substrate只是提供了这种“热更新”的强大机制，如何使用这种机制是这条链的问题。</p>
</div>
</div>
<h4 id="以太坊合约更新策略-1"><a class="header" href="#以太坊合约更新策略-1">以太坊合约更新策略</a></h4>
<div id="admonition-合约更新策略" class="admonition info">
<div class="admonition-title">
<p>合约更新策略</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-合约更新策略"></a></p>
</div>
<div>
<p>我们使用以太坊中“合约更新策略”来解释Substrate的Runtime机制：</p>
</div>
</div>
<p>由于以太坊部署一个合约后，其地址已经被固定，且数据完全存储在这个合约地址下，若这个合约需要升级功能或出现Bug，将会带来许多的问题（比如许多垃圾山寨币的ERC20合约有溢出漏洞，被攻击后损失惨重，只能通过重新部署合约，**
并将老合约的数据重新导入的方式**进行合约升级，且此时的合约地址只能使用新的了）。</p>
<p>许多开发人员不断探索后发展出了如下的以太坊合约升级方式：</p>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Substrate_runtime_intro.jpeg" alt="Substrate_runtime_intro" /></p>
<p>熟悉以太坊的开发人员应该很容易理解上图表达的意思。</p>
<p>其核心思想是将一个合约拆分成为“逻辑合约”与“数据合约”，并使用一个“核心合约”将它们串在一起，这个核心合约就是用户的入口。</p>
<p>由于以太坊部署后的地址是固定的，所以将逻辑合约做成一个独立的合约，并将其地址设置在核心合约当中。那么只要更改核心合约中设置的地址，就可以更改核心合约执行的逻辑了。</p>
<p>并且由于以太坊的合约部署后都存在于“世界状态”当中，那么在同步区块时，老数据就会自动使用老的逻辑合约执行，而新的数据使用新的逻辑合约执行。</p>
<div id="admonition-链上代码" class="admonition tip">
<div class="admonition-title">
<p>链上代码</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-链上代码"></a></p>
</div>
<div>
<p>这里的“逻辑合约”就是“链上代码”的概念，它存在于被共识的数据当中，具备历史的意义</p>
</div>
</div>
<h4 id="substrate对应合约更新策略-1"><a class="header" href="#substrate对应合约更新策略-1">Substrate对应‘合约更新策略’</a></h4>
<p>那么将Substrate的框架对应过来，其中：</p>
<ul>
<li>“核心合约”的部分就是节点采用wasm执行去从“状态”存储中加载出最新的合约代码</li>
<li>“逻辑合约”的部分就是这条链的Runtime</li>
<li>“数据合约”的部分就是这条链自己的状态数据</li>
</ul>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/v2-b9bb441d00298a06de67ab8fdd368c08_720w.jpg" alt="img" /></p>
<div id="admonition-wasm" class="admonition tip">
<div class="admonition-title">
<p>wasm</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-wasm"></a></p>
</div>
<div>
<p>由此可见，由于wasm代码的存在，可以保证即使节点没有更新到最新版本，仍然能够<strong>以最新的代码运行</strong>，保证不会因为代码的不同而分叉。同时在节点同步老数据的过程中也<strong>不会因为本地代码是最新的而导致同步出错</strong></p>
</div>
</div>
<h2 id="项目结构-1"><a class="header" href="#项目结构-1">项目结构</a></h2>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/substrate_github.gif" alt="substrate_github" /></p>
<h3 id="客户端架构-1"><a class="header" href="#客户端架构-1">客户端架构</a></h3>
<h4 id="架构图-1"><a class="header" href="#架构图-1">架构图</a></h4>
<div id="admonition-substrate-client" class="admonition tip">
<div class="admonition-title">
<p>Substrate Client</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-substrate-client"></a></p>
</div>
<div>
<pre><code class="language-text">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃         ___ _   _ ___ ___ _____ ___    _ _____ ___    ___ _    ___ ___ _  _ _____        ┃
┃        / __| | | | _ ) __|_   _| _ \  /_\_   _| __|  / __| |  |_ _| __| \| |_   _|       ┃
┃        \__ \ |_| | _ \__ \ | | |   / / _ \| | | _|  | (__| |__ | || _|| .` | | |         ┃
┃        |___/\___/|___/___/ |_| |_|_\/_/ \_\_| |___|  \___|____|___|___|_|\_| |_|         ┃
┃                                                                                          ┃
┃                                                                                          ┃
┃     ┌───────────────┐     ┌──────────────────────────────────────────────────────────┐   ┃
┃     │               │     │                                                          │   ┃
┃     │               │     │                                                          │   ┃
┃     │               │     │                           RPC                            │   ┃
┃     │               │     │                                                          │   ┃
┃     │      P2P      │     │                                                          │   ┃
┃     │    NETWORK    │     └──────────────────────────────────────────────────────────┘   ┃
┃     │               │     ┌────────────────────────────────────────┐ ┌───────────────┐   ┃
┃     │               │     │                                        │ │               │   ┃
┃     │               │     │            ┌───────────────┐           │ │               │   ┃
┃     │               │     │            │               │           │ │   CONSENSUS   │   ┃
┃     └───────────────┘     │            │     Wasm      │           │ │               │   ┃
┃          .───────.        │            │    Runtime    │           │ │               │   ┃
┃       ,─'         '─.     │            │               │           │ └───────────────┘   ┃
┃      ╱               ╲░   │            └───────────────┘           │                     ┃
┃     ;     NATIVE      :░  │                                        │ ┌───────────────┐   ┃
┃     :     RUNTIME     ;░░ │                                        │ │               │   ┃
┃      ╲               ╱░░░ │                STORAGE                 │ │               │   ┃
┃       ╲             ╱░░░  │                                        │ │   TELEMETRY   │   ┃
┃        '─.       ,─'░░░   │                                        │ │               │   ┃
┃          ░`─────'░░░░░    │                                        │ │               │   ┃
┃             ░░░░░░░       └────────────────────────────────────────┘ └───────────────┘   ┃
┃                                                                                          ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
</code></pre>
</div>
</div>
<p>现在我们知道了 Substrate 是什么，让我们对框架、它的移动部分以及我们可以用来创建自定义区块链的扩展点进行高级概述。 
由于我们在这里处理的是去中心化的点对点系统，所以我们谈论的基本单元是节点,这是我们的区块链运行的地方。
该节点在客户端内部运行，并提供系统运行所需的所有基本组件，例如p2p网络、区块链的存储、块处理和共识的逻辑，以及从外部与区块链交互的能力。</p>
<h4 id="模块说明-1"><a class="header" href="#模块说明-1">模块说明</a></h4>
<blockquote>
<p>substrate客户端是基于substrate实现的区块链的节点客户端（可以理解为全节点），
它主要由以下几个组件组成（以下也就是告诉我们实现一条链由哪几部分组成）：</p>
</blockquote>
<h5 id="存储-1"><a class="header" href="#存储-1">存储</a></h5>
<p>用来维持区块链系统所呈现的状态演变。substrate提供了的存储方式是一种简单有效的key-value对存储机制的方式。</p>
<h5 id="runtime-2"><a class="header" href="#runtime-2">Runtime</a></h5>
<p>这里就可以回答上面的问题，什么是runtime？runtime定义了区块的处理方式，主要是状态转换的逻辑。在substrate中，runtime code被编译成wasm作为区块链存储状态的一部分。</p>
<h5 id="p2p网络-1"><a class="header" href="#p2p网络-1">p2p网络</a></h5>
<p>允许客户端和其它网络参与者进行通信。</p>
<h5 id="共识-1"><a class="header" href="#共识-1">共识</a></h5>
<p>提供了一种逻辑，能使网络参与者就区块链的状态达成一致。 substrate 支持提供自定义的共识引擎。</p>
<h5 id="rpc-1"><a class="header" href="#rpc-1">RPC</a></h5>
<p>远程过程调用。</p>
<h5 id="telemetry-遥测-1"><a class="header" href="#telemetry-遥测-1">telemetry （遥测）</a></h5>
<p>通过嵌入式Prometheus服务器的方式对外展示（我理解应该是类似于区块链浏览器一样的东西，或者是提供信息给区块链浏览器展示）。</p>
<h3 id="tree-level1-1"><a class="header" href="#tree-level1-1">Tree Level1</a></h3>
<p>首先来看看项目的整理结构：</p>
<pre><code class="language-shell"> tree -L 1 | pbcopy                                                                                                                                                                                                                        ─╯
.
├── Cargo.lock
├── Cargo.toml
├── HEADER-APACHE2
├── HEADER-GPL3
├── LICENSE-APACHE2
├── LICENSE-GPL3
├── README.md
├── bin
├── client
├── docker
├── docs
├── frame
├── primitives
├── rustfmt.toml
├── scripts
├── shell.nix
├── test-utils
└── utils

9 directories, 9 files
</code></pre>
<h4 id="用cargo组织代码-1"><a class="header" href="#用cargo组织代码-1">用Cargo组织代码</a></h4>
<p>Substrate非常明显使用Cargo来组织代码：</p>
<ol>
<li>项目根目录的Cargo.toml会用workspace+members导入各子模块</li>
</ol>
<pre><code class="language-yaml">[ workspace ]
  resolver = &quot;2&quot;

  members = [...]
</code></pre>
<div id="admonition-workspacememgers" class="admonition info">
<div class="admonition-title">
<p>workspace+memgers</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-workspacememgers"></a></p>
</div>
<div>
<p>在[workspace]项下, members 属性表示工作区目录中的程序库列表</p>
</div>
</div>
<ol start="2">
<li>各子模块之间也用Cargo.toml来相互导入使用</li>
</ol>
<pre><code class="language-yaml">[ dependencies ]
  sc-consensus = { version = &quot;0.10.0-dev&quot;, path = &quot;../../client/consensus/common&quot; }
</code></pre>
<div id="admonition-高内聚低耦合" class="admonition tip">
<div class="admonition-title">
<p>高内聚，低耦合</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-高内聚低耦合"></a></p>
</div>
<div>
<p>这里正是通过Cargo.toml的语法，将模块功能内聚之后供调用</p>
</div>
</div>
<h3 id="主要部分介绍nodeframecore-1"><a class="header" href="#主要部分介绍nodeframecore-1">主要部分介绍：Node、Frame、Core</a></h3>
<h4 id="substrate-node-1"><a class="header" href="#substrate-node-1">Substrate Node:</a></h4>
<p>我们将从 Substrate Node 开始。这是我们可以开始的最高级别；</p>
<p>它提供了最多的预建功能和最少的技术自由度。它是完全可运行的，包括所有基本组件的默认实现，例如:</p>
<ul>
<li>账户管理</li>
<li>特权访问</li>
<li>共识</li>
<li>...</li>
</ul>
<p>我们可以自定义链的创世块（即初始状态）以开始。 在这里，我们可以运行节点并熟悉 Substrate 提供的开箱即用的功能，玩转状态并与正在运行的区块链交互以熟悉。</p>
<p>另一种实现相同目的的方法是使用 <a href="https://substrate.io/developers/playground/">Substrate Playground</a>，您可以在其中查看后端和前端模板以熟悉它们。
然而，一旦我们准备好真正构建自己的区块链，我们最好降低一层并使用 FRAME。</p>
<pre><code class="language-shell">tree bin -L 2 | pbcopy                                                                                                                                                                                                                       ─╯
bin
├── node
│   ├── bench
│   ├── cli
│   ├── executor
│   ├── inspect
│   ├── primitives
│   ├── rpc
│   ├── runtime
│   └── testing
├── node-template: 使用Substrate写项目的基础模版
│   ├── LICENSE
│   ├── README.md
│   ├── docker-compose.yml
│   ├── docs
│   ├── node
│   ├── pallets
│   ├── runtime
│   ├── scripts
│   └── shell.nix
└── utils
    ├── chain-spec-builder
    └── subkey

18 directories, 4 files
</code></pre>
<h5 id="重点说说nodepallets和runtime-1"><a class="header" href="#重点说说nodepallets和runtime-1">重点说说node、pallets和runtime</a></h5>
<div id="admonition-nodepalletsruntimes" class="admonition tip">
<div class="admonition-title">
<p>node、pallets、runtimes</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-nodepalletsruntimes"></a></p>
</div>
<div>
<p>│   ├── node: 链的一些基础功能的实现（或者说比较底层的实现，如网络、rpc，搭建链的最基础的code)
│   ├── pallets: 放置的就是各个pallet，也就是业务相关的模块
│   ├── runtime: 可以简单理解为把所有pallet组合到一起，也就是业务相关的逻辑</p>
</div>
</div>
<p>三者的关系大致如下：</p>
<div id="admonition-nodepalletsruntime的关系" class="admonition tip">
<div class="admonition-title">
<p>node、pallets、runtime的关系</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-nodepalletsruntime的关系"></a></p>
</div>
<div>
<pre><code class="language-text">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃             ___ _   _ ___ ___ _____ ___    _ _____ ___   _  _  ___  ___  ___             ┃
┃            / __| | | | _ ) __|_   _| _ \  /_\_   _| __| | \| |/ _ \|   \| __|            ┃
┃            \__ \ |_| | _ \__ \ | | |   / / _ \| | | _|  | .` | (_) | |) | _|             ┃
┃            |___/\___/|___/___/ |_| |_|_\/_/ \_\_| |___| |_|\_|\___/|___/|___|            ┃
┃                                                                                          ┃
┃                                                                                          ┃
┃                                                                                          ┃
┃  ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ ┃
┃  ┃                         ___ _   _ _  _ _____ ___ __  __ ___                         ┃ ┃
┃  ┃                        | _ \ | | | \| |_   _|_ _|  \/  | __|                        ┃ ┃
┃  ┃                        |   / |_| | .` | | |  | || |\/| | _|                         ┃ ┃
┃  ┃                        |_|_\\___/|_|\_| |_| |___|_|  |_|___|                        ┃ ┃
┃  ┃                                                                                     ┃ ┃
┃  ┃                                                                                     ┃ ┃
┃  ┃                                                                                     ┃ ┃
┃  ┃                                                                                     ┃ ┃
┃  ┃    ┌───────────────┐    ┌───────────────┐    ┌───────────────┐   ┌───────────────┐  ┃ ┃
┃  ┃    │               │    │               │    │               │   │               │  ┃ ┃
┃  ┃    │   pallet 1    │    │   pallet 2    │    │      ...      │   │   pallet n    │  ┃ ┃
┃  ┃    │               │    │               │    │               │   │               │  ┃ ┃
┃  ┃    └───────────────┘    └───────────────┘    └───────────────┘   └───────────────┘  ┃ ┃
┃  ┃                                                                                     ┃ ┃
┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛ ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
</code></pre>
</div>
</div>
<blockquote>
<p>当然，对于pallets来说，在runtime中使用的pallet，有些是我们自己开发的pallet，有些是substrate中已经开发好的pallet，甚至还有些是pallet是第三方开发的pallet。</p>
</blockquote>
<h4 id="substrate-frame-1"><a class="header" href="#substrate-frame-1">Substrate FRAME</a></h4>
<p>FRAME (Framework for Runtime Aggregation of Modularized Entities) 是一个框架，用于从现有库构建 Substrate 运行时(Runtime)
，并具有高度的自由度来确定我们的区块链逻辑。</p>
<p>我们基本上是从 Substrate 的预构建节点模板开始，可以添加所谓的托盘（pallet, Substrate 库模块的名称）来定制和扩展我们的链。</p>
<p>在这个抽象级别，我们还能够完全自定义我们区块链的逻辑、状态和数据类型。这当然是大多数旨在接近 Substrate 的基本定制项目在易于开发和技术自由之间利用两全其美的地方。</p>
<div id="admonition-专注定制" class="admonition tip">
<div class="admonition-title">
<p>专注定制</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-专注定制"></a></p>
</div>
<div>
<p>从这个起点开始，我们必须投入最少的时间来建立我们的区块链，并且可以完全专注于我们自己的定制。</p>
</div>
</div>
<p>我们仍然需要在它们到来时采用一些默认值——或者更确切地说，因为它们可以被配置——但是如果我们从根本上想要做不同的事情，我们可以从 Core 开始再降低一步。</p>
<div id="admonition-frame" class="admonition info">
<div class="admonition-title">
<p>FRAME</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-frame"></a></p>
</div>
<div>
<p>The Framework for Runtime Aggregation of Modularized Entities (FRAME) is a set of modules and support libraries that simplify runtime development. 
In Substrate , these modules are called Pallets, each hosting domain-specific logic to include in a chain's runtime.</p>
<p>FRAME also provides some helper modules to interact with important Substrate Primitives that provide the interface to the core client.</p>
<p>The following diagram shows the architectural overview of FRAME and its support libraries:</p>
</div>
</div>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/frame-arch.png" alt="frame-arch" /></p>
<p><a href="https://docs.substrate.io/v3/runtime/frame/">FRAME | Substrate_</a></p>
<pre><code class="language-shell">tree frame -L 1 | pbcopy
frame
├── alliance: The Alliance Pallet provides a collective that curates a list of accounts and URLs, deemed by the voting members to be unscrupulous actors.
├── assets: A simple, secure module for dealing with fungible assets. The Assets module provides functionality for asset management of fungible asset classes with a fixed supply
├── atomic-swap: A module for atomically sending funds.
├── aura: The Aura module extends Aura consensus by managing offline reporting.
├── authority-discovery: This module is used by the client/authority-discovery to retrieve the current set of authorities.
├── authorship
├── babe
├── bags-list
├── balances: The Balances module provides functionality for handling accounts and balances.
├── beefy
├── beefy-mmr
├── benchmarking
├── bounties
├── child-bounties
├── collective
├── contracts
├── conviction-voting
├── democracy
├── election-provider-multi-phase
├── election-provider-support
├── elections-phragmen
├── examples
├── executive
├── gilt
├── grandpa
├── identity
├── im-online
├── indices
├── lottery
├── membership
├── merkle-mountain-range
├── multisig
├── nicks
├── node-authorization
├── nomination-pools
├── offences
├── preimage
├── proxy
├── randomness-collective-flip
├── ranked-collective
├── recovery
├── referenda
├── remark
├── scheduler
├── scored-pool
├── session
├── society
├── staking
├── state-trie-migration
├── sudo
├── support
├── system
├── timestamp
├── tips
├── transaction-payment
├── transaction-storage
├── treasury
├── try-runtime
├── uniques
├── utility
├── vesting
└── whitelist

62 directories, 0 files

</code></pre>
<h4 id="substrate-coreclient-1"><a class="header" href="#substrate-coreclient-1">Substrate Core(client)</a></h4>
<p>Substrate Core 本质上意味着我们可以以任何我们想要的方式实现我们的运行时，只要它以 WebAssembly 为目标并遵守 Substrate 块创建的基本法则。</p>
<p>然后，我们可以使用这个运行时并在 Substrate 节点中运行它。</p>
<div id="admonition-最高自由度" class="admonition info">
<div class="admonition-title">
<p>最高自由度</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-最高自由度"></a></p>
</div>
<div>
<p>这种方法当然需要最多的工作和最高的难度，但它也具有最高的技术自由度，同时仍然能够在 Substrate 生态系统中无缝工作。</p>
</div>
</div>
<p>说到 Substrate 的生态系统，有一个充满活力（充满活力）的开发者社区，他们在自己的项目中使用 Substrate，其中许多人通过共享自己的托盘(pallet)来回馈生态系统。</p>
<p>您可以通过使用诸如 <a href="https://substratemarketplace.com/">Substrate Market</a>
之类的站点或仅在托管 <a href="https://crates.io/">crates.io: Rust Package Registry</a> 的任何地方找到托盘(pallet)，因为 Substrate 托盘本质上是自包含的 Rust
库，您可以将其集成到您的 Substrate 项目中, 并根据需要进行配置。</p>
<p>与任何其他库一样，建议首先审核代码，并了解依赖外部代码与编写自己的代码之间的权衡。</p>
<p>在玩了一点预建节点之后，我们应该专注于 FRAME，学习如何通过在 Substrate 模板节点之上构建自定义区块链。这也是许多精彩教程的起点。</p>
<pre><code class="language-shell"> tree client -L 1 | pbcopy                                                                                                                                                                                                                    ─╯
client
├── allocator
├── api
├── authority-discovery
├── basic-authorship
├── beefy
├── block-builder
├── chain-spec
├── cli
├── consensus
├── db
├── executor
├── finality-grandpa
├── informant
├── keystore
├── network
├── network-gossip
├── offchain
├── peerset
├── proposer-metrics
├── rpc
├── rpc-api
├── rpc-servers
├── service
├── state-db
├── sync-state-rpc
├── sysinfo
├── telemetry
├── tracing
├── transaction-pool
└── utils

30 directories, 0 files
</code></pre>
<h3 id="其他-1"><a class="header" href="#其他-1">其他</a></h3>
<h4 id="primitives-1"><a class="header" href="#primitives-1">primitives</a></h4>
<pre><code class="language-shell">tree primitives -L 1 | pbcopy
primitives
├── api
├── application-crypto
├── arithmetic
├── authority-discovery
├── authorship
├── beefy
├── block-builder
├── blockchain
├── consensus
├── core
├── database
├── debug-derive
├── externalities
├── finality-grandpa
├── inherents
├── io
├── keyring
├── keystore
├── maybe-compressed-blob
├── merkle-mountain-range
├── npos-elections
├── offchain
├── panic-handler
├── rpc
├── runtime
├── runtime-interface
├── sandbox
├── serializer
├── session
├── staking
├── state-machine
├── std
├── storage
├── tasks
├── test-primitives
├── timestamp
├── tracing
├── transaction-pool
├── transaction-storage-proof
├── trie
├── version
└── wasm-interface

42 directories, 0 files

</code></pre>
<h4 id="scriptsci-1"><a class="header" href="#scriptsci-1">scripts/ci</a></h4>
<pre><code class="language-shell">tree scripts/ci | pbcopy
scripts/ci
├── common
│   └── lib.sh
├── deny.toml
├── docker
│   ├── subkey.Dockerfile
│   └── substrate.Dockerfile
├── github
│   ├── check_labels.sh
│   └── generate_changelog.sh
├── gitlab
│   ├── check_runtime.sh
│   ├── check_signed.sh
│   ├── ensure-deps.sh
│   ├── pipeline
│   │   ├── build.yml
│   │   ├── check.yml
│   │   ├── publish.yml
│   │   └── test.yml
│   ├── publish_draft_release.sh
│   └── skip_if_draft.sh
├── monitoring
│   ├── alerting-rules
│   │   ├── alerting-rule-tests.yaml
│   │   └── alerting-rules.yaml
│   └── grafana-dashboards
│       ├── README_dashboard.md
│       ├── substrate-networking.json
│       └── substrate-service-tasks.json
├── node-template-release
│   ├── Cargo.toml
│   └── src
│       └── main.rs
└── node-template-release.sh

10 directories, 23 files

</code></pre>
<h4 id="utils-1"><a class="header" href="#utils-1">utils</a></h4>
<pre><code class="language-shell">tree utils -L 1 | pbcopy
utils
├── build-script-utils
├── fork-tree
├── frame
├── prometheus
└── wasm-builder

5 directories, 0 files

</code></pre>
<h2 id="功能逻辑-1"><a class="header" href="#功能逻辑-1">功能逻辑</a></h2>
<div id="admonition-注意" class="admonition tip">
<div class="admonition-title">
<p>注意</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_intro.html#admonition-注意"></a></p>
</div>
<div>
<p>这里将结合前面提到的runtim/core分块方式来进行功能模块说明</p>
</div>
</div>
<h2 id="特色代码-1"><a class="header" href="#特色代码-1">特色代码</a></h2>
<h2 id="参考资源-43"><a class="header" href="#参考资源-43">参考资源</a></h2>
<h3 id="online-book-39"><a class="header" href="#online-book-39">online-book</a></h3>
<ul>
<li><a href="https://github.com/paritytech/substrate">paritytech/substrate: Substrate: The platform for blockchain innovators</a></li>
<li><a href="https://docs.substrate.io/v3/getting-started/architecture/">Architecture | Substrate_</a></li>
<li><a href="https://www.bilibili.com/video/BV1KT4y1Y7Uf">substrate轻松学</a></li>
</ul>
<h3 id="fragment-39"><a class="header" href="#fragment-39">fragment</a></h3>
<ul>
<li><a href="https://www.zhihu.com/column/c_74315572">链块与分散的数据 - 知乎</a></li>
<li><a href="https://web.archive.org/web/20220627112702/https://mp.weixin.qq.com/s/MP0LXWVqUn5R4C6fAbe1nQ">区块链与substrate</a></li>
<li><a href="https://web.archive.org/web/20220618042220/https://zhuanlan.zhihu.com/p/47805322">substrate 源码解析与运用 - 介绍 - 知乎</a></li>
<li><a href="https://www.zhihu.com/column/substrate">Substrate区块链开发 - 知乎</a></li>
<li><a href="https://substrate.io/ecosystem/">Substrate Ecosystem | Substrate_</a></li>
<li><a href="https://blog.logrocket.com/substrate-blockchain-framework-core-concepts/"><strong>Substrate blockchain development: Core concepts - LogRocket
Blog</strong></a>：对Substrate的简要介绍</li>
<li><a href="https://substrate.io/developers/playground/">Playground | Substrate_</a></li>
<li><a href="https://substratemarketplace.com/">Substrate Market</a></li>
<li><a href="https://crates.io/">crates.io: Rust Package Registry</a></li>
<li><a href="https://docs.substrate.io/quick-start/">Quick start | Substrate Docs</a></li>
<li><a href="https://docs.substrate.io/tutorials/">Tutorials | Substrate Docs</a></li>
<li><a href="https://substrate.io/ecosystem/projects/">Projects | Substrate_</a>: 一些基于Substrate建立的项目，值得参考</li>
<li><a href="https://docs.substrate.io/tutorials/v3/kitties/pt1/">Build the Substrate Kitties Chain | Substrate_</a>: 教你建立一个nft平台</li>
<li><a href="https://docs.substrate.io/v3/runtime/frame/">FRAME | Substrate_</a></li>
<li><a href="https://medium.com/frctls/the-substrate-guide-i-wish-i-had-6bc76b10ddd2">The Substrate Guide I Wish I Had. Fractal’s blockchain lead Shelby… | by Fractal | Fractal | Medium</a></li>
<li><a href="https://docs.substrate.io/reference/how-to-guides/">How-to quick reference guides | Substrate Docs</a></li>
</ul>
<h3 id="runtime-3"><a class="header" href="#runtime-3">Runtime</a></h3>
<ul>
<li><a href="https://web.archive.org/web/20220627114404/https://zhuanlan.zhihu.com/p/79539782">剖析Substrate Runtime - 知乎</a>
<blockquote>
<p>基于Substrate开发自己的运行时模块，会遇到一个比较大的挑战，就是理解Substrate运行时（Runtime）。
本文首先介绍了Runtime的架构，类型，常用宏，并结合一个实际的演示项目，做了具体代码分析，以帮助大家更好地理解在Substrate中它们是如何一起工作的。</p>
</blockquote>
</li>
</ul>
<h3 id="local-39"><a class="header" href="#local-39">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="尝试substrate"><a class="header" href="#尝试substrate">尝试Substrate</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E5%B0%9D%E8%AF%95substrate">尝试Substrate</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E5%88%9D%E4%BD%93%E9%AA%8Csubstrate%E9%93%BE">初体验Substrate链</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E8%AE%BE%E7%BD%AE%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">设置开发环境</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E4%BD%BF%E7%94%A8rustup%E8%AE%BE%E7%BD%AErust%E7%8E%AF%E5%A2%83">使用rustup设置rust环境</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E6%A3%80%E6%9F%A5%E7%8E%AF%E5%A2%83">检查环境</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E5%90%AF%E5%8A%A8%E9%93%BE%E8%8A%82%E7%82%B9">启动链节点</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E4%B8%8B%E8%BD%BDnode-template">下载node-template</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#node-templeate%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84">node-templeate项目结构</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#cargotoml">Cargo.toml</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E7%BC%96%E8%AF%91%E5%89%8D%E7%9A%84%E6%A3%80%E6%9F%A5">编译前的检查</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E7%BC%96%E8%AF%91">编译</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E5%8F%AF%E8%83%BD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98">可能遇到的问题</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E6%9C%AC%E5%9C%B0%E8%BF%90%E8%A1%8C%E8%8A%82%E7%82%B9">本地运行节点</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#docker%E8%BF%90%E8%A1%8C%E8%8A%82%E7%82%B9">docker运行节点</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E5%89%8D%E7%AB%AF%E8%AE%BF%E9%97%AE">前端访问</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E4%BD%BF%E7%94%A8%E5%89%8D%E7%AB%AF%E6%A8%A1%E7%89%88">使用前端模版</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E4%BD%BF%E7%94%A8polkadot-js%E8%AE%BF%E9%97%AE%E8%8A%82%E7%82%B9">使用polkadot-js访问节点</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#substrate%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F">Substrate使用方式</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E4%BD%BF%E7%94%A8subtrate-node">使用subtrate node</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E4%BD%BF%E7%94%A8substrate-frame">使用substrate frame</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E4%BD%BF%E7%94%A8substrate-core">使用substrate core</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#substrate%E6%96%87%E6%A1%A3%E7%BB%83%E4%B9%A0">substrate文档练习</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:38 UTC 2022 -->
<!--te-->
<h2 id="初体验substrate链"><a class="header" href="#初体验substrate链">初体验Substrate链</a></h2>
<p>这里主要使用官方提供的默认模版启动节点。</p>
<ul>
<li><a href="https://docs.substrate.io/tutorials/get-started/build-local-blockchain/">Build a local blockchain | Substrate_ Docs</a></li>
</ul>
<div id="admonition-一定要注意文档是否更新" class="admonition note">
<div class="admonition-title">
<p>一定要注意文档是否更新</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#admonition-一定要注意文档是否更新"></a></p>
</div>
<div>
<p>由于rust对crate的版本只能检查，无法解决冲突问题，需要手动进行，所以一定要注意文档是否有更新，尤其是里面的代码</p>
</div>
</div>
<p><a href="https://github.com/substrate-developer-hub/substrate-docs/issues/1132">New Substrate documentation released · Issue #1132 · substrate-developer-hub/substrate-docs</a></p>
<blockquote>
<p>另外，substrate官方文档也一直处在更新状态中。</p>
</blockquote>
<h3 id="设置开发环境"><a class="header" href="#设置开发环境">设置开发环境</a></h3>
<h4 id="使用rustup设置rust环境"><a class="header" href="#使用rustup设置rust环境">使用rustup设置rust环境</a></h4>
<pre><code class="language-shell"># 1.安装预编译包
sudo apt update &amp;&amp; sudo apt install -y git clang curl libssl-dev llvm libudev-dev

# 2.安装Rust编译环境
curl https://sh.rustup.rs -sSf | sh
source ~/.cargo/env
rustup default stable
rustup update
rustup update nightly
rustup target add wasm32-unknown-unknown --toolchain nightly
</code></pre>
<h4 id="检查环境"><a class="header" href="#检查环境">检查环境</a></h4>
<pre><code class="language-shell">rustc --version
rustup show
</code></pre>
<h3 id="启动链节点"><a class="header" href="#启动链节点">启动链节点</a></h3>
<div id="admonition-node-template" class="admonition info">
<div class="admonition-title">
<p>node-template</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#admonition-node-template"></a></p>
</div>
<div>
<p>node-template实际上是官方提供的使用substrate开发的模板链，可以理解为substrate官方提供的样例，后续任何人想使用substrate可以在这个样例的基础上进行修改，这样开发链就更方便。</p>
<blockquote>
<p>这就好比以前的好多山寨链，在btc的源码上改下创世区块的配置，就是一条新链。那么substrate其实也一样，提供了node-template这样一个模板，后续根据需求在这个上面改吧改吧，就能产生一条新链。</p>
</blockquote>
</div>
</div>
<h4 id="下载node-template"><a class="header" href="#下载node-template">下载node-template</a></h4>
<pre><code class="language-shell">git clone https://github.com/substrate-developer-hub/substrate-node-template
cd substrate-node-template
git checkout latest
</code></pre>
<div id="admonition-注意查看最新分支的编号" class="admonition note">
<div class="admonition-title">
<p>⚠️注意查看最新分支的编号</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#admonition-注意查看最新分支的编号"></a></p>
</div>
<div>
<p>/home/substrate-node-template on  #polkadot-v0.9.24</p>
</div>
</div>
<h4 id="node-templeate项目结构"><a class="header" href="#node-templeate项目结构">node-templeate项目结构</a></h4>
<div id="admonition-node-template项目结构" class="admonition info">
<div class="admonition-title">
<p>node-template项目结构</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#admonition-node-template项目结构"></a></p>
</div>
<div>
<pre><code class="language-shell">tree -L 2                                                                                                                                                                                                                              ─╯
.
├── Cargo.lock
├── Cargo.toml
├── LICENSE
├── README.md
├── docker-compose.yml
├── docs
│   └── rust-setup.md
├── node
│   ├── Cargo.toml
│   ├── build.rs
│   └── src
├── pallets
│   └── template
├── runtime
│   ├── Cargo.toml
│   ├── build.rs
│   └── src
├── rustfmt.toml
├── scripts
│   ├── docker_run.sh
│   └── init.sh
├── shell.nix
└── target
    ├── CACHEDIR.TAG
    └── release

10 directories, 15 files
</code></pre>
</div>
</div>
<h4 id="cargotoml"><a class="header" href="#cargotoml">Cargo.toml</a></h4>
<pre><code class="language-toml">[workspace]
members = [
    &quot;node&quot;,
    &quot;pallets/template&quot;,
    &quot;runtime&quot;,
]
[profile.release]
panic = &quot;unwind&quot;
</code></pre>
<blockquote>
<p>可见node-template主要包含三部分：node、pallets/template、runtime</p>
</blockquote>
<h4 id="编译前的检查"><a class="header" href="#编译前的检查">编译前的检查</a></h4>
<pre><code class="language-shell">cargo check -p node-template-runtime
</code></pre>
<div id="admonition-idea将会在修改cargotoml之后自动执行指令进行检查" class="admonition tip">
<div class="admonition-title">
<p>IDEA将会在修改Cargo.toml之后自动执行指令进行检查</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#admonition-idea将会在修改cargotoml之后自动执行指令进行检查"></a></p>
</div>
<div>
<pre><code class="language-shell">cargo metadata --verbose --format-version 1 --all-features
</code></pre>
</div>
</div>
<ul>
<li><a href="https://doc.rust-lang.org/cargo/commands/cargo-metadata.html">cargo metadata - The Cargo Book</a></li>
</ul>
<blockquote>
<p>Output JSON to stdout containing information about the workspace members and resolved dependencies of the current package.</p>
</blockquote>
<p>It is recommended to include the --format-version flag to future-proof your code to ensure the output is in the format
you are expecting.</p>
<h4 id="编译"><a class="header" href="#编译">编译</a></h4>
<pre><code class="language-shell">cargo build --release
</code></pre>
<blockquote>
<p>这个过程比较慢，会下载并编译上面三部分内的Cargo.toml列出的所有包</p>
</blockquote>
<h4 id="可能遇到的问题"><a class="header" href="#可能遇到的问题">可能遇到的问题</a></h4>
<ul>
<li>安装cmake</li>
</ul>
<pre><code class="language-shell">brew install cmake
</code></pre>
<h4 id="本地运行节点"><a class="header" href="#本地运行节点">本地运行节点</a></h4>
<pre><code class="language-shell">./target/release/node-template --dev
</code></pre>
<h4 id="docker运行节点"><a class="header" href="#docker运行节点">docker运行节点</a></h4>
<h3 id="前端访问"><a class="header" href="#前端访问">前端访问</a></h3>
<p><a href="https://docs.substrate.io/tutorials/get-started/build-local-blockchain/#install-the-front-end-template">Build a local blockchain | Substrate_ Docs</a></p>
<h3 id="使用前端模版"><a class="header" href="#使用前端模版">使用前端模版</a></h3>
<pre><code class="language-shell">node --version
yarn --version
npm install -g yarn
git clone https://github.com/substrate-developer-hub/substrate-front-end-template
cd substrate-front-end-template
yarn install
yarn start
</code></pre>
<blockquote>
<p>启动后访问本地：http://localhost:8000</p>
</blockquote>
<h4 id="使用polkadot-js访问节点"><a class="header" href="#使用polkadot-js访问节点">使用polkadot-js访问节点</a></h4>
<div id="admonition-polkadot-js-app" class="admonition info">
<div class="admonition-title">
<p>polkadot-js-app</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#admonition-polkadot-js-app"></a></p>
</div>
<div>
<p>在substrate官方的教程中，是使用了substrate的前端模板来访问刚才启动的节点。但是在实际的开发中，后端人员其实更多的使用polkadot-js-app来访问我们的节点，所以这里我们也使用它来访问我们的节点。</p>
</div>
</div>
<ul>
<li>在浏览器中输入https://polkadot.js.org/apps, 点击左上角会展开；</li>
</ul>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/CleanShot%202022-07-01%20at%2020.08.02%402x.png" alt="CleanShot 2022-07-01 at 20.08.02@2x" /></p>
<ul>
<li>
<p>在展开的菜单中点击DEVELOPMENT；</p>
</li>
<li>
<p>点击Local Node；</p>
</li>
<li>
<p>点击switch。</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/CleanShot%202022-07-01%20at%2020.17.59%402x.png" alt="CleanShot 2022-07-01 at 20.17.59@2x" /></p>
<h2 id="substrate使用方式"><a class="header" href="#substrate使用方式">Substrate使用方式</a></h2>
<blockquote>
<p>使用substrate的方式主要有以下几种：</p>
</blockquote>
<h3 id="使用subtrate-node"><a class="header" href="#使用subtrate-node">使用subtrate node</a></h3>
<p>开发者可以运行已经设计好的substrate节点，并配置genesis区块，在此方式下只需要提供一个json文件就可以启动自己的区块链。其实我们上一节的substrate初体验，也可以看成是使用此种方式的一个例子。</p>
<h3 id="使用substrate-frame"><a class="header" href="#使用substrate-frame">使用substrate frame</a></h3>
<p>frame其实是一组模块（pallet）和支持库。使用substrate frame可以轻松的创建自己的自定义运行时，因为frame是用来构建底层节点的。使用frame还可以配置数据类型，也可以从模块库中选择甚至是添加自己定义的模块。</p>
<h3 id="使用substrate-core"><a class="header" href="#使用substrate-core">使用substrate core</a></h3>
<p>使用substrate code运行开发者完全从头开始设计运行时（runtime，问题：什么是runtime？），当然此种方式也是使用substrate自由度最大的方式。</p>
<div id="admonition-几种方式的关系可以用图描述如下技术自由-vs-开发便利" class="admonition tip">
<div class="admonition-title">
<p>几种方式的关系可以用图描述如下：技术自由 vs 开发便利</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_try.html#admonition-几种方式的关系可以用图描述如下技术自由-vs-开发便利"></a></p>
</div>
<div>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/technical-freedom.png" alt="Technical freedom vs development ease" /></p>
</div>
</div>
<h2 id="参考资源-44"><a class="header" href="#参考资源-44">参考资源</a></h2>
<h3 id="substrate文档练习"><a class="header" href="#substrate文档练习">substrate文档练习</a></h3>
<ul>
<li>
<p><a href="https://web.archive.org/web/20220628074841/https://mp.weixin.qq.com/s/2DuNX0-a14yPKT1nJNjk7Q">构建一条链的体验</a></p>
<blockquote>
<p>substrate官方教程里面的<a href="https://docs.substrate.io/tutorials/v3/create-your-first-substrate-chain/">第一课</a>名称叫做创建我们的第一条链，
实际上我觉得应该叫做启动substrate默认模板链的节点更贴切，因为这个教程里面实际上就是把一个用substrate已经开发好的模板链的代码拉下来，然后编译一下，然后再启动起来。
这个过程实际上和我们拉一个比特币的代码，然后编译下然后再启动 ，并没有太大的不同。</p>
</blockquote>
<ul>
<li>
<p>substrate 开发环境</p>
<blockquote>
<ul>
<li>启动链的节点：
&gt; 这里要用到node-template的代码。node-template实际上是官方提供的使用substrate开发的模板链，
&gt; 可以理解为substrate官方提供的样例，后续任何人想使用substrate可以在这个样例的基础上进行修改，这样开发链就更方便。
&gt; 这就好比以前的好多山寨链，在btc的源码上改下创世区块的配置，就是一条新链。 那么substrate其实也一样，提供了node-template这样一个模板，后续根据需求在这个上面改吧改吧，就能产生一条新链。</li>
</ul>
</blockquote>
</li>
<li>
<p>使用polkadot-js访问节点:
在substrate官方的教程中，是使用了substrate的前端模板来访问刚才启动的节点。但是在实际的开发中，后端人员其实更多的使用polkadot-js-app来访问我们的节点，所以这里我们也使用它来访问我们的节点。</p>
</li>
<li>
<p><a href="https://docs.substrate.io/tutorials/v3/create-your-first-substrate-chain/">文档资料</a></p>
</li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220628084629/https://mp.weixin.qq.com/s/GSWxgEA-CtdB8pi-gHe1ig">Substrate快速入门</a></p>
<blockquote>
<p>substrate采用模块化的方法进行开发，它定义了一组丰富的原语，给开发人员提供了强大的、熟悉的编程方法。</p>
</blockquote>
<ul>
<li>
<p>使用方式介绍：</p>
<ol>
<li>
<p>使用substrate node: 使用json文件启动</p>
</li>
<li>
<p>使用substrate frame: 业务逻辑自由</p>
<blockquote>
<p>frame其实是一组模块（pallet）和支持库。使用substrate frame可以轻松的创建自己的自定义运行时，因为frame是用来构建底层节点的。使用frame还可以配置数据类型，也可以从模块库中选择甚至是添加自己定义的模块。</p>
</blockquote>
</li>
<li>
<p>使用substrate core: runtime自由</p>
<blockquote>
<p>使用substrate code运行开发者完全从头开始设计运行时（runtime，问题：什么是runtime？），当然此种方式也是使用substrate自由度最大的方式。</p>
</blockquote>
</li>
</ol>
</li>
<li>
<p>Substrate Client:</p>
<blockquote>
<p>substrate客户端是基于substrate实现的区块链的节点客户端（可以理解为全节点），它主要由以下几个组件组成（以下也就是告诉我们实现一条链由哪几部分组成）：</p>
</blockquote>
<ol>
<li>存储: 用来维持区块链系统所呈现的状态演变。substrate提供了的存储方式是一种简单有效的key-value对存储机制的方式。</li>
<li>Runtime: 这里就可以回答上面的问题，什么是runtime？runtime定义了区块的处理方式，主要是状态转换的逻辑。在substrate中，runtime code被编译成wasm作为区块链存储状态的一部分。</li>
<li>p2p网络: 允许客户端和其它网络参与者进行通信。</li>
<li>共识: 提供了一种逻辑，能使网络参与者就区块链的状态达成一致。substrate支持提供自定义的共识引擎。</li>
<li>RPC: 远程过程调用。</li>
<li>telemetry: 通过嵌入式Prometheus服务器的方式对外展示（我理解应该是类似于区块链浏览器一样的东西，或者是提供信息给区块链浏览器展示）。</li>
</ol>
</li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220628065030/https://mp.weixin.qq.com/s/MrnenO7AWhrf_-3Qs-aRJg">构建一个PoE(Prove of Existence)去中心化的应用</a></p>
<blockquote>
<p>substrat官方手册的第三个例子，使用substrate来创建自定义的存在证明dapp。我们本节的主要内容分为以下三步：</p>
</blockquote>
<ol>
<li>基于node template启动一条substrate的链。</li>
<li>修改node template来添加我们自己定制的Poe pallet，并实现我们的PoE API。</li>
<li>修改前端模板以添加与PoE API交互的自定义用户界面。</li>
</ol>
<ul>
<li>接口设计</li>
<li><strong>创建自定义pallet</strong>
<blockquote>
<p>node template的运行时是基于FRAME来实现的。FRAME是一个代码库，允许我们使用一系列pallet来构建底层的运行时。pallet可以看出是定义区块链功能的单个逻辑模块。subtrate为我们提供了一些已经构建好的pallet，我们在定义运行时时可以直接使用。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220628065034/https://mp.weixin.qq.com/s/w9Cj7jWkTo-PIBxtIyV9xQ">使用substrate构建私有网络</a></p>
<blockquote>
<p>本节内容：</p>
</blockquote>
<ol>
<li>基于模板启动substrate区块链网络；</li>
<li>生成ed25519和sr25519 密钥对用于网络授权；</li>
<li>创建和编辑chainspec json文件。</li>
</ol>
<ul>
<li><a href="https://substrate.dev/docs/en/tutorials/start-a-private-network/">参考资料</a></li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220628070053/https://mp.weixin.qq.com/s/1Yf6H6NoEOlpYQlBtuhy7A">构建kitties链条</a></p>
<blockquote>
<p>分两部分，一是介绍如何构建kitties pallet，包括创建与kittes交互的功能；另一部分是介绍开发前端UI，与我们第一部分的链进行交互。
目标：</p>
</blockquote>
<ol>
<li>学习构建和运行substrate节点的基本模式。</li>
<li>编写自定义框架pallet并集成到运行时。</li>
<li>了解如何创建和更新存储项。</li>
<li>编写pellet相关辅助函数。</li>
<li>使用PolkadotJs API将substrate节点连接到自定义前端。</li>
</ol>
<ul>
<li>kitties功能：
<ol>
<li>可以通过一些原始来源或者通过使用现有小猫进行繁殖创造。</li>
<li>以其所有者设定的价格出售。</li>
<li>从一个所有者转移到另一个所有者。</li>
</ol>
</li>
<li><a href="https://docs.substrate.io/tutorials/v3/kitties/pt1/#tutorial-objectives">参考资料</a></li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220628070149/https://mp.weixin.qq.com/s/dOghynr1eVMdtXITwY5clQ">构建授权网络</a></p>
<blockquote>
<p>无许可准入区块链网络我们比较常见，例如比特币、以太坊都是无准入的。那么授权准入网络在哪些地方可能出现呢?</p>
</blockquote>
<ol>
<li>专用网络或者是联盟链网络；</li>
<li>高度管控的环境；</li>
<li>大规模测试预公开网络。</li>
</ol>
<blockquote>
<p>目标</p>
</blockquote>
<ol>
<li>修改node-template工程添加node-authorization pallet。</li>
<li>加载部分节点并授权新节点加入网络。</li>
</ol>
</li>
<li>
<p><a href="https://web.archive.org/web/20220628070102/https://mp.weixin.qq.com/s/tvva1vogIcyN60tWcBPqww">初探ink!智能合约开发</a></p>
<ul>
<li>
<p><a href="https://web.archive.org/web/20220628095113/https://zhuanlan.zhihu.com/p/468304741">发展两年的波卡智能合约语言ink!将会带来什么影响？ - 知乎</a></p>
<blockquote>
<p>ink!是由Parity在这里开发智能合约语言Rust编写智能合同并编译成Wasm代码。
智能合同是在分散区块链网络上运行的计算机协议，可视为可自动执行的应用程序。
ink!它不同于其他更成熟的智能合约语言Parity的烙印。ink!最初是通过使用Rust宏系统生成自定义语法和风格，开发智能合约。
但是这种方法偏离了Rust在不牺牲易用性或开发性的前提下，开发人员熟悉和喜欢的语言诞生了ink!2.0.为开发人员提供最大的灵活性。简单来说，整合后现在ink!所有的结构和语法都是纯的Rust</p>
</blockquote>
</li>
<li>
<p><a href="https://docs.substrate.io/tutorials/v3/ink-workshop/pt1/">参考</a></p>
</li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220628070203/https://mp.weixin.qq.com/s/lPkXiu4hyYryHCqx-peRmQ">深入ink!智能合约</a></p>
<blockquote>
<p>学习智能合约的开发，主要包括：</p>
</blockquote>
<ul>
<li>ink!智能合约的结构；</li>
<li>存储单个的值和hash map；</li>
<li>安全的设置或获取这些值；</li>
<li>编写public和private函数；</li>
<li>配置Rust使用安全的数学库。</li>
</ul>
<blockquote>
<p>总的来说，写ink！合约和直接用Rust编码没有太大的区别，只要能使用Rust都能很快的编写合约。</p>
</blockquote>
</li>
<li>
<p><a href="https://web.archive.org/web/20220628065106/https://mp.weixin.qq.com/s/fLZc_lQxe1jpgfHmmZ65Lg">ERC20合约开发</a></p>
<ul>
<li><a href="https://web.archive.org/web/20220628095517/https://www.jb51.net/blockchain/797814.html">ERC20协议是什么意思?一文读懂ERC20协议_区块链技术_区块链_脚本之家</a></li>
</ul>
<blockquote>
<p>学习写一个ERC20合约，主要包括：</p>
</blockquote>
<ul>
<li>初始token设置；</li>
<li>支持transfer；</li>
<li>通过substrate触发事件。</li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220628065113/https://mp.weixin.qq.com/s/qvqsKqn_h79Uig30jgQk7A">无分叉runtime升级</a></p>
<blockquote>
<p>substrate框架的特性之一就是支持无分叉运行时升级。无分叉升级时以区块链自身能力支持和保护的方式增强区块链运行时的一种手段，区块链的运行时定义了区块链可以保持的状态，还定义了改变该装填的逻辑。
substrate可以在不分叉的情况下更新runtime，因为运行时的定义本身就是substrate链中的一个元素，网络参与者可以通过交易函数，特别是set_code函数来更新该值。
由于运行时状态的更新受到区块链共识机制和加密安全的约束，网络参与者可以在不分叉的情况下使用不受信任分发的更新或者扩展的运行时逻辑，甚至不需要发布新的区块链客户端。</p>
</blockquote>
<ul>
<li>本节内容：
<ol>
<li>使用sudo调用将schelduler</li>
<li>pallet包含到runtime中；</li>
<li>调用runtime升级。</li>
</ol>
</li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220628065121/https://mp.weixin.qq.com/s/QSJRjdvqKgbY9eMbdhpVOA">Relay Chain</a></p>
<blockquote>
<p>学习启动一个relay chain， 通过cumus来创建自己的parachain，并且在在本地测试网络中将parachain连接到relaychain。</p>
</blockquote>
</li>
<li>
<p><a href="https://web.archive.org/web/20220628074818/https://mp.weixin.qq.com/s/hF3vevPi4ZLuXwR2Ehhp_A">连接parachain</a></p>
<blockquote>
<p>上一节，我们启动了relaychain的节点，本节将连接parachain到relaychain节点。 主要包括以下内容：</p>
</blockquote>
<ul>
<li>启动parachain；</li>
<li>parachain注册；</li>
<li>和parachain交互；</li>
<li>连接到添加的parachain节点。 </li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="substrate深入尝试pallet"><a class="header" href="#substrate深入尝试pallet">Substrate深入尝试pallet</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#substrate%E6%B7%B1%E5%85%A5%E5%B0%9D%E8%AF%95pallet">Substrate深入尝试pallet</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#%E6%96%87%E6%A1%A3%E4%BB%A3%E7%A0%81%E6%9B%B4%E6%96%B0%E9%97%AE%E9%A2%98">文档/代码更新问题</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#1-%E8%AE%BE%E7%BD%AE%E6%98%B5%E7%A7%B0%E6%B7%BB%E5%8A%A0%E7%AC%AC%E4%B8%80%E4%B8%AApallet%E5%88%B0runtime">1. 设置昵称：添加第一个Pallet到Runtime</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#runtime%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90">runtime结构分析</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#runtimecargotoml%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90">runtime/Cargo.toml结构分析</a>
<ul>
<li>[[package]{...}](#package)</li>
<li>[[package.metadata.docs.rs]{...}](#packagemetadatadocsrs)</li>
<li>[[dependencies]{...}](#dependencies)</li>
<li>[[build-dependencies]{...}](#build-dependencies)</li>
<li>[[features]{...}](#features)</li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#%E5%9B%9B%E6%AD%A5%E6%B7%BB%E5%8A%A0pallet">四步添加pallet</a>
<ul>
<li>[添加依赖: Cargo.toml/[dependincies]](#添加依赖-cargotomldependincies)</li>
<li>[添加feature: Cargo.toml/[features]](#添加feature-cargotomlfeatures)</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#%E9%85%8D%E7%BD%AE-%E6%B7%BB%E5%8A%A0config%E6%8E%A5%E5%8F%A3-srclibrs">配置-&gt;添加config接口: src/lib.rs</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#%E5%AE%9A%E4%B9%89%E8%BF%90%E8%A1%8C%E6%97%B6-srclibrsconstruct_runtime">定义运行时: src/lib.rs/construct_runtime!</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#%E7%BC%96%E8%AF%91-%E8%BF%90%E8%A1%8C-%E5%90%AF%E5%8A%A8%E5%89%8D%E7%AB%AF">编译-&gt;运行-&gt;启动前端</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD">验证功能</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#%E4%B8%BA%E5%B8%90%E6%88%B7%E8%AE%BE%E7%BD%AE%E6%98%B5%E7%A7%B0">为帐户设置昵称</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#%E4%BD%BF%E7%94%A8nicks-pallet%E6%9F%A5%E8%AF%A2%E8%B4%A6%E6%88%B7%E4%BF%A1%E6%81%AF">使用Nicks pallet查询账户信息</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98">可能出现的问题</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#2-%E6%8C%87%E5%AE%9A%E8%B0%83%E7%94%A8%E6%BA%90%E5%A4%B4unsigned-signed-or-sudo">2. 指定调用源头unsigned, signed or sudo</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#signed%E4%B8%8Esudo%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90">signed与sudo有不同权限。</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#pallet%E7%9B%B8%E5%85%B3">pallet相关</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:36 UTC 2022 -->
<!--te-->
<h2 id="文档代码更新问题"><a class="header" href="#文档代码更新问题">文档/代码更新问题</a></h2>
<pre><code class="language-admonisth warn title='substrate文档更新带来的问题'">由于目前substrate的源码和文档都在快速更新，所以可能出现一些未曾说过的问题。比如链接找不到、目录里面不存在对应文章链接、编译时依赖包版本冲突。这些都需要对文档的熟悉、对rust编程的熟悉才能轻松越过。
</code></pre>
<h2 id="1-设置昵称添加第一个pallet到runtime"><a class="header" href="#1-设置昵称添加第一个pallet到runtime">1. 设置昵称：添加第一个Pallet到Runtime</a></h2>
<blockquote>
<p>substrate node template提供了一个最小的可工作的运行时，但是为了保持精炼，它并不包括Frame中的大多数的Pallet</p>
</blockquote>
<ul>
<li><a href="https://docs.substrate.io/tutorials/work-with-pallets/add-a-pallet/">Add a pallet to the runtime | Substrate_ Docs</a>
接下来接着使用前面的node template</li>
</ul>
<h3 id="runtime结构分析"><a class="header" href="#runtime结构分析">runtime结构分析</a></h3>
<pre><code class="language-shell">tree -L 2 runtime                                                                                               ─╯
runtime
├── Cargo.toml
├── build.rs
└── src
    └── lib.rs

1 directory, 3 files
</code></pre>
<h3 id="runtimecargotoml结构分析"><a class="header" href="#runtimecargotoml结构分析">runtime/Cargo.toml结构分析</a></h3>
<h4 id="package"><a class="header" href="#package">[package]{...}</a></h4>
<h4 id="packagemetadatadocsrs"><a class="header" href="#packagemetadatadocsrs">[package.metadata.docs.rs]{...}</a></h4>
<h4 id="dependencies"><a class="header" href="#dependencies">[dependencies]{...}</a></h4>
<h4 id="build-dependencies"><a class="header" href="#build-dependencies">[build-dependencies]{...}</a></h4>
<h4 id="features"><a class="header" href="#features">[features]{...}</a></h4>
<h3 id="四步添加pallet"><a class="header" href="#四步添加pallet">四步添加pallet</a></h3>
<h4 id="添加依赖-cargotomldependincies"><a class="header" href="#添加依赖-cargotomldependincies">添加依赖: Cargo.toml/[dependincies]</a></h4>
<pre><code class="language-toml">pallet-nicks = { default-features = false, version = '4.0.0-dev', git = 'https://github.com/paritytech/substrate.git', tag = 'monthly-2021-08' }
</code></pre>
<div id="admonition-排地雷" class="admonition note">
<div class="admonition-title">
<p>排地雷</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#admonition-排地雷"></a></p>
</div>
<div>
<p>由于官方文档和代码一直都在更新，可能会出现问题，这里就需要根据默认依赖的substrate分支进行更换</p>
<pre><code class="language-toml">[dependencies]
sp-std = { version = &quot;4.0.0-dev&quot;, default-features = false, git = &quot;https://github.com/paritytech/substrate.git&quot;, branch = &quot;polkadot-v0.9.24&quot; }
</code></pre>
<p>如上所示，对应的分支为：branch = &quot;polkadot-v0.9.24&quot;, 所以需要改成：</p>
<pre><code class="language-toml">[dependencies.pallet-nicks]
default-features = false
git = 'https://github.com/paritytech/substrate.git'
#tag = 'monthly-2021-10'
#tag = 'monthly-2022-04'
branch = &quot;polkadot-v0.9.24&quot;
version = '4.0.0-dev'
</code></pre>
<blockquote>
<p>详见: <a href="layer5_ecosystem/7_business/blockchain/substrate//layer2_design_abstract/6_module_manage/cargo_rustc.html#cargo-%E4%B8%8E-git-%E7%9A%84%E5%85%B3%E8%81%94">cargo 与 git</a></p>
</blockquote>
</div>
</div>
<h4 id="添加feature-cargotomlfeatures"><a class="header" href="#添加feature-cargotomlfeatures">添加feature: Cargo.toml/[features]</a></h4>
<pre><code class="language-toml">[features]
default = [&quot;std&quot;]
std = [
    #--snip--
    'pallet-nicks/std',
    #--snip--
]
</code></pre>
<h4 id="配置-添加config接口-srclibrs"><a class="header" href="#配置-添加config接口-srclibrs">配置-&gt;添加config接口: src/lib.rs</a></h4>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Add this code block to your template for Nicks:
parameter_types! {
    // Choose a fee that incentivizes desireable behavior.
    pub const NickReservationFee: u128 = 100;
    pub const MinNickLength: usize = 8;
    // Maximum bounds on storage are important to secure your chain.
    pub const MaxNickLength: usize = 32;
}

impl pallet_nicks::Config for Runtime {
    // The Balances pallet implements the ReservableCurrency trait.
    // https://substrate.dev/rustdocs/v3.0.0/pallet_balances/index.html#implementations-2
    type Currency = pallet_balances::Module&lt;Runtime&gt;;

    // Use the NickReservationFee from the parameter_types block.
    type ReservationFee = NickReservationFee;

    // No action is taken when deposits are forfeited.
    type Slashed = ();

    // Configure the FRAME System Root origin as the Nick pallet admin.
    // https://substrate.dev/rustdocs/v3.0.0/frame_system/enum.RawOrigin.html#variant.Root
    type ForceOrigin = frame_system::EnsureRoot&lt;AccountId&gt;;

    // Use the MinNickLength from the parameter_types block.
    type MinLength = MinNickLength;

    // Use the MaxNickLength from the parameter_types block.
    type MaxLength = MaxNickLength;

    // The ubiquitous event type.
    type Event = Event;
}
<span class="boring">}
</span></code></pre></pre>
<h4 id="定义运行时-srclibrsconstruct_runtime"><a class="header" href="#定义运行时-srclibrsconstruct_runtime">定义运行时: src/lib.rs/construct_runtime!</a></h4>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>construct_runtime!(
    pub enum Runtime where
        Block = Block,
        NodeBlock = opaque::Block,
        UncheckedExtrinsic = UncheckedExtrinsic
    {
        /* --snip-- */

        /*** Add This Line ***/
        Nicks: pallet_nicks::{Module, Call, Storage, Event&lt;T&gt;},
    }
);
<span class="boring">}
</span></code></pre></pre>
<h3 id="编译-运行-启动前端"><a class="header" href="#编译-运行-启动前端">编译-&gt;运行-&gt;启动前端</a></h3>
<pre><code class="language-shell">cargo build --release
./target/release/node-template --dev --tmp
yarn start
</code></pre>
<h3 id="验证功能"><a class="header" href="#验证功能">验证功能</a></h3>
<h4 id="为帐户设置昵称"><a class="header" href="#为帐户设置昵称">为帐户设置昵称</a></h4>
<ul>
<li>检查帐户选择列表以验证当前选择了 Alice 帐户。</li>
<li>在 Pallet Interactor 组件中，确认选择了 Extrinsic。</li>
<li>从可调用的托盘列表中选择nicks。</li>
<li>选择 <strong>settName</strong> 作为要从 nicks palette 调用的函数。</li>
<li>键入一个长于 MinNickLength（8 个字符）且不长于 MaxNickLength（32 个字符）的名称。</li>
<li>单击Signed以执行该功能。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/CleanShot%202022-07-03%20at%2010.51.26.png" alt="CleanShot 2022-07-03 at 10.51.26" /></p>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/CleanShot%202022-07-03%20at%2010.54.34.png" alt="CleanShot 2022-07-03 at 10.54.34" /></p>
<h4 id="使用nicks-pallet查询账户信息"><a class="header" href="#使用nicks-pallet查询账户信息">使用Nicks pallet查询账户信息</a></h4>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/CleanShot%202022-07-03%20at%2011.00.08.png" alt="CleanShot 2022-07-03 at 11.00.08" /></p>
<ul>
<li>
<p>按图所示进行设置，查询，复制Alice的地址进行查询会返回一个元组，里面的两个值分别指：</p>
<ul>
<li>Alice 帐户的十六进制编码昵称。</li>
<li>为保护昵称而从 Alice 的账户中保留的金额。</li>
</ul>
</li>
</ul>
<blockquote>
<p>如果使用Bob的地址，会返回None，因为没有给他设置昵称。</p>
</blockquote>
<h3 id="可能出现的问题"><a class="header" href="#可能出现的问题">可能出现的问题</a></h3>
<ul>
<li><a href="https://github.com/substrate-developer-hub/pallet-did/issues/9">Conflicts when adding pallet to substrate-node-template · Issue #9 · substrate-developer-hub/pallet-did</a></li>
<li><a href="https://substrate.stackexchange.com/questions/2774/error-failed-to-select-a-version-for-parity-util-mem">substrate node template - &quot;error: failed to select a version for <code>parity-util-mem</code>&quot; - Substrate and Polkadot Stack Exchange</a></li>
</ul>
<h2 id="2-指定调用源头unsigned-signed-or-sudo"><a class="header" href="#2-指定调用源头unsigned-signed-or-sudo">2. 指定调用源头unsigned, signed or sudo</a></h2>
<ul>
<li><a href="https://docs.substrate.io/tutorials/work-with-pallets/specify-origin/">Specify the origin for a call | Substrate_ Docs</a></li>
</ul>
<blockquote>
<p>前面已经介绍用Alice的地址来设置并查询nickname(setName)，里面还有其他函数(killName、forceName、clearName)这里将会进行调用验证</p>
</blockquote>
<h3 id="signed与sudo有不同权限"><a class="header" href="#signed与sudo有不同权限">signed与sudo有不同权限。</a></h3>
<p>点击Sudo按钮将会发出一个 Sudid 事件以通知节点参与者 Root 源发送了一个呼叫。 但是，内部调度会因 DispatchError 而失败（Sudo 按钮的 sudo 函数是“外部”调度）。</p>
<blockquote>
<p>特别是，这是 DispatchError::Module 变体的一个实例，它会提供两个元数据：一个索引号和一个错误号。</p>
</blockquote>
<ul>
<li>索引号与产生错误的pallet有关；它对应于construct_runtime!中pallet的索引（位置）！。</li>
<li>错误编号与该托盘的错误枚举中相关变体的索引相对应。</li>
</ul>
<blockquote>
<p>使用这些数字查找托盘错误时，请记住索引是从零开始。</p>
</blockquote>
<p>比如：</p>
<ul>
<li>索引为 9（第十个托盘），对应nicks,</li>
<li>错误为 2（第三个错误）,
对应<a href="https://github.com/paritytech/substrate/blob/master/frame/nicks/src/lib.rs#L99-L108">substrate源码</a>中定义的第三个错误</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Error for the nicks pallet.
#[pallet::error]
pub enum Error&lt;T&gt; {
    /// A name is too short.    
    TooShort,
    /// A name is too long.
    TooLong,
    /// An account isn't named.
    Unnamed,
}
<span class="boring">}
</span></code></pre></pre>
<ul>
<li>取决于您的construct_runtime中尼克斯托盘的位置！宏，您可能会看到不同的索引编号。不管 index 的值如何，你应该看到错误值是 2，它对应于 Nick 的 Pallet 的 Error 枚举的第三个变体，Unnamed
变体。这应该不足为奇，因为 Bob 尚未保留昵称，因此无法清除！</li>
</ul>
<h2 id="参考资料-1"><a class="header" href="#参考资料-1">参考资料</a></h2>
<h3 id="pallet相关"><a class="header" href="#pallet相关">pallet相关</a></h3>
<ul>
<li>
<p><a href="https://web.archive.org/web/20220628065009/https://mp.weixin.qq.com/s/iQ6a-diWMfYDghuLVPJd9Q">添加一个pallet到runtime</a></p>
<blockquote>
<p>substrate node template提供了一个最小的可工作的运行时，但是为了保持精炼，它并不包括Frame中的大多数的Pallet。本节我们将学习如何将Pallet添加到runtime中。</p>
</blockquote>
<ol>
<li>安装Node Template</li>
<li>导入Pallet</li>
<li>配置Pallet</li>
<li>将Nicks添加到construct_runtime!中</li>
</ol>
<ul>
<li><a href="https://docs.substrate.io/tutorials/work-with-pallets/add-a-pallet/">Add a pallet to the runtime | Substrate_ Docs</a></li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220627101518/https://mp.weixin.qq.com/s/wPVbEeIVKdXGro0QYsmJBg">Pallet前置知识</a></p>
<ul>
<li>trait的孤儿规则</li>
<li>trait对象</li>
<li>trait的继承</li>
<li>关联类型</li>
<li>定义Config trait，然后为Pallet实现相应的trait，最后在main函数中使用它</li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220626145126/https://mp.weixin.qq.com/s/4vIelf3YSV4fybakkT6QPQ">编写简单的pallet</a></p>
<ul>
<li>
<p>node-template的结构</p>
</li>
<li>
<p>编写pallet的一般格式, 整理出7个部分, 1和2基本上是固定的写法，而对于后面的3-7部分，则是根据实际需要写或者不写。关于模板中每部分的解释，可以参考文档.</p>
<ol>
<li>依赖;</li>
<li>pallet类型声明;</li>
<li>config trait;</li>
<li>定义要使用的链上存储;</li>
<li>事件;</li>
<li>钩子函数;</li>
<li>交易调用函数;</li>
</ol>
</li>
<li>
<p>举例编写simple-pallet</p>
<blockquote>
<p>功能介绍: simple-pallet是一个存证的pallet，简单说就是提供一个存取一段hash到链上的功能，和从链上读取的功能。</p>
</blockquote>
</li>
<li>
<p>将pallet添加到runtime中</p>
</li>
<li>
<p>编译运行</p>
</li>
<li>
<p>调试使用pallet中的功能</p>
</li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220627101333/https://mp.weixin.qq.com/s/1M2HBpxIDVPDwHvbTLEk4w">Pallet的组成</a></p>
<blockquote>
<p>要想熟练的开发pallet，我们必须得把pallet中的各个组成部分弄清楚。本节，我们就按照模板中的各个部分的顺序来讲解pallet的组成</p>
</blockquote>
<ol>
<li>导出和依赖：Pub mod pallet{}就是将我们的pallet暴露出来， pub use pallet::*;是可以使用pallet中的所有类型，函数，数据等</li>
<li>pallet类型声明：它是一系列trait和方法的拥有者，实际的作用类似于占位符，这里举例rust程序</li>
<li>config trait： 这部分是指定Runtime的配置trait，Pallet中使用的一些类型和常量在此trait中进行配置。</li>
<li>Storage-定义要使用的链上存储： 存储（Storage）允许我们在链上存储数据，使用它存储的数据可以通过Runtime进行访问。substrate提供了四种存储方式，分别是：
<ul>
<li>Storage Value: 存储单个的值, 无键</li>
<li>Storage Map: 以map方式存储，单键，key-value</li>
<li>Storage Double Map: 以双键方式存储，(key1, key2)-value</li>
<li>Storage N Map: 以多键方式存储，(key1, key2, ..., keyn)-value</li>
</ul>
</li>
<li>Event-事件：当pallet需要把运行时上的更改或变化通知给外部主体时，就需要用到事件。事件是一个枚举类型</li>
<li>hooks-钩子函数：钩子函数，是在区块链运行过程中希望固定执行的函数，例如我们希望在每个区块构建之前、之后的时候执行某些逻辑等，就可以把这些逻辑放在钩子函数中</li>
<li>Extrinsic-调度函数，交易调用函数: Extrinsic则是<strong>可以从runtime外部可以调用的函数，也是pallet对外提供的逻辑功能</strong>。比如交易</li>
</ol>
</li>
<li>
<p><a href="https://web.archive.org/web/20220628021501/https://mp.weixin.qq.com/s/tPyB9CuTVP2Y1DGgl_VPyQ">hooks: pallet的🪝钩子函数使用</a></p>
<ul>
<li>substrate中的执行过程
<ol>
<li>初始化区块（Initializes the block）</li>
<li>执行区块（Executes extrinsics）</li>
<li>确认区块（ Finalizes the block）.</li>
</ol>
</li>
<li>hooks介绍:
<ol>
<li>on_finalize: 在区块 finalize 的时候调用。</li>
<li>on_idle：区块finalize的时候调用，不过比on_finalize先调用。</li>
<li>on_initialize：区块初始化的时候调用。</li>
<li>on_runtime_upgrade：执行模块升级的时候调用。</li>
<li>pre_upgrade：升级之前的检查。</li>
<li>post_upgrade：升级之后的处理。</li>
<li>offchain_worker：在一个 pallet 上实现此函数后可以在此函数中长时间的执行需要链下执行的功能。该函数会在每次区块导入的时候调用。后续我们讲ocw使用的时候就需要和这个函数打交道。</li>
<li>integrity_test：运行集成测试。</li>
</ol>
</li>
<li>示例</li>
<li><a href="https://docs.substrate.io/v3/concepts/execution/">资料</a></li>
<li><a href="https://paritytech.github.io/substrate/master/frame_support/traits/trait.Hooks.html">substrate源码</a></li>
</ul>
</li>
<li>
<p><a href="https://mp.weixin.qq.com/s/Xnv5aNiLn-NoH6obouaONg">substrate轻松学：写调度函数</a></p>
<blockquote>
<p>调度函数在substrate官方文档里面叫做Extrinsics（外部调用），详细的Extrinsics介绍可以参考这里.在substrate中共有三种Extrinsics，分别是Inherents、Signed transactions和Unsigned transactions。而在我们开发pallet的过程中，比较常用到的是后两种，所以我们这里也主要介绍后两种，对于Inherents有兴趣的小伙伴可以自己看官方文档研究下。</p>
</blockquote>
<ul>
<li>Signed transactions</li>
<li>Unsigned transactions</li>
<li>通常写法：调度函数的位置-&gt;函数体的写法-&gt;权重-&gt;transactional</li>
<li>示例</li>
<li></li>
</ul>
<p>参考：<a href="https://docs.substrate.io/v3/concepts/extrinsics/">extrinsics</a>&amp;<a href="https://docs.substrate.io/v3/runtime/weights-and-fees/">weights-and-fees</a></p>
</li>
<li>
<p><a href="https://web.archive.org/web/20220627112629/https://mp.weixin.qq.com/s/cNijF5h2Yn7R-K0ryoOJrA">pallet中Error类型的使用</a></p>
<blockquote>
<p>在runtime代码执行时，代码必须是“非抛出的”，或者说不应该panic，应该是优雅的处理错误，所以在写pallet代码时，允许我们自定义错误类型，当错误发生时，可以返回我们定义的错误类型。这里的Error类型是指运行时在执行调度函数（也就是交易函数）时返回的错误。因为在调度函数执行时，返回的结果为DispatchResult类型，当执行结果错误时，返回DispatchError。</p>
</blockquote>
<ul>
<li>错误类型的定义</li>
<li>在函数中返回错误</li>
<li>简单示例</li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220627112755/https://mp.weixin.qq.com/s/JOaBn4bkda2LicV3Lyb4tw">pallet中的config</a></p>
<ul>
<li>好好理解rust中关于trait和关联类型相关的知识</li>
<li>pallet 简单示例: 介绍一个存储学生信息的pallet，其中存储逻辑写在extrinsic中</li>
<li>在Config中定义配置类型：主要使用trait约束和关联类型改写</li>
<li>在runtime中指定具体的类型</li>
<li>构建、交互与调试</li>
<li><a href="https://docs.substrate.io/v3/runtime/events-and-errors/">参考资料</a></li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220627101725/https://mp.weixin.qq.com/s/z4fefNUb3avcae0htHpxgQ">在pallet中使用其他pallet</a></p>
<ul>
<li>
<p>在自己的pallet中使用其它的pallet主要有以下几种情况：</p>
<ol>
<li>指定某个现成的pallet: 在pallet的config中定义类型，然后runtime中使用时指定这个类型为frame中指定某个现成的pallet；</li>
<li>指定某个自定义的pallet: 在pallet的config中定义类型，然后runtime中使用时指定这个类型为frame中指定某个自定义的pallet；</li>
<li>封装和扩展现有的 pallet 。</li>
</ol>
</li>
<li>
<p>在runtime中直接指定某个类型为其它的pallet</p>
<blockquote>
<p>这种方式比较常见的就是在pallet中定义currency类型，然后用指定currency类型为balances pallet。详细的可以看substrate中node中的使用，在pallet_assets中使用了pallet_balances，就是通过指定前者的currency类型为后者</p>
</blockquote>
<ul>
<li><a href="https://github.com/paritytech/substrate/blob/master/bin/node/runtime/src/lib.rs#L1343">详情</a></li>
</ul>
</li>
<li>
<p>pallet中使用其它pallet的storage</p>
<blockquote>
<p>自定义两个pallet，分别叫做pallet-use-other-pallet1和pallet-storage-provider，然后我们在前一个pallet中读取和存储后一个pallet</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220627113013/https://mp.weixin.qq.com/s/23wuRo4gj4oH-3EG74NnTA">封装和扩展现有的pallet</a></p>
<ul>
<li>
<p>这里使用substrate提供的contracts pallet，然后对其中的功能进行封装。</p>
<blockquote>
<p>在我们的封装中，将contracts pallet的call函数封装成sudo_call，即需要root权限才能调用。同时，我们在runtime中加载contracts时，去掉直接调用contracts函数的方式。</p>
</blockquote>
</li>
<li>
<p>整个方式我们分成两大步骤，如下：</p>
<ol>
<li>编写extend-pallet;</li>
<li>在runtime配置extend- pallet 和contracts pallet。</li>
</ol>
</li>
<li>
<p><a href="https://www.shawntabrizi.com/substrate/extending-substrate-runtime-modules/">文档资料</a></p>
</li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220627113043/https://mp.weixin.qq.com/s/Ddu-CPgRz-U7uO4PkUnp2g">调试pallet</a></p>
<ul>
<li>在pallet开发时主要有以下几种调试方式：
<ol>
<li>logging uilities;</li>
<li>printable trait;</li>
<li>print函数;</li>
<li>if_std.</li>
</ol>
</li>
<li>使用logging uilities</li>
<li>使用 printable trait</li>
<li>使用print函数</li>
<li>使用 if_std</li>
<li><a href="https://docs.substrate.io/v3/runtime/debugging/">文档资料</a></li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220627101811/https://mp.weixin.qq.com/s/ZU5SYYrL6OORWGEbRev7Zg">为pallet编写tests</a></p>
</li>
<li>
<p><a href="https://web.archive.org/web/20220627101825/https://mp.weixin.qq.com/s/_QTUGTAWLreUVcNJcVKBjA">为pallet自定义rpc接口</a></p>
<blockquote>
<p>pallet写好后需要通过runtime加载到链上（就是runtime/src/lib.rs中的construct_runtime宏包含的部分）。那么对应到我们的测试，如果对pallet进行测试，我们也需要构建一个runtime测试环境，然后在这个环境中加载pallet，对pallet进行测试。所以，编写pallet的测试就分为以下几部分：</p>
</blockquote>
<ol>
<li>编写 mock runtime;</li>
<li>编写pallet的genesisconfig;</li>
<li>编写测试。</li>
</ol>
<ul>
<li><a href="https://docs.substrate.io/v3/runtime/custom-rpcs/">文档资料</a></li>
</ul>
</li>
<li>
<p><a href="https://web.archive.org/web/20220701080314/https://mp.weixin.qq.com/s/8DsbCwL8XkiIEbTlHx4oAg">为pallet编写benchmarking</a></p>
<blockquote>
<p>为pallet编写benchmarking分两种情况，如下：</p>
</blockquote>
<ol>
<li>对函数进行性能测试时需要的构造条件不会涉及到本pallet以外的其它pallet；</li>
<li>在对函数进行性能测试时需要先使用其它的 pallet 构造测试的先决条件。</li>
</ol>
</li>
</ul>
<div id="admonition-大部分用第一种" class="admonition info">
<div class="admonition-title">
<p>大部分用第一种</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_deep_try.html#admonition-大部分用第一种"></a></p>
</div>
<div>
<ul>
<li>第一种情况相对来说比较简单，这个也比较好找到例子。
<ul>
<li>第二种情况则比较复杂，写起来也比较麻烦。</li>
<li>不过在我们的开发中，大部分都是第一种情况。</li>
</ul>
</li>
</ul>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="substrate项目介绍"><a class="header" href="#substrate项目介绍">Substrate项目介绍</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#substrate%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D">Substrate项目介绍</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#case-study">Case Study</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#acala-network-defi">Acala Network: Defi</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#case-study-1">Case Study</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#astar-network-smart-contracts">Astar Network: Smart Contracts</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#case-study-2">Case Study</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#equilibrium">Equilibrium</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#case-study-3">Case Study</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#moonbeam-smart-contracts">Moonbeam: Smart Contracts</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#case-study-4">Case Study</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#polkadex-defi-infrastructure">Polkadex: DeFi, Infrastructure</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#case-study-5">Case Study</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#unique-network-nfts">Unique Network: NFTs</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#case-study-6">Case Study</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#%E5%88%86%E7%B1%BB%E4%BB%8B%E7%BB%8D-144">分类介绍: 144</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#defi-35">DeFi: 35</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#wallet-16">Wallet: 16</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#identity-14">Identity: 14</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#social-5">Social: 5</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#smart-contracts-10">Smart Contracts: 10</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#file-storage-5">File Storage: 5</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#bluzelle">Bluzelle</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#cere">Cere</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#crust-network">Crust Network</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#datdot">DatDot</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#equilibriumco">Equilibrium.co</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#iot-4">IoT: 4</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#data-highway">Data Highway</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#nodle">Nodle</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#origin-trail">Origin Trail</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#robonomicsairalabs">Robonomics(Airalabs)</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#gaming-7">Gaming: 7</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#ajuna-network">Ajuna Network</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#bitcountry">Bit.Country</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#celer-network">Celer Network</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#everdream-soft">Everdream Soft</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#gamedao">GameDAO</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#sensorium-corporation">Sensorium Corporation</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#bridge-4">Bridge: 4</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#infrastructure-39">Infrastructure: 39</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#relay-chain-2">Relay Chain: 2</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#nfts-1">NFTs: 1</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#unique-network">Unique Network</a></li>
</ul>
</li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a></li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:37 UTC 2022 -->
<!--te-->
<div id="admonition-他山之石可以攻玉" class="admonition tip">
<div class="admonition-title">
<p>他山之石，可以攻玉</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#admonition-他山之石可以攻玉"></a></p>
</div>
<div>
<p>都知道Substrate框架开发区块链项目功能强大，那么这里可以先看看Substrate至少能做到什么程度</p>
</div>
</div>
<h2 id="case-study"><a class="header" href="#case-study">Case Study</a></h2>
<p>这里主要重点看几个案例学习项目。</p>
<h3 id="acala-network-defi"><a class="header" href="#acala-network-defi">Acala Network: Defi</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Acala%20Network.png" alt="img" style="zoom: 25%;" />
<p>Acala is a decentralized stablecoin platform that powers cross-blockchain open finance applications.</p>
<h4 id="case-study-1"><a class="header" href="#case-study-1">Case Study</a></h4>
<p><a href="https://substrate.io/ecosystem/projects/case-studies/acala/">Acala Network Case Study | Substrate_</a></p>
<h3 id="astar-network-smart-contracts"><a class="header" href="#astar-network-smart-contracts">Astar Network: Smart Contracts</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Astar%20Network.png" alt="img" style="zoom:150%;" />
<p>Astar Network is a scaling dapps platform on Substrate compatible with Ethereum Virtual Machine (EVM) and connected to
Polkadot.</p>
<h4 id="case-study-2"><a class="header" href="#case-study-2">Case Study</a></h4>
<p><a href="https://substrate.io/ecosystem/projects/case-studies/astar/">Astar Network Case Study | Substrate_</a></p>
<h3 id="equilibrium"><a class="header" href="#equilibrium">Equilibrium</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/equilibrium.png" alt="img" style="zoom:65%;" />
<p>Equilibrium introduces a cross-chain money market that combines pooled lending with synthetic asset generation and
trading</p>
<h4 id="case-study-3"><a class="header" href="#case-study-3">Case Study</a></h4>
<p><a href="https://substrate.io/ecosystem/projects/case-studies/equilibrium/">Equilibrium Case Study | Substrate_</a></p>
<h3 id="moonbeam-smart-contracts"><a class="header" href="#moonbeam-smart-contracts">Moonbeam: Smart Contracts</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Moonbeam.png" alt="img" style="zoom:150%;" />
<p>Decentralized and permissionless, Moonbeam provides an Ethereum-compatible smart contract platform that makes it easy to
build natively interoperable applications.</p>
<h4 id="case-study-4"><a class="header" href="#case-study-4">Case Study</a></h4>
<p><a href="https://substrate.io/ecosystem/projects/case-studies/moonbeam/">Moonbeam Case Study | Substrate_</a></p>
<h3 id="polkadex-defi-infrastructure"><a class="header" href="#polkadex-defi-infrastructure">Polkadex: DeFi, Infrastructure</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Polkadex.png" alt="img" style="zoom:67%;" />
<p>Polkadex is a Open Source, Decentralized Exchange Platform that features feeless trades, Market Order, AMM and full
focus on UI.</p>
<h4 id="case-study-5"><a class="header" href="#case-study-5">Case Study</a></h4>
<p><a href="https://substrate.io/ecosystem/projects/case-studies/polkadex/">Polkadex Case Study | Substrate_</a></p>
<h3 id="unique-network-nfts"><a class="header" href="#unique-network-nfts">Unique Network: NFTs</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Unique%20Network-6253646.png" alt="img" style="zoom:400%;" />
<p>Unique Network is an infrastructure for the next generation NFTs, offering developers independence from network-wide
transaction fees and upgrades.</p>
<h4 id="case-study-6"><a class="header" href="#case-study-6">Case Study</a></h4>
<p><a href="https://substrate.io/ecosystem/projects/case-studies/unique/">Unique Network Case Study | Substrate_</a></p>
<h2 id="分类介绍-144"><a class="header" href="#分类介绍-144">分类介绍: 144</a></h2>
<p>这里主要学习网站上面的分类方法，首先分成DeFi、Wallet、Identity、Social、Smart Contracts、File Storage、IoT、Gaming、Bridge、Infrastructure、Relay
Chain、NFTs这些类别，然后再加上是否企业级别的标记.</p>
<div id="admonition-关于案例学习" class="admonition tip">
<div class="admonition-title">
<p>关于案例学习</p>
<p><a class="admonition-anchor-link" href="layer5_ecosystem/7_business/blockchain/substrate/substrate_projects.html#admonition-关于案例学习"></a></p>
</div>
<div>
<p>这里的项目有些直接提供案例学习，也会有相应标出</p>
</div>
</div>
<h2 id="defi-35"><a class="header" href="#defi-35">DeFi: 35</a></h2>
<h2 id="wallet-16"><a class="header" href="#wallet-16">Wallet: 16</a></h2>
<h2 id="identity-14"><a class="header" href="#identity-14">Identity: 14</a></h2>
<h2 id="social-5"><a class="header" href="#social-5">Social: 5</a></h2>
<h2 id="smart-contracts-10"><a class="header" href="#smart-contracts-10">Smart Contracts: 10</a></h2>
<h2 id="file-storage-5"><a class="header" href="#file-storage-5">File Storage: 5</a></h2>
<h3 id="bluzelle"><a class="header" href="#bluzelle">Bluzelle</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Bluzelle.png" alt="img" style="zoom:50%;" />
<p>The Bluzelle project enables dapps to store their data in a place that is both decentralized and mutable</p>
<h3 id="cere"><a class="header" href="#cere">Cere</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/cere.svg" alt="img" style="zoom:50%;" />
<p>Delivers fast-tracked consumer enterprise adoption through decentralized data clouds, data interoperability and SaaS
DeFi.</p>
<h3 id="crust-network"><a class="header" href="#crust-network">Crust Network</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/crust%20network.png" alt="img" style="zoom:67%;" />
<p>Crust Network implements a decentralized cloud blockchain based on Polkadot. It is designed to build a decentralized
cloud ecosystem that values data privacy and ownership.</p>
<h3 id="datdot"><a class="header" href="#datdot">DatDot</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/DatDot.png" alt="img" style="zoom:40%;" />
<p>DatDot is a Distributed (peer-to-peer ) File Hosting Network, leveraging on the Dat Protocol and Substrate.</p>
<h3 id="equilibriumco"><a class="header" href="#equilibriumco">Equilibrium.co</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/equilibrium.co.svg" alt="img" style="zoom: 200%;" />
<p>Equillibrium is building a Rust-based implementation of the InterPlanetary File System (IPFS) Protocol.</p>
<h2 id="iot-4"><a class="header" href="#iot-4">IoT: 4</a></h2>
<h3 id="data-highway"><a class="header" href="#data-highway">Data Highway</a></h3>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/data%20highway.png" alt="img" /></p>
<p>DataHighway is a DAO that incentivizes the community to run a sophisticated IoT parachain based on Polkadot using the
DHX token.</p>
<h3 id="nodle"><a class="header" href="#nodle">Nodle</a></h3>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Nodle.png" alt="img" /></p>
<p>Nodle is the world’s largest ecosystem of connected devices, providing infrastructure, software and access to data for
the Internet of Things.</p>
<h3 id="origin-trail"><a class="header" href="#origin-trail">Origin Trail</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Origin%20Trail.svg" alt="img" style="zoom: 400%;" />
<p>OriginTrail is an ecosystem dedicated to making global supply chains work together by enabling a universal,
collaborative and trusted data exchange.</p>
<h3 id="robonomicsairalabs"><a class="header" href="#robonomicsairalabs">Robonomics(Airalabs)</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/robonomics%20(airalabs).png" alt="img" style="zoom:67%;" />
<p>Robonomics Network is a set of open-source packages for Robotics, Smart Cities and Industry 4.0 developers.</p>
<h2 id="gaming-7"><a class="header" href="#gaming-7">Gaming: 7</a></h2>
<h3 id="ajuna-network"><a class="header" href="#ajuna-network">Ajuna Network</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Ajuna%20Network.png" alt="img" style="zoom: 33%;" />
<p>Ajuna Network is an infrastructure for Blockhain Games, featureing a full featured UnitySDK and UnrealSDK built on
Substrate.</p>
<h3 id="bitcountry"><a class="header" href="#bitcountry">Bit.Country</a></h3>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Bit.Country.jpeg" alt="img" /></p>
<p>Bit.Country is a decentralized world where everyone can start their own metaverse with the token economy and DAO.</p>
<h3 id="celer-network"><a class="header" href="#celer-network">Celer Network</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/celer%20network.png" alt="img" style="zoom: 33%;" />
<p>Celer Network enables fast, easy and secure off-chain transactions for payment transactions and generalized off-chain
smart contract.</p>
<h3 id="everdream-soft"><a class="header" href="#everdream-soft">Everdream Soft</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Everdream%20Soft.png" alt="img" style="zoom: 50%;" />
<p>Since 2014 is pinoneer in the integration and use of blockchain tools in the domain of gaming and digital collectibles.</p>
<h3 id="gamedao"><a class="header" href="#gamedao">GameDAO</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Gamedao.png" alt="img" style="zoom:20%;" />
<p>GameDAO is democratic and transparent crowdfunding for video game creators, publishers, investors and gamers.</p>
<h3 id="sensorium-corporation"><a class="header" href="#sensorium-corporation">Sensorium Corporation</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Sensorium%20Corporation.jpeg" alt="img" style="zoom:75%;" />
<p>Sensorium Galaxy leverages state-of-the-art blockchain technologies to make the future of content distribution safe for
both the public and artists.</p>
<h2 id="bridge-4"><a class="header" href="#bridge-4">Bridge: 4</a></h2>
<h2 id="infrastructure-39"><a class="header" href="#infrastructure-39">Infrastructure: 39</a></h2>
<h2 id="relay-chain-2"><a class="header" href="#relay-chain-2">Relay Chain: 2</a></h2>
<h2 id="nfts-1"><a class="header" href="#nfts-1">NFTs: 1</a></h2>
<h3 id="unique-network"><a class="header" href="#unique-network">Unique Network</a></h3>
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/Unique%20Network.png" alt="img" style="zoom: 250%;" />
<p>Unique Network is an infrastructure for the next generation NFTs, offering developers independence from network-wide
transaction fees and upgrades.</p>
<h2 id="参考资源-45"><a class="header" href="#参考资源-45">参考资源</a></h2>
<ul>
<li><a href="https://substrate.io/ecosystem/projects/">Projects | Substrate_</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="substrate惊奇资源"><a class="header" href="#substrate惊奇资源">Substrate惊奇资源</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#substrate%E6%83%8A%E5%A5%87%E8%B5%84%E6%BA%90">Substrate惊奇资源</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#resources">Resources</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#support">Support</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#social">Social</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#events">Events</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#blogs">Blogs</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#videos">Videos</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#templates">Templates</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#frame-pallets">FRAME Pallets</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#framework-extensions">Framework Extensions</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#client-libraries">Client Libraries</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#mobile">Mobile</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#tools">Tools</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#products-and-services">Products and Services</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#alternative-implementations">Alternative Implementations</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#scale-codec">SCALE Codec</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/substrate/awesome_substrate.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a></li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:35 UTC 2022 -->
<!--te-->
<h2 id="resources"><a class="header" href="#resources">Resources</a></h2>
<ul>
<li><a href="https://dotjobs.net/">DotJobs</a> - A job board for the Substrate and Polkadot ecosystem projects, maintained
by <a href="https://stateless.money/">Stateless.Money</a>.</li>
<li><a href="https://github.com/substrate-developer-hub/">Developer Hub GitHub</a> - Substrate Developer Hub repositories.</li>
<li><a href="https://substrate.io/ecosystem/projects/">Ecosystem Projects</a> - Projects and teams building with Substrate.</li>
<li><a href="https://github.com/w3f/Grants-Program/blob/master/docs/polkadot_stack.md">Polkadot Stack</a> - An <code>awesome list</code>
maintained by our friends at <a href="https://web3.foundation/">Web3 Foundation</a>.</li>
<li><a href="https://substrate.io/">Official Homepage</a> - Vision, ecosystem, opportunities, and much more.
<ul>
<li><a href="https://docs.substrate.io/">Docs</a> - Developer documentation.</li>
<li><a href="https://docs.substrate.io/tutorials">Tutorials</a> - Guided exercises to get you started.</li>
<li><a href="https://docs.substrate.io/how-to-guides">How-to guides</a> - Workflows outlined to achieve a specific goal.</li>
<li><a href="https://docs.substrate.io/rustdocs">Reference Docs</a> - Versioned API documentation.</li>
</ul>
</li>
<li>Technical Papers
<ul>
<li><a href="https://polkadot.network/Polkadot-lightpaper.pdf">Polkadot Lightpaper</a></li>
<li><a href="https://github.com/polkadot-io/polkadotpaper/raw/master/PolkaDotPaper.pdf">Polkadot: Vision for a heterogeneous multi-chain framework</a></li>
<li><a href="https://arxiv.org/abs/2005.13456.pdf">Overview of Polkadot and its Design Considerations</a>
<ul>
<li><a href="https://github.com/AmadeusGB/Overview-of-Polkadot">Chinese Translation</a> (by community)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="support"><a class="header" href="#support">Support</a></h2>
<ul>
<li><a href="https://substrate.io/ecosystem/substrate-builders-program/">Builders Program</a> - White-glove solutions and dedicated
support team for visionary teams using Substrate.</li>
<li><a href="https://substrate.stackexchange.com/">Stack Exchange</a> - The best place for all technical questions.</li>
<li><a href="https://web3.foundation/grants">Web3 Foundation Grants</a> - Funding for ecosystem development.</li>
</ul>
<h2 id="social"><a class="header" href="#social">Social</a></h2>
<ul>
<li><a href="https://t.me/substratedevs">Substrate Devs Chat (Telegram)</a> - Chat with other Substrate developers, also bridged
to <a href="https://matrix.to/#/#substratedevs:matrix.org">matrix</a>.</li>
<li><a href="https://twitter.com/substrate_io">Twitter</a> - Follow us to stay up-to-date.</li>
</ul>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<ul>
<li><a href="https://sub0.parity.io/">Sub0 Developer Conference</a> - Semiannual, online and in-person for all things Substrate.</li>
<li><a href="https://substrate.io/ecosystem/resources/seminar/">Substrate Seminar</a> - Bi-weekly collaborative learning sessions.</li>
</ul>
<h2 id="blogs"><a class="header" href="#blogs">Blogs</a></h2>
<ul>
<li><a href="https://dotleap.com/">DotLeap</a> - Polkadot and Substrate Community blog and newsletter.</li>
<li><a href="https://www.parity.io/blog/tag/parity-substrate">Official</a> - Published by Parity.</li>
</ul>
<h2 id="videos"><a class="header" href="#videos">Videos</a></h2>
<ul>
<li><a href="https://www.youtube.com/c/paritytech">Parity YouTube</a>
<ul>
<li><a href="https://www.youtube.com/playlist?list=PLp0_ueXY_enXRfoaW7sTudeQH10yDvFOS">Substrate Seminar (YouTube Archive)</a></li>
<li><a href="https://www.youtube.com/playlist?list=PLp0_ueXY_enUZk1RuEAU9ly5h0wy5FuLs">Sub0 Conference Oct. 2020</a></li>
<li><a href="https://www.youtube.com/playlist?list=PLp0_ueXY_enWZ4UZE7rM0hdT8Z_ZTjU5V">Sub0 Conference Dec. 2019</a></li>
<li><a href="https://www.youtube.com/playlist?list=PLp0_ueXY_enWqrfP_vR4PLhzQj76fLT8y">Sub0 Conference Apr. 2019</a></li>
</ul>
</li>
<li><a href="https://www.youtube.com/playlist?list=PLOyWqupZ-WGuAuS00rK-pebTMAOxW41W8">Polkadot Network Technical Explainers</a></li>
<li><a href="https://www.crowdcast.io/e/substrate-seminar-2/">Seminar Crowdcast</a> - Upcoming events and latest recordings.
<ul>
<li><a href="https://www.crowdcast.io/e/substrate-seminar/">Old Seminar Crowdcast</a> - Archive only.</li>
</ul>
</li>
<li><a href="https://www.youtube.com/watch?v=0IoUZdDi5Is">Substrate: A Rustic Vision for Polkadot by Gavin Wood at Web3 Summit 2018</a></li>
</ul>
<h2 id="templates"><a class="header" href="#templates">Templates</a></h2>
<ul>
<li><a href="https://github.com/substrate-developer-hub/substrate-node-template">Base</a> - Minimal FRAME-based node, derived
from <a href="https://github.com/paritytech/substrate/tree/master/bin/node-template">upstream</a>.</li>
<li><a href="https://github.com/paritytech/frontier/tree/master/template">Frontier</a> - Fronter enabled EVM and Ethereum RPC
compatible Substrate node, ready for hacking.</li>
<li><a href="https://github.com/substrate-developer-hub/substrate-front-end-template">Front-End</a> - Polkadot-JS API
and <a href="https://reactjs.org/">React</a> app to build front-ends for Substrate-based chains.</li>
<li><a href="https://github.com/substrate-developer-hub/substrate-parachain-template">Parachain</a> - Cumulus enabled Substrate node,
derived from <a href="https://github.com/paritytech/cumulus/tree/master/parachain-template">upstream</a>.</li>
<li><a href="https://github.com/kaichaosun/substrate-stencil"><code>substrate-stencil</code></a> - A template for a Substrate node that includes
staking and governance capabilities.</li>
</ul>
<h2 id="frame-pallets"><a class="header" href="#frame-pallets">FRAME Pallets</a></h2>
<ul>
<li><a href="https://github.com/smartcontractkit/chainlink-polkadot">Chainlink Feed Pallet</a> - Chainlink feed token interface.</li>
<li><a href="https://github.com/paritytech/substrate/tree/master/frame">Official in Substrate</a> - Large collection, Parity
maintained.</li>
<li><a href="https://github.com/open-web3-stack/open-runtime-module-library">Open Runtime Module Library (ORML)</a> - Community
maintained collection of Substrate runtime modules.</li>
<li><a href="https://github.com/sunshine-protocol/sunshine-bounty/tree/master/pallets">Sunshine Bounty</a> - Distributed autonomous
organization (DAO) for administering a bounty program.</li>
<li><a href="https://github.com/sunshine-protocol/sunshine-keybase/tree/master/identity/pallet">Sunshine Identity</a> -
Keybase-inspired identity management.</li>
<li><a href="https://github.com/sunshine-protocol/sunshine-keybase/tree/master/faucet/pallet">Sunshine Faucet</a> - Dispense
resources for a development chain.</li>
<li><a href="https://github.com/rmrk-team/rmrk-substrate">RMRK Pallets</a> - Nested, conditional &amp; Multi-resourced NFTs.</li>
</ul>
<h2 id="framework-extensions"><a class="header" href="#framework-extensions">Framework Extensions</a></h2>
<ul>
<li><a href="https://github.com/paritytech/parity-bridges-common">Bridges</a> - A collection of tools for cross-chain communication.</li>
<li><a href="https://github.com/paritytech/cumulus">Cumulus</a> - A set of tools for writing Substrate-based Polkadot parachains.</li>
<li><a href="https://docs.substrate.io/v3/runtime/frame/">FRAME</a> - A system for building Substrate runtimes.</li>
<li><a href="https://github.com/paritytech/frontier">Frontier</a> - End-to-end Ethereum emulation for Substrate chains.</li>
<li><a href="https://github.com/paritytech/ink">ink!</a> - Rust smart contract language for Substrate chains.</li>
<li><a href="https://book.integritee.network/">IntegriTEE</a> - Trusted off-chain execution framework that
uses <a href="https://en.wikipedia.org/wiki/Software_Guard_Extensions">Intel SGX</a> trusted execution environments.</li>
<li><a href="https://polkadot.js.org/">Polkadot-JS</a> - Rich JavaScript API framework for front-end development.</li>
</ul>
<h2 id="client-libraries"><a class="header" href="#client-libraries">Client Libraries</a></h2>
<ul>
<li><a href="https://github.com/usetech-llc/polkadot_api_dotnet">.Net API</a> - Maintained
by <a href="https://usetech.com/blockchain/">Usetech</a>.</li>
<li><a href="https://github.com/dotmog/SubstrateNetApi">.NET Standard API</a> - Used
in <a href="https://www.nuget.org/packages/SubstrateNetApi/">nuget</a>,
and <a href="https://github.com/darkfriend77/Unity3DExample">Unity 3D integration example</a>; Maintained
by <a href="https://dotmog.com/">DOTMog</a>.</li>
<li><a href="https://github.com/Aphoh/go-substrate-gen"><code>go-substrate-gen</code></a> - Generate go (de)serialization/client code from
substrate metadata.</li>
<li><a href="https://github.com/virto-network/sube"><code>sube</code></a> - Lightweight Rust client library and CLI with support for type
information.</li>
<li><a href="https://github.com/paritytech/substrate-subxt"><code>subxt</code></a> - Official Rust client.</li>
<li><a href="https://github.com/usetech-llc/polkadot_api_cpp">C++ API</a> - Maintained by Usetech.</li>
<li><a href="https://github.com/centrifuge/go-substrate-rpc-client/">Go RPC Client</a> - Maintained
by <a href="https://centrifuge.io/">Centrifuge</a>.</li>
<li><a href="https://github.com/NodleCode/substrate-client-kotlin">Kotlin Client</a> - Maintained
by <a href="https://github.com/NodleCode">Nodle.io</a>.</li>
<li><a href="https://github.com/polkadot-js/api/">Polkadot-JS API</a> - Semi-official JavaScript library for Substrate-based chains.</li>
<li><a href="https://github.com/polkascan/py-substrate-interface">Python Interface</a> - Maintained
by <a href="https://polkascan.org/">Polkascan Foundation</a>.</li>
<li><a href="https://github.com/scs/substrate-api-client">Rust API Client</a> - Rust client maintained
by <a href="https://www.scs.ch/">Supercomputing Systems AG</a>.</li>
<li><a href="https://github.com/itering/subscan-essentials">Subscan Go Utilities</a> - SS58 and more, developed by Subscan.</li>
</ul>
<h2 id="mobile"><a class="header" href="#mobile">Mobile</a></h2>
<ul>
<li><a href="https://github.com/soramitsu/fearless-utils-Android">Fearless Utils Android</a> - Android Substrate tools.</li>
<li><a href="https://github.com/soramitsu/fearless-utils-iOS">Fearless Utils iOS</a> - iOS Substrate tools.</li>
<li><a href="https://github.com/Pocket4D/Polkadot-Dart">Polkadot-Dart</a> - Dart Substrate API.</li>
<li><a href="https://github.com/polkawallet-io/sdk">PolkaWallet SDK</a> - Flutter SDK for Substrate-based App.</li>
<li><a href="https://github.com/paritytech/react-native-substrate-sign">React-Native-Substrate-Sign</a> - Rust library for React
Native.</li>
</ul>
<h2 id="tools"><a class="header" href="#tools">Tools</a></h2>
<p><a href="https://github.com/paritytech/substrate-debug-kit/tree/master/offline-election"><code>offline-election</code></a>, which is a tool
that is used to predict nominated proof-of-stake elections.</p>
<ul>
<li><a href="https://rs-ipfs.github.io/offchain-ipfs-manual/"><code>offchain::ipfs</code></a> - Substrate infused with <a href="https://ipfs.io/">IPFS</a>.</li>
<li><a href="https://github.com/shawntabrizi/polkadot-js-bundle"><code>polkadot-js-bundle</code></a> - A standalone JS bundle that contains
Polkadot{JS} libraries.</li>
<li><a href="https://github.com/shawntabrizi/polkadot-launch"><code>polkadot-launch</code></a> - Simple CLI tool to launch a local Polkadot test
network.</li>
<li><a href="https://github.com/paritytech/polkadot-runtime-prom-exporter/"><code>polkadot-runtime-prom-exporter</code></a> -
A <a href="https://prometheus.io/">Prometheus</a> exporter for Polkadot runtime metrics (modifiable for Substrate use).</li>
<li><a href="https://github.com/paritytech/polkadot-scripts"><code>polkadot-scripts</code></a> - A collection of scripts Parity uses to diagnose
Polkadot/Kusama.</li>
<li><a href="https://github.com/koute/polkadot-starship"><code>polkadot-starship</code></a> - Another tool to launch a local Polkadot test
network, with emphasis on the ability to run big testnets.</li>
<li><a href="https://github.com/chevdor/srtool-actions"><code>srtool-actions</code></a> - GitHub actions to easily use the <code>srtool</code> Docker image
to build your own runtime.</li>
<li><a href="https://github.com/chevdor/srtool-cli"><code>srtool-cli</code></a> - CLI frontend for the <code>srtool</code> Docker image.</li>
<li><a href="https://github.com/paritytech/srtool"><code>srtool</code></a> - Docker image to deterministically build a runtime.</li>
<li><a href="https://github.com/ascjones/subsee"><code>subsee</code></a> - CLI to inspect metadata of a Substrate node as JSON.</li>
<li><a href="https://github.com/shawntabrizi/substrate-balance-calculator"><code>substrate-balance-calculator</code></a> - Breakdown the
balances of your Substrate account.</li>
<li><a href="https://github.com/shawntabrizi/substrate-balance-graph"><code>substrate-balance-graph</code></a> - Create a graph of the token
balance over time of a Substrate address.</li>
<li><a href="https://github.com/shawntabrizi/substrate-graph-benchmarks"><code>substrate-graph-benchmarks</code></a> - Graph the benchmark
output of FRAME pallets.</li>
<li><a href="https://github.com/shawntabrizi/substrate-js-utilities"><code>substrate-js-utils</code></a> - A set of useful JavaScript utilities
for Substrate that uses the Polkadot{JS} API;
Also <a href="https://www.shawntabrizi.com/substrate-js-utilities/">deployed as a website</a>.</li>
<li><a href="https://github.com/shawntabrizi/substrate-society"><code>substrate-society</code></a> - A basic front-end for the FRAME Society
pallet.</li>
<li><a href="https://github.com/shawntabrizi/substrate-toml-lint"><code>substrate-toml-lint</code></a> - A toml parser and checker to avoid
common errors in Substrate projects.</li>
<li><a href="https://github.com/chevdor/subwasm"><code>subwasm</code></a> - CLI to inspect a runtime WASM blob offline. It shows information,
metadata and can compare runtimes. It can also help you fetch a runtime directly from a node.</li>
<li><a href="https://github.com/clearloop/sup"><code>sup</code></a> - Command line tool for generating or upgrading a Substrate node.</li>
<li><a href="https://aleph.im">Aleph.im</a> - Scalable, decentralized database, file storage, and computation services for Substrate
chains and more.</li>
<li><a href="https://github.com/paritytech/substrate-archive">Archive</a> - Indexing engine for Substrate chains.</li>
<li><a href="https://github.com/danforbes/substrate-devhub-utils">Dev Hub Utils</a> - <em>Unofficial</em> utilities for working with
official Substrate Developer Hub resources.</li>
<li><a href="https://github.com/patractlabs/europa">Europa</a> - A sandbox for the Substrate runtime execution environment.</li>
<li><a href="https://github.com/maxsam4/fork-off-substrate">Fork Off Substrate</a> - Script to help bootstrap a new chain with the
state of a running chain.</li>
<li><a href="https://github.com/centrifuge/fudge">fudge</a> - Core lib for accessing and (arbitrarily) manipulating substrate
databases, including the building and importing of local blocks.</li>
<li><a href="https://github.com/gantree-io/gantree-lib-nodejs">Gantree Library</a> - A suite of technologies for managing
Substrate-powered parachain networks via rapid spin-up &amp; tear-down.</li>
<li><a href="https://github.com/halva-suite/halva">Halva</a> - A toolchain for improving the experience of developing on Substrate.</li>
<li><a href="https://github.com/Joystream/hydra">Hydra</a> - A GraphQL framework for Substrate nodes.</li>
<li><a href="https://github.com/patractlabs/jupiter">Jupiter</a> - Testnet for smart contracts written for the FRAME Contracts pallet
and ink!.</li>
<li><a href="https://github.com/patractlabs/megaclite">Megaclite</a> - Zero-knowledge tools for the Polkadot ecosystem.</li>
<li><a href="https://www.parity.io/signer/">Parity Signer</a> - Upcycle an unused mobile phone into an air-gapped hardware wallet.</li>
<li><a href="https://github.com/SimplyVC/panic_polkadot">Polkadot PANIC</a> - Monitoring and alerting solution for Polkadot nodes by
Simply VC, compatible with many Substrate chains.</li>
<li><a href="https://wiki.polkadot.network/docs/build-tools-index">Polkadot Tool Index</a> - List of tools available for your
development with Polkadot and any Substrate chain including Block Explorers, Wallets, Network Monitoring &amp; Reporting,
Clients, Benchmarking, Fuzzing, Forking, SCALE Codec, CLI Tools and much more.</li>
<li><a href="https://polkadot.js.org/apps/">Polkadot-JS Apps UI</a> - Semi-official block explorer &amp; front-end for Substrate-based
chains.</li>
<li><a href="https://github.com/polkadot-js/extension">Polkadot-JS Extension</a> - Browser extension for interacting with
Substrate-based chains.</li>
<li><a href="https://polkascan.io/">Polkascan</a> - Multi-chain block explorer maintained by Polkascan Foundation.</li>
<li><a href="https://github.com/emostov/proxy-hot-wallet">Proxy Hot Wallet Demo</a> - A demonstration of a secure, convenient, and
flexible hot wallet architecture built on Substrate primitives.</li>
<li><a href="https://github.com/patractlabs/redspot">Redspot</a> - A <a href="https://www.trufflesuite.com/truffle">Truffle</a>-like toolkit for
smart contracts for the FRAME Contracts pallet and ink!.</li>
<li><a href="https://github.com/paritytech/substrate-api-sidecar">Sidecar</a> - REST service that runs alongside Substrate nodes.</li>
<li><a href="https://polkadot.subscan.io/tools/ss58_transform">SS58 Transform</a> - Display key's addressees with all SS58 prefixes.</li>
<li><a href="https://github.com/w3f/staking-rewards-collector">Staking Rewards Collector</a> - A script to parse and output staking
rewards for a given Kusama or Polkadot address and cross-reference them with daily price data.</li>
<li><a href="https://substrate.dev/docs/en/knowledgebase/integrate/subkey">Subkey</a> - Command line utility for working with
cryptographic keys.</li>
<li><a href="https://subquery.network">SubQuery</a> - A GraphQL indexer and query service that allows users to easily create indexed
data sources and host them online for free.</li>
<li><a href="https://www.subscan.io/">Subscan</a> - Multi-network explorer for Substrate-based chains.</li>
<li><a href="https://subsquid.io">Subsquid</a> - An indexing framework (SDK + infrastructure) to quickly and easily turn Substrate
and EVM on-chain data into APIs and host them.</li>
<li><a href="https://github.com/arrudagates/substate">Substate</a> - 100% no-std/wasm compatible Substrate storage key generator
library for Rust.</li>
<li><a href="https://github.com/paritytech/substrate-debug-kit">Substrate debug-kit</a> - A collection of tools and libraries for
debugging Substrate-based chains.</li>
<li><a href="https://github.com/ETeissonniere/substrate-nodeops">Substrate Docker Builders</a> - A set of Dockerfiles and GitHub
Actions to auto-build and push a Docker image for Substrate-based chains.</li>
<li><a href="https://github.com/starkleytech/substrate-faucet">Substrate Faucet Bot</a> - Python-based faucet for development
purposes.</li>
<li><a href="https://github.com/playzero/substrate-graph">Substrate Graph</a> - GraphQL indexer for Substrate-based chains.</li>
<li><a href="https://github.com/paritytech/txwrapper">TxWrapper</a> - Helpful library for offline transaction creation.</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=paritytech.vscode-substrate">VSCode Substrate</a> - Plugin for
Visual Studio Code.</li>
</ul>
<h2 id="products-and-services"><a class="header" href="#products-and-services">Products and Services</a></h2>
<ul>
<li><a href="https://onfinality.io">OnFinality</a> - Free and paid services to shared Substrate based nodes.</li>
</ul>
<h2 id="alternative-implementations"><a class="header" href="#alternative-implementations">Alternative Implementations</a></h2>
<ul>
<li><a href="https://github.com/ChainSafe/gossamer">Gossamer</a> - A Polkadot client implemented in Go;
from <a href="https://chainsafe.io/">ChainSafe</a>.</li>
<li><a href="https://kagome.readthedocs.io/en/latest/">Kagome</a> - A C++17 implementation of the Polkadot client;
from <a href="http://www.soramitsu.co.jp/">Soramitsu</a>.</li>
<li><a href="https://github.com/LimeChain/as-substrate-runtime">LimeChain AssemblyScript Runtime</a> - An account-based Substrate
proof-of-concept runtime written in AssemblyScript; from <a href="https://limechain.tech/">LimeChain</a>.</li>
</ul>
<h2 id="scale-codec"><a class="header" href="#scale-codec">SCALE Codec</a></h2>
<ul>
<li><a href="https://github.com/LimeChain/as-scale-codec">AssemblyScript</a> - Maintained by LimeChain.</li>
<li><a href="https://github.com/MatthewDarnell/cScale">C</a> - Maintained by Matthew Darnell.</li>
<li><a href="https://github.com/soramitsu/scale-codec-cpp">C++</a> - Maintained by Soramitsu.</li>
<li><a href="https://docs.substrate.io/v3/advanced/scale-codec/">Codec Definition</a> - Official codec documentation.</li>
<li><a href="https://github.com/itering/scale.go">Go</a> - Maintained by <a href="https://www.itering.com/">Itering</a>.</li>
<li><a href="https://github.com/airalab/hs-web3/tree/master/src/Codec">Haskell</a> - Maintained
by <a href="https://robonomics.network/">Robonomics Network</a>.</li>
<li><a href="https://github.com/emeraldpay/polkaj/tree/master/polkaj-scale">Java</a> - Maintained by <a href="https://emerald.cash/">Emerald</a>
.</li>
<li><a href="https://github.com/paritytech/parity-scale-codec">Parity SCALE Codec</a> - Reference implementation written in Rust.</li>
<li><a href="https://github.com/polkascan/py-scale-codec">Python</a> - Maintained by Polkascan Foundation.</li>
<li><a href="https://github.com/itering/scale.rb">Ruby</a> - Maintained by Itering.</li>
<li><a href="https://github.com/virto-network/scales">Scales</a> - Serializing SCALE using type information from a type registry.</li>
<li>JavaScript / TypeScript implementations:
<ul>
<li><a href="https://github.com/paritytech/parity-scale-codec-ts">paritytech/parity-scale-codec-ts</a> - Maintained by Parity
Technologies.</li>
<li><a href="https://github.com/polkadot-js/api/tree/master/packages/types">polkadot-js/api</a> - Maintained by Polkadot-JS.</li>
<li><a href="https://github.com/unstoppablejs/unstoppablejs/tree/main/packages/scale-ts#scale-ts">scale-ts</a> - Maintained by
Josep M Sobrepere.</li>
<li><a href="https://github.com/soramitsu/scale-codec-js-library">soramitsu/scale-codec-js-library</a> - Maintained by Soramitsu.</li>
</ul>
</li>
</ul>
<h2 id="参考资源-46"><a class="header" href="#参考资源-46">参考资源</a></h2>
<ul>
<li><a href="https://github.com/substrate-developer-hub/awesome-substrate/blob/master/README.md">awesome-substrate/README.md at master · substrate-developer-hub/awesome-substrate</a>
<blockquote>
<p>an awesome list is a list of awesome things curated by the Substrate community.</p>
</blockquote>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nervosckb"><a class="header" href="#nervosckb">nervos/ckb</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/nervos_ckb_anatomy.html#nervosckb">nervos/ckb</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/nervos_ckb_anatomy.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/nervos_ckb_anatomy.html#online-book">online-book</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/nervos_ckb_anatomy.html#fragment">fragment</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/nervos_ckb_anatomy.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:34 UTC 2022 -->
<!--te-->
<h2 id="参考资源-47"><a class="header" href="#参考资源-47">参考资源</a></h2>
<h3 id="online-book-40"><a class="header" href="#online-book-40">online-book</a></h3>
<ul>
<li><a href="https://github.com/nervosnetwork/ckb">nervosnetwork/ckb: The Nervos CKB is a public permissionless blockchain, and the layer 1 of Nervos network.</a></li>
</ul>
<h3 id="fragment-40"><a class="header" href="#fragment-40">fragment</a></h3>
<h3 id="local-40"><a class="header" href="#local-40">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="solana"><a class="header" href="#solana">Solana</a></h1>
<!--ts-->
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/solana.html#solana">Solana</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/solana.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90">参考资源</a>
<ul>
<li><a href="layer5_ecosystem/7_business/blockchain/solana.html#online-book">online-book</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/solana.html#fragment">fragment</a></li>
<li><a href="layer5_ecosystem/7_business/blockchain/solana.html#local">local</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Tue Jul 12 07:54:34 UTC 2022 -->
<!--te-->
<h2 id="参考资源-48"><a class="header" href="#参考资源-48">参考资源</a></h2>
<h3 id="online-book-41"><a class="header" href="#online-book-41">online-book</a></h3>
<ul>
<li><a href="https://github.com/solana-labs/solana">solana-labs/solana: Web-Scale Blockchain for fast, secure, scalable, decentralized apps and marketplaces.</a></li>
</ul>
<h3 id="fragment-41"><a class="header" href="#fragment-41">fragment</a></h3>
<h3 id="local-41"><a class="header" href="#local-41">local</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="生产实践"><a class="header" href="#生产实践">生产实践</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="优秀产品"><a class="header" href="#优秀产品">优秀产品</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="基础库"><a class="header" href="#基础库">基础库</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="框架引擎"><a class="header" href="#框架引擎">框架引擎</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="checklist"><a class="header" href="#checklist">Checklist</a></h1>

            </main>

            <!--            <script src="https://utteranc.es/client.js"-->
            <!--                    repo="RustMagazine/rust_magazine_2022"-->
            <!--                    issue-term="title"-->
            <!--                    theme="github-light"-->
            <!--                    crossorigin="anonymous"-->
            <!--                    async></script>-->

            <nav class="nav-wrapper" aria-label="Page navigation">
                <!-- Mobile navigation buttons -->


                <div style="clear: both"></div>
            </nav>
        </div>
    </div>

    <nav class="nav-wide-wrapper" aria-label="Page navigation">

    </nav>

</div>




    <script type="text/javascript">
        window.playground_copyable = true;
    </script>

    <script src="ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

    <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

<script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
<script src="highlight.js" type="text/javascript" charset="utf-8"></script>
<script src="book.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JS scripts -->
    <script type="text/javascript" src="assets/mermaid/mermaid.min.js"></script>
    <script type="text/javascript" src="assets/mermaid/mermaid-init.js"></script>
    <script type="text/javascript" src="assets/smart-anchor.js"></script>
    <script type="text/javascript" src="assets/pagetoc/sidebar.js"></script>

        <script type="text/javascript">
            window.addEventListener('load', function () {
                MathJax.Hub.Register.StartupHook('End', function () {
                    window.setTimeout(window.print, 100);
                });
            });
        </script>
</body>
</html>
